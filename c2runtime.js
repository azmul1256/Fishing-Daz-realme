// Generated by Construct 3, the game and app creator :: https://www.construct.net
'use strict';var cr=window.cr={};cr.plugins_={};cr.behaviors={};"function"!==typeof Object.getPrototypeOf&&(Object.getPrototypeOf="object"===typeof"test".__proto__?function(b){return b.__proto__}:function(b){return b.constructor.prototype});
(function(){function b(g,z){this.x=g;this.y=z;cr.seal(this)}function d(g,z,J,N){this.set(g,z,J,N);cr.seal(this)}function h(){this.bly=this.blx=this.bry=this.brx=this.try_=this.trx=this.tly=this.tlx=0;cr.seal(this)}function q(g,z,J,N){g<z?J<N?(F=g<J?g:J,C=z>N?z:N):(F=g<N?g:N,C=z>J?z:J):J<N?(F=z<J?z:J,C=g>N?g:N):(F=z<N?z:N,C=g>J?g:J)}function y(){this.items=this.s=null;this.item_count=0;D&&(this.s=new Set);this.values_cache=[];this.cache_valid=!0;cr.seal(this)}function A(g){S[V++]=g}function e(){this.sum=
this.t=this.y=this.c=0;cr.seal(this)}function a(g,z){g||(g=[0,0,1,0,1,1,0,1]);this.pts_cache=[];this.bboxBottom=this.bboxRight=this.bboxTop=this.bboxLeft=0;this.convexpolys=null;this.enabled="undefined"===typeof z?!0:z;this.set_pts(g);cr.seal(this)}function c(g,z){this.cellwidth=g;this.cellheight=z;this.cells={}}function m(g,z){this.cellwidth=g;this.cellheight=z;this.cells={}}function u(g,z,J){c.prototype.totalCellCount++;if(f.length){var N=f.pop();N.grid=g;N.x=z;N.y=J;return N}return new cr.GridCell(g,
z,J)}function p(g,z,J){this.grid=g;this.x=z;this.y=J;this.objects=new cr.ObjectSet}function x(g,z,J){m.prototype.totalCellCount++;if(n.length){var N=n.pop();N.grid=g;N.x=z;N.y=J;return N}return new cr.RenderCell(g,z,J)}function M(g,z,J){this.grid=g;this.x=z;this.y=J;this.objects=[];this.is_sorted=!0;this.pending_removal=new cr.ObjectSet;this.any_pending_removal=!1}function v(g,z){return g.zindex-z.zindex}cr.logexport=function(g){window.console&&window.console.log&&window.console.log(g)};cr.logerror=
function(g){window.console&&window.console.error&&window.console.error(g)};cr.seal=function(g){return g};cr.freeze=function(g){return g};cr.is_undefined=function(g){return"undefined"===typeof g};cr.is_number=function(g){return"number"===typeof g};cr.is_string=function(g){return"string"===typeof g};cr.isPOT=function(g){return 0<g&&0===(g-1&g)};cr.nextHighestPowerOfTwo=function(g){--g;for(var z=1;32>z;z<<=1)g|=g>>z;return g+1};cr.abs=function(g){return 0>g?-g:g};cr.max=function(g,z){return g>z?g:z};
cr.min=function(g,z){return g<z?g:z};cr.PI=Math.PI;cr.round=function(g){return g+.5|0};cr.floor=function(g){return 0<=g?g|0:(g|0)-1};cr.ceil=function(g){var z=g|0;return z===g?z:z+1};b.prototype.offset=function(g,z){this.x+=g;this.y+=z;return this};b.prototype.mul=function(g,z){this.x*=g;this.y*=z;return this};cr.vector2=b;cr.segments_intersect=function(g,z,J,N,U,W,X,Y){if(g<J){var ea=g;var ha=J}else ea=J,ha=g;if(U<X){var k=U;var r=X}else k=X,r=U;if(ha<k||ea>r)return!1;z<N?(ea=z,ha=N):(ea=N,ha=z);
W<Y?(k=W,r=Y):(k=Y,r=W);if(ha<k||ea>r)return!1;ha=U-g+X-J;ea=W-z+Y-N;g=J-g;z=N-z;U=X-U;W=Y-W;Y=cr.abs(z*U-W*g);return cr.abs(U*ea-W*ha)>Y?!1:cr.abs(g*ea-z*ha)<=Y};d.prototype.set=function(g,z,J,N){this.left=g;this.top=z;this.right=J;this.bottom=N};d.prototype.copy=function(g){this.left=g.left;this.top=g.top;this.right=g.right;this.bottom=g.bottom};d.prototype.width=function(){return this.right-this.left};d.prototype.height=function(){return this.bottom-this.top};d.prototype.offset=function(g,z){this.left+=
g;this.top+=z;this.right+=g;this.bottom+=z;return this};d.prototype.normalize=function(){if(this.left>this.right){var g=this.left;this.left=this.right;this.right=g}this.top>this.bottom&&(g=this.top,this.top=this.bottom,this.bottom=g)};d.prototype.intersects_rect=function(g){return!(g.right<this.left||g.bottom<this.top||g.left>this.right||g.top>this.bottom)};d.prototype.intersects_rect_off=function(g,z,J){return!(g.right+z<this.left||g.bottom+J<this.top||g.left+z>this.right||g.top+J>this.bottom)};
d.prototype.contains_pt=function(g,z){return g>=this.left&&g<=this.right&&z>=this.top&&z<=this.bottom};d.prototype.equals=function(g){return this.left===g.left&&this.top===g.top&&this.right===g.right&&this.bottom===g.bottom};cr.rect=d;h.prototype.set_from_rect=function(g){this.tlx=g.left;this.tly=g.top;this.trx=g.right;this.try_=g.top;this.brx=g.right;this.bry=g.bottom;this.blx=g.left;this.bly=g.bottom};h.prototype.set_from_rotated_rect=function(g,z){if(0===z)this.set_from_rect(g);else{var J=Math.sin(z),
N=Math.cos(z);z=g.left*J;var U=g.top*J,W=g.right*J;J*=g.bottom;var X=g.left*N,Y=g.top*N,ea=g.right*N;g=g.bottom*N;this.tlx=X-U;this.tly=Y+z;this.trx=ea-U;this.try_=Y+W;this.brx=ea-J;this.bry=g+W;this.blx=X-J;this.bly=g+z}};h.prototype.offset=function(g,z){this.tlx+=g;this.tly+=z;this.trx+=g;this.try_+=z;this.brx+=g;this.bry+=z;this.blx+=g;this.bly+=z;return this};var F=0,C=0;h.prototype.bounding_box=function(g){q(this.tlx,this.trx,this.brx,this.blx);g.left=F;g.right=C;q(this.tly,this.try_,this.bry,
this.bly);g.top=F;g.bottom=C};h.prototype.contains_pt=function(g,z){var J=this.tlx,N=this.tly,U=this.trx-J,W=this.try_-N,X=this.brx-J,Y=this.bry-N;g-=J;z-=N;var ea=U*U+W*W,ha=U*X+W*Y;W=U*g+W*z;var k=X*X+Y*Y,r=X*g+Y*z,E=1/(ea*k-ha*ha);U=(k*W-ha*r)*E;ea=(ea*r-ha*W)*E;if(0<=U&&0<ea&&1>U+ea)return!0;U=this.blx-J;W=this.bly-N;ea=U*U+W*W;ha=U*X+W*Y;W=U*g+W*z;E=1/(ea*k-ha*ha);U=(k*W-ha*r)*E;ea=(ea*r-ha*W)*E;return 0<=U&&0<ea&&1>U+ea};h.prototype.at=function(g,z){if(z)switch(g){case 0:return this.tlx;case 1:return this.trx;
case 2:return this.brx;case 3:return this.blx;case 4:return this.tlx;default:return this.tlx}else switch(g){case 0:return this.tly;case 1:return this.try_;case 2:return this.bry;case 3:return this.bly;case 4:return this.tly;default:return this.tly}};h.prototype.midX=function(){return(this.tlx+this.trx+this.brx+this.blx)/4};h.prototype.midY=function(){return(this.tly+this.try_+this.bry+this.bly)/4};h.prototype.intersects_segment=function(g,z,J,N){if(this.contains_pt(g,z)||this.contains_pt(J,N))return!0;
var U;for(U=0;4>U;U++){var W=this.at(U,!0);var X=this.at(U,!1);var Y=this.at(U+1,!0);var ea=this.at(U+1,!1);if(cr.segments_intersect(g,z,J,N,W,X,Y,ea))return!0}return!1};h.prototype.intersects_quad=function(g){var z=g.midX(),J=g.midY();if(this.contains_pt(z,J))return!0;z=this.midX();J=this.midY();if(g.contains_pt(z,J))return!0;var N,U;for(N=0;4>N;N++)for(U=0;4>U;U++){z=this.at(N,!0);J=this.at(N,!1);var W=this.at(N+1,!0);var X=this.at(N+1,!1);var Y=g.at(U,!0);var ea=g.at(U,!1);var ha=g.at(U+1,!0);
var k=g.at(U+1,!1);if(cr.segments_intersect(z,J,W,X,Y,ea,ha,k))return!0}return!1};cr.quad=h;cr.RGB=function(g,z,J){return Math.max(Math.min(g,255),0)|Math.max(Math.min(z,255),0)<<8|Math.max(Math.min(J,255),0)<<16};cr.RGBAEx=function(g,z,J,N){g=cr.clamp(Math.floor(1024*g),-8192,8191);z=cr.clamp(Math.floor(1024*z),-8192,8191);J=cr.clamp(Math.floor(1024*J),-8192,8191);N=cr.clamp(Math.floor(1024*N),0,1024);0>g&&(g+=16384);0>z&&(z+=16384);0>J&&(J+=16384);return-(274877906944*g+16777216*z+1024*J+N)};cr.RGBEx=
function(g,z,J){return cr.RGBAEx(g,z,J,1)};cr.GetRValue=function(g){if(0<=g)return(g&255)/255;g=Math.floor(-g/274877906944);8191<g&&(g-=16384);return g/1024};cr.GetGValue=function(g){if(0<=g)return((g&65280)>>8)/255;g=Math.floor(-g%274877906944/16777216);8191<g&&(g-=16384);return g/1024};cr.GetBValue=function(g){if(0<=g)return((g&16711680)>>16)/255;g=Math.floor(-g%16777216/1024);8191<g&&(g-=16384);return g/1024};cr.GetAValue=function(g){return 0===g&&0>1/g?0:0<=g?1:Math.floor(-g%1024)/1024};cr.shallowCopy=
function(g,z,J){for(var N in z)z.hasOwnProperty(N)&&(g[N]=z[N]);return g};cr.arrayRemove=function(g,z){var J;z=cr.floor(z);if(!(0>z||z>=g.length)){for(J=g.length-1;z<J;z++)g[z]=g[z+1];cr.truncateArray(g,J)}};cr.truncateArray=function(g,z){g.length=z};cr.clearArray=function(g){cr.truncateArray(g,0)};cr.shallowAssignArray=function(g,z){cr.clearArray(g);var J;var N=0;for(J=z.length;N<J;++N)g[N]=z[N]};cr.appendArray=function(g,z){g.push.apply(g,z)};cr.fastIndexOf=function(g,z){var J;var N=0;for(J=g.length;N<
J;++N)if(g[N]===z)return N;return-1};cr.arrayFindRemove=function(g,z){z=cr.fastIndexOf(g,z);-1!==z&&cr.arrayRemove(g,z)};cr.clamp=function(g,z,J){return g<z?z:g>J?J:g};cr.to_radians=function(g){return g/(180/cr.PI)};cr.to_degrees=function(g){return 180/cr.PI*g};cr.clamp_angle_degrees=function(g){g%=360;0>g&&(g+=360);return g};cr.clamp_angle=function(g){g%=2*cr.PI;0>g&&(g+=2*cr.PI);return g};cr.to_clamped_degrees=function(g){return cr.clamp_angle_degrees(cr.to_degrees(g))};cr.to_clamped_radians=function(g){return cr.clamp_angle(cr.to_radians(g))};
cr.angleTo=function(g,z,J,N){return Math.atan2(N-z,J-g)};cr.angleDiff=function(g,z){if(g===z)return 0;g=Math.sin(g)*Math.sin(z)+Math.cos(g)*Math.cos(z);return 1<=g?0:-1>=g?cr.PI:Math.acos(g)};cr.angleRotate=function(g,z,J){var N=Math.sin(g),U=Math.cos(g),W=Math.sin(z),X=Math.cos(z);return Math.acos(N*W+U*X)>J?0<U*W-N*X?cr.clamp_angle(g+J):cr.clamp_angle(g-J):cr.clamp_angle(z)};cr.angleClockwise=function(g,z){return 0>=Math.cos(g)*Math.sin(z)-Math.sin(g)*Math.cos(z)};cr.rotatePtAround=function(g,z,
J,N,U,W){if(0===J)return W?g:z;var X=Math.sin(J);J=Math.cos(J);g-=N;z-=U;var Y=g*X;g=g*J-z*X;return W?g+N:z*J+Y+U};cr.distanceTo=function(g,z,J,N){g=J-g;z=N-z;return Math.sqrt(g*g+z*z)};cr.xor=function(g,z){return!g!==!z};cr.lerp=function(g,z,J){return g+(z-g)*J};cr.unlerp=function(g,z,J){return g===z?0:(J-g)/(z-g)};cr.anglelerp=function(g,z,J){var N=cr.angleDiff(g,z);return cr.angleClockwise(z,g)?g+N*J:g-N*J};cr.qarp=function(g,z,J,N){return cr.lerp(cr.lerp(g,z,N),cr.lerp(z,J,N),N)};cr.cubic=function(g,
z,J,N,U){return cr.lerp(cr.qarp(g,z,J,U),cr.qarp(z,J,N,U),U)};cr.cosp=function(g,z,J){return(g+z+(g-z)*Math.cos(J*Math.PI))/2};cr.hasAnyOwnProperty=function(g){for(var z in g)if(g.hasOwnProperty(z))return!0;return!1};cr.wipe=function(g){for(var z in g)g.hasOwnProperty(z)&&delete g[z]};var l=+new Date;cr.performance_now=function(){if("undefined"!==typeof window.performance){var g=window.performance;if("undefined"!==typeof g.now)return g.now();if("undefined"!==typeof g.webkitNow)return g.webkitNow();
if("undefined"!==typeof g.mozNow)return g.mozNow();if("undefined"!==typeof g.msNow)return g.msNow()}return Date.now()-l};var t=!1;"undefined"!==typeof window&&(t=/chrome/i.test(navigator.userAgent)||/chromium/i.test(navigator.userAgent),!t&&/safari/i.test(navigator.userAgent),/(iphone|ipod|ipad)/i.test(navigator.userAgent));var D="undefined"!==typeof Set&&"undefined"!==typeof Set.prototype.forEach;y.prototype.contains=function(g){return this.isEmpty()?!1:D?this.s.has(g):this.items&&this.items.hasOwnProperty(g)};
y.prototype.add=function(g){if(D)this.s.has(g)||(this.s.add(g),this.cache_valid=!1);else{var z=g.toString(),J=this.items;J?J.hasOwnProperty(z)||(J[z]=g,this.item_count++,this.cache_valid=!1):(this.items={},this.items[z]=g,this.item_count=1,this.cache_valid=!1)}};y.prototype.remove=function(g){if(!this.isEmpty())if(D)this.s.has(g)&&(this.s["delete"](g),this.cache_valid=!1);else if(this.items){g=g.toString();var z=this.items;z.hasOwnProperty(g)&&(delete z[g],this.item_count--,this.cache_valid=!1)}};
y.prototype.clear=function(){this.isEmpty()||(D?this.s.clear():(this.items=null,this.item_count=0),cr.clearArray(this.values_cache),this.cache_valid=!0)};y.prototype.isEmpty=function(){return 0===this.count()};y.prototype.count=function(){return D?this.s.size:this.item_count};var S=null,V=0;y.prototype.update_cache=function(){if(!this.cache_valid){if(D)cr.clearArray(this.values_cache),S=this.values_cache,V=0,this.s.forEach(A),S=null,V=0;else{var g=this.values_cache;cr.clearArray(g);var z,J=0,N=this.items;
if(N)for(z in N)N.hasOwnProperty(z)&&(g[J++]=N[z])}this.cache_valid=!0}};y.prototype.valuesRef=function(){this.update_cache();return this.values_cache};cr.ObjectSet=y;var K=new cr.ObjectSet;cr.removeArrayDuplicates=function(g){var z;var J=0;for(z=g.length;J<z;++J)K.add(g[J]);cr.shallowAssignArray(g,K.valuesRef());K.clear()};cr.arrayRemoveAllFromObjectSet=function(g,z){D?cr.arrayRemoveAll_set(g,z.s):cr.arrayRemoveAll_arr(g,z.valuesRef())};cr.arrayRemoveAll_set=function(g,z){var J,N;var U=J=0;for(N=
g.length;J<N;++J){var W=g[J];z.has(W)||(g[U++]=W)}cr.truncateArray(g,U)};cr.arrayRemoveAll_arr=function(g,z){var J,N;var U=J=0;for(N=g.length;J<N;++J){var W=g[J];-1===cr.fastIndexOf(z,W)&&(g[U++]=W)}cr.truncateArray(g,U)};e.prototype.add=function(g){this.y=g-this.c;this.t=this.sum+this.y;this.c=this.t-this.sum-this.y;this.sum=this.t};e.prototype.reset=function(){this.sum=this.t=this.y=this.c=0};cr.KahanAdder=e;cr.regexp_escape=function(g){return g.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")};a.prototype.set_pts=
function(g){this.pts_array=g;this.pts_count=g.length/2;this.pts_cache.length=g.length;this.cache_height=this.cache_width=-1;this.cache_angle=0};a.prototype.is_empty=function(){return!this.pts_array.length};a.prototype.update_bbox=function(){for(var g=this.pts_cache,z=g[0],J=z,N=g[1],U=N,W,X,Y=1,ea=this.pts_count;Y<ea;++Y)X=2*Y,W=g[X],X=g[X+1],W<z&&(z=W),W>J&&(J=W),X<N&&(N=X),X>U&&(U=X);this.bboxLeft=z;this.bboxRight=J;this.bboxTop=N;this.bboxBottom=U};a.prototype.set_from_rect=function(g,z,J){this.pts_cache.length=
8;this.pts_count=4;var N=this.pts_cache;N[0]=g.left-z;N[1]=g.top-J;N[2]=g.right-z;N[3]=g.top-J;N[4]=g.right-z;N[5]=g.bottom-J;N[6]=g.left-z;N[7]=g.bottom-J;this.cache_width=g.right-g.left;this.cache_height=g.bottom-g.top;this.update_bbox()};a.prototype.set_from_quad=function(g,z,J,N,U){this.pts_cache.length=8;this.pts_count=4;var W=this.pts_cache;W[0]=g.tlx-z;W[1]=g.tly-J;W[2]=g.trx-z;W[3]=g.try_-J;W[4]=g.brx-z;W[5]=g.bry-J;W[6]=g.blx-z;W[7]=g.bly-J;this.cache_width=N;this.cache_height=U;this.update_bbox()};
a.prototype.set_from_poly=function(g){this.pts_count=g.pts_count;cr.shallowAssignArray(this.pts_cache,g.pts_cache);this.bboxLeft=g.bboxLeft;this.bboxTop-g.bboxTop;this.bboxRight=g.bboxRight;this.bboxBottom=g.bboxBottom};a.prototype.cache_poly=function(g,z,J){if(this.cache_width!==g||this.cache_height!==z||this.cache_angle!==J){this.cache_width=g;this.cache_height=z;this.cache_angle=J;var N,U=0,W=1,X=this.pts_array,Y=this.pts_cache;0!==J&&(U=Math.sin(J),W=Math.cos(J));J=0;for(N=this.pts_count;J<N;J++){var ea=
2*J;var ha=ea+1;var k=X[ea]*g;var r=X[ha]*z;Y[ea]=k*W-r*U;Y[ha]=r*W+k*U}this.update_bbox()}};a.prototype.contains_pt=function(g,z){var J=this.pts_cache;if(g===J[0]&&z===J[1])return!0;var N,U=this.pts_count,W=this.bboxLeft-110,X=this.bboxTop-101,Y=this.bboxRight+131,ea=this.bboxBottom+120,ha=0,k=0;for(N=0;N<U;N++){var r=2*N;var E=(N+1)%U*2;var H=J[r];r=J[r+1];var B=J[E];E=J[E+1];cr.segments_intersect(W,X,g,z,H,r,B,E)&&ha++;cr.segments_intersect(Y,ea,g,z,H,r,B,E)&&k++}return 1===ha%2||1===k%2};a.prototype.intersects_poly=
function(g,z,J){var N=g.pts_cache,U=this.pts_cache;if(this.contains_pt(N[0]+z,N[1]+J)||g.contains_pt(U[0]-z,U[1]-J))return!0;var W,X;var Y=0;for(W=this.pts_count;Y<W;Y++){var ea=2*Y;var ha=(Y+1)%W*2;var k=U[ea];ea=U[ea+1];var r=U[ha];var E=U[ha+1];ha=0;for(X=g.pts_count;ha<X;ha++){var H=2*ha;var B=(ha+1)%X*2;var L=N[H]+z;H=N[H+1]+J;var Q=N[B]+z;B=N[B+1]+J;if(cr.segments_intersect(k,ea,r,E,L,H,Q,B))return!0}}return!1};a.prototype.intersects_segment=function(g,z,J,N,U,W){var X=this.pts_cache;if(this.contains_pt(J-
g,N-z))return!0;var Y;var ea=0;for(Y=this.pts_count;ea<Y;ea++){var ha=2*ea;var k=(ea+1)%Y*2;var r=X[ha]+g;ha=X[ha+1]+z;var E=X[k]+g;k=X[k+1]+z;if(cr.segments_intersect(J,N,U,W,r,ha,E,k))return!0}return!1};a.prototype.mirror=function(g){var z;var J=0;for(z=this.pts_count;J<z;++J){var N=2*J;this.pts_cache[N]=2*g-this.pts_cache[N]}};a.prototype.flip=function(g){var z;var J=0;for(z=this.pts_count;J<z;++J){var N=2*J+1;this.pts_cache[N]=2*g-this.pts_cache[N]}};a.prototype.diag=function(){var g;var z=0;
for(g=this.pts_count;z<g;++z){var J=2*z;var N=J+1;var U=this.pts_cache[J];this.pts_cache[J]=this.pts_cache[N];this.pts_cache[N]=U}};a.prototype.is_enabled=function(){return this.enabled};cr.CollisionPoly=a;c.prototype.totalCellCount=0;c.prototype.getCell=function(g,z,J){var N=this.cells[g];return N?(N=N[z])?N:J?(N=u(this,g,z),this.cells[g][z]=N):null:J?(N=u(this,g,z),this.cells[g]={},this.cells[g][z]=N):null};c.prototype.XToCell=function(g){return cr.floor(g/this.cellwidth)};c.prototype.YToCell=function(g){return cr.floor(g/
this.cellheight)};c.prototype.update=function(g,z,J){var N,U,W;if(z){var X=z.left;for(N=z.right;X<=N;++X){var Y=z.top;for(U=z.bottom;Y<=U;++Y)if(!J||!J.contains_pt(X,Y))if(W=this.getCell(X,Y,!1))W.remove(g),W.isEmpty()&&(c.prototype.totalCellCount--,W.objects.clear(),1E3>f.length&&f.push(W),this.cells[X][Y]=null)}}if(J)for(X=J.left,N=J.right;X<=N;++X)for(Y=J.top,U=J.bottom;Y<=U;++Y)z&&z.contains_pt(X,Y)||this.getCell(X,Y,!0).insert(g)};c.prototype.queryRange=function(g,z){var J,N;var U=this.XToCell(g.left);
var W=this.YToCell(g.top);var X=this.XToCell(g.right);for(J=this.YToCell(g.bottom);U<=X;++U)for(g=W;g<=J;++g)(N=this.getCell(U,g,!1))&&N.dump(z)};cr.SparseGrid=c;m.prototype.totalCellCount=0;m.prototype.getCell=function(g,z,J){var N=this.cells[g];return N?(N=N[z])?N:J?(N=x(this,g,z),this.cells[g][z]=N):null:J?(N=x(this,g,z),this.cells[g]={},this.cells[g][z]=N):null};m.prototype.XToCell=function(g){return cr.floor(g/this.cellwidth)};m.prototype.YToCell=function(g){return cr.floor(g/this.cellheight)};
m.prototype.update=function(g,z,J){var N,U,W;if(z){var X=z.left;for(N=z.right;X<=N;++X){var Y=z.top;for(U=z.bottom;Y<=U;++Y)if(!J||!J.contains_pt(X,Y))if(W=this.getCell(X,Y,!1))W.remove(g),W.isEmpty()&&(m.prototype.totalCellCount--,W.reset(),1E3>n.length&&n.push(W),this.cells[X][Y]=null)}}if(J)for(X=J.left,N=J.right;X<=N;++X)for(Y=J.top,U=J.bottom;Y<=U;++Y)z&&z.contains_pt(X,Y)||this.getCell(X,Y,!0).insert(g)};m.prototype.queryRange=function(g,z,J,N,U){var W,X;g=this.XToCell(g);z=this.YToCell(z);
J=this.XToCell(J);for(W=this.YToCell(N);g<=J;++g)for(N=z;N<=W;++N)(X=this.getCell(g,N,!1))&&X.dump(U)};m.prototype.markRangeChanged=function(g){var z,J;var N=g.left;var U=g.top;var W=g.right;for(z=g.bottom;N<=W;++N)for(g=U;g<=z;++g)if(J=this.getCell(N,g,!1))J.is_sorted=!1};cr.RenderGrid=m;var f=[];p.prototype.isEmpty=function(){return this.objects.isEmpty()};p.prototype.insert=function(g){this.objects.add(g)};p.prototype.remove=function(g){this.objects.remove(g)};p.prototype.dump=function(g){cr.appendArray(g,
this.objects.valuesRef())};cr.GridCell=p;var n=[];M.prototype.isEmpty=function(){if(!this.objects.length)return!0;if(this.objects.length>this.pending_removal.count())return!1;this.flush_pending();return!0};M.prototype.insert=function(g){this.pending_removal.contains(g)?(this.pending_removal.remove(g),this.pending_removal.isEmpty()&&(this.any_pending_removal=!1)):this.objects.length?(this.objects[this.objects.length-1].get_zindex()>g.get_zindex()&&(this.is_sorted=!1),this.objects.push(g)):(this.objects.push(g),
this.is_sorted=!0)};M.prototype.remove=function(g){this.pending_removal.add(g);this.any_pending_removal=!0;30<=this.pending_removal.count()&&this.flush_pending()};M.prototype.flush_pending=function(){this.any_pending_removal&&(this.pending_removal.count()===this.objects.length?this.reset():(cr.arrayRemoveAllFromObjectSet(this.objects,this.pending_removal),this.pending_removal.clear(),this.any_pending_removal=!1))};M.prototype.ensure_sorted=function(){this.is_sorted||(this.objects.sort(v),this.is_sorted=
!0)};M.prototype.reset=function(){cr.clearArray(this.objects);this.is_sorted=!0;this.pending_removal.clear();this.any_pending_removal=!1};M.prototype.dump=function(g){this.flush_pending();this.ensure_sorted();this.objects.length&&g.push(this.objects)};cr.RenderCell=M;var G="lighter xor copy destination-over source-in destination-in source-out destination-out source-atop destination-atop".split(" ");cr.effectToCompositeOp=function(g){return 0>=g||11<=g?"source-over":G[g-1]};cr.setGLBlend=function(g,
z,J){if(J)switch(g.srcBlend=J.ONE,g.destBlend=J.ONE_MINUS_SRC_ALPHA,z){case 1:g.srcBlend=J.ONE;g.destBlend=J.ONE;break;case 3:g.srcBlend=J.ONE;g.destBlend=J.ZERO;break;case 4:g.srcBlend=J.ONE_MINUS_DST_ALPHA;g.destBlend=J.ONE;break;case 5:g.srcBlend=J.DST_ALPHA;g.destBlend=J.ZERO;break;case 6:g.srcBlend=J.ZERO;g.destBlend=J.SRC_ALPHA;break;case 7:g.srcBlend=J.ONE_MINUS_DST_ALPHA;g.destBlend=J.ZERO;break;case 8:g.srcBlend=J.ZERO;g.destBlend=J.ONE_MINUS_SRC_ALPHA;break;case 9:g.srcBlend=J.DST_ALPHA;
g.destBlend=J.ONE_MINUS_SRC_ALPHA;break;case 10:g.srcBlend=J.ONE_MINUS_DST_ALPHA,g.destBlend=J.SRC_ALPHA}};cr.round6dp=function(g){return Math.round(1E6*g)/1E6};cr.equals_nocase=function(g,z){return"string"!==typeof g||"string"!==typeof z||g.length!==z.length?!1:g===z?!0:g.toLowerCase()===z.toLowerCase()};cr.cssToCamelCase=function(g){var z="",J,N=!1;var U=0;for(J=g.length;U<J;++U){var W=g.charAt(U);"-"===W?N=!0:N?(z+=W.toUpperCase(),N=!1):z+=W}return z};cr.isCanvasInputEvent=function(g){g=g.target;
return!g||g===document||g===window||document&&document.body&&g===document.body||cr.equals_nocase(g.tagName,"canvas")?!0:!1}})();var MatrixArray="undefined"!==typeof Float32Array?Float32Array:Array,glMatrixArrayType=MatrixArray,vec3={},mat3={},mat4={},quat4={};vec3.create=function(b){var d=new MatrixArray(3);b&&(d[0]=b[0],d[1]=b[1],d[2]=b[2]);return d};vec3.set=function(b,d){d[0]=b[0];d[1]=b[1];d[2]=b[2];return d};
vec3.add=function(b,d,h){if(!h||b===h)return b[0]+=d[0],b[1]+=d[1],b[2]+=d[2],b;h[0]=b[0]+d[0];h[1]=b[1]+d[1];h[2]=b[2]+d[2];return h};vec3.subtract=function(b,d,h){if(!h||b===h)return b[0]-=d[0],b[1]-=d[1],b[2]-=d[2],b;h[0]=b[0]-d[0];h[1]=b[1]-d[1];h[2]=b[2]-d[2];return h};vec3.negate=function(b,d){d||(d=b);d[0]=-b[0];d[1]=-b[1];d[2]=-b[2];return d};vec3.scale=function(b,d,h){if(!h||b===h)return b[0]*=d,b[1]*=d,b[2]*=d,b;h[0]=b[0]*d;h[1]=b[1]*d;h[2]=b[2]*d;return h};
vec3.normalize=function(b,d){d||(d=b);var h=b[0],q=b[1];b=b[2];var y=Math.sqrt(h*h+q*q+b*b);if(y){if(1===y)return d[0]=h,d[1]=q,d[2]=b,d}else return d[0]=0,d[1]=0,d[2]=0,d;y=1/y;d[0]=h*y;d[1]=q*y;d[2]=b*y;return d};vec3.cross=function(b,d,h){h||(h=b);var q=b[0],y=b[1];b=b[2];var A=d[0],e=d[1];d=d[2];h[0]=y*d-b*e;h[1]=b*A-q*d;h[2]=q*e-y*A;return h};vec3.length=function(b){var d=b[0],h=b[1];b=b[2];return Math.sqrt(d*d+h*h+b*b)};vec3.dot=function(b,d){return b[0]*d[0]+b[1]*d[1]+b[2]*d[2]};
vec3.direction=function(b,d,h){h||(h=b);var q=b[0]-d[0],y=b[1]-d[1];b=b[2]-d[2];d=Math.sqrt(q*q+y*y+b*b);if(!d)return h[0]=0,h[1]=0,h[2]=0,h;d=1/d;h[0]=q*d;h[1]=y*d;h[2]=b*d;return h};vec3.lerp=function(b,d,h,q){q||(q=b);q[0]=b[0]+h*(d[0]-b[0]);q[1]=b[1]+h*(d[1]-b[1]);q[2]=b[2]+h*(d[2]-b[2]);return q};vec3.str=function(b){return"["+b[0]+", "+b[1]+", "+b[2]+"]"};
mat3.create=function(b){var d=new MatrixArray(9);b&&(d[0]=b[0],d[1]=b[1],d[2]=b[2],d[3]=b[3],d[4]=b[4],d[5]=b[5],d[6]=b[6],d[7]=b[7],d[8]=b[8]);return d};mat3.set=function(b,d){d[0]=b[0];d[1]=b[1];d[2]=b[2];d[3]=b[3];d[4]=b[4];d[5]=b[5];d[6]=b[6];d[7]=b[7];d[8]=b[8];return d};mat3.identity=function(b){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=1;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};
mat3.transpose=function(b,d){if(!d||b===d){d=b[1];var h=b[2],q=b[5];b[1]=b[3];b[2]=b[6];b[3]=d;b[5]=b[7];b[6]=h;b[7]=q;return b}d[0]=b[0];d[1]=b[3];d[2]=b[6];d[3]=b[1];d[4]=b[4];d[5]=b[7];d[6]=b[2];d[7]=b[5];d[8]=b[8];return d};mat3.toMat4=function(b,d){d||(d=mat4.create());d[15]=1;d[14]=0;d[13]=0;d[12]=0;d[11]=0;d[10]=b[8];d[9]=b[7];d[8]=b[6];d[7]=0;d[6]=b[5];d[5]=b[4];d[4]=b[3];d[3]=0;d[2]=b[2];d[1]=b[1];d[0]=b[0];return d};
mat3.str=function(b){return"["+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+", "+b[4]+", "+b[5]+", "+b[6]+", "+b[7]+", "+b[8]+"]"};mat4.create=function(b){var d=new MatrixArray(16);b&&(d[0]=b[0],d[1]=b[1],d[2]=b[2],d[3]=b[3],d[4]=b[4],d[5]=b[5],d[6]=b[6],d[7]=b[7],d[8]=b[8],d[9]=b[9],d[10]=b[10],d[11]=b[11],d[12]=b[12],d[13]=b[13],d[14]=b[14],d[15]=b[15]);return d};
mat4.set=function(b,d){d[0]=b[0];d[1]=b[1];d[2]=b[2];d[3]=b[3];d[4]=b[4];d[5]=b[5];d[6]=b[6];d[7]=b[7];d[8]=b[8];d[9]=b[9];d[10]=b[10];d[11]=b[11];d[12]=b[12];d[13]=b[13];d[14]=b[14];d[15]=b[15];return d};mat4.identity=function(b){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=1;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=1;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};
mat4.transpose=function(b,d){if(!d||b===d){d=b[1];var h=b[2],q=b[3],y=b[6],A=b[7],e=b[11];b[1]=b[4];b[2]=b[8];b[3]=b[12];b[4]=d;b[6]=b[9];b[7]=b[13];b[8]=h;b[9]=y;b[11]=b[14];b[12]=q;b[13]=A;b[14]=e;return b}d[0]=b[0];d[1]=b[4];d[2]=b[8];d[3]=b[12];d[4]=b[1];d[5]=b[5];d[6]=b[9];d[7]=b[13];d[8]=b[2];d[9]=b[6];d[10]=b[10];d[11]=b[14];d[12]=b[3];d[13]=b[7];d[14]=b[11];d[15]=b[15];return d};
mat4.determinant=function(b){var d=b[0],h=b[1],q=b[2],y=b[3],A=b[4],e=b[5],a=b[6],c=b[7],m=b[8],u=b[9],p=b[10],x=b[11],M=b[12],v=b[13],F=b[14];b=b[15];return M*u*a*y-m*v*a*y-M*e*p*y+A*v*p*y+m*e*F*y-A*u*F*y-M*u*q*c+m*v*q*c+M*h*p*c-d*v*p*c-m*h*F*c+d*u*F*c+M*e*q*x-A*v*q*x-M*h*a*x+d*v*a*x+A*h*F*x-d*e*F*x-m*e*q*b+A*u*q*b+m*h*a*b-d*u*a*b-A*h*p*b+d*e*p*b};
mat4.inverse=function(b,d){d||(d=b);var h=b[0],q=b[1],y=b[2],A=b[3],e=b[4],a=b[5],c=b[6],m=b[7],u=b[8],p=b[9],x=b[10],M=b[11],v=b[12],F=b[13],C=b[14];b=b[15];var l=h*a-q*e,t=h*c-y*e,D=h*m-A*e,S=q*c-y*a,V=q*m-A*a,K=y*m-A*c,f=u*F-p*v,n=u*C-x*v,G=u*b-M*v,g=p*C-x*F,z=p*b-M*F,J=x*b-M*C,N=1/(l*J-t*z+D*g+S*G-V*n+K*f);d[0]=(a*J-c*z+m*g)*N;d[1]=(-q*J+y*z-A*g)*N;d[2]=(F*K-C*V+b*S)*N;d[3]=(-p*K+x*V-M*S)*N;d[4]=(-e*J+c*G-m*n)*N;d[5]=(h*J-y*G+A*n)*N;d[6]=(-v*K+C*D-b*t)*N;d[7]=(u*K-x*D+M*t)*N;d[8]=(e*z-a*G+m*f)*
N;d[9]=(-h*z+q*G-A*f)*N;d[10]=(v*V-F*D+b*l)*N;d[11]=(-u*V+p*D-M*l)*N;d[12]=(-e*g+a*n-c*f)*N;d[13]=(h*g-q*n+y*f)*N;d[14]=(-v*S+F*t-C*l)*N;d[15]=(u*S-p*t+x*l)*N;return d};mat4.toRotationMat=function(b,d){d||(d=mat4.create());d[0]=b[0];d[1]=b[1];d[2]=b[2];d[3]=b[3];d[4]=b[4];d[5]=b[5];d[6]=b[6];d[7]=b[7];d[8]=b[8];d[9]=b[9];d[10]=b[10];d[11]=b[11];d[12]=0;d[13]=0;d[14]=0;d[15]=1;return d};
mat4.toMat3=function(b,d){d||(d=mat3.create());d[0]=b[0];d[1]=b[1];d[2]=b[2];d[3]=b[4];d[4]=b[5];d[5]=b[6];d[6]=b[8];d[7]=b[9];d[8]=b[10];return d};mat4.toInverseMat3=function(b,d){var h=b[0],q=b[1],y=b[2],A=b[4],e=b[5],a=b[6],c=b[8],m=b[9];b=b[10];var u=b*e-a*m,p=-b*A+a*c,x=m*A-e*c,M=h*u+q*p+y*x;if(!M)return null;M=1/M;d||(d=mat3.create());d[0]=u*M;d[1]=(-b*q+y*m)*M;d[2]=(a*q-y*e)*M;d[3]=p*M;d[4]=(b*h-y*c)*M;d[5]=(-a*h+y*A)*M;d[6]=x*M;d[7]=(-m*h+q*c)*M;d[8]=(e*h-q*A)*M;return d};
mat4.multiply=function(b,d,h){h||(h=b);var q=b[0],y=b[1],A=b[2],e=b[3],a=b[4],c=b[5],m=b[6],u=b[7],p=b[8],x=b[9],M=b[10],v=b[11],F=b[12],C=b[13],l=b[14];b=b[15];var t=d[0],D=d[1],S=d[2],V=d[3],K=d[4],f=d[5],n=d[6],G=d[7],g=d[8],z=d[9],J=d[10],N=d[11],U=d[12],W=d[13],X=d[14];d=d[15];h[0]=t*q+D*a+S*p+V*F;h[1]=t*y+D*c+S*x+V*C;h[2]=t*A+D*m+S*M+V*l;h[3]=t*e+D*u+S*v+V*b;h[4]=K*q+f*a+n*p+G*F;h[5]=K*y+f*c+n*x+G*C;h[6]=K*A+f*m+n*M+G*l;h[7]=K*e+f*u+n*v+G*b;h[8]=g*q+z*a+J*p+N*F;h[9]=g*y+z*c+J*x+N*C;h[10]=g*
A+z*m+J*M+N*l;h[11]=g*e+z*u+J*v+N*b;h[12]=U*q+W*a+X*p+d*F;h[13]=U*y+W*c+X*x+d*C;h[14]=U*A+W*m+X*M+d*l;h[15]=U*e+W*u+X*v+d*b;return h};mat4.multiplyVec3=function(b,d,h){h||(h=d);var q=d[0],y=d[1];d=d[2];h[0]=b[0]*q+b[4]*y+b[8]*d+b[12];h[1]=b[1]*q+b[5]*y+b[9]*d+b[13];h[2]=b[2]*q+b[6]*y+b[10]*d+b[14];return h};
mat4.multiplyVec4=function(b,d,h){h||(h=d);var q=d[0],y=d[1],A=d[2];d=d[3];h[0]=b[0]*q+b[4]*y+b[8]*A+b[12]*d;h[1]=b[1]*q+b[5]*y+b[9]*A+b[13]*d;h[2]=b[2]*q+b[6]*y+b[10]*A+b[14]*d;h[3]=b[3]*q+b[7]*y+b[11]*A+b[15]*d;return h};
mat4.translate=function(b,d,h){var q=d[0],y=d[1];d=d[2];if(!h||b===h)return b[12]=b[0]*q+b[4]*y+b[8]*d+b[12],b[13]=b[1]*q+b[5]*y+b[9]*d+b[13],b[14]=b[2]*q+b[6]*y+b[10]*d+b[14],b[15]=b[3]*q+b[7]*y+b[11]*d+b[15],b;var A=b[0];var e=b[1];var a=b[2];var c=b[3];var m=b[4];var u=b[5];var p=b[6];var x=b[7];var M=b[8];var v=b[9];var F=b[10];var C=b[11];h[0]=A;h[1]=e;h[2]=a;h[3]=c;h[4]=m;h[5]=u;h[6]=p;h[7]=x;h[8]=M;h[9]=v;h[10]=F;h[11]=C;h[12]=A*q+m*y+M*d+b[12];h[13]=e*q+u*y+v*d+b[13];h[14]=a*q+p*y+F*d+b[14];
h[15]=c*q+x*y+C*d+b[15];return h};mat4.scale=function(b,d,h){var q=d[0],y=d[1];d=d[2];if(!h||b===h)return b[0]*=q,b[1]*=q,b[2]*=q,b[3]*=q,b[4]*=y,b[5]*=y,b[6]*=y,b[7]*=y,b[8]*=d,b[9]*=d,b[10]*=d,b[11]*=d,b;h[0]=b[0]*q;h[1]=b[1]*q;h[2]=b[2]*q;h[3]=b[3]*q;h[4]=b[4]*y;h[5]=b[5]*y;h[6]=b[6]*y;h[7]=b[7]*y;h[8]=b[8]*d;h[9]=b[9]*d;h[10]=b[10]*d;h[11]=b[11]*d;h[12]=b[12];h[13]=b[13];h[14]=b[14];h[15]=b[15];return h};
mat4.rotate=function(b,d,h,q){var y=h[0],A=h[1];h=h[2];var e=Math.sqrt(y*y+A*A+h*h);if(!e)return null;1!==e&&(e=1/e,y*=e,A*=e,h*=e);var a=Math.sin(d);var c=Math.cos(d);var m=1-c;d=b[0];e=b[1];var u=b[2];var p=b[3];var x=b[4];var M=b[5];var v=b[6];var F=b[7];var C=b[8];var l=b[9];var t=b[10];var D=b[11];var S=y*y*m+c;var V=A*y*m+h*a;var K=h*y*m-A*a;var f=y*A*m-h*a;var n=A*A*m+c;var G=h*A*m+y*a;var g=y*h*m+A*a;y=A*h*m-y*a;A=h*h*m+c;q?b!==q&&(q[12]=b[12],q[13]=b[13],q[14]=b[14],q[15]=b[15]):q=b;q[0]=
d*S+x*V+C*K;q[1]=e*S+M*V+l*K;q[2]=u*S+v*V+t*K;q[3]=p*S+F*V+D*K;q[4]=d*f+x*n+C*G;q[5]=e*f+M*n+l*G;q[6]=u*f+v*n+t*G;q[7]=p*f+F*n+D*G;q[8]=d*g+x*y+C*A;q[9]=e*g+M*y+l*A;q[10]=u*g+v*y+t*A;q[11]=p*g+F*y+D*A;return q};
mat4.rotateX=function(b,d,h){var q=Math.sin(d);d=Math.cos(d);var y=b[4],A=b[5],e=b[6],a=b[7],c=b[8],m=b[9],u=b[10],p=b[11];h?b!==h&&(h[0]=b[0],h[1]=b[1],h[2]=b[2],h[3]=b[3],h[12]=b[12],h[13]=b[13],h[14]=b[14],h[15]=b[15]):h=b;h[4]=y*d+c*q;h[5]=A*d+m*q;h[6]=e*d+u*q;h[7]=a*d+p*q;h[8]=y*-q+c*d;h[9]=A*-q+m*d;h[10]=e*-q+u*d;h[11]=a*-q+p*d;return h};
mat4.rotateY=function(b,d,h){var q=Math.sin(d);d=Math.cos(d);var y=b[0],A=b[1],e=b[2],a=b[3],c=b[8],m=b[9],u=b[10],p=b[11];h?b!==h&&(h[4]=b[4],h[5]=b[5],h[6]=b[6],h[7]=b[7],h[12]=b[12],h[13]=b[13],h[14]=b[14],h[15]=b[15]):h=b;h[0]=y*d+c*-q;h[1]=A*d+m*-q;h[2]=e*d+u*-q;h[3]=a*d+p*-q;h[8]=y*q+c*d;h[9]=A*q+m*d;h[10]=e*q+u*d;h[11]=a*q+p*d;return h};
mat4.rotateZ=function(b,d,h){var q=Math.sin(d);d=Math.cos(d);var y=b[0],A=b[1],e=b[2],a=b[3],c=b[4],m=b[5],u=b[6],p=b[7];h?b!==h&&(h[8]=b[8],h[9]=b[9],h[10]=b[10],h[11]=b[11],h[12]=b[12],h[13]=b[13],h[14]=b[14],h[15]=b[15]):h=b;h[0]=y*d+c*q;h[1]=A*d+m*q;h[2]=e*d+u*q;h[3]=a*d+p*q;h[4]=y*-q+c*d;h[5]=A*-q+m*d;h[6]=e*-q+u*d;h[7]=a*-q+p*d;return h};
mat4.frustum=function(b,d,h,q,y,A,e){e||(e=mat4.create());var a=d-b,c=q-h,m=A-y;e[0]=2*y/a;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=2*y/c;e[6]=0;e[7]=0;e[8]=(d+b)/a;e[9]=(q+h)/c;e[10]=-(A+y)/m;e[11]=-1;e[12]=0;e[13]=0;e[14]=-(A*y*2)/m;e[15]=0;return e};mat4.perspective=function(b,d,h,q,y){b=h*Math.tan(b*Math.PI/360);d*=b;return mat4.frustum(-d,d,-b,b,h,q,y)};
mat4.ortho=function(b,d,h,q,y,A,e){e||(e=mat4.create());var a=d-b,c=q-h,m=A-y;e[0]=2/a;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=2/c;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=-2/m;e[11]=0;e[12]=-(b+d)/a;e[13]=-(q+h)/c;e[14]=-(A+y)/m;e[15]=1;return e};
mat4.lookAt=function(b,d,h,q){q||(q=mat4.create());var y=b[0],A=b[1];b=b[2];var e=h[0];var a=h[1];var c=h[2];h=d[1];var m=d[2];if(y===d[0]&&A===h&&b===m)return mat4.identity(q);h=y-d[0];m=A-d[1];var u=b-d[2];var p=1/Math.sqrt(h*h+m*m+u*u);h*=p;m*=p;u*=p;d=a*u-c*m;c=c*h-e*u;e=e*m-a*h;(p=Math.sqrt(d*d+c*c+e*e))?(p=1/p,d*=p,c*=p,e*=p):e=c=d=0;a=m*e-u*c;var x=u*d-h*e;var M=h*c-m*d;(p=Math.sqrt(a*a+x*x+M*M))?(p=1/p,a*=p,x*=p,M*=p):M=x=a=0;q[0]=d;q[1]=a;q[2]=h;q[3]=0;q[4]=c;q[5]=x;q[6]=m;q[7]=0;q[8]=e;
q[9]=M;q[10]=u;q[11]=0;q[12]=-(d*y+c*A+e*b);q[13]=-(a*y+x*A+M*b);q[14]=-(h*y+m*A+u*b);q[15]=1;return q};mat4.fromRotationTranslation=function(b,d,h){h||(h=mat4.create());var q=b[0],y=b[1],A=b[2],e=b[3],a=q+q,c=y+y,m=A+A;b=q*a;var u=q*c;q*=m;var p=y*c;y*=m;A*=m;a*=e;c*=e;e*=m;h[0]=1-(p+A);h[1]=u+e;h[2]=q-c;h[3]=0;h[4]=u-e;h[5]=1-(b+A);h[6]=y+a;h[7]=0;h[8]=q+c;h[9]=y-a;h[10]=1-(b+p);h[11]=0;h[12]=d[0];h[13]=d[1];h[14]=d[2];h[15]=1;return h};
mat4.str=function(b){return"["+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+", "+b[4]+", "+b[5]+", "+b[6]+", "+b[7]+", "+b[8]+", "+b[9]+", "+b[10]+", "+b[11]+", "+b[12]+", "+b[13]+", "+b[14]+", "+b[15]+"]"};quat4.create=function(b){var d=new MatrixArray(4);b&&(d[0]=b[0],d[1]=b[1],d[2]=b[2],d[3]=b[3]);return d};quat4.set=function(b,d){d[0]=b[0];d[1]=b[1];d[2]=b[2];d[3]=b[3];return d};
quat4.calculateW=function(b,d){var h=b[0],q=b[1],y=b[2];if(!d||b===d)return b[3]=-Math.sqrt(Math.abs(1-h*h-q*q-y*y)),b;d[0]=h;d[1]=q;d[2]=y;d[3]=-Math.sqrt(Math.abs(1-h*h-q*q-y*y));return d};quat4.inverse=function(b,d){if(!d||b===d)return b[0]*=-1,b[1]*=-1,b[2]*=-1,b;d[0]=-b[0];d[1]=-b[1];d[2]=-b[2];d[3]=b[3];return d};quat4.length=function(b){var d=b[0],h=b[1],q=b[2];b=b[3];return Math.sqrt(d*d+h*h+q*q+b*b)};
quat4.normalize=function(b,d){d||(d=b);var h=b[0],q=b[1],y=b[2];b=b[3];var A=Math.sqrt(h*h+q*q+y*y+b*b);if(0===A)return d[0]=0,d[1]=0,d[2]=0,d[3]=0,d;A=1/A;d[0]=h*A;d[1]=q*A;d[2]=y*A;d[3]=b*A;return d};quat4.multiply=function(b,d,h){h||(h=b);var q=b[0],y=b[1],A=b[2];b=b[3];var e=d[0],a=d[1],c=d[2];d=d[3];h[0]=q*d+b*e+y*c-A*a;h[1]=y*d+b*a+A*e-q*c;h[2]=A*d+b*c+q*a-y*e;h[3]=b*d-q*e-y*a-A*c;return h};
quat4.multiplyVec3=function(b,d,h){h||(h=d);var q=d[0],y=d[1],A=d[2];d=b[0];var e=b[1],a=b[2];b=b[3];var c=b*q+e*A-a*y,m=b*y+a*q-d*A,u=b*A+d*y-e*q;q=-d*q-e*y-a*A;h[0]=c*b+q*-d+m*-a-u*-e;h[1]=m*b+q*-e+u*-d-c*-a;h[2]=u*b+q*-a+c*-e-m*-d;return h};quat4.toMat3=function(b,d){d||(d=mat3.create());var h=b[0],q=b[1],y=b[2];b=b[3];var A=h+h,e=q+q,a=y+y,c=h*A,m=h*e;h*=a;var u=q*e;q*=a;y*=a;A*=b;e*=b;b*=a;d[0]=1-(u+y);d[1]=m+b;d[2]=h-e;d[3]=m-b;d[4]=1-(c+y);d[5]=q+A;d[6]=h+e;d[7]=q-A;d[8]=1-(c+u);return d};
quat4.toMat4=function(b,d){d||(d=mat4.create());var h=b[0],q=b[1],y=b[2];b=b[3];var A=h+h,e=q+q,a=y+y,c=h*A,m=h*e;h*=a;var u=q*e;q*=a;y*=a;A*=b;e*=b;b*=a;d[0]=1-(u+y);d[1]=m+b;d[2]=h-e;d[3]=0;d[4]=m-b;d[5]=1-(c+y);d[6]=q+A;d[7]=0;d[8]=h+e;d[9]=q-A;d[10]=1-(c+u);d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return d};
quat4.slerp=function(b,d,h,q){q||(q=b);var y=b[0]*d[0]+b[1]*d[1]+b[2]*d[2]+b[3]*d[3];if(1<=Math.abs(y))return q!==b&&(q[0]=b[0],q[1]=b[1],q[2]=b[2],q[3]=b[3]),q;var A=Math.acos(y);var e=Math.sqrt(1-y*y);if(.001>Math.abs(e))return q[0]=.5*b[0]+.5*d[0],q[1]=.5*b[1]+.5*d[1],q[2]=.5*b[2]+.5*d[2],q[3]=.5*b[3]+.5*d[3],q;y=Math.sin((1-h)*A)/e;h=Math.sin(h*A)/e;q[0]=b[0]*y+d[0]*h;q[1]=b[1]*y+d[1]*h;q[2]=b[2]*y+d[2]*h;q[3]=b[3]*y+d[3]*h;return q};
quat4.str=function(b){return"["+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+"]"};
(function(){function b(a,c,m){this.isIE=/msie/i.test(navigator.userAgent)||/trident/i.test(navigator.userAgent);this.height=this.width=0;this.enableFrontToBack=!!m;this.isBatchInEarlyZPass=this.isEarlyZPass=!1;this.currentZ=0;this.zNear=1;this.zFar=1E3;this.zIncrement=(this.zFar-this.zNear)/32768;this.zA=this.zFar/(this.zFar-this.zNear);this.zB=this.zFar*this.zNear/(this.zNear-this.zFar);this.kzA=65536*this.zA;this.kzB=65536*this.zB;this.cam=vec3.create([0,0,100]);this.look=vec3.create([0,0,0]);this.up=
vec3.create([0,1,0]);this.worldScale=vec3.create([1,1,1]);this.enable_mipmaps=!0;this.matP=mat4.create();this.matMV=mat4.create();this.lastMV=mat4.create();this.currentMV=mat4.create();this.gl=a;this.version=0===this.gl.getParameter(this.gl.VERSION).indexOf("WebGL 2")?2:1;this.timerExt=null;this.isTiming=!1;this.timerExt=2===this.version?this.gl.getExtension("EXT_disjoint_timer_query_webgl2")||this.gl.getExtension("EXT_disjoint_timer_query"):this.gl.getExtension("EXT_disjoint_timer_query");this.frameNumber=
0;this.timerResults=[];this.initState()}function d(a,c,m){this.gl=a;this.shaderProgram=c;this.name=m;this.locAPos=a.getAttribLocation(c,"aPos");this.locATex=a.getAttribLocation(c,"aTex");this.locMatP=a.getUniformLocation(c,"matP");this.locMatMV=a.getUniformLocation(c,"matMV");this.locOpacity=a.getUniformLocation(c,"opacity");this.locColorFill=a.getUniformLocation(c,"colorFill");this.locSamplerFront=a.getUniformLocation(c,"samplerFront");this.locSamplerBack=a.getUniformLocation(c,"samplerBack");this.locSrcStart=
a.getUniformLocation(c,"srcStart");this.locSrcEnd=a.getUniformLocation(c,"srcEnd");this.locSrcOriginStart=a.getUniformLocation(c,"srcOriginStart");this.locSrcOriginEnd=a.getUniformLocation(c,"srcOriginEnd");this.locLayoutStart=a.getUniformLocation(c,"layoutStart");this.locLayoutEnd=a.getUniformLocation(c,"layoutEnd");this.locDestStart=a.getUniformLocation(c,"destStart");this.locDestEnd=a.getUniformLocation(c,"destEnd");this.locSeconds=a.getUniformLocation(c,"seconds");this.locPixelSize=a.getUniformLocation(c,
"pixelSize");this.locLayerScale=a.getUniformLocation(c,"layerScale");this.locLayerAngle=a.getUniformLocation(c,"layerAngle");this.hasAnyOptionalUniforms=!!(this.locPixelSize||this.locSeconds||this.locSamplerBack||this.locSrcStart||this.locSrcEnd||this.locSrcOriginStart||this.locSrcOriginEnd||this.locLayoutStart||this.locLayoutEnd||this.locDestStart||this.locDestEnd||this.locLayerScale||this.locLayerAngle);this.lpPixelHeight=this.lpPixelWidth=-999;this.lpOpacity=1;this.lpDestStartY=this.lpDestStartX=
this.lpLayoutEndY=this.lpLayoutEndX=this.lpLayoutStartY=this.lpLayoutStartX=this.lpSrcOriginEndY=this.lpSrcOriginEndX=this.lpSrcOriginStartY=this.lpSrcOriginStartX=this.lpSrcEndY=this.lpSrcEndX=this.lpSrcStartY=this.lpSrcStartX=0;this.lpLayerScale=this.lpDestEndY=this.lpDestEndX=1;this.lpSeconds=this.lpLayerAngle=0;this.lastCustomParams=[];this.lpMatMV=mat4.create();this.locOpacity&&a.uniform1f(this.locOpacity,1);this.locColorFill&&a.uniform4f(this.locColorFill,1,1,1,1);this.locSamplerFront&&a.uniform1i(this.locSamplerFront,
0);this.locSamplerBack&&a.uniform1i(this.locSamplerBack,1);this.locSrcStart&&a.uniform2f(this.locSrcStart,0,0);this.locSrcEnd&&a.uniform2f(this.locSrcEnd,1,1);this.locSrcOriginStart&&a.uniform2f(this.locSrcOriginStart,0,0);this.locSrcOriginEnd&&a.uniform2f(this.locSrcOriginEnd,0,0);this.locLayoutStart&&a.uniform2f(this.locLayoutStart,0,0);this.locLayoutEnd&&a.uniform2f(this.locLayoutEnd,0,0);this.locDestStart&&a.uniform2f(this.locDestStart,0,0);this.locDestEnd&&a.uniform2f(this.locDestEnd,1,1);this.locLayerScale&&
a.uniform1f(this.locLayerScale,1);this.locLayerAngle&&a.uniform1f(this.locLayerAngle,0);this.locSeconds&&a.uniform1f(this.locSeconds,0);this.hasCurrentMatMV=!1}function h(a,c){return a[0]===c[0]&&a[1]===c[1]&&a[2]===c[2]&&a[3]===c[3]&&a[4]===c[4]&&a[5]===c[5]&&a[6]===c[6]&&a[7]===c[7]&&a[8]===c[8]&&a[9]===c[9]&&a[10]===c[10]&&a[11]===c[11]&&a[12]===c[12]&&a[13]===c[13]&&a[14]===c[14]&&a[15]===c[15]}function q(a,c){this.type=a;this.glwrap=c;this.gl=c.gl;this.indexCount=this.startIndex=this.opacityParam=
0;this.mat4param=this.texParam=null;this.layoutRect=quat4.create();this.srcOriginRect=quat4.create();this.shaderParams=[];cr.seal(this)}var y=mat4.create();b.prototype.initState=function(){var a=this.gl,c;this.lastOpacity=1;this.lastTexture1=this.lastTexture0=null;this.currentOpacity=1;a.clearColor(0,0,0,0);a.clear(a.COLOR_BUFFER_BIT);a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);a.disable(a.CULL_FACE);a.disable(a.STENCIL_TEST);a.disable(a.DITHER);this.enableFrontToBack?(a.enable(a.DEPTH_TEST),
a.depthFunc(a.LEQUAL)):a.disable(a.DEPTH_TEST);this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE);this.lastSrcBlend=a.ONE;this.lastDestBlend=a.ONE_MINUS_SRC_ALPHA;this.vertexData=new Float32Array(8E3*(this.enableFrontToBack?3:2));this.texcoordData=new Float32Array(16E3);this.pointData=new Float32Array(32E3);this.pointBuffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.pointBuffer);a.bufferData(a.ARRAY_BUFFER,this.pointData.byteLength,a.DYNAMIC_DRAW);this.vertexBuffers=Array(4);this.texcoordBuffers=
Array(4);for(c=0;4>c;c++)this.vertexBuffers[c]=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffers[c]),a.bufferData(a.ARRAY_BUFFER,this.vertexData.byteLength,a.DYNAMIC_DRAW),this.texcoordBuffers[c]=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this.texcoordBuffers[c]),a.bufferData(a.ARRAY_BUFFER,this.texcoordData.byteLength,a.DYNAMIC_DRAW);this.curBuffer=0;this.indexBuffer=a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);for(var m=new Uint16Array(12E3),u=c=0;12E3>
c;)m[c++]=u,m[c++]=u+1,m[c++]=u+2,m[c++]=u,m[c++]=u+2,m[c++]=u+3,u+=4;a.bufferData(a.ELEMENT_ARRAY_BUFFER,m,a.STATIC_DRAW);this.pointPtr=this.texPtr=this.vertexPtr=0;this.shaderPrograms=[];c=this.enableFrontToBack?"attribute highp vec3 aPos;\nattribute mediump vec2 aTex;\nvarying mediump vec2 vTex;\nuniform highp mat4 matP;\nuniform highp mat4 matMV;\nvoid main(void) {\n\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, aPos.z, 1.0);\n\tvTex = aTex;\n}":"attribute highp vec2 aPos;\nattribute mediump vec2 aTex;\nvarying mediump vec2 vTex;\nuniform highp mat4 matP;\nuniform highp mat4 matMV;\nvoid main(void) {\n\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, 0.0, 1.0);\n\tvTex = aTex;\n}";
m=this.createShaderProgram({src:"varying mediump vec2 vTex;\nuniform lowp float opacity;\nuniform lowp sampler2D samplerFront;\nvoid main(void) {\n\tgl_FragColor = texture2D(samplerFront, vTex);\n\tgl_FragColor *= opacity;\n}"},c,"<default>");this.shaderPrograms.push(m);m=this.createShaderProgram({src:"uniform mediump sampler2D samplerFront;\nvarying lowp float opacity;\nvoid main(void) {\n\tgl_FragColor = texture2D(samplerFront, gl_PointCoord);\n\tgl_FragColor *= opacity;\n}"},"attribute vec4 aPos;\nvarying float opacity;\nuniform mat4 matP;\nuniform mat4 matMV;\nvoid main(void) {\n\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, 0.0, 1.0);\n\tgl_PointSize = aPos.z;\n\topacity = aPos.w;\n}",
"<point>");this.shaderPrograms.push(m);m=this.createShaderProgram({src:"varying mediump vec2 vTex;\nuniform lowp sampler2D samplerFront;\nvoid main(void) {\n\tif (texture2D(samplerFront, vTex).a < 1.0)\n\t\tdiscard;\n}"},c,"<earlyz>");this.shaderPrograms.push(m);m=this.createShaderProgram({src:"uniform lowp vec4 colorFill;\nvoid main(void) {\n\tgl_FragColor = colorFill;\n}"},c,"<fill>");this.shaderPrograms.push(m);for(var p in cr.shaders)cr.shaders.hasOwnProperty(p)&&this.shaderPrograms.push(this.createShaderProgram(cr.shaders[p],
c,p));a.activeTexture(a.TEXTURE0);a.bindTexture(a.TEXTURE_2D,null);this.batch=[];this.batchPtr=0;this.hasPointBatchTop=this.hasQuadBatchTop=!1;this.currentProgram=this.lastProgram=-1;this.currentShader=null;this.fbo=a.createFramebuffer();this.depthBuffer=this.renderToTex=null;this.attachedDepthBuffer=!1;this.enableFrontToBack&&(this.depthBuffer=a.createRenderbuffer());this.tmpVec3=vec3.create([0,0,0]);a=a.getParameter(a.ALIASED_POINT_SIZE_RANGE);this.minPointSize=a[0];this.maxPointSize=a[1];2048<
this.maxPointSize&&(this.maxPointSize=2048);this.switchProgram(0);cr.seal(this)};d.prototype.updateMatMV=function(a){h(this.lpMatMV,a)||(mat4.set(a,this.lpMatMV),this.gl.uniformMatrix4fv(this.locMatMV,!1,a))};b.prototype.createShaderProgram=function(a,c,m){var u=this.gl,p=u.createShader(u.FRAGMENT_SHADER);u.shaderSource(p,a.src);u.compileShader(p);if(!u.getShaderParameter(p,u.COMPILE_STATUS))throw a=u.getShaderInfoLog(p),u.deleteShader(p),Error("error compiling fragment shader: "+a);var x=u.createShader(u.VERTEX_SHADER);
u.shaderSource(x,c);u.compileShader(x);if(!u.getShaderParameter(x,u.COMPILE_STATUS))throw a=u.getShaderInfoLog(x),u.deleteShader(p),u.deleteShader(x),Error("error compiling vertex shader: "+a);c=u.createProgram();u.attachShader(c,p);u.attachShader(c,x);u.linkProgram(c);if(!u.getProgramParameter(c,u.LINK_STATUS))throw a=u.getProgramInfoLog(c),u.deleteShader(p),u.deleteShader(x),u.deleteProgram(c),Error("error linking shader program: "+a);u.useProgram(c);u.deleteShader(p);u.deleteShader(x);p=new d(u,
c,m);p.extendBoxHorizontal=a.extendBoxHorizontal||0;p.extendBoxVertical=a.extendBoxVertical||0;p.crossSampling=!!a.crossSampling;p.preservesOpaqueness=!!a.preservesOpaqueness;p.animated=!!a.animated;p.parameters=a.parameters||[];a=0;for(x=p.parameters.length;a<x;a++)p.parameters[a][1]=u.getUniformLocation(c,p.parameters[a][0]),p.lastCustomParams.push(0);cr.seal(p);return p};b.prototype.getShaderIndex=function(a){var c;var m=0;for(c=this.shaderPrograms.length;m<c;m++)if(this.shaderPrograms[m].name===
a)return m;return-1};b.prototype.project=function(a,c,m){var u=this.matMV,p=this.matP,x=[0,0,0,0,0,0,0,0];x[0]=u[0]*a+u[4]*c+u[12];x[1]=u[1]*a+u[5]*c+u[13];x[2]=u[2]*a+u[6]*c+u[14];x[3]=u[3]*a+u[7]*c+u[15];x[4]=p[0]*x[0]+p[4]*x[1]+p[8]*x[2]+p[12]*x[3];x[5]=p[1]*x[0]+p[5]*x[1]+p[9]*x[2]+p[13]*x[3];x[6]=p[2]*x[0]+p[6]*x[1]+p[10]*x[2]+p[14]*x[3];x[7]=-x[2];0!==x[7]&&(x[7]=1/x[7],x[4]*=x[7],x[5]*=x[7],x[6]*=x[7],m[0]=(.5*x[4]+.5)*this.width,m[1]=(.5*x[5]+.5)*this.height)};b.prototype.setSize=function(a,
c,m){if(this.width!==a||this.height!==c||m){this.endBatch();m=this.gl;this.width=a;this.height=c;m.viewport(0,0,a,c);mat4.lookAt(this.cam,this.look,this.up,this.matMV);this.enableFrontToBack?(mat4.ortho(-a/2,a/2,c/2,-c/2,this.zNear,this.zFar,this.matP),this.worldScale[0]=1,this.worldScale[1]=1):(mat4.perspective(45,a/c,this.zNear,this.zFar,this.matP),a=[0,0],c=[0,0],this.project(0,0,a),this.project(1,1,c),this.worldScale[0]=1/(c[0]-a[0]),this.worldScale[1]=-1/(c[1]-a[1]));a=0;for(c=this.shaderPrograms.length;a<
c;a++){var u=this.shaderPrograms[a];u.hasCurrentMatMV=!1;u.locMatP&&(m.useProgram(u.shaderProgram),m.uniformMatrix4fv(u.locMatP,!1,this.matP))}m.useProgram(this.shaderPrograms[this.lastProgram].shaderProgram);m.bindTexture(m.TEXTURE_2D,null);m.activeTexture(m.TEXTURE1);m.bindTexture(m.TEXTURE_2D,null);m.activeTexture(m.TEXTURE0);this.lastTexture1=this.lastTexture0=null;this.depthBuffer&&(m.bindFramebuffer(m.FRAMEBUFFER,this.fbo),m.bindRenderbuffer(m.RENDERBUFFER,this.depthBuffer),m.renderbufferStorage(m.RENDERBUFFER,
m.DEPTH_COMPONENT16,this.width,this.height),this.attachedDepthBuffer||(m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_ATTACHMENT,m.RENDERBUFFER,this.depthBuffer),this.attachedDepthBuffer=!0),m.bindRenderbuffer(m.RENDERBUFFER,null),m.bindFramebuffer(m.FRAMEBUFFER,null),this.renderToTex=null)}};b.prototype.resetModelView=function(){mat4.lookAt(this.cam,this.look,this.up,this.matMV);mat4.scale(this.matMV,this.worldScale)};b.prototype.translate=function(a,c){if(0!==a||0!==c)this.tmpVec3[0]=a,this.tmpVec3[1]=
c,this.tmpVec3[2]=0,mat4.translate(this.matMV,this.tmpVec3)};b.prototype.scale=function(a,c){if(1!==a||1!==c)this.tmpVec3[0]=a,this.tmpVec3[1]=c,this.tmpVec3[2]=1,mat4.scale(this.matMV,this.tmpVec3)};b.prototype.rotateZ=function(a){0!==a&&mat4.rotateZ(this.matMV,a)};b.prototype.updateModelView=function(){if(!h(this.lastMV,this.matMV)){var a=this.pushBatch();a.type=5;a.mat4param?mat4.set(this.matMV,a.mat4param):a.mat4param=mat4.create(this.matMV);mat4.set(this.matMV,this.lastMV);this.hasPointBatchTop=
this.hasQuadBatchTop=!1}};b.prototype.setEarlyZIndex=function(a){this.enableFrontToBack&&(32760<a&&(a=32760),this.currentZ=this.cam[2]-this.zNear-a*this.zIncrement)};q.prototype.doSetEarlyZPass=function(){var a=this.gl,c=this.glwrap;0!==this.startIndex?(a.depthMask(!0),a.colorMask(!1,!1,!1,!1),a.disable(a.BLEND),a.bindFramebuffer(a.FRAMEBUFFER,c.fbo),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,null,0),a.clear(a.DEPTH_BUFFER_BIT),a.bindFramebuffer(a.FRAMEBUFFER,null),c.isBatchInEarlyZPass=
!0):(a.depthMask(!1),a.colorMask(!0,!0,!0,!0),a.enable(a.BLEND),c.isBatchInEarlyZPass=!1)};q.prototype.doSetTexture=function(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.texParam)};q.prototype.doSetTexture1=function(){var a=this.gl;a.activeTexture(a.TEXTURE1);a.bindTexture(a.TEXTURE_2D,this.texParam);a.activeTexture(a.TEXTURE0)};q.prototype.doSetOpacity=function(){var a=this.opacityParam,c=this.glwrap;c.currentOpacity=a;c=c.currentShader;c.locOpacity&&c.lpOpacity!==a&&(c.lpOpacity=a,this.gl.uniform1f(c.locOpacity,
a))};q.prototype.doQuad=function(){this.gl.drawElements(this.gl.TRIANGLES,this.indexCount,this.gl.UNSIGNED_SHORT,this.startIndex)};q.prototype.doSetBlend=function(){this.gl.blendFunc(this.startIndex,this.indexCount)};q.prototype.doUpdateModelView=function(){var a,c=this.glwrap.shaderPrograms,m=this.glwrap.currentProgram;var u=0;for(a=c.length;u<a;u++){var p=c[u];u===m&&p.locMatMV?(p.updateMatMV(this.mat4param),p.hasCurrentMatMV=!0):p.hasCurrentMatMV=!1}mat4.set(this.mat4param,this.glwrap.currentMV)};
q.prototype.doRenderToTexture=function(){var a=this.gl,c=this.glwrap;this.texParam?(c.lastTexture1===this.texParam&&(a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,null),c.lastTexture1=null,a.activeTexture(a.TEXTURE0)),a.bindFramebuffer(a.FRAMEBUFFER,c.fbo),c.isBatchInEarlyZPass||a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.texParam,0)):(c.enableFrontToBack||a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,null,0),a.bindFramebuffer(a.FRAMEBUFFER,
null))};q.prototype.doClear=function(){var a=this.gl,c=this.startIndex;0===c?(a.clearColor(this.mat4param[0],this.mat4param[1],this.mat4param[2],this.mat4param[3]),a.clear(a.COLOR_BUFFER_BIT)):1===c?(a.enable(a.SCISSOR_TEST),a.scissor(this.mat4param[0],this.mat4param[1],this.mat4param[2],this.mat4param[3]),a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT),a.disable(a.SCISSOR_TEST)):a.clear(a.DEPTH_BUFFER_BIT)};q.prototype.doSetDepthTestEnabled=function(){var a=this.gl;0!==this.startIndex?a.enable(a.DEPTH_TEST):
a.disable(a.DEPTH_TEST)};q.prototype.doPoints=function(){var a=this.gl,c=this.glwrap;c.enableFrontToBack&&a.disable(a.DEPTH_TEST);var m=c.shaderPrograms[1];a.useProgram(m.shaderProgram);!m.hasCurrentMatMV&&m.locMatMV&&(m.updateMatMV(c.currentMV),m.hasCurrentMatMV=!0);a.enableVertexAttribArray(m.locAPos);a.bindBuffer(a.ARRAY_BUFFER,c.pointBuffer);a.vertexAttribPointer(m.locAPos,4,a.FLOAT,!1,0,0);a.drawArrays(a.POINTS,this.startIndex/4,this.indexCount);m=c.currentShader;a.useProgram(m.shaderProgram);
0<=m.locAPos&&(a.enableVertexAttribArray(m.locAPos),a.bindBuffer(a.ARRAY_BUFFER,c.vertexBuffers[c.curBuffer]),a.vertexAttribPointer(m.locAPos,c.enableFrontToBack?3:2,a.FLOAT,!1,0,0));0<=m.locATex&&(a.enableVertexAttribArray(m.locATex),a.bindBuffer(a.ARRAY_BUFFER,c.texcoordBuffers[c.curBuffer]),a.vertexAttribPointer(m.locATex,2,a.FLOAT,!1,0,0));c.enableFrontToBack&&a.enable(a.DEPTH_TEST)};q.prototype.doSetProgram=function(){var a=this.gl,c=this.glwrap,m=c.shaderPrograms[this.startIndex];c.currentProgram=
this.startIndex;c.currentShader=m;a.useProgram(m.shaderProgram);!m.hasCurrentMatMV&&m.locMatMV&&(m.updateMatMV(c.currentMV),m.hasCurrentMatMV=!0);m.locOpacity&&m.lpOpacity!==c.currentOpacity&&(m.lpOpacity=c.currentOpacity,a.uniform1f(m.locOpacity,c.currentOpacity));0<=m.locAPos&&(a.enableVertexAttribArray(m.locAPos),a.bindBuffer(a.ARRAY_BUFFER,c.vertexBuffers[c.curBuffer]),a.vertexAttribPointer(m.locAPos,c.enableFrontToBack?3:2,a.FLOAT,!1,0,0));0<=m.locATex&&(a.enableVertexAttribArray(m.locATex),
a.bindBuffer(a.ARRAY_BUFFER,c.texcoordBuffers[c.curBuffer]),a.vertexAttribPointer(m.locATex,2,a.FLOAT,!1,0,0))};q.prototype.doSetColor=function(){var a=this.mat4param;this.gl.uniform4f(this.glwrap.currentShader.locColorFill,a[0],a[1],a[2],a[3])};q.prototype.doSetProgramParameters=function(){var a=this.glwrap.currentShader,c=this.gl;var m=this.mat4param;var u=this.layoutRect;var p=this.srcOriginRect;a.locSamplerBack&&this.glwrap.lastTexture1!==this.texParam&&(c.activeTexture(c.TEXTURE1),c.bindTexture(c.TEXTURE_2D,
this.texParam),this.glwrap.lastTexture1=this.texParam,c.activeTexture(c.TEXTURE0));var x=m[0],M=m[1];!a.locPixelSize||x===a.lpPixelWidth&&M===a.lpPixelHeight||(a.lpPixelWidth=x,a.lpPixelHeight=M,c.uniform2f(a.locPixelSize,x,M));x=m[2];M=m[3];!a.locDestStart||x===a.lpDestStartX&&M===a.lpDestStartY||(a.lpDestStartX=x,a.lpDestStartY=M,c.uniform2f(a.locDestStart,x,M));x=m[4];M=m[5];!a.locDestEnd||x===a.lpDestEndX&&M===a.lpDestEndY||(a.lpDestEndX=x,a.lpDestEndY=M,c.uniform2f(a.locDestEnd,x,M));x=m[6];
a.locLayerScale&&x!==a.lpLayerScale&&(a.lpLayerScale=x,c.uniform1f(a.locLayerScale,x));x=m[7];a.locLayerAngle&&x!==a.lpLayerAngle&&(a.lpLayerAngle=x,c.uniform1f(a.locLayerAngle,x));x=m[12];M=m[13];!a.locSrcStart||x===a.lpSrcStartX&&M===a.lpSrcStartY||(a.lpSrcStartX=x,a.lpSrcStartY=M,c.uniform2f(a.locSrcStart,x,M));x=m[14];M=m[15];!a.locSrcEnd||x===a.lpSrcEndX&&M===a.lpSrcEndY||(a.lpSrcEndX=x,a.lpSrcEndY=M,c.uniform2f(a.locSrcEnd,x,M));x=p[0];M=p[1];!a.locSrcOriginStart||x===a.lpSrcOriginStartX&&M===
a.lpSrcOriginStartY||(a.lpSrcOriginStartX=x,a.lpSrcOriginStartY=M,c.uniform2f(a.locSrcOriginStart,x,M));x=p[2];M=p[3];!a.locSrcOriginEnd||x===a.lpSrcOriginEndX&&M===a.lpSrcOriginEndY||(a.lpSrcOriginEndX=x,a.lpSrcOriginEndY=M,c.uniform2f(a.locSrcOriginEnd,x,M));x=u[0];M=u[1];!a.locLayoutStart||x===a.lpLayoutStartX&&M===a.lpLayoutStartY||(a.lpLayoutStartX=x,a.lpLayoutStartY=M,c.uniform2f(a.locLayoutStart,x,M));x=u[2];M=u[3];!a.locLayoutEnd||x===a.lpLayoutEndX&&M===a.lpLayoutEndY||(a.lpLayoutEndX=x,
a.lpLayoutEndY=M,c.uniform2f(a.locLayoutEnd,x,M));x=this.startIndex;a.locSeconds&&x!==a.lpSeconds&&(a.lpSeconds=x,c.uniform1f(a.locSeconds,x));if(a.parameters.length)for(m=0,u=a.parameters.length;m<u;m++)x=this.shaderParams[m],Array.isArray(x)?c.uniform3fv(a.parameters[m][1],x):x!==a.lastCustomParams[m]&&(a.lastCustomParams[m]=x,c.uniform1f(a.parameters[m][1],x))};b.prototype.pushBatch=function(){this.batchPtr===this.batch.length&&this.batch.push(new q(0,this));return this.batch[this.batchPtr++]};
b.prototype.endBatch=function(){if(0!==this.batchPtr&&!this.gl.isContextLost()){this.maybeStartTiming();var a=this.gl;0<this.pointPtr&&(a.bindBuffer(a.ARRAY_BUFFER,this.pointBuffer),a.bufferSubData(a.ARRAY_BUFFER,0,this.pointData.subarray(0,this.pointPtr)),c&&0<=c.locAPos&&"<point>"===c.name&&a.vertexAttribPointer(c.locAPos,4,a.FLOAT,!1,0,0));if(0<this.vertexPtr){var c=this.currentShader;a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffers[this.curBuffer]);a.bufferSubData(a.ARRAY_BUFFER,0,this.vertexData.subarray(0,
this.vertexPtr));c&&0<=c.locAPos&&"<point>"!==c.name&&a.vertexAttribPointer(c.locAPos,this.enableFrontToBack?3:2,a.FLOAT,!1,0,0);a.bindBuffer(a.ARRAY_BUFFER,this.texcoordBuffers[this.curBuffer]);a.bufferSubData(a.ARRAY_BUFFER,0,this.texcoordData.subarray(0,this.texPtr));c&&0<=c.locATex&&"<point>"!==c.name&&a.vertexAttribPointer(c.locATex,2,a.FLOAT,!1,0,0)}a=0;for(c=this.batchPtr;a<c;a++){var m=this.batch[a];switch(m.type){case 1:m.doQuad();break;case 2:m.doSetTexture();break;case 3:m.doSetOpacity();
break;case 4:m.doSetBlend();break;case 5:m.doUpdateModelView();break;case 6:m.doRenderToTexture();break;case 7:m.doClear();break;case 8:m.doPoints();break;case 9:m.doSetProgram();break;case 10:m.doSetProgramParameters();break;case 11:m.doSetTexture1();break;case 12:m.doSetColor();break;case 13:m.doSetDepthTestEnabled();break;case 14:m.doSetEarlyZPass()}}this.pointPtr=this.texPtr=this.vertexPtr=this.batchPtr=0;this.isBatchInEarlyZPass=this.hasPointBatchTop=this.hasQuadBatchTop=!1;this.curBuffer++;
4<=this.curBuffer&&(this.curBuffer=0)}};b.prototype.maybeStartTiming=function(){if(!this.isTiming&&this.timerExt){this.isTiming=!0;var a={frameNumber:this.frameNumber,query:null,result:0};2===this.version?(a.query=this.gl.createQuery(),this.gl.beginQuery(this.timerExt.TIME_ELAPSED_EXT,a.query)):(a.query=this.timerExt.createQueryEXT(),this.timerExt.beginQueryEXT(this.timerExt.TIME_ELAPSED_EXT,a.query));this.timerResults.push(a);1E3<this.timerResults.length&&(a=this.timerResults.shift(),a.query&&(2===
this.version?this.gl.deleteQuery(a.query):this.timerExt.deleteQueryEXT(a.query)))}};b.prototype.maybeFinishTiming=function(){this.isTiming&&this.timerResults.length&&(2===this.version?this.gl.endQuery(this.timerExt.TIME_ELAPSED_EXT):this.timerExt.endQueryEXT(this.timerExt.TIME_ELAPSED_EXT),this.isTiming=!1)};b.prototype.checkForTimerResults=function(a){var c;var m=0;for(c=this.timerResults.length;m<c;++m){var u=this.timerResults[m];if(u.frameNumber>=a)break;if(u.query){var p=2===this.version?this.gl.getQueryParameter(u.query,
this.gl.QUERY_RESULT_AVAILABLE):this.timerExt.getQueryObjectEXT(u.query,this.timerExt.QUERY_RESULT_AVAILABLE_EXT);var x=this.gl.getParameter(this.timerExt.GPU_DISJOINT_EXT);p&&!x&&(u.result=2===this.version?this.gl.getQueryParameter(u.query,this.gl.QUERY_RESULT):this.timerExt.getQueryObjectEXT(u.query,this.timerExt.QUERY_RESULT_EXT),u.result/=1E9);if(p||x)2===this.version?this.gl.deleteQuery(u.query):this.timerExt.deleteQueryEXT(u.query),u.query=null}}};b.prototype.getFrameRangeTimerResults=function(a,
c){if(c<=a)return-1;var m,u=0,p=0;var x=0;for(m=this.timerResults.length;x<m;++x){var M=this.timerResults[x];if(M.frameNumber>=c)break;if(M.frameNumber>=a){if(M.query)return-1;u+=M.result;p++}}return p<c-a?-1:u};b.prototype.deleteTimerResultsToFrame=function(a){var c;var m=0;for(c=this.timerResults.length;m<c;++m){var u=this.timerResults[m];if(u.frameNumber>=a){0<m&&this.timerResults.splice(0,m);break}}};b.prototype.setOpacity=function(a){if(a!==this.lastOpacity&&!this.isEarlyZPass){var c=this.pushBatch();
c.type=3;this.lastOpacity=c.opacityParam=a;this.hasPointBatchTop=this.hasQuadBatchTop=!1}};b.prototype.setTexture=function(a){if(a!==this.lastTexture0){var c=this.pushBatch();c.type=2;this.lastTexture0=c.texParam=a;this.hasPointBatchTop=this.hasQuadBatchTop=!1}};b.prototype.setBlend=function(a,c){if((a!==this.lastSrcBlend||c!==this.lastDestBlend)&&!this.isEarlyZPass){var m=this.pushBatch();m.type=4;m.startIndex=a;m.indexCount=c;this.lastSrcBlend=a;this.lastDestBlend=c;this.hasPointBatchTop=this.hasQuadBatchTop=
!1}};b.prototype.isPremultipliedAlphaBlend=function(){return this.lastSrcBlend===this.gl.ONE&&this.lastDestBlend===this.gl.ONE_MINUS_SRC_ALPHA};b.prototype.setAlphaBlend=function(){this.setBlend(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA)};b.prototype.setNoPremultiplyAlphaBlend=function(){this.setBlend(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)};b.prototype.quad=function(a,c,m,u,p,x,M,v){15992<=this.vertexPtr&&this.endBatch();var F=this.vertexPtr,C=this.texPtr,l=this.vertexData,t=this.texcoordData,
D=this.currentZ;if(this.hasQuadBatchTop)this.batch[this.batchPtr-1].indexCount+=6;else{var S=this.pushBatch();S.type=1;S.startIndex=this.enableFrontToBack?F:F/2*3;S.indexCount=6;this.hasQuadBatchTop=!0;this.hasPointBatchTop=!1}this.enableFrontToBack?(l[F++]=a,l[F++]=c,l[F++]=D,l[F++]=m,l[F++]=u,l[F++]=D,l[F++]=p,l[F++]=x,l[F++]=D,l[F++]=M,l[F++]=v,l[F++]=D):(l[F++]=a,l[F++]=c,l[F++]=m,l[F++]=u,l[F++]=p,l[F++]=x,l[F++]=M,l[F++]=v);t[C++]=0;t[C++]=0;t[C++]=1;t[C++]=0;t[C++]=1;t[C++]=1;t[C++]=0;t[C++]=
1;this.vertexPtr=F;this.texPtr=C};b.prototype.quadTex=function(a,c,m,u,p,x,M,v,F){15992<=this.vertexPtr&&this.endBatch();var C=this.vertexPtr,l=this.texPtr,t=this.vertexData,D=this.texcoordData,S=this.currentZ;if(this.hasQuadBatchTop)this.batch[this.batchPtr-1].indexCount+=6;else{var V=this.pushBatch();V.type=1;V.startIndex=this.enableFrontToBack?C:C/2*3;V.indexCount=6;this.hasQuadBatchTop=!0;this.hasPointBatchTop=!1}V=F.left;var K=F.top,f=F.right;F=F.bottom;this.enableFrontToBack?(t[C++]=a,t[C++]=
c,t[C++]=S,t[C++]=m,t[C++]=u,t[C++]=S,t[C++]=p,t[C++]=x,t[C++]=S,t[C++]=M,t[C++]=v,t[C++]=S):(t[C++]=a,t[C++]=c,t[C++]=m,t[C++]=u,t[C++]=p,t[C++]=x,t[C++]=M,t[C++]=v);D[l++]=V;D[l++]=K;D[l++]=f;D[l++]=K;D[l++]=f;D[l++]=F;D[l++]=V;D[l++]=F;this.vertexPtr=C;this.texPtr=l};b.prototype.quadTexUV=function(a,c,m,u,p,x,M,v,F,C,l,t,D,S,V,K){15992<=this.vertexPtr&&this.endBatch();var f=this.vertexPtr,n=this.texPtr,G=this.vertexData,g=this.texcoordData,z=this.currentZ;if(this.hasQuadBatchTop)this.batch[this.batchPtr-
1].indexCount+=6;else{var J=this.pushBatch();J.type=1;J.startIndex=this.enableFrontToBack?f:f/2*3;J.indexCount=6;this.hasQuadBatchTop=!0;this.hasPointBatchTop=!1}this.enableFrontToBack?(G[f++]=a,G[f++]=c,G[f++]=z,G[f++]=m,G[f++]=u,G[f++]=z,G[f++]=p,G[f++]=x,G[f++]=z,G[f++]=M,G[f++]=v,G[f++]=z):(G[f++]=a,G[f++]=c,G[f++]=m,G[f++]=u,G[f++]=p,G[f++]=x,G[f++]=M,G[f++]=v);g[n++]=F;g[n++]=C;g[n++]=l;g[n++]=t;g[n++]=D;g[n++]=S;g[n++]=V;g[n++]=K;this.vertexPtr=f;this.texPtr=n};b.prototype.convexPoly=function(a){var c=
a.length/2-2,m=c-1,u=a[0],p=a[1],x;for(x=0;x<c;x+=2){var M=2*x;var v=a[M+2];var F=a[M+3];var C=a[M+4];var l=a[M+5];if(x===m)this.quad(u,p,v,F,C,l,C,l);else{var t=a[M+6];M=a[M+7];this.quad(u,p,v,F,C,l,t,M)}}};b.prototype.point=function(a,c,m,u){7996<=this.pointPtr&&this.endBatch();var p=this.pointPtr,x=this.pointData;if(this.hasPointBatchTop)this.batch[this.batchPtr-1].indexCount++;else{var M=this.pushBatch();M.type=8;M.startIndex=p;M.indexCount=1;this.hasPointBatchTop=!0;this.hasQuadBatchTop=!1}x[p++]=
a;x[p++]=c;x[p++]=m;x[p++]=u;this.pointPtr=p};b.prototype.switchProgram=function(a){if(this.lastProgram!==a){if(!this.shaderPrograms[a]){if(0===this.lastProgram)return;a=0}var c=this.pushBatch();c.type=9;this.lastProgram=c.startIndex=a;this.hasPointBatchTop=this.hasQuadBatchTop=!1}};b.prototype.programUsesDest=function(a){a=this.shaderPrograms[a];return!(!a.locDestStart&&!a.locDestEnd)};b.prototype.programUsesCrossSampling=function(a){a=this.shaderPrograms[a];return!!(a.locDestStart||a.locDestEnd||
a.crossSampling)};b.prototype.programPreservesOpaqueness=function(a){return this.shaderPrograms[a].preservesOpaqueness};b.prototype.programExtendsBox=function(a){a=this.shaderPrograms[a];return 0!==a.extendBoxHorizontal||0!==a.extendBoxVertical};b.prototype.getProgramBoxExtendHorizontal=function(a){return this.shaderPrograms[a].extendBoxHorizontal};b.prototype.getProgramBoxExtendVertical=function(a){return this.shaderPrograms[a].extendBoxVertical};b.prototype.getProgramParameterType=function(a,c){return this.shaderPrograms[a].parameters[c][2]};
b.prototype.programIsAnimated=function(a){return this.shaderPrograms[a].animated};b.prototype.setProgramParameters=function(a,c,m,u,p,x,M,v,F,C,l,t,D,S,V,K,f,n,G,g,z,J,N){var U=this.shaderPrograms[this.lastProgram];if(U.hasAnyOptionalUniforms||N.length){var W=this.pushBatch();W.type=10;W.mat4param?mat4.set(this.matMV,W.mat4param):W.mat4param=mat4.create();var X=W.mat4param;X[0]=c;X[1]=m;X[2]=K;X[3]=f;X[4]=n;X[5]=G;X[6]=g;X[7]=z;X[12]=u;X[13]=p;X[14]=x;X[15]=M;c=W.srcOriginRect;c[0]=v;c[1]=F;c[2]=
C;c[3]=l;v=W.layoutRect;v[0]=t;v[1]=V;v[2]=S;v[3]=D;W.startIndex=J;W.texParam=U.locSamplerBack?a:null;if(N.length)for(D=W.shaderParams,D.length=N.length,a=0,t=N.length;a<t;a++)D[a]=N[a];this.hasPointBatchTop=this.hasQuadBatchTop=!1}};b.prototype.clear=function(a,c,m,u){var p=this.pushBatch();p.type=7;p.startIndex=0;p.mat4param||(p.mat4param=mat4.create());p.mat4param[0]=a;p.mat4param[1]=c;p.mat4param[2]=m;p.mat4param[3]=u;this.hasPointBatchTop=this.hasQuadBatchTop=!1};b.prototype.clearRect=function(a,
c,m,u){if(!(0>m||0>u)){var p=this.pushBatch();p.type=7;p.startIndex=1;p.mat4param||(p.mat4param=mat4.create());p.mat4param[0]=a;p.mat4param[1]=c;p.mat4param[2]=m;p.mat4param[3]=u;this.hasPointBatchTop=this.hasQuadBatchTop=!1}};b.prototype.clearDepth=function(){var a=this.pushBatch();a.type=7;a.startIndex=2;this.hasPointBatchTop=this.hasQuadBatchTop=!1};b.prototype.setEarlyZPass=function(a){if(this.enableFrontToBack&&(a=!!a,this.isEarlyZPass!==a)){var c=this.pushBatch();c.type=14;c.startIndex=a?1:
0;this.hasPointBatchTop=this.hasQuadBatchTop=!1;this.isEarlyZPass=a;this.renderToTex=null;this.isEarlyZPass?this.switchProgram(2):this.switchProgram(0)}};b.prototype.setDepthTestEnabled=function(a){if(this.enableFrontToBack){var c=this.pushBatch();c.type=13;c.startIndex=a?1:0;this.hasPointBatchTop=this.hasQuadBatchTop=!1}};b.prototype.fullscreenQuad=function(){mat4.set(this.lastMV,y);this.resetModelView();this.updateModelView();var a=this.width/2,c=this.height/2;this.quad(-a,c,a,c,a,-c,-a,-c);mat4.set(y,
this.matMV);this.updateModelView()};b.prototype.setColorFillMode=function(a,c,m,u){this.switchProgram(3);var p=this.pushBatch();p.type=12;p.mat4param||(p.mat4param=mat4.create());p.mat4param[0]=a;p.mat4param[1]=c;p.mat4param[2]=m;p.mat4param[3]=u;this.hasPointBatchTop=this.hasQuadBatchTop=!1};b.prototype.setTextureFillMode=function(){this.switchProgram(0)};b.prototype.restoreEarlyZMode=function(){this.switchProgram(2)};b.prototype.getFrameNumber=function(){return this.frameNumber};b.prototype.present=
function(){this.endBatch();this.maybeFinishTiming();this.gl.flush();this.checkForTimerResults(this.frameNumber);this.frameNumber++};b.prototype.supportsGpuProfiling=function(){return!!this.timerExt};var A=[],e={};b.prototype.contextLost=function(){cr.clearArray(A);e={}};b.prototype.loadTexture=function(a,c,m,u,p,x){c=!!c;m=!!m;var M=a.src+","+c+","+m+(c?","+p:"");if("undefined"!==typeof a.src&&e.hasOwnProperty(M)){var v=e[M];v.c2refcount++;return v}this.endBatch();var F=this.gl,C=cr.isPOT(a.width)&&
cr.isPOT(a.height);v=F.createTexture();F.bindTexture(F.TEXTURE_2D,v);F.pixelStorei(F.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);var l=F.RGBA,t=F.RGBA,D=F.UNSIGNED_BYTE;if(u&&!this.isIE)switch(u){case 1:t=l=F.RGB;break;case 2:D=F.UNSIGNED_SHORT_4_4_4_4;break;case 3:D=F.UNSIGNED_SHORT_5_5_5_1;break;case 4:t=l=F.RGB,D=F.UNSIGNED_SHORT_5_6_5}if(1===this.version&&!C&&c){u=document.createElement("canvas");u.width=cr.nextHighestPowerOfTwo(a.width);u.height=cr.nextHighestPowerOfTwo(a.height);var S=u.getContext("2d");
S.imageSmoothingEnabled=m;S.drawImage(a,0,0,a.width,a.height,0,0,u.width,u.height);F.texImage2D(F.TEXTURE_2D,0,l,t,D,u)}else F.texImage2D(F.TEXTURE_2D,0,l,t,D,a);c?"repeat-x"===p?(F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_S,F.REPEAT),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_T,F.CLAMP_TO_EDGE)):("repeat-y"===p?F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_S,F.CLAMP_TO_EDGE):F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_S,F.REPEAT),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_T,F.REPEAT)):(F.texParameteri(F.TEXTURE_2D,
F.TEXTURE_WRAP_S,F.CLAMP_TO_EDGE),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_T,F.CLAMP_TO_EDGE));m?(F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MAG_FILTER,F.LINEAR),(C||2<=this.version)&&this.enable_mipmaps&&!x?(F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MIN_FILTER,F.LINEAR_MIPMAP_LINEAR),F.generateMipmap(F.TEXTURE_2D)):F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MIN_FILTER,F.LINEAR)):(F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MAG_FILTER,F.NEAREST),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MIN_FILTER,F.NEAREST));F.bindTexture(F.TEXTURE_2D,
null);this.lastTexture0=null;v.c2width=a.width;v.c2height=a.height;v.c2refcount=1;v.c2texkey=M;A.push(v);return e[M]=v};b.prototype.createEmptyTexture=function(a,c,m,u,p){this.endBatch();var x=this.gl;this.isIE&&(u=!1);var M=x.createTexture();x.bindTexture(x.TEXTURE_2D,M);x.texImage2D(x.TEXTURE_2D,0,x.RGBA,a,c,0,x.RGBA,u?x.UNSIGNED_SHORT_4_4_4_4:x.UNSIGNED_BYTE,null);p?(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,x.REPEAT),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,x.REPEAT)):(x.texParameteri(x.TEXTURE_2D,
x.TEXTURE_WRAP_S,x.CLAMP_TO_EDGE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,x.CLAMP_TO_EDGE));x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,m?x.LINEAR:x.NEAREST);x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,m?x.LINEAR:x.NEAREST);x.bindTexture(x.TEXTURE_2D,null);this.lastTexture0=null;M.c2width=a;M.c2height=c;A.push(M);return M};b.prototype.videoToTexture=function(a,c,m){this.endBatch();var u=this.gl;this.isIE&&(m=!1);u.bindTexture(u.TEXTURE_2D,c);u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,
!0);try{u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,m?u.UNSIGNED_SHORT_4_4_4_4:u.UNSIGNED_BYTE,a)}catch(p){console&&console.error&&console.error("Error updating WebGL texture: ",p)}u.bindTexture(u.TEXTURE_2D,null);this.lastTexture0=null};b.prototype.deleteTexture=function(a){a&&("undefined"!==typeof a.c2refcount&&1<a.c2refcount?a.c2refcount--:(this.endBatch(),a===this.lastTexture0&&(this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.lastTexture0=null),a===this.lastTexture1&&(this.gl.activeTexture(this.gl.TEXTURE1),
this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.activeTexture(this.gl.TEXTURE0),this.lastTexture1=null),cr.arrayFindRemove(A,a),"undefined"!==typeof a.c2texkey&&delete e[a.c2texkey],this.gl.deleteTexture(a)))};b.prototype.estimateVRAM=function(){var a=this.width*this.height*8,c;var m=0;for(c=A.length;m<c;m++){var u=A[m];a+=u.c2width*u.c2height*4}return a};b.prototype.textureCount=function(){return A.length};b.prototype.setRenderingToTexture=function(a){if(a!==this.renderToTex){var c=this.pushBatch();
c.type=6;this.renderToTex=c.texParam=a;this.hasPointBatchTop=this.hasQuadBatchTop=!1}};cr.GLWrap=b})();
(function(){function b(k){var r=k.canvas,E=k.projectDataUrl;r||(r=document.createElement("canvas"),document.body.appendChild(r));if(r&&r.getContext){window.c3runtime=this;window.c3canvas=r;var H=this;this.exportType=k.exportType;this.isPreview="preview"===this.exportType;this.isRemotePreview=!!k.isRemotePreview;this.isCrosswalk=/crosswalk/i.test(navigator.userAgent)||/xwalk/i.test(navigator.userAgent)||!("undefined"===typeof window.c2isCrosswalk||!window.c2isCrosswalk);this.isPhoneGap=this.isCordova=
"cordova"===this.exportType;this.isMicrosoftEdge=/edge\//i.test(navigator.userAgent);this.isIE=(/msie/i.test(navigator.userAgent)||/trident/i.test(navigator.userAgent)||/iemobile/i.test(navigator.userAgent))&&!this.isMicrosoftEdge;this.isTizen=/tizen/i.test(navigator.userAgent);this.isAndroid=/android/i.test(navigator.userAgent)&&!this.isTizen&&!this.isIE&&!this.isMicrosoftEdge;this.isiPhone=(/iphone/i.test(navigator.userAgent)||/ipod/i.test(navigator.userAgent))&&!this.isIE&&!this.isMicrosoftEdge;
this.isiPad=/ipad/i.test(navigator.userAgent);this.isiOS=this.isiPhone||this.isiPad;this.isChrome=(/chrome/i.test(navigator.userAgent)||/chromium/i.test(navigator.userAgent))&&!this.isIE&&!this.isMicrosoftEdge;this.isAmazonWebApp=/amazonwebappplatform/i.test(navigator.userAgent);this.isFirefox=/firefox/i.test(navigator.userAgent);this.isSafari=/safari/i.test(navigator.userAgent)&&!this.isChrome&&!this.isIE&&!this.isMicrosoftEdge;this.isWindows=/windows/i.test(navigator.userAgent);this.isNodeWebkit=
this.isNWjs="nwjs"===this.exportType||/nodewebkit/i.test(navigator.userAgent)||/nwjs/i.test(navigator.userAgent);this.isArcade="scirra-arcade"===this.exportType;this.isWindows8App=!("undefined"===typeof window.c2isWindows8||!window.c2isWindows8);this.isWindowsPhone8=!("undefined"===typeof window.c2isWindowsPhone8||!window.c2isWindowsPhone8);this.isWindowsPhone81=!("undefined"===typeof window.c2isWindowsPhone81||!window.c2isWindowsPhone81);this.isWindows10="windows-uwp"===this.exportType;this.isWinJS=
this.isWindows8App||this.isWindowsPhone81||this.isWindows10;this.isBlackberry10=!("undefined"===typeof window.c2isBlackberry10||!window.c2isBlackberry10);this.isAndroidStockBrowser=this.isAndroid&&!this.isChrome&&!this.isCrosswalk&&!this.isFirefox&&!this.isAmazonWebApp;this.devicePixelRatio=1;this.isMobile=this.isCordova||this.isCrosswalk||this.isAndroid||this.isiOS||this.isWindowsPhone8||this.isWindowsPhone81||this.isBlackberry10||this.isTizen;this.isMobile||(this.isMobile=/(blackberry|bb10|playbook|palm|symbian|nokia|windows\s+ce|phone|mobile|tablet|kindle|silk)/i.test(navigator.userAgent));
this.isWKWebView=!(!this.isiOS||!this.isCordova);this.isPreview&&!this.isNWjs&&("?nw"===window.location.search||/nodewebkit/i.test(navigator.userAgent)||/nwjs/i.test(navigator.userAgent))&&(this.isNWjs=!0);this.isDebug=this.isPreview&&-1<window.location.search.indexOf("debug");this.useFbInstant="undefined"!==typeof FBInstant&&!this.isPreview&&!this.isCordova;this.hasInitialized=!1;this.canvas=r;this.glwrap=this.gl=null;this.glUnmaskedRenderer="(unavailable)";this.enableFrontToBack=!1;this.earlyz_index=
0;this.ctx=null;this.firstInFullscreen=!1;this.oldHeight=this.oldWidth=0;this.canvas.oncontextmenu=function(B){B.preventDefault&&B.preventDefault();return!1};this.canvas.onselectstart=function(B){B.preventDefault&&B.preventDefault();return!1};this.canvas.ontouchstart=function(B){B.preventDefault&&B.preventDefault();return!1};this.isNWjs&&(window.ondragover=function(B){B.preventDefault();return!1},window.ondrop=function(B){B.preventDefault();return!1},window.nwgui&&window.nwgui.App.clearCache&&window.nwgui.App.clearCache());
if(this.isCordova&&this.isiOS){function B(){var L=document.activeElement;if(!L)return!1;var Q=L.tagName.toLowerCase(),R="email number password search tel text url".split(" ");if("textarea"===Q)return!0;if("input"===Q)return-1<R.indexOf(L.type.toLowerCase()||"text");a:{do{if(L.parentNode&&L.hasAttribute("contenteditable")){L=!0;break a}L=L.parentNode}while(L);L=!1}return L}window.addEventListener("focusout",function(){B()||(document.scrollingElement.scrollTop=0)})}this.projectDataUrl=E||"";this.width=
r.width;this.height=r.height;this.draw_width=this.width;this.draw_height=this.height;this.cssWidth=this.width;this.cssHeight=this.height;this.lastWindowWidth=window.innerWidth;this.lastWindowHeight=window.innerHeight;this.forceCanvasAlpha=!1;this.redraw=!0;this.isSuspended=!1;Date.now||(Date.now=function(){return+new Date});this.plugins=[];this.types={};this.types_lowercase={};this.types_by_index=[];this.behaviors=[];this.layouts={};this.layouts_by_index=[];this.eventsheets={};this.eventsheets_by_index=
[];this.wait_for_textures=[];this.triggers_to_postinit=[];this.all_global_vars=[];this.all_local_vars=[];this.shadowcasterBehavior=this.jumpthruBehavior=this.solidBehavior=null;this.deathRow={};this.isInClearDeathRow=this.hasPendingInstances=!1;this.isInOnDestroy=0;this.isEndingLayout=this.isRunningEvents=!1;this.createRow=[];this.isLoadingState=!1;this.loadFromSlot=this.saveToSlot="";this.loadFromJson=null;this.lastSaveJson="";this.suspendDrawing=this.signalledContinuousPreview=!1;this.fireOnCreateAfterLoad=
[];this.dt1=this.dt=0;this.minimumFramerate=30;this.cpuutilisation=this.logictime=0;this.timescale=1;this.kahanTime=new cr.KahanAdder;this.wallTime=new cr.KahanAdder;this.gpuTimeEndFrame=this.gpuTimeStartFrame=this.objectcount=this.framecount=this.execcount=this.tickcount_nosave=this.tickcount=this.last_fps_time=this.fps=this.last_tick_time=0;this.gpuCurUtilisation=-1;this.gpuLastUtilisation=0;this.changelayout=null;this.destroycallbacks=[];this.event_stack=[];this.event_stack_index=-1;this.localvar_stack=
[[]];this.trigger_depth=this.localvar_stack_index=0;this.pushEventStack(null);this.loop_stack=[];this.loop_stack_index=-1;this.next_puid=this.next_uid=0;this.layout_first_tick=!0;this.family_count=0;this.suspend_events=[];this.timeout_id=this.raf_id=-1;this.isloading=!0;this.stackLocalCount=this.loadingprogress=0;this.audioInstance=null;this.isInUserInputEvent=this.had_a_click=!1;this.objects_to_pretick=new cr.ObjectSet;this.objects_to_tick=new cr.ObjectSet;this.objects_to_tick2=new cr.ObjectSet;
this.registered_collisions=[];this.temp_poly=new cr.CollisionPoly([]);this.temp_poly2=new cr.CollisionPoly([]);this.allGroups=[];this.groups_by_name={};this.cndsBySid={};this.actsBySid={};this.varsBySid={};this.blocksBySid={};this.layout_ctx=this.layout_canvas=this.layout_tex=this.layer_tex=this.layer_ctx=this.layer_canvas=this.running_layout=null;this.uses_background_blending=this.is_WebGL_context_lost=!1;this.fx_tex=[null,null];this.fullscreen_scaling=0;this.files_subfolder="";this.objectsByUid=
{};this.webFontNames=this.loaderlogos=null;this.enhancedAccelerationPrecision=!0;this.snapshotCanvas=null;this.snapshotData="";this.objectRefTable=[];"html5"===this.exportType&&"file"===location.protocol.substr(0,4)&&alert("Exported games won't work until you upload them. (When running on the file: protocol, browsers block many features from working for security reasons.)");this.useFbInstant?(FBInstant.initializeAsync().then(function(){H.requestProjectData()}).catch(function(B){console.warn("[Instant Games] Unable to load: ",
B);H.requestProjectData()}),window.setTimeout(function(){H.hasInitialized||(console.warn("[Instant Games] Initialization timed out after 4 seconds. Continuing with Instant Games disabled."),H.useFbInstant=!1,H.requestProjectData())},4E3)):this.requestProjectData()}}function d(){var k=window.cordova&&window.cordova.plugins&&window.cordova.plugins.permissions;"object"!==typeof k&&Promise.reject("Permission API is not loaded");return Promise.resolve(k)}function h(k){return d().then(function(r){return new Promise(function(E,
H){r.requestPermission(r[k],function(B){E(B.hasPermission)},H)})})}function q(k){return d().then(function(r){return new Promise(function(E,H){r.checkPermission(r[k],function(B){E(B.hasPermission)},H)})})}function y(){try{return!!window.indexedDB}catch(k){return!1}}function A(k){k.target.result.createObjectStore("saves",{keyPath:"slot"})}function e(k,r,E,H){try{var B=indexedDB.open("_C2SaveStates");B.onupgradeneeded=A;B.onerror=H;B.onsuccess=function(L){L=L.target.result;L.onerror=H;L.transaction(["saves"],
"readwrite").objectStore("saves").put({slot:k,data:r}).onsuccess=E}}catch(L){H(L)}}function a(k,r,E){try{var H=indexedDB.open("_C2SaveStates");H.onupgradeneeded=A;H.onerror=E;H.onsuccess=function(B){B=B.target.result;B.onerror=E;var L=B.transaction(["saves"]).objectStore("saves").get(k);L.onsuccess=function(Q){L.result?r(L.result.data):r(null)}}}catch(B){E(B)}}function c(){cr.logexport("Reloading for continuous preview");-1<window.location.search.indexOf("continuous")?window.location.reload(!0):window.location+=
"?continuous"}function m(k){var r,E={};for(r in k)!k.hasOwnProperty(r)||k[r]instanceof cr.ObjectSet||k[r]&&"undefined"!==typeof k[r].c2userdata||"spriteCreatedDestroyCallback"!==r&&(E[r]=k[r]);return E}var u=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame,p=new Audio,x={"audio/webm; codecs=opus":!!p.canPlayType("audio/webm; codecs=opus"),"audio/ogg; codecs=opus":!!p.canPlayType("audio/ogg; codecs=opus"),
"audio/webm; codecs=vorbis":!!p.canPlayType("audio/webm; codecs=vorbis"),"audio/ogg; codecs=vorbis":!!p.canPlayType("audio/ogg; codecs=vorbis"),"audio/mp4":!!p.canPlayType("audio/mp4"),"audio/mpeg":!!p.canPlayType("audio/mpeg")};p=null;b.prototype.requestProjectData=function(){if(!this.hasInitialized){this.hasInitialized=!0;var k=this;if(this.isWKWebView)this.fetchLocalFileViaCordovaAsText("data.js",function(B){k.loadProject(JSON.parse(B))},function(B){alert("Error fetching data.js")});else{var r=
this.isWindowsPhone8?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest;var E=this.projectDataUrl||"data.js";if(this.isWindows8App||this.isWindowsPhone8||this.isWindowsPhone81||this.isWindows10)E="data.json";r.open("GET",E,!0);var H=!1;if("response"in r&&"responseType"in r)try{r.responseType="json",H="json"===r.responseType}catch(B){H=!1}if(!H&&"responseType"in r)try{r.responseType="text"}catch(B){}if("overrideMimeType"in r)try{r.overrideMimeType("application/json; charset=utf-8")}catch(B){}this.isWindowsPhone8?
r.onreadystatechange=function(){4===r.readyState&&k.loadProject(JSON.parse(r.responseText))}:(r.onload=function(){H?k.loadProject(r.response):k.loadProject(JSON.parse(r.responseText))},r.onerror=function(B){cr.logerror("Error requesting "+E+":");cr.logerror(B)});r.send()}}};b.prototype.initRendererAndLoader=function(){var k=this,r,E;this.isRetina=this.useHighDpi&&!this.isAndroidStockBrowser;0===this.fullscreen_mode&&this.isiOS&&(this.isRetina=!1);var H=window.devicePixelRatio||window.webkitDevicePixelRatio||
window.mozDevicePixelRatio||window.msDevicePixelRatio||1;this.devicePixelRatio=this.isRetina?H:1;"object"===typeof window.StatusBar&&window.StatusBar.hide();"object"===typeof window.AndroidFullScreen&&window.AndroidFullScreen.immersiveMode();this.ClearDeathRow();0<this.fullscreen_mode&&this.setSize(window.innerWidth,window.innerHeight,!0);try{if(this.enableWebGL){var B={alpha:!0,depth:!1,antialias:!1,failIfMajorPerformanceCaveat:!0};this.isAndroid||(this.gl=this.canvas.getContext("webgl2",B));this.gl||
(this.gl=this.canvas.getContext("webgl",B)||this.canvas.getContext("experimental-webgl",B))}}catch(ba){}if(this.gl){this.gl.getParameter(this.gl.VERSION).indexOf("WebGL 2");if(H=this.gl.getExtension("WEBGL_debug_renderer_info"))B=this.gl.getParameter(H.UNMASKED_VENDOR_WEBGL),this.glUnmaskedRenderer=this.gl.getParameter(H.UNMASKED_RENDERER_WEBGL)+" ["+B+"]";this.enableFrontToBack&&(this.glUnmaskedRenderer+=" [front-to-back enabled]");this.overlay_canvas=document.createElement("canvas");this.canvas.parentNode.appendChild(this.overlay_canvas);
this.overlay_canvas.oncontextmenu=function(ba){return!1};this.overlay_canvas.onselectstart=function(ba){return!1};this.overlay_canvas.width=Math.round(this.cssWidth*this.devicePixelRatio);this.overlay_canvas.height=Math.round(this.cssHeight*this.devicePixelRatio);this.overlay_canvas.style.width=this.cssWidth+"px";this.overlay_canvas.style.height=this.cssHeight+"px";this.overlay_canvas.style.position="absolute";this.overlay_ctx=this.overlay_canvas.getContext("2d");this.glwrap=new cr.GLWrap(this.gl,
this.isMobile,this.enableFrontToBack);this.glwrap.setSize(this.canvas.width,this.canvas.height);this.glwrap.enable_mipmaps=0!==this.downscalingQuality;this.ctx=null;this.canvas.addEventListener("webglcontextlost",function(ba){ba.preventDefault();k.onContextLost();cr.logexport("[Construct 2] WebGL context lost");window.cr_setSuspended(!0)},!1);this.canvas.addEventListener("webglcontextrestored",function(ba){k.glwrap.initState();k.glwrap.setSize(k.glwrap.width,k.glwrap.height,!0);k.layer_tex=null;k.layout_tex=
null;k.fx_tex[0]=null;k.fx_tex[1]=null;k.onContextRestored();k.redraw=!0;cr.logexport("[Construct 2] WebGL context restored");window.cr_setSuspended(!1)},!1);this.glwrap.supportsGpuProfiling()||(this.gpuLastUtilisation=NaN);H=0;for(B=this.types_by_index.length;H<B;H++){var L=this.types_by_index[H];var Q=0;for(r=L.effect_types.length;Q<r;Q++){var R=L.effect_types[Q];R.shaderindex=this.glwrap.getShaderIndex(R.id);R.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(R.shaderindex);this.uses_background_blending=
this.uses_background_blending||this.glwrap.programUsesDest(R.shaderindex)}}H=0;for(B=this.layouts_by_index.length;H<B;H++){var T=this.layouts_by_index[H];Q=0;for(r=T.effect_types.length;Q<r;Q++)R=T.effect_types[Q],R.shaderindex=this.glwrap.getShaderIndex(R.id),R.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(R.shaderindex);T.updateActiveEffects();Q=0;for(r=T.layers.length;Q<r;Q++){var fa=T.layers[Q];L=0;for(E=fa.effect_types.length;L<E;L++)R=fa.effect_types[L],R.shaderindex=this.glwrap.getShaderIndex(R.id),
R.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(R.shaderindex),this.uses_background_blending=this.uses_background_blending||this.glwrap.programUsesDest(R.shaderindex);fa.updateActiveEffects()}}}else B={alpha:!0},this.ctx=this.canvas.getContext("2d",B),this.ctx.imageSmoothingEnabled=this.linearSampling,this.overlay_ctx=this.overlay_canvas=null,this.gpuLastUtilisation=NaN,this.fullscreenScalingQuality=this.wantFullscreenScalingQuality=!0;this.tickFunc=function(ba){k.tick(!1,ba)};window==
window.top||this.isWinJS||this.isWindowsPhone8||(document.addEventListener("mousedown",function(){window.focus()},!0),document.addEventListener("touchstart",function(){window.focus()},!0));this.isPreview&&(-1<window.location.search.indexOf("continuous")&&(cr.logexport("Reloading for continuous preview"),this.loadFromSlot="__c2_continuouspreview",this.suspendDrawing=!0),this.pauseOnBlur&&!this.isMobile&&(window.addEventListener("focus",function(){k.setSuspended(!1)}),window.addEventListener("blur",
function(){var ba=window.parent;ba&&ba.document.hasFocus()||k.setSuspended(!0)})));window.addEventListener("blur",function(){k.onWindowBlur()});H=function(ba){"mousedown"===ba.type&&1===ba.button&&ba.preventDefault();if(cr.isCanvasInputEvent(ba)&&document.activeElement&&document.activeElement!==document.getElementsByTagName("body")[0]&&document.activeElement.blur)try{document.activeElement.blur()}catch(Z){}};"undefined"!==typeof PointerEvent?document.addEventListener("pointerdown",H):window.navigator.msPointerEnabled?
document.addEventListener("MSPointerDown",H):document.addEventListener("touchstart",H);document.addEventListener("mousedown",H);0===this.fullscreen_mode&&this.isRetina&&1<this.devicePixelRatio?this.setSize(this.original_width,this.original_height,!0):this.setSize(window.innerWidth,window.innerHeight,!0);this.tryLockOrientation();this.getready();this.go();this.extra={};cr.seal(this)};b.prototype.setSize=function(k,r,E){var H=0,B=0;if(this.lastWindowWidth!==k||this.lastWindowHeight!==r||E){if(this.isiPhone&&
this.isCordova&&window.screen){var L=document.documentElement.style;var Q=document.body.style;var R=window.innerWidth<window.innerHeight;var T=R?window.screen.height:window.screen.width;R=R?window.screen.width:window.screen.height;T&&R&&(Q.height=L.height=T+"px",Q.width=L.width=R+"px")}this.lastWindowWidth=k;this.lastWindowHeight=r;L=this.fullscreen_mode;if((Q=(document.mozFullScreen||document.webkitIsFullScreen||!!document.msFullscreenElement||document.fullScreen)&&!this.isCordova)||0!==this.fullscreen_mode||
E)Q&&(L=this.fullscreen_scaling),E=this.devicePixelRatio,4<=L?(5===L&&1!==E&&(k+=1,r+=1),Q=this.original_width/this.original_height,k/r>Q?(Q*=r,5===L?(H=Q*E/this.original_width,1<H?H=Math.floor(H):1>H&&(H=1/Math.ceil(1/H)),Q=this.original_width*H/E,T=this.original_height*H/E,H=(k-Q)/2,B=(r-T)/2,k=Q,r=T):(H=(k-Q)/2,k=Q)):(T=k/Q,5===L?(H=T*E/this.original_height,1<H?H=Math.floor(H):1>H&&(H=1/Math.ceil(1/H)),Q=this.original_width*H/E,T=this.original_height*H/E,H=(k-Q)/2,B=(r-T)/2,k=Q):B=(r-T)/2,r=T)):
Q&&0===L&&(H=Math.floor((k-this.original_width)/2),B=Math.floor((r-this.original_height)/2),k=this.original_width,r=this.original_height),2>L&&(this.aspect_scale=E),this.cssWidth=Math.round(k),this.cssHeight=Math.round(r),this.width=Math.round(k*E),this.height=Math.round(r*E),this.redraw=!0,this.wantFullscreenScalingQuality?(this.draw_width=this.width,this.draw_height=this.height,this.fullscreenScalingQuality=!0):this.width<this.original_width&&this.height<this.original_height||1===L?(this.draw_width=
this.width,this.draw_height=this.height,this.fullscreenScalingQuality=!0):(this.draw_width=this.original_width,this.draw_height=this.original_height,this.fullscreenScalingQuality=!1,2===L?(Q=this.original_width/this.original_height,L=this.lastWindowWidth/this.lastWindowHeight,L<Q?this.draw_width=this.draw_height*L:L>Q&&(this.draw_height=this.draw_width/L)):3===L&&(Q=this.original_width/this.original_height,L=this.lastWindowWidth/this.lastWindowHeight,L>Q?this.draw_width=this.draw_height*L:L<Q&&(this.draw_height=
this.draw_width/L))),this.canvas&&(this.canvas.width=Math.round(k*E),this.canvas.height=Math.round(r*E),this.isRetina&&(this.canvas.style.width=Math.round(k)+"px",this.canvas.style.height=Math.round(r)+"px"),this.canvas.style.marginLeft=Math.floor(H)+"px",this.canvas.style.marginTop=Math.floor(B)+"px"),this.overlay_canvas&&(this.overlay_canvas.width=Math.round(k*E),this.overlay_canvas.height=Math.round(r*E),this.overlay_canvas.style.width=this.cssWidth+"px",this.overlay_canvas.style.height=this.cssHeight+
"px",this.overlay_canvas.style.left=Math.floor(H)+"px",this.overlay_canvas.style.top=Math.floor(B)+"px"),this.glwrap&&this.glwrap.setSize(Math.round(k*E),Math.round(r*E)),this.ctx&&(this.ctx.imageSmoothingEnabled=this.linearSampling),this.tryLockOrientation(),this.isiPhone&&!this.isCordova&&window.scrollTo(0,0)}};b.prototype.tryLockOrientation=function(){if(this.autoLockOrientation&&0!==this.orientations){var k="portrait";2===this.orientations&&(k="landscape");try{screen.orientation&&screen.orientation.lock?
screen.orientation.lock(k).catch(function(){}):screen.lockOrientation?screen.lockOrientation(k):screen.webkitLockOrientation?screen.webkitLockOrientation(k):screen.mozLockOrientation?screen.mozLockOrientation(k):screen.msLockOrientation&&screen.msLockOrientation(k)}catch(r){console&&console.warn&&console.warn("Failed to lock orientation: ",r)}}};b.prototype.onContextLost=function(){this.glwrap.contextLost();this.is_WebGL_context_lost=!0;var k;var r=0;for(k=this.types_by_index.length;r<k;r++){var E=
this.types_by_index[r];if(E.onLostWebGLContext)E.onLostWebGLContext()}};b.prototype.onContextRestored=function(){this.is_WebGL_context_lost=!1;var k;var r=0;for(k=this.types_by_index.length;r<k;r++){var E=this.types_by_index[r];if(E.onRestoreWebGLContext)E.onRestoreWebGLContext()}};var M=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame||window.oCancelAnimationFrame;b.prototype.setSuspended=function(k){var r;if(k&&!this.isSuspended)for(cr.logexport("[Construct 2] Suspending"),
this.isSuspended=!0,-1!==this.raf_id&&M(this.raf_id),-1!==this.timeout_id&&clearTimeout(this.timeout_id),k=0,r=this.suspend_events.length;k<r;k++)this.suspend_events[k](!0);else if(!k&&this.isSuspended){cr.logexport("[Construct 2] Resuming");this.isSuspended=!1;this.last_tick_time=cr.performance_now();this.last_fps_time=cr.performance_now();k=this.logictime=this.framecount=0;for(r=this.suspend_events.length;k<r;k++)this.suspend_events[k](!1);this.tick(!1)}};b.prototype.addSuspendCallback=function(k){this.suspend_events.push(k)};
b.prototype.GetObjectReference=function(k){return this.objectRefTable[k]};b.prototype.loadProject=function(k){k&&k.project||cr.logerror("Project model unavailable");k=k.project;this.name=k[0];this.first_layout=k[1];this.fullscreen_mode=k[12];this.fullscreen_mode_set=k[12];this.original_width=k[10];this.original_height=k[11];this.parallax_x_origin=this.original_width/2;this.parallax_y_origin=this.original_height/2;this.uses_loader_layout=k[18];this.loaderstyle=k[19];this.iconsFolder=k[28];this.webFontNames=
k[29].map(function(ka){return ka[0]});if(0===this.loaderstyle){var r=new Image;r.crossOrigin="anonymous";var E=this.loaderlogos={logo:r};r.addEventListener("error",function(){E.logo=null});var H=k[39];H=this.isPreview?this.getProjectFileUrl(H):this.iconsFolder+H;this.setImageSrc(r,H)}else if(4===this.loaderstyle){r=new Image;r.src="splash-images/splash-logo.svg";H=new Image;H.src="splash-images/splash-poweredby-512.png";var B=new Image;B.src="splash-images/splash-poweredby-256.png";var L=new Image;
L.src="splash-images/splash-poweredby-128.png";var Q=new Image;Q.src="splash-images/splash-website-512.png";var R=new Image;R.src="splash-images/splash-website-256.png";var T=new Image;T.src="splash-images/splash-website-128.png";this.loaderlogos={logo:r,powered:[H,B,L],website:[Q,R,T]}}this.next_uid=k[21];this.objectRefTable=cr.getObjectRefTable();this.system=new cr.system_object(this);r=0;for(H=k[2].length;r<H;r++){T=k[2][r];B=this.GetObjectReference(T[0]);cr.add_common_aces(T,B.prototype);var fa=
new B(this);fa.singleglobal=T[1];fa.is_world=T[2];fa.is_rotatable=T[5];fa.must_predraw=T[9];if(fa.onCreate)fa.onCreate();cr.seal(fa);this.plugins.push(fa)}this.objectRefTable=cr.getObjectRefTable();r=0;for(H=k[3].length;r<H;r++){T=k[3][r];Q=this.GetObjectReference(T[1]);fa=null;B=0;for(L=this.plugins.length;B<L;B++)if(this.plugins[B]instanceof Q){fa=this.plugins[B];break}var ba=new fa.Type(fa);ba.name=T[0];ba.is_family=T[2];ba.instvar_sids=T[3].slice(0);ba.vars_count=T[3].length;ba.behs_count=T[4];
ba.fx_count=T[5];ba.sid=T[11];ba.is_family?(ba.members=[],ba.family_index=this.family_count++,ba.families=null):(ba.members=null,ba.family_index=-1,ba.families=[]);ba.family_var_map=null;ba.family_beh_map=null;ba.family_fx_map=null;ba.is_contained=!1;ba.container=null;T[6]?(ba.texture_file=T[6][0],ba.texture_filesize=T[6][1],ba.texture_pixelformat=T[6][2],ba.texture_data=T[6]):(ba.texture_file=null,ba.texture_filesize=0,ba.texture_pixelformat=0,ba.texture_data=null);ba.animations=T[7]?T[7]:null;ba.index=
r;ba.instances=[];ba.deadCache=[];ba.solstack=[new cr.selection(ba)];ba.cur_sol=0;ba.default_instance=null;ba.default_layerindex=0;ba.stale_iids=!0;ba.updateIIDs=cr.type_updateIIDs;ba.getFirstPicked=cr.type_getFirstPicked;ba.getPairedInstance=cr.type_getPairedInstance;ba.getCurrentSol=cr.type_getCurrentSol;ba.pushCleanSol=cr.type_pushCleanSol;ba.pushCopySol=cr.type_pushCopySol;ba.popSol=cr.type_popSol;ba.getBehaviorByName=cr.type_getBehaviorByName;ba.getBehaviorIndexByName=cr.type_getBehaviorIndexByName;
ba.getEffectIndexByName=cr.type_getEffectIndexByName;ba.applySolToContainer=cr.type_applySolToContainer;ba.getInstanceByIID=cr.type_getInstanceByIID;ba.collision_grid=new cr.SparseGrid(this.original_width,this.original_height);ba.any_cell_changed=!0;ba.any_instance_parallaxed=!1;ba.extra={};ba.toString=cr.type_toString;ba.behaviors=[];B=0;for(L=T[8].length;B<L;B++){var Z=T[8][B];var da=this.GetObjectReference(Z[1]),ia=null;Q=0;for(R=this.behaviors.length;Q<R;Q++)if(this.behaviors[Q]instanceof da){ia=
this.behaviors[Q];break}if(!ia){ia=new da(this);ia.my_types=[];ia.my_instances=new cr.ObjectSet;if(ia.onCreate)ia.onCreate();cr.seal(ia);this.behaviors.push(ia);cr.behaviors.solid&&ia instanceof cr.behaviors.solid&&(this.solidBehavior=ia);cr.behaviors.jumpthru&&ia instanceof cr.behaviors.jumpthru&&(this.jumpthruBehavior=ia);cr.behaviors.shadowcaster&&ia instanceof cr.behaviors.shadowcaster&&(this.shadowcasterBehavior=ia)}-1===ia.my_types.indexOf(ba)&&ia.my_types.push(ba);Q=new ia.Type(ia,ba);Q.name=
Z[0];Q.sid=Z[2];Q.onCreate();cr.seal(Q);ba.behaviors.push(Q)}ba.global=T[9];ba.isOnLoaderLayout=T[10];ba.effect_types=[];B=0;for(L=T[12].length;B<L;B++)ba.effect_types.push({id:T[12][B][0],name:T[12][B][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:B});B=T[13];ba.tile_poly_data=B?B[0]:null;if(!this.uses_loader_layout||ba.is_family||ba.isOnLoaderLayout||!fa.is_world)ba.onCreate(),cr.seal(ba);ba.name&&(this.types[ba.name]=ba,this.types_lowercase[ba.name.toLowerCase()]=ba);this.types_by_index.push(ba);
fa.singleglobal&&(B=new fa.Instance(ba),B.uid=this.next_uid++,B.puid=this.next_puid++,B.iid=0,B.get_iid=cr.inst_get_iid,B.toString=cr.inst_toString,B.properties=T[16],B.onCreate(),cr.seal(B),ba.instances.push(B),this.objectsByUid[B.uid.toString()]=B)}r=0;for(H=k[4].length;r<H;r++)for(Q=k[4][r],R=this.types_by_index[Q[0]],B=1,L=Q.length;B<L;B++)T=this.types_by_index[Q[B]],T.families.push(R),R.members.push(T);r=0;for(H=k[27].length;r<H;r++){Q=k[27][r];R=[];B=0;for(L=Q.length;B<L;B++)R.push(this.types_by_index[Q[B]]);
B=0;for(L=R.length;B<L;B++)R[B].is_contained=!0,R[B].container=R}if(0<this.family_count)for(r=0,H=this.types_by_index.length;r<H;r++)if(T=this.types_by_index[r],!T.is_family&&T.families.length){T.family_var_map=Array(this.family_count);T.family_beh_map=Array(this.family_count);T.family_fx_map=Array(this.family_count);ba=[];B=ia=da=Z=0;for(L=T.families.length;B<L;B++)for(fa=T.families[B],T.family_var_map[fa.family_index]=Z,Z+=fa.vars_count,T.family_beh_map[fa.family_index]=da,da+=fa.behs_count,T.family_fx_map[fa.family_index]=
ia,ia+=fa.fx_count,Q=0,R=fa.effect_types.length;Q<R;Q++)ba.push(cr.shallowCopy({},fa.effect_types[Q]));T.effect_types=ba.concat(T.effect_types);B=0;for(L=T.effect_types.length;B<L;B++)T.effect_types[B].index=B}r=0;for(H=k[5].length;r<H;r++)T=k[5][r],B=new cr.layout(this,T),cr.seal(B),this.layouts[B.name]=B,this.layouts_by_index.push(B);r=0;for(H=k[6].length;r<H;r++)T=k[6][r],B=new cr.eventsheet(this,T),cr.seal(B),this.eventsheets[B.name]=B,this.eventsheets_by_index.push(B);r=0;for(H=this.eventsheets_by_index.length;r<
H;r++)this.eventsheets_by_index[r].postInit();r=0;for(H=this.eventsheets_by_index.length;r<H;r++)this.eventsheets_by_index[r].updateDeepIncludes();r=0;for(H=this.triggers_to_postinit.length;r<H;r++)this.triggers_to_postinit[r].postInit();cr.clearArray(this.triggers_to_postinit);this.audio_files_info=k[7];this.audio_files_map={};r=0;for(H=this.audio_files_info.length;r<H;++r)B=this.audio_files_info[r],this.audio_files_map[B[0]]=B[1];this.files_subfolder=k[8];this.pixel_rounding=k[9];this.aspect_scale=
1;this.enableWebGL=k[13];this.linearSampling=k[14];this.clearBackground=k[15];this.versionstr=k[16];this.useHighDpi=k[17];this.orientations=k[20];this.autoLockOrientation=0<this.orientations;this.pauseOnBlur=k[22];this.fullscreenScalingQuality=this.wantFullscreenScalingQuality=k[23];this.downscalingQuality=k[24];this.preloadSounds=k[25];this.enableFrontToBack=k[26]&&!this.isIE;this.enhancedAccelerationPrecision=k[30];this.start_time=Date.now();cr.clearArray(this.objectRefTable);this.preloadSounds||
x["audio/webm; codecs=opus"]||!window.OpusDecoder||window.OpusDecoder.Initialise();this.initRendererAndLoader()};var v=!1;b.prototype.waitForImageLoad=function(k,r){window.cr_remotePreviewImageFiles&&r&&"blob:"!==r.substr(0,5)&&(r=window.cr_remotePreviewImageFiles[r]);k.onerror=function(E){v=k.c2error=!0;console&&console.error&&console.error("Error loading image '"+k.src+"': ",E)};k.src||("undefined"!==typeof XAPKReader?XAPKReader.get(r,function(E){k.src=E},function(E){v=k.c2error=!0;console&&console.error&&
console.error("Error extracting image '"+r+"' from expansion file: ",E)}):(k.crossOrigin="anonymous",this.setImageSrc(k,r)));this.wait_for_textures.push(k)};b.prototype.findWaitingTexture=function(k){var r;var E=0;for(r=this.wait_for_textures.length;E<r;E++)if(this.wait_for_textures[E].cr_src===k)return this.wait_for_textures[E];return null};var F=0,C=!1;b.prototype.getready=function(){if(this.audioInstance&&this.preloadSounds){var k=[],r;var E=0;for(r=this.audio_files_info.length;E<r;++E){var H=
this.audio_files_info[E];var B=H[0];var L=H[2];(H=this.getPreferredAudioFile(B))&&!L&&k.push({filename:B+H[1],size:H[2],type:H[0]})}F=this.audioInstance.setPreloadList(k)}};b.prototype.areAllTexturesAndSoundsLoaded=function(){var k=F,r=0,E=!0,H;var B=0;for(H=this.wait_for_textures.length;B<H;B++){var L=this.wait_for_textures[B];var Q=L.cr_filesize;if(!Q||0>=Q)Q=5E4;k+=Q;L.src&&L.complete&&!L.c2error?r+=Q:E=!1}E&&this.preloadSounds&&this.audioInstance&&(C||(this.audioInstance.startPreloads(),C=!0),
B=this.audioInstance.getPreloadedSize(),r+=B,B<F&&(E=!1));this.progress=0==k?1:r/k;return E};var l=!1;b.prototype.go=function(){if(this.ctx||this.glwrap){var k=this.ctx||this.overlay_ctx;if(0<this.fullscreen_mode){var r=window.innerWidth,E=window.innerHeight;this.lastWindowWidth===r&&this.lastWindowHeight===E||this.setSize(r,E)}this.progress=0;this.last_progress=-1;var H=this;if(this.areAllTexturesAndSoundsLoaded()&&(4!==this.loaderstyle||l))this.useFbInstant?FBInstant.startGameAsync().then(function(){H.go_loading_finished()}):
this.go_loading_finished();else{this.useFbInstant&&FBInstant.setLoadingProgress(100*this.progress);E=Date.now()-this.start_time;if(k){var B=this.width,L=this.height;r=this.devicePixelRatio;if(3>this.loaderstyle&&500<=E&&this.last_progress!=this.progress){k.clearRect(0,0,B,L);E=B/2;L/=2;B=0===this.loaderstyle&&this.loaderlogos.logo&&this.loaderlogos.logo.complete;var Q=40*r,R=0,T=80*r;if(B){var fa=this.loaderlogos.logo;T=fa.width*r;var ba=fa.height*r;Q=T/2;R=ba/2;k.drawImage(fa,cr.floor(E-Q),cr.floor(L-
R),T,ba)}1>=this.loaderstyle?(L+=R+(B?12*r:0),E=cr.floor(E-Q)+.5,L=cr.floor(L)+.5,k.fillStyle=v?"red":"DodgerBlue",k.fillRect(E,L,Math.floor(T*this.progress),6*r),k.strokeStyle="black",k.strokeRect(E,L,T,6*r),k.strokeStyle="white",k.strokeRect(E-1*r,L-1*r,T+2*r,8*r)):2===this.loaderstyle&&(k.font="12pt Arial",k.fillStyle=v?"#f00":"#999",k.textBaseLine="middle",r=Math.round(100*this.progress)+"%",B=k.measureText?k.measureText(r):null,k.fillText(r,E-(B?B.width:0)/2,L));this.last_progress=this.progress}else if(4===
this.loaderstyle){this.draw_c3_splash_loader(k);u?u(function(){H.go()}):setTimeout(function(){H.go()},16);return}}setTimeout(function(){H.go()},100)}}};var t=-1,D=!0,S=!1,V=0,K=0,f=null,n=null,G=0;b.prototype.draw_c3_splash_loader=function(k){if(!l){var r=this.isPreview||this.useFbInstant,E=r?0:200,H=r?0:3E3,B=Math.ceil(this.width),L=Math.ceil(this.height),Q=this.loaderlogos.logo,R=this.loaderlogos.powered,T=this.loaderlogos.website;if(Q.complete){for(var fa=0;3>fa;++fa)if(!R[fa].complete||!T[fa].complete)return;
0===G&&(t=Date.now());fa=Date.now();var ba=!1,Z=k;D||S?(k.clearRect(0,0,B,L),f&&f.width===B&&f.height===L||(f=document.createElement("canvas"),f.width=B,f.height=L,n=f.getContext("2d")),Z=n,ba=!0,D&&1===G&&(t=Date.now())):k.globalAlpha=1;Z.fillStyle="#3B4045";Z.fillRect(0,0,B,L);try{if(256<this.cssHeight){var da=1.5*cr.clamp(.22*L,105,.6*B);var ia=da/8;Z.drawImage(128>=da?R[2]:256>=da?R[1]:R[0],.5*B-da/2,.2*L-ia/2,da,ia);ia=da=Math.min(.395*L,.95*B);Z.drawImage(Q,.5*B-da/2,.485*L-ia/2,da,ia);da=1.5*
cr.clamp(.22*L,105,.6*B);ia=da/8;Z.drawImage(128>=da?T[2]:256>=da?T[1]:T[0],.5*B-da/2,.868*L-ia/2,da,ia);Z.fillStyle="#4D565D";da=B;ia=Math.max(.005*L,2);Z.fillRect(0,.8*L-ia/2,da,ia);Z.fillStyle=v?"red":"#29F3D0";da=B*this.progress;Z.fillRect(.5*B-da/2,.8*L-ia/2,da,ia)}else ia=da=.55*L,Z.drawImage(Q,.5*B-da/2,.45*L-ia/2,da,ia),Z.fillStyle="#4D565D",da=B,ia=Math.max(.005*L,2),Z.fillRect(0,.85*L-ia/2,da,ia),Z.fillStyle=v?"red":"#29F3D0",da=B*this.progress,Z.fillRect(.5*B-da/2,.85*L-ia/2,da,ia);ba&&
(D?k.globalAlpha=0===G?0:Math.min((fa-t)/300,1):S&&(k.globalAlpha=Math.max(1-(fa-K)/300,0)),k.drawImage(f,0,0,B,L))}catch(ka){}D&&300<=fa-t&&2<=G&&(D=!1,V=fa);!D&&fa-V>=H&&!S&&1<=this.progress&&(S=!0,K=fa);if(S&&fa-K>=300+E||r&&1<=this.progress&&500>Date.now()-t)l=!0,S=D=!1,this.loaderlogos=n=f=null;++G}}};b.prototype.go_loading_finished=function(){if(this.webFontNames.length&&document.fonts&&document.fonts.load){var k=this;Promise.all(this.webFontNames.map(function(r){return document.fonts.load("1em '"+
r+"'")})).then(function(){k.start_first_layout()})}else this.start_first_layout()};b.prototype.start_first_layout=function(){this.overlay_canvas&&(this.canvas.parentNode.removeChild(this.overlay_canvas),this.overlay_canvas=this.overlay_ctx=null);this.start_time=Date.now();this.last_fps_time=cr.performance_now();var k;if(this.uses_loader_layout){var r=0;for(k=this.types_by_index.length;r<k;r++){var E=this.types_by_index[r];E.is_family||E.isOnLoaderLayout||!E.plugin.is_world||(E.onCreate(),cr.seal(E))}}else this.isloading=
!1;r=0;for(k=this.layouts_by_index.length;r<k;r++)this.layouts_by_index[r].createGlobalNonWorlds();2<=this.fullscreen_mode&&(r=this.original_width/this.original_height,k=this.width/this.height,this.aspect_scale=2!==this.fullscreen_mode&&k>r||2===this.fullscreen_mode&&k<r?this.height/this.original_height:this.width/this.original_width);r=0;for(k=this.types_by_index.length;r<k;r++)if(E=this.types_by_index[r],E.onBeforeAppBegin)E.onBeforeAppBegin();this.first_layout?this.layouts[this.first_layout].startRunning():
this.layouts_by_index[0].startRunning();this.uses_loader_layout||(this.loadingprogress=1,this.trigger(cr.system_object.prototype.cnds.OnLoadFinished,null),window.C3_RegisterSW&&window.C3_RegisterSW());navigator.splashscreen&&navigator.splashscreen.hide&&navigator.splashscreen.hide();r=0;for(k=this.types_by_index.length;r<k;r++)if(E=this.types_by_index[r],E.onAppBegin)E.onAppBegin();r=function(){document.hidden||document.webkitHidden||document.mozHidden||document.msHidden?window.cr_setSuspended(!0):
window.cr_setSuspended(!1)};document.addEventListener("visibilitychange",r,!1);document.addEventListener("mozvisibilitychange",r,!1);document.addEventListener("webkitvisibilitychange",r,!1);document.addEventListener("msvisibilitychange",r,!1);this.isCordova&&(document.addEventListener("pause",function(){window.cr_setSuspended(!0)}),document.addEventListener("resume",function(){window.cr_setSuspended(!1)}));document.hidden||document.webkitHidden||document.mozHidden||document.msHidden?window.cr_setSuspended(!0):
this.tick(!1)};b.prototype.tick=function(k,r,E){if(this.running_layout){var H=cr.performance_now();if(E||!this.isSuspended||k){k||(u?this.raf_id=u(this.tickFunc):this.timeout_id=setTimeout(this.tickFunc,this.isMobile?1:16));r=r||H;var B=this.fullscreen_mode;(E=(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||!!document.msFullscreenElement)&&!this.isCordova)&&0<this.fullscreen_scaling&&(B=this.fullscreen_scaling);if(0<B){B=window.innerWidth;var L=window.innerHeight;this.lastWindowWidth===
B&&this.lastWindowHeight===L||this.setSize(B,L)}E?this.firstInFullscreen||(this.firstInFullscreen=!0):this.firstInFullscreen?(this.firstInFullscreen=!1,0===this.fullscreen_mode&&this.setSize(Math.round(this.oldWidth/this.devicePixelRatio),Math.round(this.oldHeight/this.devicePixelRatio),!0)):(this.oldWidth=this.width,this.oldHeight=this.height);this.isloading&&(E=this.areAllTexturesAndSoundsLoaded(),this.loadingprogress=this.progress,E&&(this.isloading=!1,this.progress=1,this.trigger(cr.system_object.prototype.cnds.OnLoadFinished,
null),window.C3_RegisterSW&&window.C3_RegisterSW()));this.logic(r);!this.redraw||this.is_WebGL_context_lost||this.suspendDrawing||k||(this.redraw=!1,this.glwrap?this.drawGL():this.draw(),this.snapshotCanvas&&(this.canvas&&this.canvas.toDataURL&&(this.snapshotData=this.canvas.toDataURL(this.snapshotCanvas[0],this.snapshotCanvas[1]),window.cr_onSnapshot&&window.cr_onSnapshot(this.snapshotData),this.trigger(cr.system_object.prototype.cnds.OnCanvasSnapshot,null)),this.snapshotCanvas=null));this.hit_breakpoint||
(this.tickcount++,this.tickcount_nosave++,this.execcount++,this.framecount++);this.logictime+=cr.performance_now()-H}}};b.prototype.logic=function(k){var r;1E3<=k-this.last_fps_time&&(this.last_fps_time+=1E3,1E3<=k-this.last_fps_time&&(this.last_fps_time=k),this.fps=this.framecount,this.framecount=0,this.cpuutilisation=Math.min(this.logictime,1E3),this.logictime=0,this.glwrap&&0===this.gpuTimeEndFrame&&(this.gpuTimeEndFrame=this.glwrap.getFrameNumber(),this.gpuCurUtilisation=-1));this.glwrap&&-1===
this.gpuCurUtilisation&&this.glwrap.supportsGpuProfiling()&&(this.gpuCurUtilisation=this.glwrap.getFrameRangeTimerResults(this.gpuTimeStartFrame,this.gpuTimeEndFrame),-1!==this.gpuCurUtilisation&&(this.glwrap.deleteTimerResultsToFrame(this.gpuTimeEndFrame),this.gpuLastUtilisation=Math.min(this.gpuCurUtilisation,1),this.gpuTimeStartFrame=this.gpuTimeEndFrame,this.gpuTimeEndFrame=0));if(0!==this.last_tick_time){var E=k-this.last_tick_time;0>E&&(E=0);this.dt1=E/1E3;.5<this.dt1?this.dt1=0:this.dt1>1/
this.minimumFramerate&&(this.dt1=1/this.minimumFramerate)}this.last_tick_time=k;this.dt=this.dt1*this.timescale;this.kahanTime.add(this.dt);this.wallTime.add(this.dt1);k=(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||!!document.msFullscreenElement)&&!this.isCordova;if(2<=this.fullscreen_mode||k&&0<this.fullscreen_scaling){E=this.original_width/this.original_height;var H=this.width/this.height;var B=this.fullscreen_mode;k&&0<this.fullscreen_scaling&&(B=this.fullscreen_scaling);
this.aspect_scale=2!==B&&H>E||2===B&&H<E?this.height/this.original_height:this.width/this.original_width;this.running_layout&&(this.running_layout.scrollToX(this.running_layout.scrollX),this.running_layout.scrollToY(this.running_layout.scrollY))}else this.aspect_scale=this.isRetina?this.devicePixelRatio:1;this.ClearDeathRow();this.isInOnDestroy++;this.system.runWaits();this.isInOnDestroy--;this.ClearDeathRow();this.isInOnDestroy++;H=this.objects_to_pretick.valuesRef();k=0;for(E=H.length;k<E;k++)H[k].pretick();
k=0;for(E=this.types_by_index.length;k<E;k++){var L=this.types_by_index[k];if(!L.is_family&&(L.behaviors.length||L.families.length))for(H=0,B=L.instances.length;H<B;H++){var Q=L.instances[H];var R=0;for(r=Q.behavior_insts.length;R<r;R++)Q.behavior_insts[R].tick()}}k=0;for(E=this.types_by_index.length;k<E;k++)if(L=this.types_by_index[k],!L.is_family&&(L.behaviors.length||L.families.length))for(H=0,B=L.instances.length;H<B;H++)for(Q=L.instances[H],R=0,r=Q.behavior_insts.length;R<r;R++){var T=Q.behavior_insts[R];
T.posttick&&T.posttick()}H=this.objects_to_tick.valuesRef();k=0;for(E=H.length;k<E;k++)H[k].tick();this.isInOnDestroy--;this.handleSaveLoad();for(k=0;this.changelayout&&10>k++;)this.doChangeLayout(this.changelayout);k=0;for(E=this.eventsheets_by_index.length;k<E;k++)this.eventsheets_by_index[k].hasRun=!1;this.running_layout.event_sheet&&this.running_layout.event_sheet.run();cr.clearArray(this.registered_collisions);this.layout_first_tick=!1;this.isInOnDestroy++;k=0;for(E=this.types_by_index.length;k<
E;k++)if(L=this.types_by_index[k],!L.is_family&&(L.behaviors.length||L.families.length))for(H=0,B=L.instances.length;H<B;H++)for(Q=L.instances[H],R=0,r=Q.behavior_insts.length;R<r;R++)T=Q.behavior_insts[R],T.tick2&&T.tick2();H=this.objects_to_tick2.valuesRef();k=0;for(E=H.length;k<E;k++)H[k].tick2();this.isInOnDestroy--};b.prototype.onWindowBlur=function(){var k,r,E;var H=0;for(k=this.types_by_index.length;H<k;H++){var B=this.types_by_index[H];if(!B.is_family){var L=0;for(r=B.instances.length;L<r;L++){var Q=
B.instances[L];if(Q.onWindowBlur)Q.onWindowBlur();if(Q.behavior_insts){var R=0;for(E=Q.behavior_insts.length;R<E;R++){var T=Q.behavior_insts[R];if(T.onWindowBlur)T.onWindowBlur()}}}}}};b.prototype.doChangeLayout=function(k){var r=this.running_layout;this.running_layout.stopRunning();var E;if(this.glwrap){var H=0;for(E=this.types_by_index.length;H<E;H++){var B=this.types_by_index[H];B.is_family||!B.unloadTextures||B.global&&0!==B.instances.length||-1!==k.initial_types.indexOf(B)||B.unloadTextures()}}r==
k&&cr.clearArray(this.system.waits);cr.clearArray(this.registered_collisions);this.runLayoutChangeMethods(!0);k.startRunning();this.runLayoutChangeMethods(!1);this.layout_first_tick=this.redraw=!0;this.ClearDeathRow()};b.prototype.runLayoutChangeMethods=function(k){var r,E,H;var B=0;for(r=this.behaviors.length;B<r;B++){var L=this.behaviors[B];if(k){if(L.onBeforeLayoutChange)L.onBeforeLayoutChange()}else if(L.onLayoutChange)L.onLayoutChange()}B=0;for(r=this.types_by_index.length;B<r;B++)if(L=this.types_by_index[B],
L.global||L.plugin.singleglobal){var Q=0;for(E=L.instances.length;Q<E;Q++){var R=L.instances[Q];if(k){if(R.onBeforeLayoutChange)R.onBeforeLayoutChange()}else if(R.onLayoutChange)R.onLayoutChange();if(R.behavior_insts){var T=0;for(H=R.behavior_insts.length;T<H;T++){var fa=R.behavior_insts[T];if(k){if(fa.onBeforeLayoutChange)fa.onBeforeLayoutChange()}else if(fa.onLayoutChange)fa.onLayoutChange()}}}}};b.prototype.pretickMe=function(k){this.objects_to_pretick.add(k)};b.prototype.unpretickMe=function(k){this.objects_to_pretick.remove(k)};
b.prototype.tickMe=function(k){this.objects_to_tick.add(k)};b.prototype.untickMe=function(k){this.objects_to_tick.remove(k)};b.prototype.tick2Me=function(k){this.objects_to_tick2.add(k)};b.prototype.untick2Me=function(k){this.objects_to_tick2.remove(k)};b.prototype.getDt=function(k){return k&&-1!==k.my_timescale?this.dt1*k.my_timescale:this.dt};b.prototype.draw=function(){this.running_layout.draw(this.ctx)};b.prototype.drawGL=function(){this.enableFrontToBack&&(this.earlyz_index=1,this.running_layout.drawGL_earlyZPass(this.glwrap));
this.running_layout.drawGL(this.glwrap);this.glwrap.present()};b.prototype.addDestroyCallback=function(k){k&&this.destroycallbacks.push(k)};b.prototype.removeDestroyCallback=function(k){cr.arrayFindRemove(this.destroycallbacks,k)};b.prototype.getObjectByUID=function(k){k=k.toString();return this.objectsByUid.hasOwnProperty(k)?this.objectsByUid[k]:null};var g=[];b.prototype.DestroyInstance=function(k){var r;var E=k.type.name;if(this.deathRow.hasOwnProperty(E)){var H=this.deathRow[E];if(H.contains(k))return}else H=
g.length?g.pop():new cr.ObjectSet,this.deathRow[E]=H;k.isDestroyed=!0;H.add(k);this.hasPendingInstances=!0;if(k.is_contained)for(E=0,r=k.siblings.length;E<r;E++)this.DestroyInstance(k.siblings[E]);this.isInClearDeathRow&&H.values_cache.push(k);this.isEndingLayout||(this.isInOnDestroy++,this.trigger(Object.getPrototypeOf(k.type.plugin).cnds.OnDestroyed,k),this.isInOnDestroy--)};b.prototype.ClearDeathRow=function(){if(this.hasPendingInstances){var k,r;this.isInClearDeathRow=!0;var E=0;for(k=this.createRow.length;E<
k;++E){var H=this.createRow[E];var B=H.type;B.instances.push(H);var L=0;for(r=B.families.length;L<r;++L)B.families[L].instances.push(H),B.families[L].stale_iids=!0}cr.clearArray(this.createRow);this.IterateDeathRow();cr.wipe(this.deathRow);this.hasPendingInstances=this.isInClearDeathRow=!1}};b.prototype.IterateDeathRow=function(){for(var k in this.deathRow)this.deathRow.hasOwnProperty(k)&&this.ClearDeathRowForType(this.deathRow[k])};b.prototype.ClearDeathRowForType=function(k){var r=k.valuesRef(),
E=r[0].type,H,B;cr.arrayRemoveAllFromObjectSet(E.instances,k);E.stale_iids=!0;0===E.instances.length&&(E.any_instance_parallaxed=!1);var L=0;for(H=E.families.length;L<H;++L){var Q=E.families[L];cr.arrayRemoveAllFromObjectSet(Q.instances,k);Q.stale_iids=!0}L=0;for(H=this.system.waits.length;L<H;++L){var R=this.system.waits[L];R.sols.hasOwnProperty(E.index)&&cr.arrayRemoveAllFromObjectSet(R.sols[E.index].insts,k);if(!E.is_family){var T=0;for(B=E.families.length;T<B;++T)Q=E.families[T],R.sols.hasOwnProperty(Q.index)&&
cr.arrayRemoveAllFromObjectSet(R.sols[Q.index].insts,k)}}if(R=r[0].layer){if(R.useRenderCells)for(T=R.instances,L=0,H=T.length;L<H;++L)B=T[L],k.contains(B)&&(B.update_bbox(),R.render_grid.update(B,B.rendercells,null),B.rendercells.set(0,0,-1,-1));cr.arrayRemoveAllFromObjectSet(R.instances,k);R.setZIndicesStaleFrom(0)}for(L=0;L<r.length;++L)this.ClearDeathRowForSingleInstance(r[L],E);k.clear();g.push(k);this.redraw=!0};b.prototype.ClearDeathRowForSingleInstance=function(k,r){var E;var H=0;for(E=this.destroycallbacks.length;H<
E;++H)this.destroycallbacks[H](k);k.collcells&&r.collision_grid.update(k,k.collcells,null);(H=k.layer)&&H.removeFromInstanceList(k,!0);if(k.behavior_insts)for(H=0,E=k.behavior_insts.length;H<E;++H){var B=k.behavior_insts[H];if(B.onDestroy)B.onDestroy();B.behavior.my_instances.remove(k)}this.objects_to_pretick.remove(k);this.objects_to_tick.remove(k);this.objects_to_tick2.remove(k);if(k.onDestroy)k.onDestroy();this.objectsByUid.hasOwnProperty(k.uid.toString())&&delete this.objectsByUid[k.uid.toString()];
this.objectcount--;100>r.deadCache.length&&r.deadCache.push(k)};b.prototype.createInstance=function(k,r,E,H){if(k.is_family){var B=cr.floor(Math.random()*k.members.length);return this.createInstance(k.members[B],r,E,H)}return k.default_instance?this.createInstanceFromInit(k.default_instance,r,!1,E,H,!1):null};var z=[];b.prototype.createInstanceFromInit=function(k,r,E,H,B,L){var Q,R;if(!k)return null;var T=this.types_by_index[k[1]],fa=T.plugin.is_world;if(this.isloading&&fa&&!T.isOnLoaderLayout||fa&&
!this.glwrap&&11===k[0][11])return null;var ba=r;fa||(r=null);if(T.deadCache.length){var Z=T.deadCache.pop();Z.recycled=!0;T.plugin.Instance.call(Z,T)}else Z=new T.plugin.Instance(T),Z.recycled=!1;!E||L||this.objectsByUid.hasOwnProperty(k[2].toString())?Z.uid=this.next_uid++:Z.uid=k[2];this.objectsByUid[Z.uid.toString()]=Z;Z.puid=this.next_puid++;Z.iid=T.instances.length;var da=0;for(Q=this.createRow.length;da<Q;++da)this.createRow[da].type===T&&Z.iid++;Z.get_iid=cr.inst_get_iid;Z.toString=cr.inst_toString;
Z.isDestroyed=!1;var ia=k[3];if(Z.recycled)cr.wipe(Z.extra);else{Z.extra={};if(this.isPreview)for(Z.instance_var_names=[],Z.instance_var_names.length=ia.length,da=0,Q=ia.length;da<Q;da++)Z.instance_var_names[da]=ia[da][1];Z.instance_vars=[];Z.instance_vars.length=ia.length}da=0;for(Q=ia.length;da<Q;da++)Z.instance_vars[da]=ia[da][0];if(fa){var ka=k[0];Z.x=cr.is_undefined(H)?ka[0]:H;Z.y=cr.is_undefined(B)?ka[1]:B;Z.z=ka[2];Z.width=ka[3];Z.height=ka[4];Z.depth=ka[5];Z.angle=ka[6];Z.opacity=ka[7];Z.hotspotX=
ka[8];Z.hotspotY=ka[9];Z.blend_mode=ka[10];da=ka[11];!this.glwrap&&T.effect_types.length&&(Z.blend_mode=da);Z.compositeOp=cr.effectToCompositeOp(Z.blend_mode);this.gl&&cr.setGLBlend(Z,Z.blend_mode,this.gl);if(Z.recycled){da=0;for(Q=ka[12].length;da<Q;da++)for(ia=0,R=ka[12][da].length;ia<R;ia++)Z.effect_params[da][ia]=ka[12][da][ia],Array.isArray(Z.effect_params[da][ia])&&(Z.effect_params[da][ia]=Z.effect_params[da][ia].slice(0));Z.bbox.set(0,0,0,0);Z.collcells.set(0,0,-1,-1);Z.rendercells.set(0,0,
-1,-1);Z.bquad.set_from_rect(Z.bbox);cr.clearArray(Z.bbox_changed_callbacks)}else{Z.effect_params=ka[12].slice(0);da=0;for(Q=Z.effect_params.length;da<Q;da++)for(Z.effect_params[da]=ka[12][da].slice(0),ia=0,R=Z.effect_params[da].length;ia<R;++ia)Array.isArray(Z.effect_params[da][ia])&&(Z.effect_params[da][ia]=Z.effect_params[da][ia].slice(0));Z.active_effect_types=[];Z.active_effect_flags=[];Z.active_effect_flags.length=T.effect_types.length;Z.bbox=new cr.rect(0,0,0,0);Z.collcells=new cr.rect(0,0,
-1,-1);Z.rendercells=new cr.rect(0,0,-1,-1);Z.bquad=new cr.quad;Z.bbox_changed_callbacks=[];Z.set_bbox_changed=cr.set_bbox_changed;Z.add_bbox_changed_callback=cr.add_bbox_changed_callback;Z.contains_pt=cr.inst_contains_pt;Z.update_bbox=cr.update_bbox;Z.update_render_cell=cr.update_render_cell;Z.update_collision_cell=cr.update_collision_cell;Z.get_zindex=cr.inst_get_zindex}Z.tilemap_exists=!1;Z.tilemap_width=0;Z.tilemap_height=0;Z.tilemap_data=null;ka[13]&&(Z.tilemap_exists=!0,Z.tilemap_width=ka[13][0],
Z.tilemap_height=ka[13][1],Z.tilemap_data=ka[13][2]);da=0;for(Q=T.effect_types.length;da<Q;da++)Z.active_effect_flags[da]=!0;Z.shaders_preserve_opaqueness=!0;Z.updateActiveEffects=cr.inst_updateActiveEffects;Z.updateActiveEffects();Z.uses_shaders=!!Z.active_effect_types.length;Z.bbox_changed=!0;Z.cell_changed=!0;T.any_cell_changed=!0;Z.visible=!0;Z.my_timescale=-1;Z.layer=r;Z.zindex=r.instances.length;Z.earlyz_index=0;"undefined"===typeof Z.collision_poly&&(Z.collision_poly=null);this.redraw=Z.collisionsEnabled=
!0}cr.clearArray(z);da=0;for(Q=T.families.length;da<Q;da++)z.push.apply(z,T.families[da].behaviors);z.push.apply(z,T.behaviors);if(Z.recycled)for(da=0,Q=z.length;da<Q;da++){var ta=z[da];var qa=Z.behavior_insts[da];qa.recycled=!0;ta.behavior.Instance.call(qa,ta,Z);ka=k[4][da];ia=0;for(R=ka.length;ia<R;ia++)qa.properties[ia]=ka[ia];qa.onCreate();ta.behavior.my_instances.add(Z)}else for(Z.behavior_insts=[],da=0,Q=z.length;da<Q;da++)ta=z[da],qa=new ta.behavior.Instance(ta,Z),qa.recycled=!1,qa.properties=
k[4][da].slice(0),qa.onCreate(),cr.seal(qa),Z.behavior_insts.push(qa),ta.behavior.my_instances.add(Z);ka=k[5];if(Z.recycled)for(da=0,Q=ka.length;da<Q;da++)Z.properties[da]=ka[da];else Z.properties=ka.slice(0);this.createRow.push(Z);this.hasPendingInstances=!0;r&&(r.appendToInstanceList(Z,!0),1!==r.parallaxX||1!==r.parallaxY)&&(T.any_instance_parallaxed=!0);this.objectcount++;if(T.is_contained){if(Z.is_contained=!0,Z.recycled?cr.clearArray(Z.siblings):Z.siblings=[],!E&&!L){da=0;for(Q=T.container.length;da<
Q;da++)if(T.container[da]!==T){if(!T.container[da].default_instance)return null;Z.siblings.push(this.createInstanceFromInit(T.container[da].default_instance,ba,!1,fa?Z.x:H,fa?Z.y:B,!0))}da=0;for(Q=Z.siblings.length;da<Q;da++)for(Z.siblings[da].siblings.push(Z),ia=0;ia<Q;ia++)da!==ia&&Z.siblings[da].siblings.push(Z.siblings[ia])}}else Z.is_contained=!1,Z.siblings=null;Z.onCreate();Z.recycled||cr.seal(Z);da=0;for(Q=Z.behavior_insts.length;da<Q;da++)Z.behavior_insts[da].postCreate&&Z.behavior_insts[da].postCreate();
return Z};b.prototype.getLayerByName=function(k){var r;var E=0;for(r=this.running_layout.layers.length;E<r;E++){var H=this.running_layout.layers[E];if(cr.equals_nocase(H.name,k))return H}return null};b.prototype.getLayerByNumber=function(k){k=cr.floor(k);0>k&&(k=0);k>=this.running_layout.layers.length&&(k=this.running_layout.layers.length-1);return this.running_layout.layers[k]};b.prototype.getLayer=function(k){return cr.is_number(k)?this.getLayerByNumber(k):this.getLayerByName(k.toString())};b.prototype.clearSol=
function(k){var r;var E=0;for(r=k.length;E<r;E++)k[E].getCurrentSol().select_all=!0};b.prototype.pushCleanSol=function(k){var r;var E=0;for(r=k.length;E<r;E++)k[E].pushCleanSol()};b.prototype.pushCopySol=function(k){var r;var E=0;for(r=k.length;E<r;E++)k[E].pushCopySol()};b.prototype.popSol=function(k){var r;var E=0;for(r=k.length;E<r;E++)k[E].popSol()};b.prototype.updateAllCells=function(k){if(k.any_cell_changed){var r,E=k.instances;var H=0;for(r=E.length;H<r;++H)E[H].update_collision_cell();E=this.createRow;
H=0;for(r=E.length;H<r;++H)E[H].type===k&&E[H].update_collision_cell();k.any_cell_changed=!1}};b.prototype.getCollisionCandidates=function(k,r,E,H){var B,L=k?1!==k.parallaxX||1!==k.parallaxY:!1;if(r.is_family)for(k=0,B=r.members.length;k<B;++k){var Q=r.members[k];L||Q.any_instance_parallaxed?cr.appendArray(H,Q.instances):(this.updateAllCells(Q),Q.collision_grid.queryRange(E,H))}else L||r.any_instance_parallaxed?cr.appendArray(H,r.instances):(this.updateAllCells(r),r.collision_grid.queryRange(E,H))};
b.prototype.getTypesCollisionCandidates=function(k,r,E,H){var B;var L=0;for(B=r.length;L<B;++L)this.getCollisionCandidates(k,r[L],E,H)};b.prototype.getSolidCollisionCandidates=function(k,r,E){var H=this.getSolidBehavior();if(!H)return null;this.getTypesCollisionCandidates(k,H.my_types,r,E)};b.prototype.getJumpthruCollisionCandidates=function(k,r,E){var H=this.getJumpthruBehavior();if(!H)return null;this.getTypesCollisionCandidates(k,H.my_types,r,E)};b.prototype.testAndSelectCanvasPointOverlap=function(k,
r,E,H){var B=k.getCurrentSol(),L,Q=this.getCurrentEventStack().current_event.orblock;if(B.select_all){H||(B.select_all=!1,cr.clearArray(B.instances));var R=0;for(L=k.instances.length;R<L;R++){var T=k.instances[R];T.update_bbox();var fa=T.layer.canvasToLayer(r,E,!0);var ba=T.layer.canvasToLayer(r,E,!1);if(T.contains_pt(fa,ba)){if(H)return!1;B.instances.push(T)}else Q&&B.else_instances.push(T)}}else{var Z=0;var da=Q?B.else_instances:B.instances;R=0;for(L=da.length;R<L;R++)if(T=da[R],T.update_bbox(),
fa=T.layer.canvasToLayer(r,E,!0),ba=T.layer.canvasToLayer(r,E,!1),T.contains_pt(fa,ba)){if(H)return!1;Q?B.instances.push(T):(B.instances[Z]=B.instances[R],Z++)}H||(da.length=Z)}k.applySolToContainer();return H?!0:B.hasObjects()};b.prototype.testOverlap=function(k,r){if(!(k&&r&&k!==r&&k.collisionsEnabled&&r.collisionsEnabled))return!1;k.update_bbox();r.update_bbox();var E=k.layer,H=r.layer,B;if(E===H||E.parallaxX===H.parallaxX&&H.parallaxY===H.parallaxY&&E.scale===H.scale&&E.angle===H.angle&&E.zoomRate===
H.zoomRate){if(!k.bbox.intersects_rect(r.bbox)||!k.bquad.intersects_quad(r.bquad)||k.tilemap_exists&&r.tilemap_exists)return!1;if(k.tilemap_exists)return this.testTilemapOverlap(k,r);if(r.tilemap_exists)return this.testTilemapOverlap(r,k);var L=k.collision_poly&&!k.collision_poly.is_empty();var Q=r.collision_poly&&!r.collision_poly.is_empty();if(!L&&!Q)return!0;L?(k.collision_poly.cache_poly(k.width,k.height,k.angle),L=k.collision_poly):(this.temp_poly.set_from_quad(k.bquad,k.x,k.y,k.width,k.height),
L=this.temp_poly);if(Q){r.collision_poly.cache_poly(r.width,r.height,r.angle);var R=r.collision_poly}else this.temp_poly.set_from_quad(r.bquad,r.x,r.y,r.width,r.height),R=this.temp_poly;return L.intersects_poly(R,r.x-k.x,r.y-k.y)}L=k.collision_poly&&!k.collision_poly.is_empty();Q=r.collision_poly&&!r.collision_poly.is_empty();L?(k.collision_poly.cache_poly(k.width,k.height,k.angle),this.temp_poly.set_from_poly(k.collision_poly)):this.temp_poly.set_from_quad(k.bquad,k.x,k.y,k.width,k.height);L=this.temp_poly;
Q?(r.collision_poly.cache_poly(r.width,r.height,r.angle),this.temp_poly2.set_from_poly(r.collision_poly)):this.temp_poly2.set_from_quad(r.bquad,r.x,r.y,r.width,r.height);R=this.temp_poly2;Q=0;for(B=L.pts_count;Q<B;Q++){var T=2*Q;var fa=T+1;var ba=L.pts_cache[T];var Z=L.pts_cache[fa];L.pts_cache[T]=E.layerToCanvas(ba+k.x,Z+k.y,!0);L.pts_cache[fa]=E.layerToCanvas(ba+k.x,Z+k.y,!1)}L.update_bbox();Q=0;for(B=R.pts_count;Q<B;Q++)T=2*Q,fa=T+1,ba=R.pts_cache[T],Z=R.pts_cache[fa],R.pts_cache[T]=H.layerToCanvas(ba+
r.x,Z+r.y,!0),R.pts_cache[fa]=H.layerToCanvas(ba+r.x,Z+r.y,!1);R.update_bbox();return L.intersects_poly(R,0,0)};var J=new cr.quad,N=new cr.rect(0,0,0,0),U=[];b.prototype.testTilemapOverlap=function(k,r){var E,H=r.bbox,B=k.x,L=k.y;k.getCollisionRectCandidates(H,U);var Q=r.collision_poly&&!r.collision_poly.is_empty();k=0;for(E=U.length;k<E;++k){var R=U[k];var T=R.rc;if(H.intersects_rect_off(T,B,L)&&(J.set_from_rect(T),J.offset(B,L),J.intersects_quad(r.bquad)))if(Q)if(r.collision_poly.cache_poly(r.width,
r.height,r.angle),R.poly){if(R.poly.intersects_poly(r.collision_poly,r.x-(B+T.left),r.y-(L+T.top)))return cr.clearArray(U),!0}else{if(this.temp_poly.set_from_quad(J,0,0,T.right-T.left,T.bottom-T.top),this.temp_poly.intersects_poly(r.collision_poly,r.x,r.y))return cr.clearArray(U),!0}else if(R.poly){if(this.temp_poly.set_from_quad(r.bquad,0,0,r.width,r.height),R.poly.intersects_poly(this.temp_poly,-(B+T.left),-(L+T.top)))return cr.clearArray(U),!0}else return cr.clearArray(U),!0}cr.clearArray(U);return!1};
b.prototype.testRectOverlap=function(k,r){if(!r||!r.collisionsEnabled)return!1;r.update_bbox();if(!r.bbox.intersects_rect(k))return!1;if(r.tilemap_exists){r.getCollisionRectCandidates(k,U);var E,H=r.x,B=r.y;r=0;for(E=U.length;r<E;++r){var L=U[r];var Q=L.rc;if(k.intersects_rect_off(Q,H,B))if(L.poly){if(this.temp_poly.set_from_rect(k,0,0),L.poly.intersects_poly(this.temp_poly,-(H+Q.left),-(B+Q.top)))return cr.clearArray(U),!0}else return cr.clearArray(U),!0}cr.clearArray(U);return!1}J.set_from_rect(k);
if(!r.bquad.intersects_quad(J))return!1;if(!r.collision_poly||r.collision_poly.is_empty())return!0;r.collision_poly.cache_poly(r.width,r.height,r.angle);J.offset(-k.left,-k.top);this.temp_poly.set_from_quad(J,0,0,1,1);return r.collision_poly.intersects_poly(this.temp_poly,k.left-r.x,k.top-r.y)};b.prototype.testSegmentOverlap=function(k,r,E,H,B){if(!B||!B.collisionsEnabled)return!1;B.update_bbox();N.set(cr.min(k,E),cr.min(r,H),cr.max(k,E),cr.max(r,H));if(!B.bbox.intersects_rect(N))return!1;if(B.tilemap_exists){B.getCollisionRectCandidates(N,
U);var L,Q=B.x,R=B.y;B=0;for(L=U.length;B<L;++B){var T=U[B];var fa=T.rc;if(N.intersects_rect_off(fa,Q,R)&&(J.set_from_rect(fa),J.offset(Q,R),J.intersects_segment(k,r,E,H)))if(T.poly){if(T.poly.intersects_segment(Q+fa.left,R+fa.top,k,r,E,H))return cr.clearArray(U),!0}else return cr.clearArray(U),!0}cr.clearArray(U);return!1}if(!B.bquad.intersects_segment(k,r,E,H))return!1;if(!B.collision_poly||B.collision_poly.is_empty())return!0;B.collision_poly.cache_poly(B.width,B.height,B.angle);return B.collision_poly.intersects_segment(B.x,
B.y,k,r,E,H)};b.prototype.typeHasBehavior=function(k,r){if(!r)return!1;var E,H;var B=0;for(E=k.behaviors.length;B<E;B++)if(k.behaviors[B].behavior instanceof r)return!0;if(!k.is_family)for(B=0,E=k.families.length;B<E;B++){var L=k.families[B];var Q=0;for(H=L.behaviors.length;Q<H;Q++)if(L.behaviors[Q].behavior instanceof r)return!0}return!1};b.prototype.typeHasNoSaveBehavior=function(k){return this.typeHasBehavior(k,cr.behaviors.NoSave)};b.prototype.typeHasPersistBehavior=function(k){return this.typeHasBehavior(k,
cr.behaviors.Persist)};b.prototype.getSolidBehavior=function(){return this.solidBehavior};b.prototype.getJumpthruBehavior=function(){return this.jumpthruBehavior};var W=[];b.prototype.testOverlapSolid=function(k){var r;k.update_bbox();this.getSolidCollisionCandidates(k.layer,k.bbox,W);var E=0;for(r=W.length;E<r;++E){var H=W[E];if(H.extra.solidEnabled&&this.testOverlap(k,H))return cr.clearArray(W),H}cr.clearArray(W);return null};b.prototype.testRectOverlapSolid=function(k){var r;this.getSolidCollisionCandidates(null,
k,W);var E=0;for(r=W.length;E<r;++E){var H=W[E];if(H.extra.solidEnabled&&this.testRectOverlap(k,H))return cr.clearArray(W),H}cr.clearArray(W);return null};var X=[];b.prototype.testOverlapJumpThru=function(k,r){var E=null;r&&(E=X,cr.clearArray(E));k.update_bbox();this.getJumpthruCollisionCandidates(k.layer,k.bbox,W);var H;var B=0;for(H=W.length;B<H;++B){var L=W[B];if(L.extra.jumpthruEnabled&&this.testOverlap(k,L))if(r)E.push(L);else return cr.clearArray(W),L}cr.clearArray(W);return E};b.prototype.pushOutSolid=
function(k,r,E,H,B,L){H=H||50;var Q=k.x,R=k.y,T,fa=null,ba=null;for(T=0;T<H;T++)if(k.x=Q+r*T,k.y=R+E*T,k.set_bbox_changed(),!this.testOverlap(k,fa)&&((fa=this.testOverlapSolid(k))&&(ba=fa),!fa&&(B&&(fa=L?this.testOverlap(k,L)?L:null:this.testOverlapJumpThru(k))&&(ba=fa),!fa)))return ba&&this.pushInFractional(k,r,E,ba,16),!0;k.x=Q;k.y=R;k.set_bbox_changed();return!1};b.prototype.pushOutSolidAxis=function(k,r,E,H){H=H||50;var B=k.x,L=k.y,Q=null,R=null,T,fa;for(T=0;T<H;++T)for(fa=0;2>fa;++fa){var ba=
2*fa-1;k.x=B+r*T*ba;k.y=L+E*T*ba;k.set_bbox_changed();if(!this.testOverlap(k,Q))if(Q=this.testOverlapSolid(k))R=Q;else return R&&this.pushInFractional(k,r*ba,E*ba,R,16),!0}k.x=B;k.y=L;k.set_bbox_changed();return!1};b.prototype.pushOut=function(k,r,E,H,B){H=H||50;var L=k.x,Q=k.y,R;for(R=0;R<H;R++)if(k.x=L+r*R,k.y=Q+E*R,k.set_bbox_changed(),!this.testOverlap(k,B))return!0;k.x=L;k.y=Q;k.set_bbox_changed();return!1};b.prototype.pushInFractional=function(k,r,E,H,B){var L=2,Q=!1;var R=!1;for(var T=k.x,
fa=k.y;L<=B;)R=1/L,L*=2,k.x+=r*R*(Q?1:-1),k.y+=E*R*(Q?1:-1),k.set_bbox_changed(),this.testOverlap(k,H)?R=Q=!0:(R=Q=!1,T=k.x,fa=k.y);R&&(k.x=T,k.y=fa,k.set_bbox_changed())};b.prototype.pushOutSolidNearest=function(k,r){r=cr.is_undefined(r)?100:r;var E=0,H=k.x,B=k.y,L=0,Q=0,R=0,T=this.testOverlapSolid(k);if(!T)return!0;for(;E<=r;){switch(L){case 0:Q=0;R=-1;E++;break;case 1:Q=1;R=-1;break;case 2:Q=1;R=0;break;case 3:R=Q=1;break;case 4:Q=0;R=1;break;case 5:Q=-1;R=1;break;case 6:Q=-1;R=0;break;case 7:R=
Q=-1}L=(L+1)%8;k.x=cr.floor(H+Q*E);k.y=cr.floor(B+R*E);k.set_bbox_changed();if(!this.testOverlap(k,T)&&(T=this.testOverlapSolid(k),!T))return!0}k.x=H;k.y=B;k.set_bbox_changed();return!1};b.prototype.registerCollision=function(k,r){k.collisionsEnabled&&r.collisionsEnabled&&this.registered_collisions.push([k,r])};b.prototype.addRegisteredCollisionCandidates=function(k,r,E){var H;var B=0;for(H=this.registered_collisions.length;B<H;++B){var L=this.registered_collisions[B];if(L[0]===k)L=L[1];else if(L[1]===
k)L=L[0];else continue;if(r.is_family){if(-1===r.members.indexOf(r))continue}else if(L.type!==r)continue;-1===E.indexOf(L)&&E.push(L)}};b.prototype.checkRegisteredCollision=function(k,r){var E;var H=0;for(E=this.registered_collisions.length;H<E;H++){var B=this.registered_collisions[H];if(B[0]===k&&B[1]===r||B[0]===r&&B[1]===k)return!0}return!1};b.prototype.calculateSolidBounceAngle=function(k,r,E,H){var B=k.x,L=k.y,Q=cr.max(10,cr.distanceTo(r,E,B,L)),R=cr.angleTo(r,E,B,L),T=H||this.testOverlapSolid(k);
if(!T)return cr.clamp_angle(R+cr.PI);var fa=T,ba,Z=cr.to_radians(5);for(ba=1;36>ba;ba++){var da=R-ba*Z;k.x=r+Math.cos(da)*Q;k.y=E+Math.sin(da)*Q;k.set_bbox_changed();if(!this.testOverlap(k,fa)&&(fa=H?null:this.testOverlapSolid(k),!fa)){var ia=da;break}}36===ba&&(ia=cr.clamp_angle(R+cr.PI));fa=T;for(ba=1;36>ba;ba++)if(da=R+ba*Z,k.x=r+Math.cos(da)*Q,k.y=E+Math.sin(da)*Q,k.set_bbox_changed(),!this.testOverlap(k,fa)&&(fa=H?null:this.testOverlapSolid(k),!fa)){var ka=da;break}36===ba&&(ka=cr.clamp_angle(R+
cr.PI));k.x=B;k.y=L;k.set_bbox_changed();if(ka===ia)return ka;k=cr.angleDiff(ka,ia)/2;k=cr.angleClockwise(ka,ia)?cr.clamp_angle(ia+k+cr.PI):cr.clamp_angle(ka+k);ia=Math.cos(R);R=Math.sin(R);ka=Math.cos(k);k=Math.sin(k);r=ia*ka+R*k;return cr.angleTo(0,0,ia-2*r*ka,R-2*r*k)};var Y=-1;b.prototype.trigger=function(k,r,E){if(!this.running_layout)return!1;var H=this.running_layout.event_sheet;if(!H)return!1;var B=!1,L;Y++;var Q=H.deep_includes;var R=0;for(L=Q.length;R<L;++R){var T=this.triggerOnSheet(k,
r,Q[R],E);B=B||T}T=this.triggerOnSheet(k,r,H,E);Y--;return B||T};b.prototype.triggerOnSheet=function(k,r,E,H){var B=!1,L;if(r){var Q=this.triggerOnSheetForTypeName(k,r,r.type.name,E,H);B=B||Q;var R=r.type.families;var T=0;for(L=R.length;T<L;++T)Q=this.triggerOnSheetForTypeName(k,r,R[T].name,E,H),B=B||Q}else Q=this.triggerOnSheetForTypeName(k,r,"system",E,H),B=B||Q;return B};b.prototype.triggerOnSheetForTypeName=function(k,r,E,H,B){var L,Q=!1;var R="undefined"!==typeof B;var T=(R?H.fasttriggers:H.triggers)[E];
if(!T)return Q;var fa=null;H=0;for(L=T.length;H<L;++H)if(T[H].method==k){fa=T[H].evs;break}if(!fa)return Q;k=R?fa[B]:fa;if(!k)return null;H=0;for(L=k.length;H<L;H++)B=k[H][0],R=k[H][1],B=this.executeSingleTrigger(r,E,B,R),Q=Q||B;return Q};b.prototype.executeSingleTrigger=function(k,r,E,H){var B,L=!1;this.trigger_depth++;var Q=this.getCurrentEventStack().current_event;Q&&this.pushCleanSol(Q.solModifiersIncludingParents);var R=1<this.trigger_depth;this.pushCleanSol(E.solModifiersIncludingParents);R&&
this.pushLocalVarStack();var T=this.pushEventStack(E);T.current_event=E;if(k){var fa=this.types[r].getCurrentSol();fa.select_all=!1;cr.clearArray(fa.instances);fa.instances[0]=k;this.types[r].applySolToContainer()}k=!0;if(E.parent){r=T.temp_parents_arr;for(fa=E.parent;fa;)r.push(fa),fa=fa.parent;r.reverse();fa=0;for(B=r.length;fa<B;fa++)if(!r[fa].run_pretrigger()){k=!1;break}}k&&(this.execcount++,E.orblock?E.run_orblocktrigger(H):E.run(),L=L||T.last_event_true);this.popEventStack();R&&this.popLocalVarStack();
this.popSol(E.solModifiersIncludingParents);Q&&this.popSol(Q.solModifiersIncludingParents);this.hasPendingInstances&&0===this.isInOnDestroy&&0===Y&&!this.isRunningEvents&&this.ClearDeathRow();this.trigger_depth--;return L};b.prototype.getCurrentCondition=function(){var k=this.getCurrentEventStack();return k.current_event.conditions[k.cndindex]};b.prototype.getCurrentConditionObjectType=function(){return this.getCurrentCondition().type};b.prototype.isCurrentConditionFirst=function(){return 0===this.getCurrentEventStack().cndindex};
b.prototype.getCurrentAction=function(){var k=this.getCurrentEventStack();return k.current_event.actions[k.actindex]};b.prototype.pushLocalVarStack=function(){this.localvar_stack_index++;this.localvar_stack_index>=this.localvar_stack.length&&this.localvar_stack.push([])};b.prototype.popLocalVarStack=function(){this.localvar_stack_index--};b.prototype.getCurrentLocalVarStack=function(){return this.localvar_stack[this.localvar_stack_index]};b.prototype.pushEventStack=function(k){this.event_stack_index++;
this.event_stack_index>=this.event_stack.length&&this.event_stack.push(new cr.eventStackFrame);var r=this.getCurrentEventStack();r.reset(k);return r};b.prototype.popEventStack=function(){this.event_stack_index--};b.prototype.getCurrentEventStack=function(){return this.event_stack[this.event_stack_index]};b.prototype.pushLoopStack=function(k){this.loop_stack_index++;this.loop_stack_index>=this.loop_stack.length&&this.loop_stack.push(cr.seal({name:k,index:0,stopped:!1}));var r=this.getCurrentLoop();
r.name=k;r.index=0;r.stopped=!1;return r};b.prototype.popLoopStack=function(){this.loop_stack_index--};b.prototype.getCurrentLoop=function(){return this.loop_stack[this.loop_stack_index]};b.prototype.getEventVariableByName=function(k,r){for(var E,H,B,L,Q;r;){E=0;for(H=r.subevents.length;E<H;E++)if(Q=r.subevents[E],Q instanceof cr.eventvariable&&cr.equals_nocase(k,Q.name))return Q;r=r.parent}E=0;for(H=this.eventsheets_by_index.length;E<H;E++)for(L=this.eventsheets_by_index[E],r=0,B=L.events.length;r<
B;r++)if(Q=L.events[r],Q instanceof cr.eventvariable&&cr.equals_nocase(k,Q.name))return Q;return null};b.prototype.getLayoutBySid=function(k){var r;var E=0;for(r=this.layouts_by_index.length;E<r;E++)if(this.layouts_by_index[E].sid===k)return this.layouts_by_index[E];return null};b.prototype.getObjectTypeBySid=function(k){var r;var E=0;for(r=this.types_by_index.length;E<r;E++)if(this.types_by_index[E].sid===k)return this.types_by_index[E];return null};b.prototype.getGroupBySid=function(k){var r;var E=
0;for(r=this.allGroups.length;E<r;E++)if(this.allGroups[E].sid===k)return this.allGroups[E];return null};b.prototype.requirePermissions=function(k){return this.getPermissions(k).then(function(r){if(!1===r)return Promise.reject("Permission not granted")})};b.prototype.getPermissions=function(k){return this.isCordova&&this.isAndroid?k.reduce(function(r,E){return r.then(function(H){return!1===H?!1:q(E).then(function(B){return B?!0:h(E)})})},Promise.resolve(!0)):Promise.resolve(!0)};b.prototype.doCanvasSnapshot=
function(k,r){this.snapshotCanvas=[k,r];this.redraw=!0};b.prototype.signalContinuousPreview=function(){this.signalledContinuousPreview=!0};b.prototype.handleSaveLoad=function(){var k=this,r=this.saveToSlot,E=this.lastSaveJson,H=this.loadFromSlot,B=!1;this.signalledContinuousPreview&&(B=!0,r="__c2_continuouspreview",this.signalledContinuousPreview=!1);if(r.length){this.ClearDeathRow();E=this.saveToJSONString();if(y())e(r,E,function(){cr.logexport("Saved state to IndexedDB storage ("+E.length+" bytes)");
k.lastSaveJson=E;k.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null);E=k.lastSaveJson="";B&&c()},function(L){try{localStorage.setItem("__c2save_"+r,E),cr.logexport("Saved state to WebStorage ("+E.length+" bytes)"),k.lastSaveJson=E,k.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null),E=k.lastSaveJson="",B&&c()}catch(Q){cr.logexport("Failed to save game state: "+L+"; "+Q),k.trigger(cr.system_object.prototype.cnds.OnSaveFailed,null)}});else try{localStorage.setItem("__c2save_"+r,
E),cr.logexport("Saved state to WebStorage ("+E.length+" bytes)"),k.lastSaveJson=E,this.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null),E=k.lastSaveJson="",B&&c()}catch(L){cr.logexport("Error saving to WebStorage: "+L),k.trigger(cr.system_object.prototype.cnds.OnSaveFailed,null)}this.loadFromSlot=this.saveToSlot="";this.loadFromJson=null}if(H.length){if(y())a(H,function(L){L?(k.loadFromJson=L,cr.logexport("Loaded state from IndexedDB storage ("+k.loadFromJson.length+" bytes)")):(k.loadFromJson=
localStorage.getItem("__c2save_"+H)||"",cr.logexport("Loaded state from WebStorage ("+k.loadFromJson.length+" bytes)"));k.suspendDrawing=!1;k.loadFromJson||(k.loadFromJson=null,k.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))},function(L){k.loadFromJson=localStorage.getItem("__c2save_"+H)||"";cr.logexport("Loaded state from WebStorage ("+k.loadFromJson.length+" bytes)");k.suspendDrawing=!1;k.loadFromJson||(k.loadFromJson=null,k.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))});
else{try{this.loadFromJson=localStorage.getItem("__c2save_"+H)||"",cr.logexport("Loaded state from WebStorage ("+this.loadFromJson.length+" bytes)")}catch(L){this.loadFromJson=null}this.suspendDrawing=!1;k.loadFromJson||(k.loadFromJson=null,k.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))}this.saveToSlot=this.loadFromSlot=""}null!==this.loadFromJson&&(this.ClearDeathRow(),this.loadFromJSONString(this.loadFromJson)?(this.lastSaveJson=this.loadFromJson,this.trigger(cr.system_object.prototype.cnds.OnLoadComplete,
null),this.lastSaveJson=""):k.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null),this.loadFromJson=null)};b.prototype.saveToJSONString=function(){var k,r,E,H={c2save:!0,version:1,rt:{time:this.kahanTime.sum,walltime:this.wallTime.sum,timescale:this.timescale,tickcount:this.tickcount,execcount:this.execcount,next_uid:this.next_uid,running_layout:this.running_layout.sid,start_time_offset:Date.now()-this.start_time},types:{},layouts:{},events:{groups:{},cnds:{},acts:{},vars:{}}};var B=0;for(k=
this.types_by_index.length;B<k;B++){var L=this.types_by_index[B];if(!L.is_family&&!this.typeHasNoSaveBehavior(L)){var Q={instances:[]};cr.hasAnyOwnProperty(L.extra)&&(Q.ex=m(L.extra));var R=0;for(r=L.instances.length;R<r;R++)Q.instances.push(this.saveInstanceToJSON(L.instances[R]));H.types[L.sid.toString()]=Q}}B=0;for(k=this.layouts_by_index.length;B<k;B++)R=this.layouts_by_index[B],H.layouts[R.sid.toString()]=R.saveToJSON();r=H.events.groups;B=0;for(k=this.allGroups.length;B<k;B++)R=this.allGroups[B],
r[R.sid.toString()]=this.groups_by_name[R.group_name].group_active;k=H.events.cnds;for(E in this.cndsBySid)this.cndsBySid.hasOwnProperty(E)&&(B=this.cndsBySid[E],cr.hasAnyOwnProperty(B.extra)&&(k[E]={ex:m(B.extra)}));k=H.events.acts;for(E in this.actsBySid)this.actsBySid.hasOwnProperty(E)&&(B=this.actsBySid[E],cr.hasAnyOwnProperty(B.extra)&&(k[E]={ex:m(B.extra)}));k=H.events.vars;for(E in this.varsBySid)this.varsBySid.hasOwnProperty(E)&&(B=this.varsBySid[E],B.is_constant||B.parent&&!B.is_static||
(k[E]=B.data));H.system=this.system.saveToJSON();return JSON.stringify(H)};b.prototype.refreshUidMap=function(){var k,r;this.objectsByUid={};var E=0;for(k=this.types_by_index.length;E<k;E++){var H=this.types_by_index[E];if(!H.is_family){var B=0;for(r=H.instances.length;B<r;B++){var L=H.instances[B];this.objectsByUid[L.uid.toString()]=L}}}};b.prototype.loadFromJSONString=function(k){try{var r=JSON.parse(k)}catch(ba){return!1}if(!r.c2save||1<r.version)return!1;this.isLoadingState=!0;k=r.rt;this.kahanTime.reset();
this.kahanTime.sum=k.time;this.wallTime.reset();this.wallTime.sum=k.walltime||0;this.timescale=k.timescale;this.tickcount=k.tickcount;this.execcount=k.execcount;this.start_time=Date.now()-k.start_time_offset;var E=k.running_layout;if(E!==this.running_layout.sid)if(E=this.getLayoutBySid(E))this.doChangeLayout(E);else return;var H,B,L;var Q=r.types;for(B in Q)if(Q.hasOwnProperty(B)&&(L=this.getObjectTypeBySid(parseInt(B,10)))&&!L.is_family&&!this.typeHasNoSaveBehavior(L)){Q[B].ex?L.extra=Q[B].ex:cr.wipe(L.extra);
var R=L.instances;var T=Q[B].instances;E=0;for(H=cr.min(R.length,T.length);E<H;E++)this.loadInstanceFromJSON(R[E],T[E]);E=T.length;for(H=R.length;E<H;E++)this.DestroyInstance(R[E]);E=R.length;for(H=T.length;E<H;E++){R=null;if(L.plugin.is_world&&(R=this.running_layout.getLayerBySid(T[E].w.l),!R))continue;R=this.createInstanceFromInit(L.default_instance,R,!1,0,0,!0);this.loadInstanceFromJSON(R,T[E])}L.stale_iids=!0}this.ClearDeathRow();this.refreshUidMap();H=r.layouts;for(B in H)H.hasOwnProperty(B)&&
(E=this.getLayoutBySid(parseInt(B,10)))&&E.loadFromJSON(H[B]);H=r.events.groups;for(B in H)H.hasOwnProperty(B)&&(E=this.getGroupBySid(parseInt(B,10)))&&this.groups_by_name[E.group_name]&&this.groups_by_name[E.group_name].setGroupActive(H[B]);E=r.events.cnds;for(B in this.cndsBySid)this.cndsBySid.hasOwnProperty(B)&&(E.hasOwnProperty(B)?this.cndsBySid[B].extra=E[B].ex:this.cndsBySid[B].extra={});E=r.events.acts;for(B in this.actsBySid)this.actsBySid.hasOwnProperty(B)&&(E.hasOwnProperty(B)?this.actsBySid[B].extra=
E[B].ex:this.actsBySid[B].extra={});E=r.events.vars;for(B in E)E.hasOwnProperty(B)&&this.varsBySid.hasOwnProperty(B)&&(this.varsBySid[B].data=E[B]);this.next_uid=k.next_uid;this.isLoadingState=!1;E=0;for(H=this.fireOnCreateAfterLoad.length;E<H;++E)R=this.fireOnCreateAfterLoad[E],this.trigger(Object.getPrototypeOf(R.type.plugin).cnds.OnCreated,R);cr.clearArray(this.fireOnCreateAfterLoad);this.system.loadFromJSON(r.system);E=0;for(H=this.types_by_index.length;E<H;E++)if(L=this.types_by_index[E],!L.is_family&&
!this.typeHasNoSaveBehavior(L))for(r=0,B=L.instances.length;r<B;r++){R=L.instances[r];if(L.is_contained)for(Q=R.get_iid(),cr.clearArray(R.siblings),k=0,T=L.container.length;k<T;k++){var fa=L.container[k];L!==fa&&R.siblings.push(fa.instances[Q])}R.afterLoad&&R.afterLoad();if(R.behavior_insts)for(k=0,T=R.behavior_insts.length;k<T;k++)Q=R.behavior_insts[k],Q.afterLoad&&Q.afterLoad()}return this.redraw=!0};b.prototype.saveInstanceToJSON=function(k,r){var E;var H=k.type;var B=H.plugin;var L={};r?L.c2=
!0:L.uid=k.uid;cr.hasAnyOwnProperty(k.extra)&&(L.ex=m(k.extra));if(k.instance_vars&&k.instance_vars.length)for(L.ivs={},r=0,E=k.instance_vars.length;r<E;r++)L.ivs[k.type.instvar_sids[r].toString()]=k.instance_vars[r];if(B.is_world){B={x:k.x,y:k.y,w:k.width,h:k.height,l:k.layer.sid,zi:k.get_zindex()};0!==k.angle&&(B.a=k.angle);1!==k.opacity&&(B.o=k.opacity);.5!==k.hotspotX&&(B.hX=k.hotspotX);.5!==k.hotspotY&&(B.hY=k.hotspotY);0!==k.blend_mode&&(B.bm=k.blend_mode);k.visible||(B.v=k.visible);k.collisionsEnabled||
(B.ce=k.collisionsEnabled);-1!==k.my_timescale&&(B.mts=k.my_timescale);if(H.effect_types.length)for(B.fx=[],r=0,E=H.effect_types.length;r<E;r++){var Q=H.effect_types[r];B.fx.push({name:Q.name,active:k.active_effect_flags[Q.index],params:k.effect_params[Q.index]})}L.w=B}if(k.behavior_insts&&k.behavior_insts.length)for(L.behs={},r=0,E=k.behavior_insts.length;r<E;r++)H=k.behavior_insts[r],H.saveToJSON&&(L.behs[H.type.sid.toString()]=H.saveToJSON());k.saveToJSON&&(L.data=k.saveToJSON());return L};b.prototype.getInstanceVarIndexBySid=
function(k,r){var E;var H=0;for(E=k.instvar_sids.length;H<E;H++)if(k.instvar_sids[H]===r)return H;return-1};b.prototype.getBehaviorIndexBySid=function(k,r){var E;var H=0;for(E=k.behavior_insts.length;H<E;H++)if(k.behavior_insts[H].type.sid===r)return H;return-1};b.prototype.loadInstanceFromJSON=function(k,r,E){var H,B;var L=k.type;var Q=L.plugin;if(E){if(!r.c2)return}else k.uid=r.uid;r.ex?k.extra=r.ex:cr.wipe(k.extra);if(B=r.ivs)for(H in B)if(B.hasOwnProperty(H)){var R=this.getInstanceVarIndexBySid(L,
parseInt(H,10));if(!(0>R||R>=k.instance_vars.length)){var T=B[H];null===T&&(T=NaN);k.instance_vars[R]=T}}if(Q.is_world){R=r.w;k.layer.sid!==R.l&&(B=k.layer,k.layer=this.running_layout.getLayerBySid(R.l),k.layer?(B.removeFromInstanceList(k,!0),k.layer.appendToInstanceList(k,!0),k.set_bbox_changed(),k.layer.setZIndicesStaleFrom(0)):(k.layer=B,E||this.DestroyInstance(k)));k.x=R.x;k.y=R.y;k.width=R.w;k.height=R.h;k.zindex=R.zi;k.angle=R.hasOwnProperty("a")?R.a:0;k.opacity=R.hasOwnProperty("o")?R.o:1;
k.hotspotX=R.hasOwnProperty("hX")?R.hX:.5;k.hotspotY=R.hasOwnProperty("hY")?R.hY:.5;k.visible=R.hasOwnProperty("v")?R.v:!0;k.collisionsEnabled=R.hasOwnProperty("ce")?R.ce:!0;k.my_timescale=R.hasOwnProperty("mts")?R.mts:-1;k.blend_mode=R.hasOwnProperty("bm")?R.bm:0;k.compositeOp=cr.effectToCompositeOp(k.blend_mode);this.gl&&cr.setGLBlend(k,k.blend_mode,this.gl);k.set_bbox_changed();if(R.hasOwnProperty("fx"))for(E=0,B=R.fx.length;E<B;E++)T=L.getEffectIndexByName(R.fx[E].name),0>T||(k.active_effect_flags[T]=
R.fx[E].active,k.effect_params[T]=R.fx[E].params);k.updateActiveEffects()}if(L=r.behs)for(H in L)L.hasOwnProperty(H)&&(E=this.getBehaviorIndexBySid(k,parseInt(H,10)),0>E||k.behavior_insts[E].loadFromJSON(L[H]));r.data&&k.loadFromJSON(r.data)};b.prototype.getProjectFileUrl=function(k){return this.isPreview?window.cr_previewProjectFiles.hasOwnProperty(k.toLowerCase())?window.cr_previewProjectFiles[k.toLowerCase()]:k:this.files_subfolder+k};b.prototype.getProjectFileBlob=function(k){return this.isPreview?
window.cr_previewProjectFileBlobs&&window.cr_previewProjectFiles.hasOwnProperty(k.toLowerCase())?window.cr_previewProjectFileBlobs[k.toLowerCase()]:null:null};b.prototype.getLocalFileUrl=function(k){return this.isPreview?window.cr_previewProjectFiles.hasOwnProperty(k.toLowerCase())?window.cr_previewProjectFiles[k.toLowerCase()]:k:k};b.prototype.fetchLocalFileViaCordova=function(k,r,E){window.resolveLocalFileSystemURL(window.cordova.file.applicationDirectory+"www/"+k,function(H){H.file(r,E)},E)};b.prototype.fetchLocalFileViaCordovaAsText=
function(k,r,E){this.fetchLocalFileViaCordova(k,function(H){var B=new FileReader;B.onload=function(L){r(L.target.result)};B.onerror=E;B.readAsText(H)},E)};var ea=[],ha=0;b.prototype.maybeStartNextArrayBufferRead=function(){if(ea.length&&!(8<=ha)){ha++;var k=ea.shift();this.doFetchLocalFileViaCordovaAsArrayBuffer(k.filename,k.successCallback,k.errorCallback)}};b.prototype.fetchLocalFileViaCordovaAsArrayBuffer=function(k,r,E){var H=this;ea.push({filename:k,successCallback:function(B){ha--;H.maybeStartNextArrayBufferRead();
r(B)},errorCallback:function(B){ha--;H.maybeStartNextArrayBufferRead();E(B)}});this.maybeStartNextArrayBufferRead()};b.prototype.doFetchLocalFileViaCordovaAsArrayBuffer=function(k,r,E){this.fetchLocalFileViaCordova(k,function(H){var B=new FileReader;B.onload=function(L){r(L.target.result)};B.readAsArrayBuffer(H)},E)};b.prototype.fetchLocalFileViaCordovaAsURL=function(k,r,E){var H="",B=k.toLowerCase(),L=B.substr(B.length-4);B=B.substr(B.length-5);".mp4"===L?H="video/mp4":".webm"===B?H="video/webm":
".m4a"===L?H="audio/mp4":".mp3"===L&&(H="audio/mpeg");this.fetchLocalFileViaCordovaAsArrayBuffer(k,function(Q){Q=new Blob([Q],{type:H});Q=URL.createObjectURL(Q);r(Q)},E)};b.prototype.isAbsoluteUrl=function(k){return/^(?:[a-z]+:)?\/\//.test(k)||"data:"===k.substr(0,5)||"blob:"===k.substr(0,5)};b.prototype.setImageSrc=function(k,r){this.isWKWebView&&!this.isAbsoluteUrl(r)?this.fetchLocalFileViaCordovaAsURL(r,function(E){k.src=E},function(E){alert("Failed to load image: "+E)}):this.isPreview&&!this.isAbsoluteUrl(r)?
k.src=this.getLocalFileUrl(r):(this.isAbsoluteUrl(r)||(r=r.toLowerCase()),k.src=r)};b.prototype.getPreferredAudioFile=function(k){k=k.toLowerCase();if(!this.audio_files_map.hasOwnProperty(k))return null;k=this.audio_files_map[k];var r=null,E;var H=0;for(E=k.length;H<E;++H){var B=k[H];var L=B[0];r||"audio/webm; codecs=opus"!==L||(r=B);if(x[L])return B}return r};b.prototype.getProjectAudioFileUrl=function(k){var r=k.toLowerCase();return(k=this.getPreferredAudioFile(k))?{url:this.getProjectFileUrl(r+
k[1]),type:k[0]}:null};b.prototype.getStatusInfo=function(){return{fps:this.fps,cpu:this.cpuutilisation/1E3,gpu:this.gpuLastUtilisation,layout:this.running_layout?this.running_layout.name:"",renderer:this.glUnmaskedRenderer}};b.prototype.accelerate=function(k,r,E,H,B){return this.enhancedAccelerationPrecision?cr.clamp(k*B+.5*H*B*B,r*B,E*B):k*B};cr.runtime=b;cr.createRuntime=function(k){return new b(k)};window.cr_createRuntime=cr.createRuntime})();
window.cr_getSnapshot=function(b,d){var h=window.c3runtime;h&&h.doCanvasSnapshot(b,d)};window.cr_sizeCanvas=function(b,d){if(0!==b&&0!==d){var h=window.c3runtime;h&&h.setSize(b,d)}};window.cr_setSuspended=function(b){var d=window.c3runtime;d&&d.setSuspended(b)};
(function(){function b(a,c){return a.zindex-c.zindex}function d(a,c){this.layout=a;this.runtime=a.runtime;this.instances=[];this.scale=1;this.angle=0;this.disableAngle=!1;this.tmprect=new cr.rect(0,0,0,0);this.tmpquad=new cr.quad;this.viewBottom=this.viewTop=this.viewRight=this.viewLeft=0;this.zindices_stale=!1;this.zindices_stale_from=-1;this.clear_earlyz_index=0;this.name=c[0];this.index=c[1];this.sid=c[2];this.visible=c[3];this.background_color=c[4];this.transparent=c[5];this.parallaxX=c[6];this.parallaxY=
c[7];this.opacity=c[8];this.forceOwnTexture=c[9];this.useRenderCells=c[10];this.zoomRate=c[11];this.blend_mode=c[12];this.effect_fallback=c[13];this.compositeOp="source-over";this.destBlend=this.srcBlend=0;this.render_grid=null;this.last_render_list=h();this.render_list_stale=!0;this.last_render_cells=new cr.rect(0,0,-1,-1);this.cur_render_cells=new cr.rect(0,0,-1,-1);this.useRenderCells&&(this.render_grid=new cr.RenderGrid(this.runtime.original_width,this.runtime.original_height));this.render_offscreen=
!1;a=c[14];var m;this.startup_initial_instances=[];this.initial_instances=[];this.created_globals=[];var u=0;for(m=a.length;u<m;u++){var p=a[u],x=this.runtime.types_by_index[p[1]];x.default_instance||(x.default_instance=p,x.default_layerindex=this.index);this.initial_instances.push(p);-1===this.layout.initial_types.indexOf(x)&&this.layout.initial_types.push(x)}cr.shallowAssignArray(this.startup_initial_instances,this.initial_instances);this.effect_types=[];this.active_effect_types=[];this.shaders_preserve_opaqueness=
!0;this.effect_params=[];u=0;for(m=c[15].length;u<m;u++)this.effect_types.push({id:c[15][u][0],name:c[15][u][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:u}),this.effect_params.push(c[15][u][2].slice(0));this.updateActiveEffects();this.rcTexBounce=new cr.rect(0,0,1,1);this.rcTexDest=new cr.rect(0,0,1,1);this.rcTexOrigin=new cr.rect(0,0,1,1)}function h(){return y.length?y.pop():[]}function q(a){cr.clearArray(a);y.push(a)}d.prototype.updateActiveEffects=function(){cr.clearArray(this.active_effect_types);
this.shaders_preserve_opaqueness=!0;var a;var c=0;for(a=this.effect_types.length;c<a;c++){var m=this.effect_types[c];m.active&&(this.active_effect_types.push(m),m.preservesOpaqueness||(this.shaders_preserve_opaqueness=!1))}};d.prototype.getEffectByName=function(a){var c;var m=0;for(c=this.effect_types.length;m<c;m++){var u=this.effect_types[m];if(u.name===a)return u}return null};d.prototype.createInitialInstances=function(a){var c,m;var u=c=0;for(m=this.initial_instances.length;c<m;c++){var p=this.initial_instances[c];
var x=this.runtime.types_by_index[p[1]];var M=this.runtime.typeHasPersistBehavior(x);x=!0;if(!M||this.layout.first_visit){p=this.runtime.createInstanceFromInit(p,this,!0);if(!p)continue;a.push(p);p.type.global&&(x=!1,this.created_globals.push(p.uid))}x&&(this.initial_instances[u]=this.initial_instances[c],u++)}this.initial_instances.length=u;this.runtime.ClearDeathRow();!this.runtime.glwrap&&this.effect_types.length&&(this.blend_mode=this.effect_fallback);this.compositeOp=cr.effectToCompositeOp(this.blend_mode);
this.runtime.gl&&cr.setGLBlend(this,this.blend_mode,this.runtime.gl);this.render_list_stale=!0};d.prototype.recreateInitialObjects=function(a,c){var m,u=this.runtime.types_by_index,p=a.is_family,x=a.members;var M=0;for(m=this.initial_instances.length;M<m;++M){var v=this.initial_instances[M];var F=v[0];var C=F[0];F=F[1];if(c.contains_pt(C,F)){C=u[v[1]];if(C!==a)if(p){if(0>x.indexOf(C))continue}else continue;v=this.runtime.createInstanceFromInit(v,this,!1);this.runtime.isInOnDestroy++;this.runtime.trigger(Object.getPrototypeOf(C.plugin).cnds.OnCreated,
v);if(v.is_contained)for(C=0,F=v.siblings.length;C<F;C++){var l=v.siblings[M];this.runtime.trigger(Object.getPrototypeOf(l.type.plugin).cnds.OnCreated,l)}this.runtime.isInOnDestroy--}}};d.prototype.removeFromInstanceList=function(a,c){var m=cr.fastIndexOf(this.instances,a);0>m||(c&&this.useRenderCells&&a.rendercells&&a.rendercells.right>=a.rendercells.left&&(a.update_bbox(),this.render_grid.update(a,a.rendercells,null),a.rendercells.set(0,0,-1,-1)),m===this.instances.length-1?this.instances.pop():
(cr.arrayRemove(this.instances,m),this.setZIndicesStaleFrom(m)),this.render_list_stale=!0)};d.prototype.appendToInstanceList=function(a,c){a.zindex=this.instances.length;this.instances.push(a);c&&this.useRenderCells&&a.rendercells&&a.set_bbox_changed();this.render_list_stale=!0};d.prototype.prependToInstanceList=function(a,c){this.instances.unshift(a);this.setZIndicesStaleFrom(0);c&&this.useRenderCells&&a.rendercells&&a.set_bbox_changed()};d.prototype.moveInstanceAdjacent=function(a,c,m){var u=a.get_zindex();
c=c.get_zindex();cr.arrayRemove(this.instances,u);u<c&&c--;m&&c++;c===this.instances.length?this.instances.push(a):this.instances.splice(c,0,a);this.setZIndicesStaleFrom(u<c?u:c)};d.prototype.setZIndicesStaleFrom=function(a){-1===this.zindices_stale_from?this.zindices_stale_from=a:a<this.zindices_stale_from&&(this.zindices_stale_from=a);this.render_list_stale=this.zindices_stale=!0};d.prototype.updateZIndices=function(){if(this.zindices_stale){-1===this.zindices_stale_from&&(this.zindices_stale_from=
0);var a;if(this.useRenderCells){var c=this.zindices_stale_from;for(a=this.instances.length;c<a;++c){var m=this.instances[c];m.zindex=c;this.render_grid.markRangeChanged(m.rendercells)}}else for(c=this.zindices_stale_from,a=this.instances.length;c<a;++c)this.instances[c].zindex=c;this.zindices_stale=!1;this.zindices_stale_from=-1}};d.prototype.getScale=function(a){return this.getNormalScale()*(this.runtime.fullscreenScalingQuality||a?this.runtime.aspect_scale:1)};d.prototype.getNormalScale=function(){return(this.scale*
this.layout.scale-1)*this.zoomRate+1};d.prototype.getAngle=function(){return this.disableAngle?0:cr.clamp_angle(this.layout.angle+this.angle)};var y=[],A=[],e=[];d.prototype.getRenderCellInstancesToDraw=function(){this.updateZIndices();this.render_grid.queryRange(this.viewLeft,this.viewTop,this.viewRight,this.viewBottom,e);if(!e.length)return h();if(1===e.length){var a=h();cr.shallowAssignArray(a,e[0]);cr.clearArray(e);return a}for(var c=!0;1<e.length;){var m;a=e;var u=c;var p=0;for(m=a.length;p<
m-1;p+=2){var x=a[p];var M=a[p+1];c=h();var v=x,F=M,C=c,l=0,t=0,D=0,S=v.length,V=F.length;for(C.length=S+V;l<S&&t<V;++D){var K=v[l];var f=F[t];K.zindex<f.zindex?(C[D]=K,++l):(C[D]=f,++t)}for(;l<S;++l,++D)C[D]=v[l];for(;t<V;++t,++D)C[D]=F[t];u||(q(x),q(M));A.push(c)}1===m%2&&(u?(x=h(),cr.shallowAssignArray(x,a[m-1]),A.push(x)):A.push(a[m-1]));cr.shallowAssignArray(a,A);cr.clearArray(A);c=!1}a=e[0];cr.clearArray(e);return a};d.prototype.draw=function(a){this.render_offscreen=this.forceOwnTexture||1!==
this.opacity||0!==this.blend_mode;var c=this.runtime.canvas,m=a,u=!1;this.render_offscreen&&(this.runtime.layer_canvas||(this.runtime.layer_canvas=document.createElement("canvas"),c=this.runtime.layer_canvas,c.width=this.runtime.draw_width,c.height=this.runtime.draw_height,this.runtime.layer_ctx=c.getContext("2d"),u=!0),c=this.runtime.layer_canvas,m=this.runtime.layer_ctx,c.width!==this.runtime.draw_width&&(c.width=this.runtime.draw_width,u=!0),c.height!==this.runtime.draw_height&&(c.height=this.runtime.draw_height,
u=!0),u&&(m.imageSmoothingEnabled=this.runtime.linearSampling),this.transparent&&m.clearRect(0,0,this.runtime.draw_width,this.runtime.draw_height));m.globalAlpha=1;m.globalCompositeOperation="source-over";this.transparent||(m.fillStyle="rgb("+this.background_color[0]+","+this.background_color[1]+","+this.background_color[2]+")",m.fillRect(0,0,this.runtime.draw_width,this.runtime.draw_height));m.save();this.disableAngle=!0;u=this.canvasToLayer(0,0,!0,!0);var p=this.canvasToLayer(0,0,!1,!0);this.disableAngle=
!1;this.runtime.pixel_rounding&&(u=Math.round(u),p=Math.round(p));this.rotateViewport(u,p,m);var x=this.getScale();m.scale(x,x);m.translate(-u,-p);this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?
(q(this.last_render_list),u=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):u=this.last_render_list):u=this.instances;var M=null;p=0;for(x=u.length;p<x;++p){var v=u[p];v!==M&&(this.drawInstance(v,m),M=v)}this.useRenderCells&&(this.last_render_list=u);m.restore();this.render_offscreen&&(a.globalCompositeOperation=this.compositeOp,a.globalAlpha=this.opacity,a.drawImage(c,0,0))};d.prototype.drawInstance=function(a,c){if(a.visible&&0!==
a.width&&0!==a.height){a.update_bbox();var m=a.bbox;m.right<this.viewLeft||m.bottom<this.viewTop||m.left>this.viewRight||m.top>this.viewBottom||(c.globalCompositeOperation=a.compositeOp,a.draw(c))}};d.prototype.updateViewport=function(a){this.disableAngle=!0;var c=this.canvasToLayer(0,0,!0,!0),m=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1;this.runtime.pixel_rounding&&(c=Math.round(c),m=Math.round(m));this.rotateViewport(c,m,a)};d.prototype.rotateViewport=function(a,c,m){var u=this.getScale();
this.viewLeft=a;this.viewTop=c;this.viewRight=a+1/u*this.runtime.draw_width;this.viewBottom=c+1/u*this.runtime.draw_height;a=this.getAngle();0!==a&&(m&&(m.translate(this.runtime.draw_width/2,this.runtime.draw_height/2),m.rotate(-a),m.translate(this.runtime.draw_width/-2,this.runtime.draw_height/-2)),this.tmprect.set(this.viewLeft,this.viewTop,this.viewRight,this.viewBottom),this.tmprect.offset((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),this.tmpquad.set_from_rotated_rect(this.tmprect,
a),this.tmpquad.bounding_box(this.tmprect),this.tmprect.offset((this.viewLeft+this.viewRight)/2,(this.viewTop+this.viewBottom)/2),this.viewLeft=this.tmprect.left,this.viewTop=this.tmprect.top,this.viewRight=this.tmprect.right,this.viewBottom=this.tmprect.bottom)};d.prototype.drawGL_earlyZPass=function(a){if(this.render_offscreen=this.forceOwnTexture){this.runtime.layer_tex||(this.runtime.layer_tex=a.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling));
if(this.runtime.layer_tex.c2width!==this.runtime.draw_width||this.runtime.layer_tex.c2height!==this.runtime.draw_height)a.deleteTexture(this.runtime.layer_tex),this.runtime.layer_tex=a.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling);a.setRenderingToTexture(this.runtime.layer_tex)}this.disableAngle=!0;var c=this.canvasToLayer(0,0,!0,!0),m=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1;this.runtime.pixel_rounding&&(c=Math.round(c),m=Math.round(m));
this.rotateViewport(c,m,null);c=this.getScale();a.resetModelView();a.scale(c,c);a.rotateZ(-this.getAngle());a.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2);a.updateModelView();this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),
this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(q(this.last_render_list),c=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):c=this.last_render_list):c=this.instances;var u=null;for(m=c.length-1;0<=m;--m){var p=c[m];p!==u&&(this.drawInstanceGL_earlyZPass(c[m],a),u=p)}this.useRenderCells&&(this.last_render_list=c);this.transparent||(this.clear_earlyz_index=this.runtime.earlyz_index++,a.setEarlyZIndex(this.clear_earlyz_index),
a.setColorFillMode(1,1,1,1),a.fullscreenQuad(),a.restoreEarlyZMode())};d.prototype.drawGL=function(a){if(this.render_offscreen=this.forceOwnTexture||1!==this.opacity||0<this.active_effect_types.length||0!==this.blend_mode){this.runtime.layer_tex||(this.runtime.layer_tex=a.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling));if(this.runtime.layer_tex.c2width!==this.runtime.draw_width||this.runtime.layer_tex.c2height!==this.runtime.draw_height)a.deleteTexture(this.runtime.layer_tex),
this.runtime.layer_tex=a.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling);a.setRenderingToTexture(this.runtime.layer_tex);this.transparent&&a.clear(0,0,0,0)}this.transparent||(this.runtime.enableFrontToBack?(a.setEarlyZIndex(this.clear_earlyz_index),a.setColorFillMode(this.background_color[0]/255,this.background_color[1]/255,this.background_color[2]/255,1),a.fullscreenQuad(),a.setTextureFillMode()):a.clear(this.background_color[0]/255,this.background_color[1]/
255,this.background_color[2]/255,1));this.disableAngle=!0;var c=this.canvasToLayer(0,0,!0,!0);var m=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1;this.runtime.pixel_rounding&&(c=Math.round(c),m=Math.round(m));this.rotateViewport(c,m,null);c=this.getScale();a.resetModelView();a.scale(c,c);a.rotateZ(-this.getAngle());a.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2);a.updateModelView();this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),
this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(q(this.last_render_list),m=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):m=this.last_render_list):m=this.instances;var u,p=null;if(2.220446049250313E-16<
this.getNormalScale()){var x=0;for(u=m.length;x<u;++x){var M=m[x];M!==p&&(this.drawInstanceGL(m[x],a),p=M)}}this.useRenderCells&&(this.last_render_list=m);this.render_offscreen&&(m=this.active_effect_types.length?this.active_effect_types[0].shaderindex:0,x=this.active_effect_types.length?this.active_effect_types[0].index:0,0===this.active_effect_types.length||1===this.active_effect_types.length&&!a.programUsesCrossSampling(m)&&1===this.opacity?(1===this.active_effect_types.length?(a.switchProgram(m),
a.setProgramParameters(this.layout.getRenderTarget(),1/this.runtime.draw_width,1/this.runtime.draw_height,0,0,1,1,0,0,1,1,this.viewLeft,this.viewTop,this.viewRight,this.viewBottom,0,0,1,1,c,this.getAngle(),this.runtime.kahanTime.sum,this.effect_params[x]),a.programIsAnimated(m)&&(this.runtime.redraw=!0)):a.switchProgram(0),a.setRenderingToTexture(this.layout.getRenderTarget()),a.setOpacity(this.opacity),a.setTexture(this.runtime.layer_tex),a.setBlend(this.srcBlend,this.destBlend),a.resetModelView(),
a.updateModelView(),c=this.runtime.draw_width/2,m=this.runtime.draw_height/2,a.quad(-c,m,c,m,c,-m,-c,-m),a.setTexture(null)):this.layout.renderEffectChain(a,this,null,this.layout.getRenderTarget()))};d.prototype.drawInstanceGL=function(a,c){if(a.visible&&0!==a.width&&0!==a.height){a.update_bbox();var m=a.bbox;m.right<this.viewLeft||m.bottom<this.viewTop||m.left>this.viewRight||m.top>this.viewBottom||(c.setEarlyZIndex(a.earlyz_index),a.uses_shaders?this.drawInstanceWithShadersGL(a,c):(c.switchProgram(0),
c.setBlend(a.srcBlend,a.destBlend),a.drawGL(c)))}};d.prototype.drawInstanceGL_earlyZPass=function(a,c){if(a.visible&&0!==a.width&&0!==a.height){a.update_bbox();var m=a.bbox;m.right<this.viewLeft||m.bottom<this.viewTop||m.left>this.viewRight||m.top>this.viewBottom||(a.earlyz_index=this.runtime.earlyz_index++,0===a.blend_mode&&1===a.opacity&&a.shaders_preserve_opaqueness&&a.drawGL_earlyZPass&&(c.setEarlyZIndex(a.earlyz_index),a.drawGL_earlyZPass(c)))}};d.prototype.drawInstanceWithShadersGL=function(a,
c){var m=a.active_effect_types[0].shaderindex,u=a.active_effect_types[0].index,p=this.getScale(),x=this.runtime.draw_width,M=this.runtime.draw_height;if(1!==a.active_effect_types.length||c.programUsesCrossSampling(m)||c.programExtendsBox(m)||(a.angle||a.layer.getAngle())&&c.programUsesDest(m)||1!==a.opacity||a.type.plugin.must_predraw)this.layout.renderEffectChain(c,this,a,this.render_offscreen?this.runtime.layer_tex:this.layout.getRenderTarget()),c.resetModelView(),c.scale(p,p),c.rotateZ(-this.getAngle()),
c.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),c.updateModelView();else{c.switchProgram(m);c.setBlend(a.srcBlend,a.destBlend);c.programIsAnimated(m)&&(this.runtime.redraw=!0);var v=0,F=0,C=0,l=0;c.programUsesDest(m)&&(l=a.bbox,v=this.layerToCanvas(l.left,l.top,!0,!0),F=this.layerToCanvas(l.left,l.top,!1,!0),C=this.layerToCanvas(l.right,l.bottom,!0,!0),l=this.layerToCanvas(l.right,l.bottom,!1,!0),v/=x,F=1-F/M,C/=x,l=1-l/M);M=x=0;var t=m=1,D=1/a.width,S=1/a.height;
a.curFrame&&a.curFrame.sheetTex&&(x=a.curFrame.sheetTex.left,M=a.curFrame.sheetTex.top,m=a.curFrame.sheetTex.right,t=a.curFrame.sheetTex.bottom,a.curFrame.texture_img&&(D=1/a.curFrame.texture_img.width,S=1/a.curFrame.texture_img.height));c.setProgramParameters(this.render_offscreen?this.runtime.layer_tex:this.layout.getRenderTarget(),D,S,x,M,m,t,x,M,m,t,a.bbox.left,a.bbox.top,a.bbox.right,a.bbox.bottom,v,F,C,l,p,this.getAngle(),this.runtime.kahanTime.sum,a.effect_params[u]);a.drawGL(c)}};d.prototype.canvasToLayer=
function(a,c,m,u){var p=this.runtime.devicePixelRatio;this.runtime.isRetina&&(a*=p,c*=p);p=this.runtime.parallax_x_origin;var x=this.runtime.parallax_y_origin;p=(this.layout.scrollX-p)*this.parallaxX+p;x=(this.layout.scrollY-x)*this.parallaxY+x;var M=p,v=x,F=1/this.getScale(!u);u?(M-=this.runtime.draw_width*F/2,v-=this.runtime.draw_height*F/2):(M-=this.runtime.width*F/2,v-=this.runtime.height*F/2);M+=a*F;v+=c*F;c=this.getAngle();0!==c&&(M-=p,v-=x,a=Math.cos(c),c=Math.sin(c),u=M*a-v*c,v=v*a+M*c,M=
u+p,v+=x);return m?M:v};d.prototype.layerToCanvas=function(a,c,m,u){var p=this.runtime.parallax_x_origin,x=this.runtime.parallax_y_origin,M=(this.layout.scrollX-p)*this.parallaxX+p,v=(this.layout.scrollY-x)*this.parallaxY+x;x=M;p=v;var F=this.getAngle();if(0!==F){a-=M;c-=v;var C=Math.cos(-F);F=Math.sin(-F);var l=a*C-c*F;c=c*C+a*F;a=l+M;c+=v}M=1/this.getScale(!u);u?(x-=this.runtime.draw_width*M/2,p-=this.runtime.draw_height*M/2):(x-=this.runtime.width*M/2,p-=this.runtime.height*M/2);x=(a-x)/M;p=(c-
p)/M;a=this.runtime.devicePixelRatio;this.runtime.isRetina&&!u&&(x/=a,p/=a);return m?x:p};d.prototype.rotatePt=function(a,c,m){if(0===this.getAngle())return m?a:c;var u=this.layerToCanvas(a,c,!0);c=this.layerToCanvas(a,c,!1);this.disableAngle=!0;a=this.canvasToLayer(u,c,!0);u=this.canvasToLayer(u,c,!0);this.disableAngle=!1;return m?a:u};d.prototype.saveToJSON=function(){var a,c={s:this.scale,a:this.angle,vl:this.viewLeft,vt:this.viewTop,vr:this.viewRight,vb:this.viewBottom,v:this.visible,bc:this.background_color,
t:this.transparent,px:this.parallaxX,py:this.parallaxY,o:this.opacity,zr:this.zoomRate,fx:[],cg:this.created_globals,instances:[]};var m=0;for(a=this.effect_types.length;m<a;m++){var u=this.effect_types[m];c.fx.push({name:u.name,active:u.active,params:this.effect_params[u.index]})}return c};d.prototype.loadFromJSON=function(a){var c;this.scale=a.s;this.angle=a.a;this.viewLeft=a.vl;this.viewTop=a.vt;this.viewRight=a.vr;this.viewBottom=a.vb;this.visible=a.v;this.background_color=a.bc;this.transparent=
a.t;this.parallaxX=a.px;this.parallaxY=a.py;this.opacity=a.o;this.zoomRate=a.zr;this.created_globals=a.cg||[];cr.shallowAssignArray(this.initial_instances,this.startup_initial_instances);var m=new cr.ObjectSet;var u=0;for(c=this.created_globals.length;u<c;++u)m.add(this.created_globals[u]);var p=u=0;for(c=this.initial_instances.length;u<c;++u)m.contains(this.initial_instances[u][2])||(this.initial_instances[p]=this.initial_instances[u],++p);cr.truncateArray(this.initial_instances,p);p=a.fx;u=0;for(c=
p.length;u<c;u++)if(a=this.getEffectByName(p[u].name))a.active=p[u].active,this.effect_params[a.index]=p[u].params;this.updateActiveEffects();this.instances.sort(b);this.zindices_stale=!0};cr.layer=d})();
(function(){function b(e,a){this.runtime=e;this.event_sheet=null;this.scrollX=this.runtime.original_width/2;this.scrollY=this.runtime.original_height/2;this.scale=1;this.angle=0;this.first_visit=!0;this.name=a[0];this.originalWidth=a[1];this.originalHeight=a[2];this.width=a[1];this.height=a[2];this.unbounded_scrolling=a[3];this.sheetname=a[4];this.sid=a[5];var c=a[6],m;this.layers=[];this.initial_types=[];e=0;for(m=c.length;e<m;e++){var u=new cr.layer(this,c[e]);u.number=e;cr.seal(u);this.layers.push(u)}c=
a[7];this.initial_nonworld=[];e=0;for(m=c.length;e<m;e++){u=c[e];var p=this.runtime.types_by_index[u[1]];p.default_instance||(p.default_instance=u);this.initial_nonworld.push(u);-1===this.initial_types.indexOf(p)&&this.initial_types.push(p)}this.effect_types=[];this.active_effect_types=[];this.shaders_preserve_opaqueness=!0;this.effect_params=[];e=0;for(m=a[8].length;e<m;e++)this.effect_types.push({id:a[8][e][0],name:a[8][e][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:e}),this.effect_params.push(a[8][e][2].slice(0));
this.updateActiveEffects();this.rcTexBounce=new cr.rect(0,0,1,1);this.rcTexDest=new cr.rect(0,0,1,1);this.rcTexOrigin=new cr.rect(0,0,1,1);this.viewRect=new cr.rect(0,0,0,0);this.persist_data={}}function d(e,a){return e.zindex-a.zindex}function h(e){return e.some(function(a){return a.plugin.is_world})}b.prototype.saveObjectToPersist=function(e){var a=e.type.sid.toString();this.persist_data.hasOwnProperty(a)||(this.persist_data[a]=[]);this.persist_data[a].push(this.runtime.saveInstanceToJSON(e))};
b.prototype.hasOpaqueBottomLayer=function(){var e=this.layers[0];return!e.transparent&&1===e.opacity&&!e.forceOwnTexture&&e.visible};b.prototype.updateActiveEffects=function(){cr.clearArray(this.active_effect_types);this.shaders_preserve_opaqueness=!0;var e;var a=0;for(e=this.effect_types.length;a<e;a++){var c=this.effect_types[a];c.active&&(this.active_effect_types.push(c),c.preservesOpaqueness||(this.shaders_preserve_opaqueness=!1))}};b.prototype.getEffectByName=function(e){var a;var c=0;for(a=
this.effect_types.length;c<a;c++){var m=this.effect_types[c];if(m.name===e)return m}return null};var q=[],y=!0;b.prototype.startRunning=function(){this.sheetname&&(this.event_sheet=this.runtime.eventsheets[this.sheetname],this.event_sheet.updateDeepIncludes());this.runtime.running_layout=this;this.width=this.originalWidth;this.height=this.originalHeight;this.scrollX=this.runtime.original_width/2;this.scrollY=this.runtime.original_height/2;var e,a;var c=0;for(e=this.runtime.types_by_index.length;c<
e;c++){var m=this.runtime.types_by_index[c];if(!m.is_family){var u=m.instances;m=0;for(a=u.length;m<a;m++){var p=u[m];if(p.layer){var x=p.layer.number;x>=this.layers.length&&(x=this.layers.length-1);p.layer=this.layers[x];-1===p.layer.instances.indexOf(p)&&p.layer.instances.push(p);p.layer.zindices_stale=!0}}}}if(!y)for(c=0,e=this.layers.length;c<e;++c)this.layers[c].instances.sort(d);cr.clearArray(q);this.boundScrolling();c=0;for(e=this.layers.length;c<e;c++)p=this.layers[c],p.createInitialInstances(q),
p.updateViewport(null);u=!1;if(!this.first_visit){for(M in this.persist_data)if(this.persist_data.hasOwnProperty(M)&&(m=this.runtime.getObjectTypeBySid(parseInt(M,10)))&&!m.is_family&&this.runtime.typeHasPersistBehavior(m)){a=this.persist_data[M];c=0;for(e=a.length;c<e;c++){p=null;if(m.plugin.is_world&&(p=this.getLayerBySid(a[c].w.l),!p))continue;p=this.runtime.createInstanceFromInit(m.default_instance,p,!1,0,0,!0);this.runtime.loadInstanceFromJSON(p,a[c]);u=!0;q.push(p)}cr.clearArray(a)}c=0;for(e=
this.layers.length;c<e;c++)this.layers[c].instances.sort(d),this.layers[c].zindices_stale=!0}u&&(this.runtime.ClearDeathRow(),this.runtime.refreshUidMap());this.createAndLinkContainerInstances(q);c=0;for(e=this.initial_nonworld.length;c<e;c++){var M=this.initial_nonworld[c];m=this.runtime.types_by_index[M[1]];m.is_contained||this.runtime.createInstanceFromInit(this.initial_nonworld[c],null,!0)}this.runtime.changelayout=null;this.runtime.ClearDeathRow();if(this.runtime.ctx)for(c=0,e=this.runtime.types_by_index.length;c<
e;c++)M=this.runtime.types_by_index[c],!M.is_family&&M.instances.length&&M.preloadCanvas2D&&M.preloadCanvas2D(this.runtime.ctx);if(this.runtime.isLoadingState)cr.shallowAssignArray(this.runtime.fireOnCreateAfterLoad,q);else for(c=0,e=q.length;c<e;c++)p=q[c],this.runtime.trigger(Object.getPrototypeOf(p.type.plugin).cnds.OnCreated,p);cr.clearArray(q);this.runtime.isLoadingState||this.runtime.trigger(cr.system_object.prototype.cnds.OnLayoutStart,null);this.first_visit=!1};b.prototype.createAndLinkContainerInstances=
function(e){var a,c;for(a=0;a<e.length;a++){var m=e[a];if(m.type.is_contained){var u=m.get_iid();var p=0;for(c=m.type.container.length;p<c;p++){var x=m.type.container[p];if(m.type!==x)if(x.instances.length>u)m.siblings.push(x.instances[u]);else if(x.default_instance){var M=this.runtime.createInstanceFromInit(x.default_instance,m.layer,!0,m.x,m.y,!0);this.runtime.ClearDeathRow();x.updateIIDs();m.siblings.push(M);e.push(M)}}}}};b.prototype.createGlobalNonWorlds=function(){var e,a,c=[];var m=e=0;for(a=
this.initial_nonworld.length;e<a;e++){var u=this.initial_nonworld[e];var p=this.runtime.types_by_index[u[1]];p.global?p.is_contained&&h(p.container)||c.push(this.runtime.createInstanceFromInit(u,null,!0)):(this.initial_nonworld[m]=u,m++)}cr.truncateArray(this.initial_nonworld,m);this.runtime.ClearDeathRow();this.createAndLinkContainerInstances(c)};b.prototype.stopRunning=function(){this.runtime.isLoadingState||this.runtime.trigger(cr.system_object.prototype.cnds.OnLayoutEnd,null);this.runtime.isEndingLayout=
!0;cr.clearArray(this.runtime.system.waits);var e,a;if(!this.first_visit){var c=0;for(e=this.layers.length;c<e;c++){this.layers[c].updateZIndices();var m=this.layers[c].instances;var u=0;for(a=m.length;u<a;u++){var p=m[u];p.type.global||this.runtime.typeHasPersistBehavior(p.type)&&this.saveObjectToPersist(p)}}}c=0;for(e=this.layers.length;c<e;c++){m=this.layers[c].instances;u=0;for(a=m.length;u<a;u++)p=m[u],p.type.global||this.runtime.DestroyInstance(p);this.runtime.ClearDeathRow();cr.clearArray(m);
this.layers[c].zindices_stale=!0}c=0;for(e=this.runtime.types_by_index.length;c<e;c++)if(m=this.runtime.types_by_index[c],!(m.global||m.plugin.is_world||m.plugin.singleglobal||m.is_family)){u=0;for(a=m.instances.length;u<a;u++)this.runtime.DestroyInstance(m.instances[u]);this.runtime.ClearDeathRow()}y=!1;this.runtime.isEndingLayout=!1};var A=new cr.rect(0,0,0,0);b.prototype.recreateInitialObjects=function(e,a,c,m,u){A.set(a,c,m,u);a=0;for(c=this.layers.length;a<c;a++)this.layers[a].recreateInitialObjects(e,
A)};b.prototype.draw=function(e){var a=e,c=!1,m=!this.runtime.fullscreenScalingQuality;if(m){if(!this.runtime.layout_canvas){this.runtime.layout_canvas=document.createElement("canvas");var u=this.runtime.layout_canvas;u.width=this.runtime.draw_width;u.height=this.runtime.draw_height;this.runtime.layout_ctx=u.getContext("2d");c=!0}u=this.runtime.layout_canvas;a=this.runtime.layout_ctx;u.width!==this.runtime.draw_width&&(u.width=this.runtime.draw_width,c=!0);u.height!==this.runtime.draw_height&&(u.height=
this.runtime.draw_height,c=!0);c&&(a.imageSmoothingEnabled=this.runtime.linearSampling)}a.globalAlpha=1;a.globalCompositeOperation="source-over";this.runtime.clearBackground&&!this.hasOpaqueBottomLayer()&&a.clearRect(0,0,this.runtime.draw_width,this.runtime.draw_height);var p;c=0;for(p=this.layers.length;c<p;c++){var x=this.layers[c];x.visible&&0<x.opacity&&11!==x.blend_mode&&(x.instances.length||!x.transparent)?x.draw(a):x.updateViewport(null)}m&&e.drawImage(u,0,0,this.runtime.width,this.runtime.height)};
b.prototype.drawGL_earlyZPass=function(e){e.setEarlyZPass(!0);this.runtime.layout_tex||(this.runtime.layout_tex=e.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling));if(this.runtime.layout_tex.c2width!==this.runtime.draw_width||this.runtime.layout_tex.c2height!==this.runtime.draw_height)e.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=e.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling);e.setRenderingToTexture(this.runtime.layout_tex);
this.runtime.fullscreenScalingQuality||e.setSize(this.runtime.draw_width,this.runtime.draw_height);var a;for(a=this.layers.length-1;0<=a;--a){var c=this.layers[a];c.visible&&1===c.opacity&&c.shaders_preserve_opaqueness&&0===c.blend_mode&&(c.instances.length||!c.transparent)?c.drawGL_earlyZPass(e):c.updateViewport(null)}e.setEarlyZPass(!1)};b.prototype.drawGL=function(e){var a=0<this.active_effect_types.length||this.runtime.uses_background_blending||!this.runtime.fullscreenScalingQuality||this.runtime.enableFrontToBack;
if(a){this.runtime.layout_tex||(this.runtime.layout_tex=e.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling));if(this.runtime.layout_tex.c2width!==this.runtime.draw_width||this.runtime.layout_tex.c2height!==this.runtime.draw_height)e.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=e.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling);e.setRenderingToTexture(this.runtime.layout_tex);this.runtime.fullscreenScalingQuality||
e.setSize(this.runtime.draw_width,this.runtime.draw_height)}else this.runtime.layout_tex&&(e.setRenderingToTexture(null),e.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=null);this.runtime.clearBackground&&!this.hasOpaqueBottomLayer()&&e.clear(0,0,0,0);var c;var m=0;for(c=this.layers.length;m<c;m++){var u=this.layers[m];u.visible&&0<u.opacity&&(u.instances.length||!u.transparent)?u.drawGL(e):u.updateViewport(null)}a&&(0===this.active_effect_types.length||1===this.active_effect_types.length&&
this.runtime.fullscreenScalingQuality?(1===this.active_effect_types.length?(a=this.active_effect_types[0].index,m=this.calculateViewRect(),e.switchProgram(this.active_effect_types[0].shaderindex),e.setProgramParameters(null,1/this.runtime.draw_width,1/this.runtime.draw_height,0,0,1,1,0,0,1,1,m.left,m.top,m.right,m.bottom,0,0,1,1,this.scale,this.angle,this.runtime.kahanTime.sum,this.effect_params[a]),e.programIsAnimated(this.active_effect_types[0].shaderindex)&&(this.runtime.redraw=!0)):e.switchProgram(0),
this.runtime.fullscreenScalingQuality||e.setSize(this.runtime.width,this.runtime.height),e.setRenderingToTexture(null),e.setDepthTestEnabled(!1),e.setOpacity(1),e.setTexture(this.runtime.layout_tex),e.setAlphaBlend(),e.resetModelView(),e.updateModelView(),a=this.runtime.width/2,m=this.runtime.height/2,e.quad(-a,m,a,m,a,-m,-a,-m),e.setTexture(null),e.setDepthTestEnabled(!0)):this.renderEffectChain(e,null,null,null))};b.prototype.getRenderTarget=function(){return 0<this.active_effect_types.length||
this.runtime.uses_background_blending||!this.runtime.fullscreenScalingQuality||this.runtime.enableFrontToBack?this.runtime.layout_tex:null};b.prototype.getMinLayerScale=function(){var e=this.layers[0].getScale(),a;var c=1;for(a=this.layers.length;c<a;c++){var m=this.layers[c];(0!==m.parallaxX||0!==m.parallaxY)&&m.getScale()<e&&(e=m.getScale())}return e};b.prototype.scrollToX=function(e){if(!this.unbounded_scrolling){var a=this.runtime.draw_width*(1/this.getMinLayerScale())/2;e>this.width-a&&(e=this.width-
a);e<a&&(e=a)}this.scrollX!==e&&(this.scrollX=e,this.runtime.redraw=!0)};b.prototype.scrollToY=function(e){if(!this.unbounded_scrolling){var a=this.runtime.draw_height*(1/this.getMinLayerScale())/2;e>this.height-a&&(e=this.height-a);e<a&&(e=a)}this.scrollY!==e&&(this.scrollY=e,this.runtime.redraw=!0)};b.prototype.boundScrolling=function(){this.scrollToX(this.scrollX);this.scrollToY(this.scrollY)};b.prototype.calculateViewRect=function(){var e=this.scrollX,a=this.scrollY,c=1/(this.scale*this.runtime.aspect_scale);
e-=this.runtime.width*c/2;a-=this.runtime.height*c/2;this.viewRect.set(e,a,e+this.runtime.draw_width*c,a+this.runtime.draw_height*c);return this.viewRect};b.prototype.renderEffectChain=function(e,a,c,m){var u=c?c.active_effect_types:a?a.active_effect_types:this.active_effect_types;if(c){var p=c.layer.getScale();var x=c.layer.getAngle();var M=c.layer.viewLeft;var v=c.layer.viewTop;var F=c.layer.viewRight;var C=c.layer.viewBottom}else a?(p=a.getScale(),x=a.getAngle(),M=a.viewLeft,v=a.viewTop,F=a.viewRight,
C=a.viewBottom):(p=this.scale,x=this.angle,C=this.calculateViewRect(),M=C.left,v=C.top,F=C.right,C=C.bottom);var l=this.runtime.fx_tex,t,D,S=0,V=1,K=this.runtime.draw_width,f=this.runtime.draw_height,n=K/2,G=f/2,g=a?a.rcTexBounce:this.rcTexBounce,z=a?a.rcTexDest:this.rcTexDest,J=a?a.rcTexOrigin:this.rcTexOrigin,N=0,U=0,W=0,X=0,Y=K,ea=K,ha=f,k=f,r=D=0,E=c?c.layer.getAngle():0;if(c){var H=0;for(t=u.length;H<t;H++)D+=e.getProgramBoxExtendHorizontal(u[H].shaderindex),r+=e.getProgramBoxExtendVertical(u[H].shaderindex);
X=c.bbox;N=a.layerToCanvas(X.left,X.top,!0,!0);W=a.layerToCanvas(X.left,X.top,!1,!0);Y=a.layerToCanvas(X.right,X.bottom,!0,!0);ha=a.layerToCanvas(X.right,X.bottom,!1,!0);if(0!==E){H=a.layerToCanvas(X.right,X.top,!0,!0);t=a.layerToCanvas(X.right,X.top,!1,!0);U=a.layerToCanvas(X.left,X.bottom,!0,!0);X=a.layerToCanvas(X.left,X.bottom,!1,!0);var B=Math.min(N,Y,H,U);Y=Math.max(N,Y,H,U);N=B;B=Math.min(W,ha,t,X);ha=Math.max(W,ha,t,X);W=B}J.left=N/K;J.top=1-W/f;J.right=Y/K;J.bottom=1-ha/f;N-=D;W-=r;Y+=D;
ha+=r;z.left=N/K;z.top=1-W/f;z.right=Y/K;z.bottom=1-ha/f;U=N=cr.floor(N);X=W=cr.floor(W);ea=Y=cr.ceil(Y);k=ha=cr.ceil(ha);U-=D;X-=r;ea+=D;k+=r;0>N&&(N=0);0>W&&(W=0);Y>K&&(Y=K);ha>f&&(ha=f);0>U&&(U=0);0>X&&(X=0);ea>K&&(ea=K);k>f&&(k=f);g.left=N/K;g.top=1-W/f;g.right=Y/K;g.bottom=1-ha/f}else g.left=z.left=J.left=0,g.top=z.top=J.top=0,g.right=z.right=J.right=1,g.bottom=z.bottom=1;r=c&&(e.programUsesDest(u[0].shaderindex)||0!==D||0!==r||1!==c.opacity||c.type.plugin.must_predraw)||a&&!c&&1!==a.opacity;
e.setAlphaBlend();if(r){l[S]||(l[S]=e.createEmptyTexture(K,f,this.runtime.linearSampling));if(l[S].c2width!==K||l[S].c2height!==f)e.deleteTexture(l[S]),l[S]=e.createEmptyTexture(K,f,this.runtime.linearSampling);e.switchProgram(0);e.setRenderingToTexture(l[S]);var L=k-X;e.clearRect(U,f-X-L,ea-U,L);c?c.drawGL(e):(e.setTexture(this.runtime.layer_tex),e.setOpacity(a.opacity),e.resetModelView(),e.translate(-n,-G),e.updateModelView(),e.quadTex(N,ha,Y,ha,Y,W,N,W,g));z.left=z.top=0;z.right=z.bottom=1;c&&
(B=g.top,g.top=g.bottom,g.bottom=B);S=1;V=0}e.setOpacity(1);D=u.length-1;E=e.programUsesCrossSampling(u[D].shaderindex)||!a&&!c&&!this.runtime.fullscreenScalingQuality;H=0;for(t=u.length;H<t;H++){l[S]||(l[S]=e.createEmptyTexture(K,f,this.runtime.linearSampling));if(l[S].c2width!==K||l[S].c2height!==f)e.deleteTexture(l[S]),l[S]=e.createEmptyTexture(K,f,this.runtime.linearSampling);e.switchProgram(u[H].shaderindex);B=u[H].index;e.programIsAnimated(u[H].shaderindex)&&(this.runtime.redraw=!0);if(0!=H||
r){e.setProgramParameters(m,1/K,1/f,0,0,1,1,J.left,J.top,J.right,J.bottom,M,v,F,C,z.left,z.top,z.right,z.bottom,p,x,this.runtime.kahanTime.sum,c?c.effect_params[B]:a?a.effect_params[B]:this.effect_params[B]);e.setTexture(null);if(H!==D||E){e.setRenderingToTexture(l[S]);L=k-X;var Q=f-X-L;e.clearRect(U,Q,ea-U,L)}else c?e.setBlend(c.srcBlend,c.destBlend):a&&e.setBlend(a.srcBlend,a.destBlend),e.setRenderingToTexture(m);e.setTexture(l[V]);e.resetModelView();e.translate(-n,-G);e.updateModelView();e.quadTex(N,
ha,Y,ha,Y,W,N,W,g);H!==D||E||e.setTexture(null)}else{e.setRenderingToTexture(l[S]);L=k-X;Q=f-X-L;e.clearRect(U,Q,ea-U,L);if(c){Q=V=0;var R=L=1,T=1/c.width,fa=1/c.height;c.curFrame&&c.curFrame.sheetTex&&(V=c.curFrame.sheetTex.left,Q=c.curFrame.sheetTex.top,L=c.curFrame.sheetTex.right,R=c.curFrame.sheetTex.bottom,c.curFrame.texture_img&&(T=1/c.curFrame.texture_img.width,fa=1/c.curFrame.texture_img.height));e.setProgramParameters(m,T,fa,V,Q,L,R,V,Q,L,R,c.bbox.left,c.bbox.top,c.bbox.right,c.bbox.bottom,
z.left,z.top,z.right,z.bottom,p,x,this.runtime.kahanTime.sum,c.effect_params[B]);c.drawGL(e)}else e.setProgramParameters(m,1/K,1/f,0,0,1,1,0,0,1,1,M,v,F,C,0,0,1,1,p,x,this.runtime.kahanTime.sum,a?a.effect_params[B]:this.effect_params[B]),e.setTexture(a?this.runtime.layer_tex:this.runtime.layout_tex),e.resetModelView(),e.translate(-n,-G),e.updateModelView(),e.quadTex(N,ha,Y,ha,Y,W,N,W,g);z.left=z.top=0;z.right=z.bottom=1;c&&!E&&(B=ha,ha=W,W=B)}S=0===S?1:0;V=0===S?1:0}E&&(e.switchProgram(0),c?e.setBlend(c.srcBlend,
c.destBlend):a?e.setBlend(a.srcBlend,a.destBlend):this.runtime.fullscreenScalingQuality||(e.setSize(this.runtime.width,this.runtime.height),n=this.runtime.width/2,G=this.runtime.height/2,W=N=0,Y=this.runtime.width,ha=this.runtime.height),e.setRenderingToTexture(m),e.setTexture(l[V]),e.resetModelView(),e.translate(-n,-G),e.updateModelView(),c&&1===u.length&&!r?e.quadTex(N,W,Y,W,Y,ha,N,ha,g):e.quadTex(N,ha,Y,ha,Y,W,N,W,g),e.setTexture(null))};b.prototype.getLayerBySid=function(e){var a;var c=0;for(a=
this.layers.length;c<a;c++)if(this.layers[c].sid===e)return this.layers[c];return null};b.prototype.saveToJSON=function(){var e,a={sx:this.scrollX,sy:this.scrollY,s:this.scale,a:this.angle,w:this.width,h:this.height,fv:this.first_visit,persist:this.persist_data,fx:[],layers:{}};var c=0;for(e=this.effect_types.length;c<e;c++){var m=this.effect_types[c];a.fx.push({name:m.name,active:m.active,params:this.effect_params[m.index]})}c=0;for(e=this.layers.length;c<e;c++)m=this.layers[c],a.layers[m.sid.toString()]=
m.saveToJSON();return a};b.prototype.loadFromJSON=function(e){var a,c,m;this.scrollX=e.sx;this.scrollY=e.sy;this.scale=e.s;this.angle=e.a;this.width=e.w;this.height=e.h;this.persist_data=e.persist;"undefined"!==typeof e.fv&&(this.first_visit=e.fv);var u=e.fx;var p=0;for(a=u.length;p<a;p++)if(c=this.getEffectByName(u[p].name))c.active=u[p].active,this.effect_params[c.index]=u[p].params;this.updateActiveEffects();p=e.layers;for(m in p)p.hasOwnProperty(m)&&(e=this.getLayerBySid(parseInt(m,10)))&&e.loadFromJSON(p[m])};
cr.layout=b})();
(function(){function b(l,t){var D,S=l.length;switch(S){case 0:return!0;case 1:return l[0]===t[0];case 2:return l[0]===t[0]&&l[1]===t[1];default:for(D=0;D<S;D++)if(l[D]!==t[D])return!1;return!0}}function d(l,t){return l.index-t.index}function h(l){var t;if(2===l.length){if(l[0].index>l[1].index){var D=l[0];l[0]=l[1];l[1]=D}}else 2<l.length&&l.sort(d);l.length>=v.length&&(v.length=l.length+1);v[l.length]||(v[l.length]=[]);var S=v[l.length];D=0;for(t=S.length;D<t;D++){var V=S[D];if(b(l,V))return V}S.push(l);
return l}function q(l,t){this.runtime=l;this.triggers={};this.fasttriggers={};this.hasRun=!1;this.includes=new cr.ObjectSet;this.deep_includes=[];this.already_included_sheets=[];this.name=t[0];l=t[1];this.events=[];var D;t=0;for(D=l.length;t<D;t++)this.init_event(l[t],null,this.events)}function y(l){this.type=l;this.instances=[];this.else_instances=[];this.select_all=!0}function A(l,t,D){this.sheet=l;this.parent=t;this.runtime=l.runtime;this.solModifiers=[];this.solModifiersIncludingParents=[];this.has_else_block=
this.toplevelgroup=this.toplevelevent=this.initially_activated=this.group=this.solWriterAfterCnds=!1;this.conditions=[];this.actions=[];this.subevents=[];this.group_name="";this.group_active=this.initially_activated=this.group=!1;this.contained_includes=null;3===D[0]&&(this.group_name=D[1][1].toLowerCase(),this.group=!0,this.initially_activated=!!D[1][0],this.contained_includes=[],this.group_active=this.initially_activated,this.runtime.allGroups.push(this),this.runtime.groups_by_name[this.group_name]=
this);this.orblock=D[2];this.sid=D[4];this.group||(this.runtime.blocksBySid[this.sid.toString()]=this);var S=D[6];l=0;for(t=S.length;l<t;l++){var V=new cr.condition(this,S[l]);V.index=l;cr.seal(V);this.conditions.push(V);this.addSolModifier(V.type)}S=D[7];l=0;for(t=S.length;l<t;l++)V=new cr.action(this,S[l]),V.index=l,cr.seal(V),this.actions.push(V);if(9===D.length)for(D=D[8],l=0,t=D.length;l<t;l++)this.sheet.init_event(D[l],this,this.subevents);this.is_else_block=!1;this.conditions.length&&(this.is_else_block=
null==this.conditions[0].type&&this.conditions[0].func==cr.system_object.prototype.cnds.Else)}function e(l,t){var D;if(l&&(-1===t.indexOf(l)&&t.push(l),l.is_contained)){var S=0;for(D=l.container.length;S<D;S++){var V=l.container[S];l!==V&&-1===t.indexOf(V)&&t.push(V)}}}function a(l,t){this.block=l;this.sheet=l.sheet;this.runtime=l.runtime;this.parameters=[];this.results=[];this.extra={};this.index=-1;this.anyParamVariesPerInstance=!1;this.func=this.runtime.GetObjectReference(t[1]);this.trigger=0<
t[3];this.fasttrigger=2===t[3];this.looping=t[4];this.inverted=t[5];this.isstatic=t[6];this.sid=t[7];this.runtime.cndsBySid[this.sid.toString()]=this;-1===t[0]?(this.type=null,this.run=this.run_system,this.behaviortype=null,this.beh_index=-1):(this.type=this.runtime.types_by_index[t[0]],this.run=this.isstatic?this.run_static:this.run_object,t[2]?(this.behaviortype=this.type.getBehaviorByName(t[2]),this.beh_index=this.type.getBehaviorIndexByName(t[2])):(this.behaviortype=null,this.beh_index=-1),this.block.parent&&
this.block.parent.setSolWriterAfterCnds());this.fasttrigger&&(this.run=this.run_true);if(10===t.length){var D=t[9];l=0;for(t=D.length;l<t;l++){var S=new cr.parameter(this,D[l]);cr.seal(S);this.parameters.push(S)}this.results.length=D.length}}function c(l,t){this.block=l;this.sheet=l.sheet;this.runtime=l.runtime;this.parameters=[];this.results=[];this.extra={};this.index=-1;this.anyParamVariesPerInstance=!1;this.func=this.runtime.GetObjectReference(t[1]);-1===t[0]?(this.type=null,this.run=this.run_system,
this.behaviortype=null,this.beh_index=-1):(this.type=this.runtime.types_by_index[t[0]],this.run=this.run_object,t[2]?(this.behaviortype=this.type.getBehaviorByName(t[2]),this.beh_index=this.type.getBehaviorIndexByName(t[2])):(this.behaviortype=null,this.beh_index=-1));this.sid=t[3];this.runtime.actsBySid[this.sid.toString()]=this;if(7===t.length){var D=t[6];l=0;for(t=D.length;l<t;l++){var S=new cr.parameter(this,D[l]);cr.seal(S);this.parameters.push(S)}this.results.length=D.length}}function m(){C++;
F.length===C&&F.push(new cr.expvalue);return F[C]}function u(l,t){this.owner=l;this.block=l.block;this.sheet=l.sheet;this.runtime=l.runtime;this.type=t[0];this.expression=null;this.solindex=0;this.get=null;this.combosel=0;this.layout=null;this.key=0;this.object=null;this.index=0;this.variadicret=this.subparams=this.fileinfo=this.eventvar=this.varname=null;this.variesPerInstance=!1;var D;switch(this.type){case 0:case 7:this.expression=new cr.expNode(this,t[1]);this.solindex=0;this.get=this.get_exp;
break;case 1:case 14:this.expression=new cr.expNode(this,t[1]);this.solindex=0;this.get=this.get_exp_str;14===this.type&&(this.block.setAllSolModifiers(),this.owner instanceof cr.action&&this.block.setSolWriterAfterCnds());break;case 5:this.expression=new cr.expNode(this,t[1]);this.solindex=0;this.get=this.get_layer;break;case 3:case 8:this.combosel=t[1];this.get=this.get_combosel;break;case 16:this.combosel=t[1]?1:0;this.get=this.get_boolean;break;case 6:this.layout=this.runtime.layouts[t[1]];this.get=
this.get_layout;break;case 9:this.key=t[1];this.get=this.get_key;break;case 4:this.object=this.runtime.types_by_index[t[1]];this.get=this.get_object;this.block.addSolModifier(this.object);this.owner instanceof cr.action?this.block.setSolWriterAfterCnds():this.block.parent&&this.block.parent.setSolWriterAfterCnds();break;case 10:this.index=t[1];l.type&&l.type.is_family?(this.get=this.get_familyvar,this.variesPerInstance=!0):this.get=this.get_instvar;break;case 11:this.varname=t[1];this.eventvar=null;
this.get=this.get_eventvar;break;case 2:case 12:this.fileinfo=t[1];this.get=this.get_audiofile;break;case 13:for(this.get=this.get_variadic,this.subparams=[],this.variadicret=[],l=1,D=t.length;l<D;l++){var S=new cr.parameter(this.owner,t[l]);cr.seal(S);this.subparams.push(S);this.variadicret.push(0)}}}function p(l,t,D){this.sheet=l;this.parent=t;this.runtime=l.runtime;this.solModifiers=[];this.name=D[1];this.vartype=D[2];this.initial=D[3];this.is_static=!!D[4];this.is_constant=!!D[5];this.sid=D[6];
this.runtime.varsBySid[this.sid.toString()]=this;this.data=this.initial;this.parent?(this.localIndex=this.is_static||this.is_constant?-1:this.runtime.stackLocalCount++,this.runtime.all_local_vars.push(this)):(this.localIndex=-1,this.runtime.all_global_vars.push(this))}function x(l,t,D){this.sheet=l;this.parent=t;this.runtime=l.runtime;this.solModifiers=[];this.include_sheet=null;this.include_sheet_name=D[1];this.active=!0}function M(){this.temp_parents_arr=[];this.reset(null);cr.seal(this)}var v=
[];q.prototype.toString=function(){return this.name};q.prototype.init_event=function(l,t,D){switch(l[0]){case 0:case 3:l=new cr.eventblock(this,t,l);cr.seal(l);if(l.orblock)for(D.push(l),D=0,t=l.conditions.length;D<t;D++)l.conditions[D].trigger&&this.init_trigger(l,D);else l.is_trigger()?this.init_trigger(l,0):D.push(l);break;case 1:l=new cr.eventvariable(this,t,l);cr.seal(l);D.push(l);break;case 2:l=new cr.eventinclude(this,t,l),cr.seal(l),D.push(l)}};q.prototype.postInit=function(){var l;var t=
0;for(l=this.events.length;t<l;t++)this.events[t].postInit(t<l-1&&this.events[t+1].is_else_block)};q.prototype.updateDeepIncludes=function(){cr.clearArray(this.deep_includes);cr.clearArray(this.already_included_sheets);this.addDeepIncludes(this);cr.clearArray(this.already_included_sheets)};q.prototype.addDeepIncludes=function(l){var t,D=l.deep_includes,S=l.already_included_sheets,V=this.includes.valuesRef();var K=0;for(t=V.length;K<t;++K){var f=V[K];var n=f.include_sheet;!f.isActive()||l===n||-1<
S.indexOf(n)||(S.push(n),n.addDeepIncludes(l),D.push(n))}};q.prototype.run=function(l){this.runtime.resuming_breakpoint||(this.hasRun=!0,l||(this.runtime.isRunningEvents=!0));var t;var D=0;for(t=this.events.length;D<t;D++){var S=this.events[D];S.run();this.runtime.clearSol(S.solModifiers);this.runtime.hasPendingInstances&&this.runtime.ClearDeathRow()}l||(this.runtime.isRunningEvents=!1)};q.prototype.init_trigger=function(l,t){l.orblock||this.runtime.triggers_to_postinit.push(l);var D,S,V=l.conditions[t];
var K=V.type?V.type.name:"system";var f=(D=V.fasttrigger)?this.fasttriggers:this.triggers;f[K]||(f[K]=[]);K=f[K];f=V.func;if(D){if(V.parameters.length&&(V=V.parameters[0],1===V.type&&2===V.expression.type)){V=V.expression.value.toLowerCase();D=0;for(S=K.length;D<S;D++)if(K[D].method==f){D=K[D].evs;D[V]?D[V].push([l,t]):D[V]=[[l,t]];return}D={};D[V]=[[l,t]];K.push({method:f,evs:D})}}else{D=0;for(S=K.length;D<S;D++)if(K[D].method==f){K[D].evs.push([l,t]);return}V=cr.plugins_.Sprite&&f===cr.plugins_.Sprite.prototype.cnds.OnFrameChanged?
!0:!1;V?K.unshift({method:f,evs:[[l,t]]}):K.push({method:f,evs:[[l,t]]})}};cr.eventsheet=q;y.prototype.hasObjects=function(){return this.select_all?this.type.instances.length:this.instances.length};y.prototype.getObjects=function(){return this.select_all?this.type.instances:this.instances};y.prototype.pick_one=function(l){l&&(l.runtime.getCurrentEventStack().current_event.orblock?(this.select_all&&(cr.clearArray(this.instances),cr.shallowAssignArray(this.else_instances,l.type.instances),this.select_all=
!1),l=this.else_instances.indexOf(l),-1!==l&&(this.instances.push(this.else_instances[l]),this.else_instances.splice(l,1))):(this.select_all=!1,cr.clearArray(this.instances),this.instances[0]=l))};cr.selection=y;A.prototype.postInit=function(l){var t,D=this.parent;if(this.group)for(this.toplevelgroup=!0;D;){if(!D.group){this.toplevelgroup=!1;break}D=D.parent}this.toplevelevent=!this.is_trigger()&&(!this.parent||this.parent.group&&this.parent.toplevelgroup);this.has_else_block=!!l;D=this.runtime.types_by_index;
if(this.solModifiers===D)this.solModifiersIncludingParents=D;else{this.solModifiersIncludingParents=this.solModifiers.slice(0);for(D=this.parent;D;){l=0;for(t=D.solModifiers.length;l<t;l++)this.addParentSolModifier(D.solModifiers[l]);D=D.parent}this.solModifiers=h(this.solModifiers);this.solModifiersIncludingParents=h(this.solModifiersIncludingParents)}l=0;for(t=this.conditions.length;l<t;l++)this.conditions[l].postInit();l=0;for(t=this.actions.length;l<t;l++)this.actions[l].postInit();l=0;for(t=
this.subevents.length;l<t;l++)this.subevents[l].postInit(l<t-1&&this.subevents[l+1].is_else_block)};A.prototype.setGroupActive=function(l){if(this.group_active!==!!l){this.group_active=!!l;var t;l=0;for(t=this.contained_includes.length;l<t;++l)this.contained_includes[l].updateActive();0<t&&this.runtime.running_layout.event_sheet&&this.runtime.running_layout.event_sheet.updateDeepIncludes()}};A.prototype.addSolModifier=function(l){e(l,this.solModifiers)};A.prototype.addParentSolModifier=function(l){e(l,
this.solModifiersIncludingParents)};A.prototype.setAllSolModifiers=function(){this.solModifiers=this.runtime.types_by_index};A.prototype.setSolWriterAfterCnds=function(){this.solWriterAfterCnds=!0;this.parent&&this.parent.setSolWriterAfterCnds()};A.prototype.is_trigger=function(){return this.conditions.length?this.conditions[0].trigger:!1};A.prototype.run=function(){var l,t=!1,D=this.runtime,S=this.runtime.getCurrentEventStack();S.current_event=this;var V=this.conditions;this.is_else_block||(S.else_branch_ran=
!1);if(this.orblock){0===V.length&&(t=!0);S.cndindex=0;for(l=V.length;S.cndindex<l;S.cndindex++){var K=V[S.cndindex];K.trigger||(K=K.run())&&(t=!0)}(S.last_event_true=t)&&this.run_actions_and_subevents()}else{S.cndindex=0;for(l=V.length;S.cndindex<l;S.cndindex++)if(K=V[S.cndindex].run(),!K){S.last_event_true=!1;this.toplevelevent&&D.hasPendingInstances&&D.ClearDeathRow();return}S.last_event_true=!0;this.run_actions_and_subevents()}this.end_run(S)};A.prototype.end_run=function(l){l.last_event_true&&
this.has_else_block&&(l.else_branch_ran=!0);this.toplevelevent&&this.runtime.hasPendingInstances&&this.runtime.ClearDeathRow()};A.prototype.run_orblocktrigger=function(l){this.runtime.getCurrentEventStack().current_event=this;this.conditions[l].run()&&(this.run_actions_and_subevents(),this.runtime.getCurrentEventStack().last_event_true=!0)};A.prototype.run_actions_and_subevents=function(){var l=this.runtime.getCurrentEventStack(),t;l.actindex=0;for(t=this.actions.length;l.actindex<t;l.actindex++)if(this.actions[l.actindex].run())return;
this.run_subevents()};A.prototype.resume_actions_and_subevents=function(){var l=this.runtime.getCurrentEventStack(),t;for(t=this.actions.length;l.actindex<t;l.actindex++)if(this.actions[l.actindex].run())return;this.run_subevents()};A.prototype.run_subevents=function(){if(this.subevents.length){var l,t,D=this.subevents.length-1;this.runtime.pushEventStack(this);if(this.solWriterAfterCnds){var S=0;for(l=this.subevents.length;S<l;S++){var V=this.subevents[S];(t=!this.toplevelgroup||!this.group&&S<D)&&
this.runtime.pushCopySol(V.solModifiers);V.run();t?this.runtime.popSol(V.solModifiers):this.runtime.clearSol(V.solModifiers)}}else for(S=0,l=this.subevents.length;S<l;S++)this.subevents[S].run();this.runtime.popEventStack()}};A.prototype.run_pretrigger=function(){var l=this.runtime.getCurrentEventStack();l.current_event=this;var t=!1,D;l.cndindex=0;for(D=this.conditions.length;l.cndindex<D;l.cndindex++)if(this.conditions[l.cndindex].run())t=!0;else if(!this.orblock)return!1;return this.orblock?t:
!0};A.prototype.retrigger=function(){this.runtime.execcount++;var l=this.runtime.getCurrentEventStack().cndindex,t=this.runtime.pushEventStack(this);if(!this.orblock)for(t.cndindex=l+1,l=this.conditions.length;t.cndindex<l;t.cndindex++)if(!this.conditions[t.cndindex].run())return this.runtime.popEventStack(),!1;this.run_actions_and_subevents();this.runtime.popEventStack();return!0};A.prototype.isFirstConditionOfType=function(l){var t=l.index;if(0===t)return!0;for(--t;0<=t;--t)if(this.conditions[t].type===
l.type)return!1;return!0};cr.eventblock=A;a.prototype.postInit=function(){var l;var t=0;for(l=this.parameters.length;t<l;t++){var D=this.parameters[t];D.postInit();D.variesPerInstance&&(this.anyParamVariesPerInstance=!0)}};a.prototype.run_true=function(){return!0};a.prototype.run_system=function(){var l;var t=0;for(l=this.parameters.length;t<l;t++)this.results[t]=this.parameters[t].get();return cr.xor(this.func.apply(this.runtime.system,this.results),this.inverted)};a.prototype.run_static=function(){var l;
var t=0;for(l=this.parameters.length;t<l;t++)this.results[t]=this.parameters[t].get();t=this.func.apply(this.behaviortype?this.behaviortype:this.type,this.results);this.type.applySolToContainer();return t};a.prototype.run_object=function(){var l,t,D,S=this.type,V=S.getCurrentSol(),K=this.block.orblock&&!this.trigger,f=S.is_contained,n=S.is_family,G=S.family_index,g=this.beh_index,z=-1<g,J=this.anyParamVariesPerInstance,N=this.parameters,U=this.results,W=this.inverted,X=this.func;if(J){var Y=0;for(t=
N.length;Y<t;++Y){var ea=N[Y];ea.variesPerInstance||(U[Y]=ea.get(0))}}else for(Y=0,t=N.length;Y<t;++Y)U[Y]=N[Y].get(0);if(V.select_all){cr.clearArray(V.instances);cr.clearArray(V.else_instances);var ha=S.instances;var k=0;for(l=ha.length;k<l;++k){var r=ha[k];if(J)for(Y=0,t=N.length;Y<t;++Y)ea=N[Y],ea.variesPerInstance&&(U[Y]=ea.get(k));z?(Y=0,n&&(Y=r.type.family_beh_map[G]),Y=X.apply(r.behavior_insts[g+Y],U)):Y=X.apply(r,U);(D=cr.xor(Y,W))?V.instances.push(r):K&&V.else_instances.push(r)}S.finish&&
S.finish(!0);V.select_all=!1;S.applySolToContainer();return V.hasObjects()}var E=0;ha=(D=K&&!this.block.isFirstConditionOfType(this))?V.else_instances:V.instances;var H=!1;k=0;for(l=ha.length;k<l;++k){r=ha[k];if(J)for(Y=0,t=N.length;Y<t;++Y)ea=N[Y],ea.variesPerInstance&&(U[Y]=ea.get(k));z?(Y=0,n&&(Y=r.type.family_beh_map[G]),Y=X.apply(r.behavior_insts[g+Y],U)):Y=X.apply(r,U);if(cr.xor(Y,W))if(H=!0,D){if(V.instances.push(r),f)for(Y=0,t=r.siblings.length;Y<t;Y++)ea=r.siblings[Y],ea.type.getCurrentSol().instances.push(ea)}else{ha[E]=
r;if(f)for(Y=0,t=r.siblings.length;Y<t;Y++)ea=r.siblings[Y],ea.type.getCurrentSol().instances[E]=ea;E++}else if(D){ha[E]=r;if(f)for(Y=0,t=r.siblings.length;Y<t;Y++)ea=r.siblings[Y],ea.type.getCurrentSol().else_instances[E]=ea;E++}else if(K&&(V.else_instances.push(r),f))for(Y=0,t=r.siblings.length;Y<t;Y++)ea=r.siblings[Y],ea.type.getCurrentSol().else_instances.push(ea)}cr.truncateArray(ha,E);if(f)for(n=S.container,k=0,l=n.length;k<l;k++)r=n[k].getCurrentSol(),D?cr.truncateArray(r.else_instances,E):
cr.truncateArray(r.instances,E);E=H;if(D&&!H)for(k=0,l=V.instances.length;k<l;k++){r=V.instances[k];if(J)for(Y=0,t=N.length;Y<t;Y++)ea=N[Y],ea.variesPerInstance&&(U[Y]=ea.get(k));Y=z?X.apply(r.behavior_insts[g],U):X.apply(r,U);if(cr.xor(Y,W)){H=!0;break}}S.finish&&S.finish(E||K);return K?H:V.hasObjects()};cr.condition=a;c.prototype.postInit=function(){var l;var t=0;for(l=this.parameters.length;t<l;t++){var D=this.parameters[t];D.postInit();D.variesPerInstance&&(this.anyParamVariesPerInstance=!0)}};
c.prototype.run_system=function(){var l=this.runtime,t,D=this.parameters,S=this.results;var V=0;for(t=D.length;V<t;++V)S[V]=D[V].get();return this.func.apply(l.system,S)};c.prototype.run_object=function(){var l=this.type,t=this.beh_index,D=l.family_index,S=this.anyParamVariesPerInstance,V=this.parameters,K=this.results,f=this.func,n=l.getCurrentSol().getObjects();l=l.is_family;var G=-1<t,g,z;if(S){var J=0;for(z=V.length;J<z;++J){var N=V[J];N.variesPerInstance||(K[J]=N.get(0))}}else for(J=0,z=V.length;J<
z;++J)K[J]=V[J].get(0);var U=0;for(g=n.length;U<g;++U){var W=n[U];if(S)for(J=0,z=V.length;J<z;++J)N=V[J],N.variesPerInstance&&(K[J]=N.get(U));G?(J=0,l&&(J=W.type.family_beh_map[D]),f.apply(W.behavior_insts[t+J],K)):f.apply(W,K)}return!1};cr.action=c;var F=[],C=-1;u.prototype.postInit=function(){var l;if(11===this.type)this.eventvar=this.runtime.getEventVariableByName(this.varname,this.block.parent);else if(13===this.type){var t=0;for(l=this.subparams.length;t<l;t++)this.subparams[t].postInit()}this.expression&&
this.expression.postInit()};u.prototype.maybeVaryForType=function(l){this.variesPerInstance||!l||l.plugin.singleglobal||(this.variesPerInstance=!0)};u.prototype.setVaries=function(){this.variesPerInstance=!0};u.prototype.get_exp=function(l){this.solindex=l||0;l=m();this.expression.get(l);C--;return l.data};u.prototype.get_exp_str=function(l){this.solindex=l||0;l=m();this.expression.get(l);C--;return cr.is_string(l.data)?l.data:""};u.prototype.get_object=function(){return this.object};u.prototype.get_combosel=
function(){return this.combosel};u.prototype.get_boolean=function(){return!!this.combosel};u.prototype.get_layer=function(l){this.solindex=l||0;l=m();this.expression.get(l);C--;return l.is_number()?this.runtime.getLayerByNumber(l.data):this.runtime.getLayerByName(l.data)};u.prototype.get_layout=function(){return this.layout};u.prototype.get_key=function(){return this.key};u.prototype.get_instvar=function(){return this.index};u.prototype.get_familyvar=function(l){var t=l||0;l=this.owner.type;var D=
l.getCurrentSol(),S=D.getObjects();if(S.length)t=S[t%S.length].type;else if(D.else_instances.length)t=D.else_instances[t%D.else_instances.length].type;else if(l.instances.length)t=l.instances[t%l.instances.length].type;else return 0;return this.index+t.family_var_map[l.family_index]};u.prototype.get_eventvar=function(){return this.eventvar};u.prototype.get_audiofile=function(){return this.fileinfo};u.prototype.get_variadic=function(){var l;var t=0;for(l=this.subparams.length;t<l;t++)this.variadicret[t]=
this.subparams[t].get();return this.variadicret};cr.parameter=u;p.prototype.postInit=function(){this.solModifiers=h(this.solModifiers)};p.prototype.setValue=function(l){var t=this.runtime.getCurrentLocalVarStack();this.parent&&!this.is_static&&t?(this.localIndex>=t.length&&(t.length=this.localIndex+1),t[this.localIndex]=l):this.data=l};p.prototype.getValue=function(){var l=this.runtime.getCurrentLocalVarStack();return!this.parent||this.is_static||!l||this.is_constant?this.data:this.localIndex>=l.length||
"undefined"===typeof l[this.localIndex]?this.initial:l[this.localIndex]};p.prototype.run=function(){!this.parent||this.is_static||this.is_constant||this.setValue(this.initial)};cr.eventvariable=p;x.prototype.toString=function(){return"include:"+this.include_sheet.toString()};x.prototype.postInit=function(){this.include_sheet=this.runtime.eventsheets[this.include_sheet_name];this.sheet.includes.add(this);this.solModifiers=h(this.solModifiers);for(var l=this.parent;l;)l.group&&l.contained_includes.push(this),
l=l.parent;this.updateActive()};x.prototype.run=function(){this.parent&&this.runtime.pushCleanSol(this.runtime.types_by_index);this.include_sheet.hasRun||this.include_sheet.run(!0);this.parent&&this.runtime.popSol(this.runtime.types_by_index)};x.prototype.updateActive=function(){for(var l=this.parent;l;){if(l.group&&!l.group_active){this.active=!1;return}l=l.parent}this.active=!0};x.prototype.isActive=function(){return this.active};cr.eventinclude=x;M.prototype.reset=function(l){this.current_event=
l;this.actindex=this.cndindex=0;cr.clearArray(this.temp_parents_arr);this.any_true_state=this.else_branch_ran=this.last_event_true=!1};M.prototype.isModifierAfterCnds=function(){return this.current_event.solWriterAfterCnds?!0:this.cndindex<this.current_event.conditions.length-1?!!this.current_event.solModifiers.length:!1};cr.eventStackFrame=M})();
(function(){function b(e,a){this.owner=e;this.runtime=e.runtime;this.type=a[0];this.get=[this.eval_int,this.eval_float,this.eval_string,this.eval_unaryminus,this.eval_add,this.eval_subtract,this.eval_multiply,this.eval_divide,this.eval_mod,this.eval_power,this.eval_and,this.eval_or,this.eval_equal,this.eval_notequal,this.eval_less,this.eval_lessequal,this.eval_greater,this.eval_greaterequal,this.eval_conditional,this.eval_system_exp,this.eval_object_exp,this.eval_instvar_exp,this.eval_behavior_exp,
this.eval_eventvar_exp][this.type];var c=null;this.object_type=this.parameters=this.results=this.func=this.third=this.second=this.first=this.value=null;this.beh_index=-1;this.instance_expr=null;this.varindex=-1;this.eventvar=this.varname=this.behavior_type=null;this.return_string=!1;switch(this.type){case 0:case 1:case 2:this.value=a[1];break;case 3:this.first=new cr.expNode(e,a[1]);break;case 18:this.first=new cr.expNode(e,a[1]);this.second=new cr.expNode(e,a[2]);this.third=new cr.expNode(e,a[3]);
break;case 19:this.func=this.runtime.GetObjectReference(a[1]);this.func!==cr.system_object.prototype.exps.random&&this.func!==cr.system_object.prototype.exps.choose||this.owner.setVaries();this.results=[];this.parameters=[];3===a.length?(c=a[2],this.results.length=c.length+1):this.results.length=1;break;case 20:this.object_type=this.runtime.types_by_index[a[1]];this.beh_index=-1;this.func=this.runtime.GetObjectReference(a[2]);this.return_string=a[3];cr.plugins_.Function&&this.func===cr.plugins_.Function.prototype.exps.Call&&
this.owner.setVaries();this.instance_expr=a[4]?new cr.expNode(e,a[4]):null;this.results=[];this.parameters=[];6===a.length?(c=a[5],this.results.length=c.length+1):this.results.length=1;break;case 21:this.object_type=this.runtime.types_by_index[a[1]];this.return_string=a[2];this.instance_expr=a[3]?new cr.expNode(e,a[3]):null;this.varindex=a[4];break;case 22:this.object_type=this.runtime.types_by_index[a[1]];this.behavior_type=this.object_type.getBehaviorByName(a[2]);this.beh_index=this.object_type.getBehaviorIndexByName(a[2]);
this.func=this.runtime.GetObjectReference(a[3]);this.return_string=a[4];this.instance_expr=a[5]?new cr.expNode(e,a[5]):null;this.results=[];this.parameters=[];7===a.length?(c=a[6],this.results.length=c.length+1):this.results.length=1;break;case 23:this.varname=a[1],this.eventvar=null}this.owner.maybeVaryForType(this.object_type);4<=this.type&&17>=this.type&&(this.first=new cr.expNode(e,a[1]),this.second=new cr.expNode(e,a[2]));if(c){var m;a=0;for(m=c.length;a<m;a++)this.parameters.push(new cr.expNode(e,
c[a]))}cr.seal(this)}function d(){++A;y.length===A&&y.push(new cr.expvalue);return y[A]}function h(e,a,c){var m;var u=0;for(m=e.length;u<m;++u)e[u].get(c),a[u+1]=c.data}function q(e,a){this.type=e||cr.exptype.Integer;this.data=a||0;this.object_class=null;this.type==cr.exptype.Integer&&(this.data=Math.floor(this.data));cr.seal(this)}b.prototype.postInit=function(){23===this.type&&(this.eventvar=this.owner.runtime.getEventVariableByName(this.varname,this.owner.block.parent));this.first&&this.first.postInit();
this.second&&this.second.postInit();this.third&&this.third.postInit();this.instance_expr&&this.instance_expr.postInit();if(this.parameters){var e;var a=0;for(e=this.parameters.length;a<e;a++)this.parameters[a].postInit()}};var y=[],A=-1;b.prototype.eval_system_exp=function(e){var a=this.parameters,c=this.results;c[0]=e;e=d();h(a,c,e);--A;this.func.apply(this.runtime.system,c)};b.prototype.eval_object_exp=function(e){var a=this.object_type,c=this.results,m=this.parameters,u=this.instance_expr,p=this.func,
x=this.owner.solindex,M=a.getCurrentSol(),v=M.getObjects();if(!v.length)if(M.else_instances.length)v=M.else_instances;else{this.return_string?e.set_string(""):e.set_int(0);return}c[0]=e;e.object_class=a;e=d();h(m,c,e);u&&(u.get(e),e.is_number()&&(x=e.data,v=a.instances));--A;a=v.length;if(x>=a||x<=-a)x%=a;0>x&&(x+=a);p.apply(v[x],c)};b.prototype.eval_behavior_exp=function(e){var a=this.object_type,c=this.results,m=this.parameters,u=this.instance_expr,p=this.beh_index,x=this.func,M=this.owner.solindex,
v=a.getCurrentSol(),F=v.getObjects();if(!F.length)if(v.else_instances.length)F=v.else_instances;else{this.return_string?e.set_string(""):e.set_int(0);return}c[0]=e;e.object_class=a;e=d();h(m,c,e);u&&(u.get(e),e.is_number()&&(M=e.data,F=a.instances));--A;m=F.length;if(M>=m||M<=-m)M%=m;0>M&&(M+=m);M=F[M];F=0;a.is_family&&(F=M.type.family_beh_map[a.family_index]);x.apply(M.behavior_insts[p+F],c)};b.prototype.eval_instvar_exp=function(e){var a=this.instance_expr,c=this.object_type,m=this.varindex,u=this.owner.solindex,
p=c.getCurrentSol(),x=p.getObjects();if(!x.length)if(p.else_instances.length)x=p.else_instances;else{this.return_string?e.set_string(""):e.set_int(0);return}if(a){p=d();a.get(p);if(p.is_number()){u=p.data;x=c.instances;0!==x.length&&(u%=x.length,0>u&&(u+=x.length));u=c.getInstanceByIID(u);c=u.instance_vars[m];cr.is_string(c)?e.set_string(c):e.set_float(c);--A;return}--A}a=x.length;if(u>=a||u<=-a)u%=a;0>u&&(u+=a);u=x[u];x=0;c.is_family&&(x=u.type.family_var_map[c.family_index]);c=u.instance_vars[m+
x];cr.is_string(c)?e.set_string(c):e.set_float(c)};b.prototype.eval_int=function(e){e.type=cr.exptype.Integer;e.data=this.value};b.prototype.eval_float=function(e){e.type=cr.exptype.Float;e.data=this.value};b.prototype.eval_string=function(e){e.type=cr.exptype.String;e.data=this.value};b.prototype.eval_unaryminus=function(e){this.first.get(e);e.is_number()&&(e.data=-e.data)};b.prototype.eval_add=function(e){this.first.get(e);var a=d();this.second.get(a);e.is_number()&&a.is_number()&&(e.data+=a.data,
a.is_float()&&e.make_float());--A};b.prototype.eval_subtract=function(e){this.first.get(e);var a=d();this.second.get(a);e.is_number()&&a.is_number()&&(e.data-=a.data,a.is_float()&&e.make_float());--A};b.prototype.eval_multiply=function(e){this.first.get(e);var a=d();this.second.get(a);e.is_number()&&a.is_number()&&(e.data*=a.data,a.is_float()&&e.make_float());--A};b.prototype.eval_divide=function(e){this.first.get(e);var a=d();this.second.get(a);e.is_number()&&a.is_number()&&(e.data/=a.data,e.make_float());
--A};b.prototype.eval_mod=function(e){this.first.get(e);var a=d();this.second.get(a);e.is_number()&&a.is_number()&&(e.data%=a.data,a.is_float()&&e.make_float());--A};b.prototype.eval_power=function(e){this.first.get(e);var a=d();this.second.get(a);e.is_number()&&a.is_number()&&(e.data=Math.pow(e.data,a.data),a.is_float()&&e.make_float());--A};b.prototype.eval_and=function(e){this.first.get(e);var a=d();this.second.get(a);a.is_string()||e.is_string()?this.eval_and_stringconcat(e,a):this.eval_and_logical(e,
a);--A};b.prototype.eval_and_stringconcat=function(e,a){e.is_string()&&a.is_string()?this.eval_and_stringconcat_str_str(e,a):this.eval_and_stringconcat_num(e,a)};b.prototype.eval_and_stringconcat_str_str=function(e,a){e.data+=a.data};b.prototype.eval_and_stringconcat_num=function(e,a){e.is_string()?e.data+=(Math.round(1E10*a.data)/1E10).toString():e.set_string(e.data.toString()+a.data)};b.prototype.eval_and_logical=function(e,a){e.set_int(e.data&&a.data?1:0)};b.prototype.eval_or=function(e){this.first.get(e);
var a=d();this.second.get(a);e.is_number()&&a.is_number()&&(e.data||a.data?e.set_int(1):e.set_int(0));--A};b.prototype.eval_conditional=function(e){this.first.get(e);e.data?this.second.get(e):this.third.get(e)};b.prototype.eval_equal=function(e){this.first.get(e);var a=d();this.second.get(a);e.set_int(e.data===a.data?1:0);--A};b.prototype.eval_notequal=function(e){this.first.get(e);var a=d();this.second.get(a);e.set_int(e.data!==a.data?1:0);--A};b.prototype.eval_less=function(e){this.first.get(e);
var a=d();this.second.get(a);e.set_int(e.data<a.data?1:0);--A};b.prototype.eval_lessequal=function(e){this.first.get(e);var a=d();this.second.get(a);e.set_int(e.data<=a.data?1:0);--A};b.prototype.eval_greater=function(e){this.first.get(e);var a=d();this.second.get(a);e.set_int(e.data>a.data?1:0);--A};b.prototype.eval_greaterequal=function(e){this.first.get(e);var a=d();this.second.get(a);e.set_int(e.data>=a.data?1:0);--A};b.prototype.eval_eventvar_exp=function(e){var a=this.eventvar.getValue();"number"===
typeof a?e.set_float(a):"boolean"===typeof a?e.set_int(a?1:0):e.set_string(a)};cr.expNode=b;q.prototype.is_int=function(){return this.type===cr.exptype.Integer};q.prototype.is_float=function(){return this.type===cr.exptype.Float};q.prototype.is_number=function(){return this.type===cr.exptype.Integer||this.type===cr.exptype.Float};q.prototype.is_string=function(){return this.type===cr.exptype.String};q.prototype.make_int=function(){this.is_int()||(this.is_float()?this.data=Math.floor(this.data):this.is_string()&&
(this.data=parseInt(this.data,10)),this.type=cr.exptype.Integer)};q.prototype.make_float=function(){this.is_float()||(this.is_string()&&(this.data=parseFloat(this.data)),this.type=cr.exptype.Float)};q.prototype.make_string=function(){this.is_string()||(this.data=this.data.toString(),this.type=cr.exptype.String)};q.prototype.set_int=function(e){this.type=cr.exptype.Integer;this.data=Math.floor(e)};q.prototype.set_float=function(e){this.type=cr.exptype.Float;this.data=e};q.prototype.set_string=function(e){this.type=
cr.exptype.String;this.data=e};q.prototype.set_any=function(e){cr.is_number(e)?(this.type=cr.exptype.Float,this.data=e):cr.is_string(e)?(this.type=cr.exptype.String,this.data=e.toString()):(this.type=cr.exptype.Integer,this.data=0)};cr.expvalue=q;cr.exptype={Integer:0,Float:1,String:2}})();cr.system_object=function(b){this.runtime=b;this.waits=[]};
cr.system_object.prototype.saveToJSON=function(){var b={},d,h,q;b.waits=[];var y=b.waits;var A=0;for(d=this.waits.length;A<d;A++){var e=this.waits[A];var a={t:e.time,st:e.signaltag,s:e.signalled,ev:e.ev.sid,sm:[],sols:{}};e.ev.actions[e.actindex]&&(a.act=e.ev.actions[e.actindex].sid);var c=0;for(h=e.solModifiers.length;c<h;c++)a.sm.push(e.solModifiers[c].sid);for(q in e.sols)if(e.sols.hasOwnProperty(q)){var m=this.runtime.types_by_index[parseInt(q,10)];var u={sa:e.sols[q].sa,insts:[]};c=0;for(h=e.sols[q].insts.length;c<
h;c++)u.insts.push(e.sols[q].insts[c].uid);a.sols[m.sid.toString()]=u}y.push(a)}return b};
cr.system_object.prototype.loadFromJSON=function(b){b=b.waits;var d,h,q,y,A;cr.clearArray(this.waits);var e=0;for(d=b.length;e<d;e++){var a=b[e];if(y=this.runtime.blocksBySid[a.ev.toString()]){var c=-1;var m=0;for(h=y.actions.length;m<h;m++)if(y.actions[m].sid===a.act){c=m;break}if(-1!==c){var u={sols:{},solModifiers:[],deleteme:!1};u.time=a.t;u.signaltag=a.st||"";u.signalled=!!a.s;u.ev=y;u.actindex=c;m=0;for(h=a.sm.length;m<h;m++)(y=this.runtime.getObjectTypeBySid(a.sm[m]))&&u.solModifiers.push(y);
for(q in a.sols)if(a.sols.hasOwnProperty(q)&&(y=this.runtime.getObjectTypeBySid(parseInt(q,10)))){c=a.sols[q];var p={sa:c.sa,insts:[]};m=0;for(h=c.insts.length;m<h;m++)(A=this.runtime.getObjectByUID(c.insts[m]))&&p.insts.push(A);u.sols[y.index.toString()]=p}this.waits.push(u)}}}};
(function(){function b(){}function d(f,n){f=f.extra.c2_feo_val;n=n.extra.c2_feo_val;if(cr.is_number(f)&&cr.is_number(n))return f-n;f=""+f;n=""+n;return f<n?-1:f>n?1:0}function h(f,n){M&&f===v&&n===F||(M=new RegExp(f,n),v=f,F=n);M.lastIndex=0;return M}function q(){}function y(){var f=l.length?l.pop():{sols:{},solModifiers:[]};f.deleteme=!1;return f}function A(){var f=t.length?t.pop():{insts:[]};f.sa=!1;return f}function e(f,n){var G=f[0]-n[0];return 0!==G?G:f[1]-n[1]}function a(f,n){return f[1]-n[1]}
function c(){}function m(f,n,G){if(f!==S||n!==V||G!==K){var g=h(n,G);D=f.match(g);S=f;V=n;K=G}}var u=cr.system_object.prototype;b.prototype.EveryTick=function(){return!0};b.prototype.OnLayoutStart=function(){return!0};b.prototype.OnLayoutEnd=function(){return!0};b.prototype.Compare=function(f,n,G){return cr.do_cmp(f,n,G)};b.prototype.CompareTime=function(f,n){var G=this.runtime.kahanTime.sum;return 0===f?(f=this.runtime.getCurrentCondition(),!f.extra.CompareTime_executed&&G>=n?f.extra.CompareTime_executed=
!0:!1):cr.do_cmp(G,f,n)};b.prototype.LayerVisible=function(f){return f?f.visible:!1};b.prototype.LayerEmpty=function(f){return f?!f.instances.length:!1};b.prototype.LayerCmpOpacity=function(f,n,G){return f?cr.do_cmp(100*f.opacity,n,G):!1};b.prototype.Repeat=function(f){var n=this.runtime.getCurrentEventStack(),G=n.current_event,g=n.isModifierAfterCnds();n=this.runtime.pushLoopStack();if(g)for(g=0;g<f&&!n.stopped;g++)this.runtime.pushCopySol(G.solModifiers),n.index=g,G.retrigger(),this.runtime.popSol(G.solModifiers);
else for(g=0;g<f&&!n.stopped;g++)n.index=g,G.retrigger();this.runtime.popLoopStack();return!1};b.prototype.While=function(f){var n=this.runtime.getCurrentEventStack();f=n.current_event;var G=n.isModifierAfterCnds();n=this.runtime.pushLoopStack();if(G)for(G=0;!n.stopped;G++)this.runtime.pushCopySol(f.solModifiers),n.index=G,f.retrigger()||(n.stopped=!0),this.runtime.popSol(f.solModifiers);else for(G=0;!n.stopped;G++)n.index=G,f.retrigger()||(n.stopped=!0);this.runtime.popLoopStack();return!1};b.prototype.For=
function(f,n,G){var g=this.runtime.getCurrentEventStack(),z=g.current_event;g=g.isModifierAfterCnds();f=this.runtime.pushLoopStack(f);if(G<n)if(g)for(;n>=G&&!f.stopped;--n)this.runtime.pushCopySol(z.solModifiers),f.index=n,z.retrigger(),this.runtime.popSol(z.solModifiers);else for(;n>=G&&!f.stopped;--n)f.index=n,z.retrigger();else if(g)for(;n<=G&&!f.stopped;++n)this.runtime.pushCopySol(z.solModifiers),f.index=n,z.retrigger(),this.runtime.popSol(z.solModifiers);else for(;n<=G&&!f.stopped;++n)f.index=
n,z.retrigger();this.runtime.popLoopStack();return!1};var p=[],x=-1;b.prototype.ForEach=function(f){var n=f.getCurrentSol();x++;p.length===x&&p.push([]);var G=p[x];cr.shallowAssignArray(G,n.getObjects());var g=this.runtime.getCurrentEventStack(),z=g.current_event,J=g.isModifierAfterCnds();g=this.runtime.pushLoopStack();var N,U,W=f.is_contained;if(J)for(J=0,N=G.length;J<N&&!g.stopped;J++){this.runtime.pushCopySol(z.solModifiers);var X=G[J];n=f.getCurrentSol();n.select_all=!1;cr.clearArray(n.instances);
n.instances[0]=X;if(W){var Y=0;for(U=X.siblings.length;Y<U;Y++){var ea=X.siblings[Y];var ha=ea.type.getCurrentSol();ha.select_all=!1;cr.clearArray(ha.instances);ha.instances[0]=ea}}g.index=J;z.retrigger();this.runtime.popSol(z.solModifiers)}else for(n.select_all=!1,cr.clearArray(n.instances),J=0,N=G.length;J<N&&!g.stopped;J++){X=G[J];n.instances[0]=X;if(W)for(Y=0,U=X.siblings.length;Y<U;Y++)ea=X.siblings[Y],ha=ea.type.getCurrentSol(),ha.select_all=!1,cr.clearArray(ha.instances),ha.instances[0]=ea;
g.index=J;z.retrigger()}cr.clearArray(G);this.runtime.popLoopStack();x--;return!1};b.prototype.ForEachOrdered=function(f,n,G){n=f.getCurrentSol();x++;p.length===x&&p.push([]);var g=p[x];cr.shallowAssignArray(g,n.getObjects());var z=this.runtime.getCurrentEventStack(),J=z.current_event,N=this.runtime.getCurrentCondition(),U=z.isModifierAfterCnds();z=this.runtime.pushLoopStack();var W;var X=0;for(W=g.length;X<W;X++)g[X].extra.c2_feo_val=N.parameters[1].get(X);g.sort(d);1===G&&g.reverse();G=f.is_contained;
if(U)for(X=0,W=g.length;X<W&&!z.stopped;X++){this.runtime.pushCopySol(J.solModifiers);var Y=g[X];n=f.getCurrentSol();n.select_all=!1;cr.clearArray(n.instances);n.instances[0]=Y;if(G)for(N=0,U=Y.siblings.length;N<U;N++){var ea=Y.siblings[N];var ha=ea.type.getCurrentSol();ha.select_all=!1;cr.clearArray(ha.instances);ha.instances[0]=ea}z.index=X;J.retrigger();this.runtime.popSol(J.solModifiers)}else for(n.select_all=!1,cr.clearArray(n.instances),X=0,W=g.length;X<W&&!z.stopped;X++){Y=g[X];n.instances[0]=
Y;if(G)for(N=0,U=Y.siblings.length;N<U;N++)ea=Y.siblings[N],ha=ea.type.getCurrentSol(),ha.select_all=!1,cr.clearArray(ha.instances),ha.instances[0]=ea;z.index=X;J.retrigger()}cr.clearArray(g);this.runtime.popLoopStack();x--;return!1};b.prototype.PickByComparison=function(f,n,G,g){var z,J;if(f){x++;p.length===x&&p.push([]);var N=p[x],U=f.getCurrentSol();cr.shallowAssignArray(N,U.getObjects());U.select_all&&cr.clearArray(U.else_instances);var W=this.runtime.getCurrentCondition();var X=z=0;for(J=N.length;z<
J;z++){var Y=N[z];N[X]=Y;n=W.parameters[1].get(z);g=W.parameters[3].get(z);cr.do_cmp(n,G,g)?X++:U.else_instances.push(Y)}cr.truncateArray(N,X);U.select_all=!1;cr.shallowAssignArray(U.instances,N);cr.clearArray(N);x--;f.applySolToContainer();return!!U.instances.length}};b.prototype.PickByEvaluate=function(f,n){var G,g;if(f){x++;p.length===x&&p.push([]);var z=p[x],J=f.getCurrentSol();cr.shallowAssignArray(z,J.getObjects());J.select_all&&cr.clearArray(J.else_instances);var N=this.runtime.getCurrentCondition();
var U=G=0;for(g=z.length;G<g;G++){var W=z[G];z[U]=W;(n=N.parameters[1].get(G))?U++:J.else_instances.push(W)}cr.truncateArray(z,U);J.select_all=!1;cr.shallowAssignArray(J.instances,z);cr.clearArray(z);x--;f.applySolToContainer();return!!J.instances.length}};b.prototype.TriggerOnce=function(){var f=this.runtime.getCurrentCondition().extra;"undefined"===typeof f.TriggerOnce_lastTick&&(f.TriggerOnce_lastTick=-1);var n=f.TriggerOnce_lastTick,G=this.runtime.tickcount;f.TriggerOnce_lastTick=G;return this.runtime.layout_first_tick||
n!==G-1};b.prototype.Every=function(f){var n=this.runtime.getCurrentCondition(),G=n.extra.Every_lastTime||0,g=this.runtime.kahanTime.sum;"undefined"===typeof n.extra.Every_seconds&&(n.extra.Every_seconds=f);var z=n.extra.Every_seconds;if(g>=G+z)return n.extra.Every_lastTime=G+z,g>=n.extra.Every_lastTime+.04&&(n.extra.Every_lastTime=g),n.extra.Every_seconds=f,!0;g<G-.1&&(n.extra.Every_lastTime=g);return!1};b.prototype.PickNth=function(f,n){if(!f)return!1;var G=f.getCurrentSol(),g=G.getObjects();n=
cr.floor(n);if(0>n||n>=g.length)return!1;G.pick_one(g[n]);f.applySolToContainer();return!0};b.prototype.PickRandom=function(f){if(!f)return!1;var n=f.getCurrentSol(),G=n.getObjects(),g=cr.floor(Math.random()*G.length);if(g>=G.length)return!1;n.pick_one(G[g]);f.applySolToContainer();return!0};b.prototype.CompareVar=function(f,n,G){return cr.do_cmp(f.getValue(),n,G)};b.prototype.CompareBoolVar=function(f){return f.getValue()};b.prototype.IsGroupActive=function(f){return(f=this.runtime.groups_by_name[f.toLowerCase()])&&
f.group_active};b.prototype.IsPreview=function(){return this.runtime.isPreview};b.prototype.PickAll=function(f){if(!f||!f.instances.length)return!1;f.getCurrentSol().select_all=!0;f.applySolToContainer();return!0};b.prototype.IsMobile=function(){return this.runtime.isMobile};b.prototype.CompareBetween=function(f,n,G){return f>=n&&f<=G};b.prototype.Else=function(){var f=this.runtime.getCurrentEventStack();return f.else_branch_ran?!1:!f.last_event_true};b.prototype.OnLoadFinished=function(){return!0};
b.prototype.OnCanvasSnapshot=function(){return!0};b.prototype.EffectsSupported=function(){return!!this.runtime.glwrap};b.prototype.OnSaveComplete=function(){return!0};b.prototype.OnSaveFailed=function(){return!0};b.prototype.OnLoadComplete=function(){return!0};b.prototype.OnLoadFailed=function(){return!0};b.prototype.ObjectUIDExists=function(f){return!!this.runtime.getObjectByUID(f)};b.prototype.IsOnPlatform=function(f){var n=this.runtime;switch(f){case 0:return!n.isNodeWebkit&&!n.isCordova&&!n.isWinJS&&
!n.isWindowsPhone8&&!n.isBlackberry10&&!n.isAmazonWebApp;case 1:return n.isiOS;case 2:return n.isAndroid;case 3:return n.isWindows8App;case 4:return n.isWindowsPhone8;case 5:return n.isBlackberry10;case 6:return n.isTizen;case 7:return!1;case 8:return n.isCordova;case 9:return n.isArcade;case 10:return n.isNodeWebkit;case 11:return n.isCrosswalk;case 12:return n.isAmazonWebApp;case 13:return n.isWindows10;default:return!1}};var M=null,v="",F="";b.prototype.RegexTest=function(f,n,G){return h(n,G).test(f)};
var C=[];b.prototype.PickOverlappingPoint=function(f,n,G){if(!f)return!1;var g=f.getCurrentSol(),z=g.getObjects(),J=this.runtime.getCurrentEventStack().current_event.orblock,N=this.runtime.getCurrentCondition(),U;g.select_all?(cr.shallowAssignArray(C,z),cr.clearArray(g.else_instances),g.select_all=!1,cr.clearArray(g.instances)):J?(cr.shallowAssignArray(C,g.else_instances),cr.clearArray(g.else_instances)):(cr.shallowAssignArray(C,z),cr.clearArray(g.instances));z=0;for(J=C.length;z<J;++z){var W=C[z];
W.update_bbox();(U=cr.xor(W.contains_pt(n,G),N.inverted))?g.instances.push(W):g.else_instances.push(W)}f.applySolToContainer();return cr.xor(!!g.instances.length,N.inverted)};b.prototype.PickLastCreated=function(f){if(!f)return!1;var n=this.runtime.createRow,G,g=null,z=f.is_family;for(G=n.length-1;0<=G;--G){var J=n[G];if(z){if(0<=J.type.families.indexOf(f)){g=J;break}}else if(J.type===f){g=J;break}}!g&&f.instances.length&&(g=f.instances[f.instances.length-1]);if(!g)return!1;f.getCurrentSol().pick_one(g);
f.applySolToContainer();return!0};b.prototype.IsNaN=function(f){return!!isNaN(f)};b.prototype.AngleWithin=function(f,n,G){return cr.angleDiff(cr.to_radians(f),cr.to_radians(G))<=cr.to_radians(n)};b.prototype.IsClockwiseFrom=function(f,n){return cr.angleClockwise(cr.to_radians(f),cr.to_radians(n))};b.prototype.IsBetweenAngles=function(f,n,G){f=cr.to_clamped_radians(f);n=cr.to_clamped_radians(n);G=cr.to_clamped_radians(G);return cr.angleClockwise(G,n)?cr.angleClockwise(f,n)&&!cr.angleClockwise(f,G):
!(!cr.angleClockwise(f,n)&&cr.angleClockwise(f,G))};b.prototype.IsValueType=function(f,n){return"number"===typeof f?0===n:1===n};u.cnds=new b;q.prototype.GoToLayout=function(f){this.runtime.isloading||this.runtime.changelayout||(this.runtime.changelayout=f)};q.prototype.NextPrevLayout=function(f){if(!this.runtime.isloading&&!this.runtime.changelayout){var n=this.runtime.layouts_by_index.indexOf(this.runtime.running_layout);if(!f||0!==n)if(f||n!==this.runtime.layouts_by_index.length-1)this.runtime.changelayout=
this.runtime.layouts_by_index[n+(f?-1:1)]}};q.prototype.CreateObject=function(f,n,G,g){if(n&&f&&(n=this.runtime.createInstance(f,n,G,g))){this.runtime.isInOnDestroy++;this.runtime.trigger(Object.getPrototypeOf(f.plugin).cnds.OnCreated,n);if(n.is_contained)for(G=0,g=n.siblings.length;G<g;G++){var z=n.siblings[G];this.runtime.trigger(Object.getPrototypeOf(z.type.plugin).cnds.OnCreated,z)}this.runtime.isInOnDestroy--;f=f.getCurrentSol();f.select_all=!1;cr.clearArray(f.instances);f.instances[0]=n;if(n.is_contained)for(G=
0,g=n.siblings.length;G<g;G++)z=n.siblings[G],f=z.type.getCurrentSol(),f.select_all=!1,cr.clearArray(f.instances),f.instances[0]=z}};q.prototype.CreateObjectByName=function(f,n,G,g){n&&f&&(f=this.runtime.types_lowercase[f.toLowerCase()])&&q.prototype.CreateObject.call(this,f,n,G,g)};q.prototype.SetLayerVisible=function(f,n){f&&f.visible!==n&&(f.visible=n,this.runtime.redraw=!0)};q.prototype.SetLayerOpacity=function(f,n){f&&(n=cr.clamp(n/100,0,1),f.opacity!==n&&(f.opacity=n,this.runtime.redraw=!0))};
q.prototype.SetLayerScaleRate=function(f,n){f&&f.zoomRate!==n&&(f.zoomRate=n,this.runtime.redraw=!0)};q.prototype.SetLayerForceOwnTexture=function(f,n){f&&(n=!!n,f.forceOwnTexture!==n&&(f.forceOwnTexture=n,this.runtime.redraw=!0))};q.prototype.SetLayoutScale=function(f){this.runtime.running_layout&&this.runtime.running_layout.scale!==f&&(this.runtime.running_layout.scale=f,this.runtime.running_layout.boundScrolling(),this.runtime.redraw=!0)};q.prototype.ScrollX=function(f){this.runtime.running_layout.scrollToX(f)};
q.prototype.ScrollY=function(f){this.runtime.running_layout.scrollToY(f)};q.prototype.Scroll=function(f,n){this.runtime.running_layout.scrollToX(f);this.runtime.running_layout.scrollToY(n)};q.prototype.ScrollToObject=function(f){if(f=f.getFirstPicked())this.runtime.running_layout.scrollToX(f.x),this.runtime.running_layout.scrollToY(f.y)};q.prototype.SetVar=function(f,n){0===f.vartype?cr.is_number(n)?f.setValue(n):f.setValue(parseFloat(n)):1===f.vartype&&f.setValue(n.toString())};q.prototype.AddVar=
function(f,n){0===f.vartype?cr.is_number(n)?f.setValue(f.getValue()+n):f.setValue(f.getValue()+parseFloat(n)):1===f.vartype&&f.setValue(f.getValue()+n.toString())};q.prototype.SubVar=function(f,n){0===f.vartype&&(cr.is_number(n)?f.setValue(f.getValue()-n):f.setValue(f.getValue()-parseFloat(n)))};q.prototype.SetBoolVar=function(f,n){f.setValue(0!==n)};q.prototype.ToggleBoolVar=function(f){f.setValue(!f.getValue())};q.prototype.SetGroupActive=function(f,n){if(f=this.runtime.groups_by_name[f.toLowerCase()])switch(n){case 0:f.setGroupActive(!1);
break;case 1:f.setGroupActive(!0);break;case 2:f.setGroupActive(!f.group_active)}};q.prototype.SetTimescale=function(f){0>f&&(f=0);this.runtime.timescale=f};q.prototype.SetObjectTimescale=function(f,n){0>n&&(n=0);if(f){f=f.getCurrentSol().getObjects();var G;var g=0;for(G=f.length;g<G;g++)f[g].my_timescale=n}};q.prototype.RestoreObjectTimescale=function(f){if(!f)return!1;f=f.getCurrentSol().getObjects();var n;var G=0;for(n=f.length;G<n;G++)f[G].my_timescale=-1};var l=[],t=[];q.prototype.Wait=function(f){if(!(0>
f)){var n,G=this.runtime.getCurrentEventStack(),g=y();g.time=this.runtime.kahanTime.sum+f;g.signaltag="";g.signalled=!1;g.ev=G.current_event;g.actindex=G.actindex+1;f=0;for(n=this.runtime.types_by_index.length;f<n;f++){var z=this.runtime.types_by_index[f];var J=z.getCurrentSol();J.select_all&&-1===G.current_event.solModifiers.indexOf(z)||(g.solModifiers.push(z),z=A(),z.sa=J.select_all,cr.shallowAssignArray(z.insts,J.instances),g.sols[f.toString()]=z)}this.waits.push(g);return!0}};q.prototype.WaitForSignal=
function(f){var n,G=this.runtime.getCurrentEventStack(),g=y();g.time=-1;g.signaltag=f.toLowerCase();g.signalled=!1;g.ev=G.current_event;g.actindex=G.actindex+1;f=0;for(n=this.runtime.types_by_index.length;f<n;f++){var z=this.runtime.types_by_index[f];var J=z.getCurrentSol();J.select_all&&-1===G.current_event.solModifiers.indexOf(z)||(g.solModifiers.push(z),z=A(),z.sa=J.select_all,cr.shallowAssignArray(z.insts,J.instances),g.sols[f.toString()]=z)}this.waits.push(g);return!0};q.prototype.Signal=function(f){f=
f.toLowerCase();var n;var G=0;for(n=this.waits.length;G<n;++G){var g=this.waits[G];-1===g.time&&g.signaltag===f&&(g.signalled=!0)}};q.prototype.SetLayerScale=function(f,n){f&&f.scale!==n&&(f.scale=n,this.runtime.redraw=!0)};q.prototype.ResetGlobals=function(){var f;var n=0;for(f=this.runtime.all_global_vars.length;n<f;n++){var G=this.runtime.all_global_vars[n];G.data=G.initial}};q.prototype.SetLayoutAngle=function(f){f=cr.to_radians(f);f=cr.clamp_angle(f);this.runtime.running_layout&&this.runtime.running_layout.angle!==
f&&(this.runtime.running_layout.angle=f,this.runtime.redraw=!0)};q.prototype.SetLayerAngle=function(f,n){f&&(n=cr.to_radians(n),n=cr.clamp_angle(n),f.angle!==n&&(f.angle=n,this.runtime.redraw=!0))};q.prototype.SetLayerParallax=function(f,n,G){if(f&&(f.parallaxX!==n/100||f.parallaxY!==G/100)){f.parallaxX=n/100;f.parallaxY=G/100;if(1!==f.parallaxX||1!==f.parallaxY)for(G=f.instances,f=0,n=G.length;f<n;++f)G[f].type.any_instance_parallaxed=!0;this.runtime.redraw=!0}};q.prototype.SetLayerBackground=function(f,
n){if(f){var G=cr.clamp(Math.floor(255*cr.GetRValue(n)),0,255),g=cr.clamp(Math.floor(255*cr.GetGValue(n)),0,255);n=cr.clamp(Math.floor(255*cr.GetBValue(n)),0,255);if(f.background_color[0]!==G||f.background_color[1]!==g||f.background_color[2]!==n)f.background_color[0]=G,f.background_color[1]=g,f.background_color[2]=n,this.runtime.redraw=!0}};q.prototype.SetLayerTransparent=function(f,n){f&&!!n!==!!f.transparent&&(f.transparent=!!n,this.runtime.redraw=!0)};q.prototype.SetLayerBlendMode=function(f,n){f&&
f.blend_mode!==n&&(f.blend_mode=n,f.compositeOp=cr.effectToCompositeOp(f.blend_mode),this.runtime.gl&&cr.setGLBlend(f,f.blend_mode,this.runtime.gl),this.runtime.redraw=!0)};q.prototype.StopLoop=function(){0>this.runtime.loop_stack_index||(this.runtime.getCurrentLoop().stopped=!0)};q.prototype.GoToLayoutByName=function(f){if(!this.runtime.isloading&&!this.runtime.changelayout)for(var n in this.runtime.layouts)if(this.runtime.layouts.hasOwnProperty(n)&&cr.equals_nocase(n,f)){this.runtime.changelayout=
this.runtime.layouts[n];break}};q.prototype.RestartLayout=function(f){if(!this.runtime.isloading&&!this.runtime.changelayout&&this.runtime.running_layout){this.runtime.changelayout=this.runtime.running_layout;var n;f=0;for(n=this.runtime.allGroups.length;f<n;f++){var G=this.runtime.allGroups[f];G.setGroupActive(G.initially_activated)}}};q.prototype.SnapshotCanvas=function(f,n){this.runtime.doCanvasSnapshot(0===f?"image/png":"image/jpeg",n/100)};q.prototype.SetCanvasSize=function(f,n){if(!(0>=f||0>=
n)){var G=this.runtime.fullscreen_mode;(document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement||document.fullScreen)&&0<this.runtime.fullscreen_scaling&&(G=this.runtime.fullscreen_scaling);0===G?this.runtime.setSize(f,n,!0):(this.runtime.original_width=f,this.runtime.original_height=n,this.runtime.setSize(this.runtime.lastWindowWidth,this.runtime.lastWindowHeight,!0))}};q.prototype.SetLayoutEffectEnabled=function(f,n){this.runtime.running_layout&&this.runtime.glwrap&&(n=
this.runtime.running_layout.getEffectByName(n))&&(f=1===f,n.active!=f&&(n.active=f,this.runtime.running_layout.updateActiveEffects(),this.runtime.redraw=!0))};q.prototype.SetLayerEffectEnabled=function(f,n,G){f&&this.runtime.glwrap&&(G=f.getEffectByName(G))&&(n=1===n,G.active!=n&&(G.active=n,f.updateActiveEffects(),this.runtime.redraw=!0))};q.prototype.SetLayoutEffectParam=function(f,n,G){if(this.runtime.running_layout&&this.runtime.glwrap&&(f=this.runtime.running_layout.getEffectByName(f))){var g=
this.runtime.running_layout.effect_params[f.index];n=Math.floor(n);if(!(0>n||n>=g.length)){var z=this.runtime.glwrap.getProgramParameterType(f.shaderindex,n);1===z?G/=100:2===z&&(G=[cr.GetRValue(G),cr.GetGValue(G),cr.GetBValue(G)]);g[n]!==G&&(g[n]=G,f.active&&(this.runtime.redraw=!0))}}};q.prototype.SetLayerEffectParam=function(f,n,G,g){if(f&&this.runtime.glwrap&&(n=f.getEffectByName(n))&&(f=f.effect_params[n.index],G=Math.floor(G),!(0>G||G>=f.length))){var z=this.runtime.glwrap.getProgramParameterType(n.shaderindex,
G);1===z?g/=100:2===z&&(g=[cr.GetRValue(g),cr.GetGValue(g),cr.GetBValue(g)]);f[G]!==g&&(f[G]=g,n.active&&(this.runtime.redraw=!0))}};q.prototype.SaveState=function(f){this.runtime.saveToSlot=f};q.prototype.LoadState=function(f){this.runtime.loadFromSlot=f};q.prototype.LoadStateJSON=function(f){this.runtime.loadFromJson=f};q.prototype.SetHalfFramerateMode=function(f){this.runtime.halfFramerateMode=0!==f};q.prototype.SetFullscreenQuality=function(f){if(document.mozFullScreen||document.webkitIsFullScreen||
document.msFullscreenElement||document.fullScreen||0!==this.runtime.fullscreen_mode)this.runtime.wantFullscreenScalingQuality=0!==f,this.runtime.setSize(this.runtime.lastWindowWidth,this.runtime.lastWindowHeight,!0)};q.prototype.ResetPersisted=function(){var f;var n=0;for(f=this.runtime.layouts_by_index.length;n<f;++n)this.runtime.layouts_by_index[n].persist_data={},this.runtime.layouts_by_index[n].first_visit=!0};q.prototype.RecreateInitialObjects=function(f,n,G,g,z){f&&this.runtime.running_layout.recreateInitialObjects(f,
n,G,g,z)};q.prototype.SetPixelRounding=function(f){this.runtime.pixel_rounding=0!==f;this.runtime.redraw=!0};q.prototype.SetMinimumFramerate=function(f){1>f&&(f=1);120<f&&(f=120);this.runtime.minimumFramerate=f};q.prototype.SortZOrderByInstVar=function(f,n){if(f){var G;var g=f.getCurrentSol().getObjects();var z=[],J=[],N=this.runtime.running_layout,U=f.is_family,W=f.family_index,X=!1;f=0;for(G=g.length;f<G;++f){var Y=g[f];if(Y.layer){var ea=U?Y.instance_vars[n+Y.type.family_var_map[W]]:Y.instance_vars[n];
z.push([Y.layer.index,Y.get_zindex()]);J.push([Y,ea])}}if(z.length){z.sort(e);J.sort(a);f=0;for(G=z.length;f<G;++f)Y=J[f][0],n=N.layers[z[f][0]],g=z[f][1],n.instances[g]!==Y&&(n.instances[g]=Y,Y.layer=n,n.setZIndicesStaleFrom(g),X=!0);X&&(this.runtime.redraw=!0)}}};u.acts=new q;c.prototype.int=function(f,n){cr.is_string(n)?(f.set_int(parseInt(n,10)),isNaN(f.data)&&(f.data=0)):f.set_int(n)};c.prototype.float=function(f,n){cr.is_string(n)?(f.set_float(parseFloat(n)),isNaN(f.data)&&(f.data=0)):f.set_float(n)};
c.prototype.str=function(f,n){cr.is_string(n)?f.set_string(n):f.set_string(n.toString())};c.prototype.len=function(f,n){f.set_int(n.length||0)};c.prototype.random=function(f,n,G){void 0===G?f.set_float(Math.random()*n):f.set_float(Math.random()*(G-n)+n)};c.prototype.sqrt=function(f,n){f.set_float(Math.sqrt(n))};c.prototype.abs=function(f,n){f.set_float(Math.abs(n))};c.prototype.round=function(f,n){f.set_int(Math.round(n))};c.prototype.floor=function(f,n){f.set_int(Math.floor(n))};c.prototype.ceil=
function(f,n){f.set_int(Math.ceil(n))};c.prototype.sign=function(f,n){f.set_float(Math.sign(n))};c.prototype.sin=function(f,n){f.set_float(Math.sin(cr.to_radians(n)))};c.prototype.cos=function(f,n){f.set_float(Math.cos(cr.to_radians(n)))};c.prototype.tan=function(f,n){f.set_float(Math.tan(cr.to_radians(n)))};c.prototype.asin=function(f,n){f.set_float(cr.to_degrees(Math.asin(n)))};c.prototype.acos=function(f,n){f.set_float(cr.to_degrees(Math.acos(n)))};c.prototype.atan=function(f,n){f.set_float(cr.to_degrees(Math.atan(n)))};
c.prototype.exp=function(f,n){f.set_float(Math.exp(n))};c.prototype.ln=function(f,n){f.set_float(Math.log(n))};c.prototype.log10=function(f,n){f.set_float(Math.log(n)/Math.LN10)};c.prototype.max=function(f){var n=arguments[1];"number"!==typeof n&&(n=0);var G;var g=2;for(G=arguments.length;g<G;g++){var z=arguments[g];"number"===typeof z&&n<z&&(n=z)}f.set_float(n)};c.prototype.min=function(f){var n=arguments[1];"number"!==typeof n&&(n=0);var G;var g=2;for(G=arguments.length;g<G;g++){var z=arguments[g];
"number"===typeof z&&n>z&&(n=z)}f.set_float(n)};c.prototype.dt=function(f){f.set_float(this.runtime.dt)};c.prototype.timescale=function(f){f.set_float(this.runtime.timescale)};c.prototype.wallclocktime=function(f){f.set_float((Date.now()-this.runtime.start_time)/1E3)};c.prototype.unixtime=function(f){f.set_float(Date.now())};c.prototype.time=function(f){f.set_float(this.runtime.kahanTime.sum)};c.prototype.tickcount=function(f){f.set_int(this.runtime.tickcount)};c.prototype.objectcount=function(f){f.set_int(this.runtime.objectcount)};
c.prototype.fps=function(f){f.set_int(this.runtime.fps)};c.prototype.loopindex=function(f,n){var G;if(this.runtime.loop_stack.length)if(n){for(G=this.runtime.loop_stack_index;0<=G;--G){var g=this.runtime.loop_stack[G];if(g.name===n){f.set_int(g.index);return}}f.set_int(0)}else g=this.runtime.getCurrentLoop(),f.set_int(g?g.index:-1);else f.set_int(0)};c.prototype.distance=function(f,n,G,g,z){f.set_float(cr.distanceTo(n,G,g,z))};c.prototype.angle=function(f,n,G,g,z){f.set_float(cr.to_degrees(cr.angleTo(n,
G,g,z)))};c.prototype.scrollx=function(f){f.set_float(this.runtime.running_layout.scrollX)};c.prototype.scrolly=function(f){f.set_float(this.runtime.running_layout.scrollY)};c.prototype.newline=function(f){f.set_string("\n")};c.prototype.lerp=function(f,n,G,g){f.set_float(cr.lerp(n,G,g))};c.prototype.qarp=function(f,n,G,g,z){f.set_float(cr.qarp(n,G,g,z))};c.prototype.cubic=function(f,n,G,g,z,J){f.set_float(cr.cubic(n,G,g,z,J))};c.prototype.cosp=function(f,n,G,g){f.set_float(cr.cosp(n,G,g))};c.prototype.windowwidth=
function(f){f.set_int(this.runtime.width)};c.prototype.windowheight=function(f){f.set_int(this.runtime.height)};c.prototype.uppercase=function(f,n){f.set_string(cr.is_string(n)?n.toUpperCase():"")};c.prototype.lowercase=function(f,n){f.set_string(cr.is_string(n)?n.toLowerCase():"")};c.prototype.clamp=function(f,n,G,g){n<G?f.set_float(G):n>g?f.set_float(g):f.set_float(n)};c.prototype.layerscale=function(f,n){(n=this.runtime.getLayer(n))?f.set_float(n.scale):f.set_float(0)};c.prototype.layeropacity=
function(f,n){(n=this.runtime.getLayer(n))?f.set_float(100*n.opacity):f.set_float(0)};c.prototype.layerscalerate=function(f,n){(n=this.runtime.getLayer(n))?f.set_float(n.zoomRate):f.set_float(0)};c.prototype.layerparallaxx=function(f,n){(n=this.runtime.getLayer(n))?f.set_float(100*n.parallaxX):f.set_float(0)};c.prototype.layerparallaxy=function(f,n){(n=this.runtime.getLayer(n))?f.set_float(100*n.parallaxY):f.set_float(0)};c.prototype.layerindex=function(f,n){(n=this.runtime.getLayer(n))?f.set_int(n.index):
f.set_int(-1)};c.prototype.layoutscale=function(f){this.runtime.running_layout?f.set_float(this.runtime.running_layout.scale):f.set_float(0)};c.prototype.layoutangle=function(f){f.set_float(cr.to_degrees(this.runtime.running_layout.angle))};c.prototype.layerangle=function(f,n){(n=this.runtime.getLayer(n))?f.set_float(cr.to_degrees(n.angle)):f.set_float(0)};c.prototype.layoutwidth=function(f){f.set_int(this.runtime.running_layout.width)};c.prototype.layoutheight=function(f){f.set_int(this.runtime.running_layout.height)};
c.prototype.find=function(f,n,G){cr.is_string(n)&&cr.is_string(G)?f.set_int(n.search(new RegExp(cr.regexp_escape(G),"i"))):f.set_int(-1)};c.prototype.findcase=function(f,n,G){cr.is_string(n)&&cr.is_string(G)?f.set_int(n.search(new RegExp(cr.regexp_escape(G),""))):f.set_int(-1)};c.prototype.left=function(f,n,G){f.set_string(cr.is_string(n)?n.substr(0,G):"")};c.prototype.right=function(f,n,G){f.set_string(cr.is_string(n)?n.substr(n.length-G):"")};c.prototype.mid=function(f,n,G,g){f.set_string(cr.is_string(n)?
n.substr(G,g):"")};c.prototype.tokenat=function(f,n,G,g){cr.is_string(n)&&cr.is_string(g)?(n=n.split(g),G=cr.floor(G),0>G||G>=n.length?f.set_string(""):f.set_string(n[G])):f.set_string("")};c.prototype.tokencount=function(f,n,G){cr.is_string(n)&&n.length?f.set_int(n.split(G).length):f.set_int(0)};c.prototype.replace=function(f,n,G,g){cr.is_string(n)&&cr.is_string(G)&&cr.is_string(g)?f.set_string(n.replace(new RegExp(cr.regexp_escape(G),"gi"),g)):f.set_string(cr.is_string(n)?n:"")};c.prototype.trim=
function(f,n){f.set_string(cr.is_string(n)?n.trim():"")};c.prototype.pi=function(f){f.set_float(cr.PI)};c.prototype.layoutname=function(f){this.runtime.running_layout?f.set_string(this.runtime.running_layout.name):f.set_string("")};c.prototype.renderer=function(f){f.set_string(this.runtime.gl?"webgl":"canvas2d")};c.prototype.rendererdetail=function(f){f.set_string(this.runtime.glUnmaskedRenderer)};c.prototype.anglediff=function(f,n,G){f.set_float(cr.to_degrees(cr.angleDiff(cr.to_radians(n),cr.to_radians(G))))};
c.prototype.choose=function(f){var n=cr.floor(Math.random()*(arguments.length-1));f.set_any(arguments[n+1])};c.prototype.rgb=function(f,n,G,g){f.set_int(cr.RGB(n,G,g))};c.prototype.rgbex=function(f,n,G,g){f.set_float(cr.RGBEx(n/100,G/100,g/100))};c.prototype.projectversion=function(f){f.set_string(this.runtime.versionstr)};c.prototype.projectname=function(f){f.set_string(this.runtime.name)};c.prototype.anglelerp=function(f,n,G,g){n=cr.to_radians(n);G=cr.to_radians(G);var z=cr.angleDiff(n,G);cr.angleClockwise(G,
n)?f.set_float(cr.to_clamped_degrees(n+z*g)):f.set_float(cr.to_clamped_degrees(n-z*g))};c.prototype.anglerotate=function(f,n,G,g){n=cr.to_radians(n);G=cr.to_radians(G);g=cr.to_radians(g);f.set_float(cr.to_clamped_degrees(cr.angleRotate(n,G,g)))};c.prototype.zeropad=function(f,n,G){var g=0>n?"-":"";0>n&&(n=-n);G-=n.toString().length;for(var z=0;z<G;z++)g+="0";f.set_string(g+n.toString())};c.prototype.cpuutilisation=function(f){f.set_float(this.runtime.cpuutilisation/1E3)};c.prototype.gpuutilisation=
function(f){f.set_float(this.runtime.gpuLastUtilisation)};c.prototype.viewportleft=function(f,n){n=this.runtime.getLayer(n);f.set_float(n?n.viewLeft:0)};c.prototype.viewporttop=function(f,n){n=this.runtime.getLayer(n);f.set_float(n?n.viewTop:0)};c.prototype.viewportright=function(f,n){n=this.runtime.getLayer(n);f.set_float(n?n.viewRight:0)};c.prototype.viewportbottom=function(f,n){n=this.runtime.getLayer(n);f.set_float(n?n.viewBottom:0)};c.prototype.loadingprogress=function(f){f.set_float(this.runtime.loadingprogress)};
c.prototype.unlerp=function(f,n,G,g){f.set_float(cr.unlerp(n,G,g))};c.prototype.canvassnapshot=function(f){f.set_string(this.runtime.snapshotData)};c.prototype.urlencode=function(f,n){f.set_string(encodeURIComponent(n))};c.prototype.urldecode=function(f,n){f.set_string(decodeURIComponent(n))};c.prototype.canvastolayerx=function(f,n,G,g){n=this.runtime.getLayer(n);f.set_float(n?n.canvasToLayer(G,g,!0):0)};c.prototype.canvastolayery=function(f,n,G,g){n=this.runtime.getLayer(n);f.set_float(n?n.canvasToLayer(G,
g,!1):0)};c.prototype.layertocanvasx=function(f,n,G,g){n=this.runtime.getLayer(n);f.set_float(n?n.layerToCanvas(G,g,!0):0)};c.prototype.layertocanvasy=function(f,n,G,g){n=this.runtime.getLayer(n);f.set_float(n?n.layerToCanvas(G,g,!1):0)};c.prototype.savestatejson=function(f){f.set_string(this.runtime.lastSaveJson)};c.prototype.imagememoryusage=function(f){this.runtime.glwrap?f.set_float(Math.round(100*this.runtime.glwrap.estimateVRAM()/1048576)/100):f.set_float(0)};c.prototype.regexsearch=function(f,
n,G,g){G=h(G,g);f.set_int(n?n.search(G):-1)};c.prototype.regexreplace=function(f,n,G,g,z){G=h(G,g);f.set_string(n?n.replace(G,z):"")};var D=[],S="",V="",K="";c.prototype.regexmatchcount=function(f,n,G,g){h(G,g);m(n.toString(),G,g);f.set_int(D?D.length:0)};c.prototype.regexmatchat=function(f,n,G,g,z){z=Math.floor(z);h(G,g);m(n.toString(),G,g);!D||0>z||z>=D.length?f.set_string(""):f.set_string(D[z])};c.prototype.infinity=function(f){f.set_float(Infinity)};c.prototype.setbit=function(f,n,G,g){G|=0;f.set_int((n|
0)&~(1<<G)|(0!==g?1:0)<<G)};c.prototype.togglebit=function(f,n,G){f.set_int((n|0)^1<<(G|0))};c.prototype.getbit=function(f,n,G){f.set_int((n|0)&1<<(G|0)?1:0)};c.prototype.originalwindowwidth=function(f){f.set_int(this.runtime.original_width)};c.prototype.originalwindowheight=function(f){f.set_int(this.runtime.original_height)};c.prototype.originalviewportwidth=function(f){f.set_int(this.runtime.original_width)};c.prototype.originalviewportheight=function(f){f.set_int(this.runtime.original_height)};
u.exps=new c;u.runWaits=function(){var f,n=this.runtime.getCurrentEventStack();var G=0;for(f=this.waits.length;G<f;G++){var g=this.waits[G];if(-1===g.time){if(!g.signalled)continue}else if(g.time>this.runtime.kahanTime.sum)continue;n.current_event=g.ev;n.actindex=g.actindex;n.cndindex=0;for(N in g.sols)if(g.sols.hasOwnProperty(N)){var z=this.runtime.types_by_index[parseInt(N,10)].getCurrentSol();var J=g.sols[N];z.select_all=J.sa;cr.shallowAssignArray(z.instances,J.insts);z=J;cr.clearArray(z.insts);
t.push(z)}g.ev.resume_actions_and_subevents();this.runtime.clearSol(g.solModifiers);g.deleteme=!0}var N=G=0;for(f=this.waits.length;G<f;G++)g=this.waits[G],this.waits[N]=g,g.deleteme?(cr.wipe(g.sols),cr.clearArray(g.solModifiers),l.push(g)):N++;cr.truncateArray(this.waits,N)}})();
(function(){cr.add_common_aces=function(d,h){var q=d[1],y=d[3],A=d[4],e=d[5],a=d[6],c=d[7],m=d[8],u=d[10],p=d[11];d=d[12];h.cnds||(h.cnds={});h.acts||(h.acts={});h.exps||(h.exps={});var x=h.cnds,M=h.acts;h=h.exps;y&&(x.CompareX=function(v,F){return cr.do_cmp(this.x,v,F)},x.CompareY=function(v,F){return cr.do_cmp(this.y,v,F)},x.IsOnScreen=function(){var v=this.layer;this.update_bbox();var F=this.bbox;return!(F.right<v.viewLeft||F.bottom<v.viewTop||F.left>v.viewRight||F.top>v.viewBottom)},x.IsOutsideLayout=
function(){this.update_bbox();var v=this.bbox,F=this.runtime.running_layout;return 0>v.right||0>v.bottom||v.left>F.width||v.top>F.height},x.PickDistance=function(v,F,C){var l=this.getCurrentSol(),t=l.getObjects();if(!t.length)return!1;var D=t[0],S=D,V=cr.distanceTo(D.x,D.y,F,C),K;var f=1;for(K=t.length;f<K;f++){D=t[f];var n=cr.distanceTo(D.x,D.y,F,C);if(0===v&&n<V||1===v&&n>V)V=n,S=D}l.pick_one(S);return!0},M.SetX=function(v){this.x!==v&&(this.x=v,this.set_bbox_changed())},M.SetY=function(v){this.y!==
v&&(this.y=v,this.set_bbox_changed())},M.SetPos=function(v,F){if(this.x!==v||this.y!==F)this.x=v,this.y=F,this.set_bbox_changed()},M.SetPosToObject=function(v,F){var C=v.getPairedInstance(this);C&&(C.getImagePoint?(v=C.getImagePoint(F,!0),F=C.getImagePoint(F,!1)):(v=C.x,F=C.y),this.x!==v||this.y!==F)&&(this.x=v,this.y=F,this.set_bbox_changed())},M.MoveForward=function(v){0!==v&&(this.x+=Math.cos(this.angle)*v,this.y+=Math.sin(this.angle)*v,this.set_bbox_changed())},M.MoveAtAngle=function(v,F){0!==
F&&(this.x+=Math.cos(cr.to_radians(v))*F,this.y+=Math.sin(cr.to_radians(v))*F,this.set_bbox_changed())},h.X=function(v){v.set_float(this.x)},h.Y=function(v){v.set_float(this.y)},h.dt=function(v){v.set_float(this.runtime.getDt(this))});A&&(x.CompareWidth=function(v,F){return cr.do_cmp(this.width,v,F)},x.CompareHeight=function(v,F){return cr.do_cmp(this.height,v,F)},M.SetWidth=function(v){this.width!==v&&(this.width=v,this.set_bbox_changed())},M.SetHeight=function(v){this.height!==v&&(this.height=v,
this.set_bbox_changed())},M.SetSize=function(v,F){if(this.width!==v||this.height!==F)this.width=v,this.height=F,this.set_bbox_changed()},h.Width=function(v){v.set_float(this.width)},h.Height=function(v){v.set_float(this.height)},h.BBoxLeft=function(v){this.update_bbox();v.set_float(this.bbox.left)},h.BBoxTop=function(v){this.update_bbox();v.set_float(this.bbox.top)},h.BBoxRight=function(v){this.update_bbox();v.set_float(this.bbox.right)},h.BBoxBottom=function(v){this.update_bbox();v.set_float(this.bbox.bottom)});
e&&(x.AngleWithin=function(v,F){return cr.angleDiff(this.angle,cr.to_radians(F))<=cr.to_radians(v)},x.IsClockwiseFrom=function(v){return cr.angleClockwise(this.angle,cr.to_radians(v))},x.IsBetweenAngles=function(v,F){v=cr.to_clamped_radians(v);F=cr.to_clamped_radians(F);var C=cr.clamp_angle(this.angle);return cr.angleClockwise(F,v)?cr.angleClockwise(C,v)&&!cr.angleClockwise(C,F):!(!cr.angleClockwise(C,v)&&cr.angleClockwise(C,F))},M.SetAngle=function(v){v=cr.to_radians(cr.clamp_angle_degrees(v));isNaN(v)||
this.angle===v||(this.angle=v,this.set_bbox_changed())},M.RotateClockwise=function(v){0===v||isNaN(v)||(this.angle+=cr.to_radians(v),this.angle=cr.clamp_angle(this.angle),this.set_bbox_changed())},M.RotateCounterclockwise=function(v){0===v||isNaN(v)||(this.angle-=cr.to_radians(v),this.angle=cr.clamp_angle(this.angle),this.set_bbox_changed())},M.RotateTowardAngle=function(v,F){v=cr.angleRotate(this.angle,cr.to_radians(F),cr.to_radians(v));isNaN(v)||this.angle===v||(this.angle=v,this.set_bbox_changed())},
M.RotateTowardPosition=function(v,F,C){v=cr.angleRotate(this.angle,Math.atan2(C-this.y,F-this.x),cr.to_radians(v));isNaN(v)||this.angle===v||(this.angle=v,this.set_bbox_changed())},M.SetTowardPosition=function(v,F){v=Math.atan2(F-this.y,v-this.x);isNaN(v)||this.angle===v||(this.angle=v,this.set_bbox_changed())},h.Angle=function(v){v.set_float(cr.to_clamped_degrees(this.angle))});q||(x.CompareInstanceVar=function(v,F,C){return cr.do_cmp(this.instance_vars[v],F,C)},x.IsBoolInstanceVarSet=function(v){return this.instance_vars[v]},
x.PickInstVarHiLow=function(v,F){var C=this.getCurrentSol(),l=C.getObjects();if(!l.length)return!1;var t=l[0],D=t,S=t.instance_vars[F],V;var K=1;for(V=l.length;K<V;K++){t=l[K];var f=t.instance_vars[F];if(0===v&&f<S||1===v&&f>S)S=f,D=t}C.pick_one(D);return!0},x.PickByUID=function(v){var F;if(this.runtime.getCurrentCondition().inverted){var C=this.getCurrentSol();if(C.select_all){C.select_all=!1;cr.clearArray(C.instances);cr.clearArray(C.else_instances);var l=this.instances;var t=0;for(F=l.length;t<
F;t++){var D=l[t];D.uid===v?C.else_instances.push(D):C.instances.push(D)}}else{l=t=0;for(F=C.instances.length;t<F;t++)D=C.instances[t],C.instances[l]=D,D.uid===v?C.else_instances.push(D):l++;cr.truncateArray(C.instances,l)}this.applySolToContainer();return!!C.instances.length}D=this.runtime.getObjectByUID(v);if(!D)return!1;C=this.getCurrentSol();if(!C.select_all&&-1===C.instances.indexOf(D))return!1;if(this.is_family)for(v=D.type.families,t=0,F=v.length;t<F;t++){if(v[t]===this)return C.pick_one(D),
this.applySolToContainer(),!0}else if(D.type===this)return C.pick_one(D),this.applySolToContainer(),!0;return!1},x.OnCreated=function(){return!0},x.OnDestroyed=function(){return!0},M.SetInstanceVar=function(v,F){var C=this.instance_vars;cr.is_number(C[v])?cr.is_number(F)?C[v]=F:C[v]=parseFloat(F):cr.is_string(C[v])&&(cr.is_string(F)?C[v]=F:C[v]=F.toString())},M.AddInstanceVar=function(v,F){var C=this.instance_vars;cr.is_number(C[v])?cr.is_number(F)?C[v]+=F:C[v]+=parseFloat(F):cr.is_string(C[v])&&
(cr.is_string(F)?C[v]+=F:C[v]+=F.toString())},M.SubInstanceVar=function(v,F){var C=this.instance_vars;cr.is_number(C[v])&&(cr.is_number(F)?C[v]-=F:C[v]-=parseFloat(F))},M.SetBoolInstanceVar=function(v,F){this.instance_vars[v]=F?1:0},M.ToggleBoolInstanceVar=function(v){this.instance_vars[v]=1-this.instance_vars[v]},M.Destroy=function(){this.runtime.DestroyInstance(this)},M.LoadFromJsonString||(M.LoadFromJsonString=function(v){try{var F=JSON.parse(v)}catch(l){return}this.runtime.loadInstanceFromJSON(this,
F,!0);this.afterLoad&&this.afterLoad();if(this.behavior_insts)for(v=0,F=this.behavior_insts.length;v<F;++v){var C=this.behavior_insts[v];C.afterLoad&&C.afterLoad()}}),h.Count=function(v){var F=v.object_class.instances.length,C;var l=0;for(C=this.runtime.createRow.length;l<C;l++){var t=this.runtime.createRow[l];v.object_class.is_family?0<=t.type.families.indexOf(v.object_class)&&F++:t.type===v.object_class&&F++}v.set_int(F)},h.PickedCount=function(v){v.set_int(v.object_class.getCurrentSol().getObjects().length)},
h.UID=function(v){v.set_int(this.uid)},h.IID=function(v){v.set_int(this.get_iid())},h.AsJSON||(h.AsJSON=function(v){v.set_string(JSON.stringify(this.runtime.saveInstanceToJSON(this,!0)))}));a&&(x.IsVisible=function(){return this.visible},M.SetVisible=function(v){v=2===v?!this.visible:0!==v;v!==this.visible&&(this.visible=v,this.runtime.redraw=!0)},x.CompareOpacity=function(v,F){return cr.do_cmp(cr.round6dp(100*this.opacity),v,F)},M.SetOpacity=function(v){v/=100;0>v?v=0:1<v&&(v=1);v!==this.opacity&&
(this.opacity=v,this.runtime.redraw=!0)},h.Opacity=function(v){v.set_float(cr.round6dp(100*this.opacity))});c&&(x.IsOnLayer=function(v){return v?this.layer===v:!1},x.PickTopBottom=function(v){var F=this.getCurrentSol(),C=F.getObjects();if(!C.length)return!1;var l=C[0],t=l,D;var S=1;for(D=C.length;S<D;S++)if(l=C[S],0===v){if(l.layer.index>t.layer.index||l.layer.index===t.layer.index&&l.get_zindex()>t.get_zindex())t=l}else if(l.layer.index<t.layer.index||l.layer.index===t.layer.index&&l.get_zindex()<
t.get_zindex())t=l;F.pick_one(t);return!0},M.MoveToTop=function(){var v=this.layer,F=v.instances;F.length&&F[F.length-1]===this||(v.removeFromInstanceList(this,!1),v.appendToInstanceList(this,!1),this.runtime.redraw=!0)},M.MoveToBottom=function(){var v=this.layer,F=v.instances;F.length&&F[0]===this||(v.removeFromInstanceList(this,!1),v.prependToInstanceList(this,!1),this.runtime.redraw=!0)},M.MoveToLayer=function(v){v&&v!=this.layer&&(this.layer.removeFromInstanceList(this,!0),this.layer=v,v.appendToInstanceList(this,
!0),this.runtime.redraw=!0)},M.ZMoveToObject=function(v,F){v=0===v;F&&(F=F.getFirstPicked(this))&&F.uid!==this.uid&&(this.layer.index!==F.layer.index&&(this.layer.removeFromInstanceList(this,!0),this.layer=F.layer,F.layer.appendToInstanceList(this,!0)),this.layer.moveInstanceAdjacent(this,F,v),this.runtime.redraw=!0)},h.LayerNumber=function(v){v.set_int(this.layer.number)},h.LayerName=function(v){v.set_string(this.layer.name)},h.ZIndex=function(v){v.set_int(this.get_zindex())});m&&(M.SetEffectEnabled=
function(v,F){this.runtime.glwrap&&(F=this.type.getEffectIndexByName(F),0>F||(v=1===v,this.active_effect_flags[F]!==v&&(this.active_effect_flags[F]=v,this.updateActiveEffects(),this.runtime.redraw=!0)))},M.SetEffectParam=function(v,F,C){if(this.runtime.glwrap){var l=this.type.getEffectIndexByName(v);if(!(0>l||(v=this.type.effect_types[l],l=this.effect_params[l],F=Math.floor(F),0>F||F>=l.length))){var t=this.runtime.glwrap.getProgramParameterType(v.shaderindex,F);1===t&&(C/=100);if(2===t){t=cr.GetRValue(C);
var D=cr.GetGValue(C);C=cr.GetBValue(C);F=l[F];if(F[0]===t&&F[1]===D&&F[2]===C)return;F[0]=t;F[1]=D;F[2]=C}else{if(l[F]===C)return;l[F]=C}v.active&&(this.runtime.redraw=!0)}}});u&&(M.SetVisible=function(v){this.visible=0!==v},M.SetCSSStyle=function(v,F){this.elem.style[cr.cssToCamelCase(v)]=F});p&&(M.SetFocus=function(){(this.inputElem||this.elem).focus()},M.SetBlur=function(){(this.inputElem||this.elem).blur()});d&&(M.SetEnabled=function(v){(this.inputElem||this.elem).disabled=0===v})};cr.set_bbox_changed=
function(){this.cell_changed=this.bbox_changed=!0;this.type.any_cell_changed=!0;this.runtime.redraw=!0;var d,h=this.bbox_changed_callbacks;var q=0;for(d=h.length;q<d;++q)h[q](this);this.layer.useRenderCells&&this.update_bbox()};cr.add_bbox_changed_callback=function(d){d&&this.bbox_changed_callbacks.push(d)};cr.update_bbox=function(){if(this.bbox_changed){var d=this.bbox,h=this.bquad;d.set(this.x,this.y,this.x+this.width,this.y+this.height);d.offset(-this.hotspotX*this.width,-this.hotspotY*this.height);
this.angle?(d.offset(-this.x,-this.y),h.set_from_rotated_rect(d,this.angle),h.offset(this.x,this.y),h.bounding_box(d)):h.set_from_rect(d);d.normalize();this.bbox_changed=!1;this.update_render_cell()}};var b=new cr.rect(0,0,0,0);cr.update_render_cell=function(){if(this.layer.useRenderCells){var d=this.layer.render_grid,h=this.bbox;b.set(d.XToCell(h.left),d.YToCell(h.top),d.XToCell(h.right),d.YToCell(h.bottom));this.rendercells.equals(b)||(this.rendercells.right<this.rendercells.left?d.update(this,
null,b):d.update(this,this.rendercells,b),this.rendercells.copy(b),this.layer.render_list_stale=!0)}};cr.update_collision_cell=function(){if(this.cell_changed&&this.collisionsEnabled){this.update_bbox();var d=this.type.collision_grid,h=this.bbox;b.set(d.XToCell(h.left),d.YToCell(h.top),d.XToCell(h.right),d.YToCell(h.bottom));this.collcells.equals(b)||(this.collcells.right<this.collcells.left?d.update(this,null,b):d.update(this,this.collcells,b),this.collcells.copy(b),this.cell_changed=!1)}};cr.inst_contains_pt=
function(d,h){return this.bbox.contains_pt(d,h)&&this.bquad.contains_pt(d,h)?this.tilemap_exists?this.testPointOverlapTile(d,h):this.collision_poly&&!this.collision_poly.is_empty()?(this.collision_poly.cache_poly(this.width,this.height,this.angle),this.collision_poly.contains_pt(d-this.x,h-this.y)):!0:!1};cr.inst_get_iid=function(){this.type.updateIIDs();return this.iid};cr.inst_get_zindex=function(){this.layer.updateZIndices();return this.zindex};cr.inst_updateActiveEffects=function(){cr.clearArray(this.active_effect_types);
var d,h=!0;var q=0;for(d=this.active_effect_flags.length;q<d;q++)if(this.active_effect_flags[q]){var y=this.type.effect_types[q];this.active_effect_types.push(y);y.preservesOpaqueness||(h=!1)}this.uses_shaders=!!this.active_effect_types.length;this.shaders_preserve_opaqueness=h};cr.inst_toString=function(){return"Inst"+this.puid};cr.type_getFirstPicked=function(d){if(d&&d.is_contained&&d.type!=this){var h;var q=0;for(h=d.siblings.length;q<h;q++){var y=d.siblings[q];if(y.type==this)return y}}d=this.getCurrentSol().getObjects();
return d.length?d[0]:null};cr.type_getPairedInstance=function(d){var h=this.getCurrentSol().getObjects();return h.length?h[d.get_iid()%h.length]:null};cr.type_updateIIDs=function(){if(this.stale_iids&&!this.is_family){var d;var h=0;for(d=this.instances.length;h<d;h++)this.instances[h].iid=h;var q=h,y=this.runtime.createRow;h=0;for(d=y.length;h<d;++h)y[h].type===this&&(y[h].iid=q++);this.stale_iids=!1}};cr.type_getInstanceByIID=function(d){if(d<this.instances.length)return this.instances[d];d-=this.instances.length;
var h=this.runtime.createRow,q;var y=0;for(q=h.length;y<q;++y)if(h[y].type===this){if(0===d)return h[y];--d}return null};cr.type_getCurrentSol=function(){return this.solstack[this.cur_sol]};cr.type_pushCleanSol=function(){this.cur_sol++;this.cur_sol===this.solstack.length?this.solstack.push(new cr.selection(this)):(this.solstack[this.cur_sol].select_all=!0,cr.clearArray(this.solstack[this.cur_sol].else_instances))};cr.type_pushCopySol=function(){this.cur_sol++;this.cur_sol===this.solstack.length&&
this.solstack.push(new cr.selection(this));var d=this.solstack[this.cur_sol],h=this.solstack[this.cur_sol-1];h.select_all?d.select_all=!0:(d.select_all=!1,cr.shallowAssignArray(d.instances,h.instances));cr.clearArray(d.else_instances)};cr.type_popSol=function(){this.cur_sol--};cr.type_getBehaviorByName=function(d){var h,q,y=0;if(!this.is_family){var A=0;for(h=this.families.length;A<h;A++){var e=this.families[A];var a=0;for(q=e.behaviors.length;a<q;a++){if(d===e.behaviors[a].name)return this.extra.lastBehIndex=
y,e.behaviors[a];y++}}}A=0;for(h=this.behaviors.length;A<h;A++){if(d===this.behaviors[A].name)return this.extra.lastBehIndex=y,this.behaviors[A];y++}return null};cr.type_getBehaviorIndexByName=function(d){return this.getBehaviorByName(d)?this.extra.lastBehIndex:-1};cr.type_getEffectIndexByName=function(d){var h;var q=0;for(h=this.effect_types.length;q<h;q++)if(this.effect_types[q].name===d)return q;return-1};cr.type_applySolToContainer=function(){if(this.is_contained&&!this.is_family){var d,h,q;this.updateIIDs();
var y=this.getCurrentSol();var A=y.select_all,e=(d=this.runtime.getCurrentEventStack())&&d.current_event&&d.current_event.orblock;d=0;for(h=this.container.length;d<h;d++){var a=this.container[d];if(a!==this){a.updateIIDs();var c=a.getCurrentSol();c.select_all=A;if(!A){cr.clearArray(c.instances);var m=0;for(q=y.instances.length;m<q;++m)c.instances[m]=a.getInstanceByIID(y.instances[m].iid);if(e)for(cr.clearArray(c.else_instances),m=0,q=y.else_instances.length;m<q;++m)c.else_instances[m]=a.getInstanceByIID(y.else_instances[m].iid)}}}}};
cr.type_toString=function(){return"Type"+this.sid};cr.do_cmp=function(d,h,q){if("undefined"===typeof d||"undefined"===typeof q)return!1;switch(h){case 0:return d===q;case 1:return d!==q;case 2:return d<q;case 3:return d<=q;case 4:return d>q;case 5:return d>=q;default:return!1}}})();cr.shaders={};cr.plugins_.Mouse=function(b){this.runtime=b};
(function(){function b(){}function d(){}function h(){}var q=cr.plugins_.Mouse.prototype;q.Type=function(e){this.plugin=e;this.runtime=e.runtime};q.Type.prototype.onCreate=function(){};q.Instance=function(e){this.type=e;this.runtime=e.runtime;this.buttonMap=Array(4);this.triggerDir=this.triggerType=this.triggerButton=this.mouseYcanvas=this.mouseXcanvas=0;this.handled=!1};var y=q.Instance.prototype;y.onCreate=function(){var e=this;document.addEventListener("mousemove",function(c){e.onMouseMove(c)});
document.addEventListener("mousedown",function(c){e.onMouseDown(c)});document.addEventListener("mouseup",function(c){e.onMouseUp(c)});document.addEventListener("dblclick",function(c){e.onDoubleClick(c)});var a=function(c){e.onWheel(c)};document.addEventListener("mousewheel",a,!1);document.addEventListener("DOMMouseScroll",a,!1)};y.onMouseMove=function(e){this.mouseXcanvas=e.pageX-this.runtime.canvas.offsetLeft;this.mouseYcanvas=e.pageY-this.runtime.canvas.offsetTop};y.mouseInGame=function(){return 0<
this.runtime.fullscreen_mode?!0:0<=this.mouseXcanvas&&0<=this.mouseYcanvas&&this.mouseXcanvas<this.runtime.width&&this.mouseYcanvas<this.runtime.height};y.onMouseDown=function(e){this.mouseInGame()&&(this.buttonMap[e.which]=!0,this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnAnyClick,this),this.triggerButton=e.which-1,this.triggerType=0,this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnClick,this),this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnObjectClicked,
this),this.runtime.isInUserInputEvent=!1)};y.onMouseUp=function(e){this.buttonMap[e.which]&&(this.runtime.had_a_click&&!this.runtime.isMobile&&e.preventDefault(),this.runtime.had_a_click=!0,this.buttonMap[e.which]=!1,this.runtime.isInUserInputEvent=!0,this.triggerButton=e.which-1,this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnRelease,this),this.runtime.isInUserInputEvent=!1)};y.onDoubleClick=function(e){this.mouseInGame()&&(e.preventDefault(),this.runtime.isInUserInputEvent=!0,this.triggerButton=
e.which-1,this.triggerType=1,this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnClick,this),this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnObjectClicked,this),this.runtime.isInUserInputEvent=!1)};y.onWheel=function(e){this.triggerDir=0>(e.wheelDelta?e.wheelDelta:e.detail?-e.detail:0)?0:1;this.handled=!1;this.runtime.isInUserInputEvent=!0;this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnWheel,this);this.runtime.isInUserInputEvent=!1;this.handled&&cr.isCanvasInputEvent(e)&&e.preventDefault()};
y.onWindowBlur=function(){var e;var a=0;for(e=this.buttonMap.length;a<e;++a)this.buttonMap[a]&&(this.buttonMap[a]=!1,this.triggerButton=a-1,this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnRelease,this))};y.isMouseOverCanvas=function(){return 0<=this.mouseXcanvas&&0<=this.mouseYcanvas&&this.mouseXcanvas<this.runtime.width&&this.mouseYcanvas<this.runtime.height};b.prototype.OnClick=function(e,a){return e===this.triggerButton&&a===this.triggerType};b.prototype.OnAnyClick=function(){return!0};
b.prototype.IsButtonDown=function(e){return this.buttonMap[e+1]};b.prototype.OnRelease=function(e){return e===this.triggerButton};b.prototype.IsOverObject=function(e){if(this.isMouseOverCanvas()){var a=this.runtime.getCurrentCondition();return cr.xor(this.runtime.testAndSelectCanvasPointOverlap(e,this.mouseXcanvas,this.mouseYcanvas,a.inverted),a.inverted)}};b.prototype.OnObjectClicked=function(e,a,c){if(e!==this.triggerButton||a!==this.triggerType)return!1;if(this.isMouseOverCanvas())return this.runtime.testAndSelectCanvasPointOverlap(c,
this.mouseXcanvas,this.mouseYcanvas,!1)};b.prototype.OnWheel=function(e){this.handled=!0;return e===this.triggerDir};q.cnds=new b;var A=null;d.prototype.SetCursor=function(e){e="auto pointer text crosshair move help wait none".split(" ")[e];A!==e&&(A=e,document.body.style.cursor=e)};d.prototype.SetCursorSprite=function(e){!this.runtime.isMobile&&e&&(e=e.getFirstPicked())&&e.curFrame&&(e=e.curFrame,A!==e&&(A=e,e="url("+e.getDataUri()+") "+Math.round(e.hotspotX*e.width)+" "+Math.round(e.hotspotY*e.height)+
", auto",document.body.style.cursor="",document.body.style.cursor=e))};q.acts=new d;h.prototype.X=function(e,a){if(cr.is_undefined(a)){a=this.runtime.getLayerByNumber(0);var c=a.scale;var m=a.zoomRate;var u=a.parallaxX;var p=a.angle;a.scale=1;a.zoomRate=1;a.parallaxX=1;a.angle=0;e.set_float(a.canvasToLayer(this.mouseXcanvas,this.mouseYcanvas,!0));a.scale=c;a.zoomRate=m;a.parallaxX=u;a.angle=p}else(a=cr.is_number(a)?this.runtime.getLayerByNumber(a):this.runtime.getLayerByName(a))?e.set_float(a.canvasToLayer(this.mouseXcanvas,
this.mouseYcanvas,!0)):e.set_float(0)};h.prototype.Y=function(e,a){if(cr.is_undefined(a)){a=this.runtime.getLayerByNumber(0);var c=a.scale;var m=a.zoomRate;var u=a.parallaxY;var p=a.angle;a.scale=1;a.zoomRate=1;a.parallaxY=1;a.angle=0;e.set_float(a.canvasToLayer(this.mouseXcanvas,this.mouseYcanvas,!1));a.scale=c;a.zoomRate=m;a.parallaxY=u;a.angle=p}else(a=cr.is_number(a)?this.runtime.getLayerByNumber(a):this.runtime.getLayerByName(a))?e.set_float(a.canvasToLayer(this.mouseXcanvas,this.mouseYcanvas,
!1)):e.set_float(0)};h.prototype.AbsoluteX=function(e){e.set_float(this.mouseXcanvas)};h.prototype.AbsoluteY=function(e){e.set_float(this.mouseYcanvas)};q.exps=new h})();cr.plugins_.TiledBg=function(b){this.runtime=b};
(function(){function b(){}function d(){}function h(){}var q=cr.plugins_.TiledBg.prototype;q.Type=function(A){this.plugin=A;this.runtime=A.runtime};var y=q.Type.prototype;y.onCreate=function(){this.is_family||(this.texture_img=this.runtime.findWaitingTexture(this.texture_file),this.texture_img||(this.texture_img=new Image,this.texture_img.cr_src=this.texture_file,this.texture_img.cr_filesize=this.texture_filesize,this.texture_img.c2webGL_texture=null,this.runtime.waitForImageLoad(this.texture_img,
this.texture_file)),this.webGL_texture=this.pattern=null)};y.onLostWebGLContext=function(){this.is_family||(this.webGL_texture=null)};y.onRestoreWebGLContext=function(){if(!this.is_family&&this.instances.length){this.webGL_texture||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!0,this.runtime.linearSampling,this.texture_pixelformat));var A;var e=0;for(A=this.instances.length;e<A;e++)this.instances[e].webGL_texture=this.webGL_texture}};y.loadTextures=function(){this.is_family||
this.webGL_texture||!this.runtime.glwrap||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!0,this.runtime.linearSampling,this.texture_pixelformat))};y.unloadTextures=function(){this.is_family||this.instances.length||!this.webGL_texture||(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null)};y.preloadCanvas2D=function(A){A.drawImage(this.texture_img,0,0)};q.Instance=function(A){this.type=A;this.runtime=A.runtime};y=q.Instance.prototype;y.onCreate=function(){this.visible=
this.properties[0];this.rcTex=new cr.rect(0,0,0,0);this.has_own_texture=!1;this.texture_img=this.type.texture_img;this.runtime.glwrap?(this.type.loadTextures(),this.webGL_texture=this.type.webGL_texture):(this.type.pattern||(this.type.pattern=this.runtime.ctx.createPattern(this.type.texture_img,"repeat")),this.pattern=this.type.pattern)};y.afterLoad=function(){this.has_own_texture=!1;this.texture_img=this.type.texture_img};y.onDestroy=function(){this.runtime.glwrap&&this.has_own_texture&&this.webGL_texture&&
(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null)};y.draw=function(A){A.globalAlpha=this.opacity;A.save();A.fillStyle=this.pattern;var e=this.x,a=this.y;this.runtime.pixel_rounding&&(e=Math.round(e),a=Math.round(a));var c=-(this.hotspotX*this.width),m=-(this.hotspotY*this.height),u=c%this.texture_img.width,p=m%this.texture_img.height;0>u&&(u+=this.texture_img.width);0>p&&(p+=this.texture_img.height);A.translate(e,a);A.rotate(this.angle);A.translate(u,p);A.fillRect(c-
u,m-p,this.width,this.height);A.restore()};y.drawGL_earlyZPass=function(A){this.drawGL(A)};y.drawGL=function(A){A.setTexture(this.webGL_texture);A.setOpacity(this.opacity);var e=this.rcTex;e.right=this.width/this.texture_img.width;e.bottom=this.height/this.texture_img.height;var a=this.bquad;if(this.runtime.pixel_rounding){var c=Math.round(this.x)-this.x,m=Math.round(this.y)-this.y;A.quadTex(a.tlx+c,a.tly+m,a.trx+c,a.try_+m,a.brx+c,a.bry+m,a.blx+c,a.bly+m,e)}else A.quadTex(a.tlx,a.tly,a.trx,a.try_,
a.brx,a.bry,a.blx,a.bly,e)};b.prototype.OnURLLoaded=function(){return!0};q.cnds=new b;d.prototype.SetEffect=function(A){this.blend_mode=A;this.compositeOp=cr.effectToCompositeOp(A);cr.setGLBlend(this,A,this.runtime.gl);this.runtime.redraw=!0};d.prototype.LoadURL=function(A,e){var a=new Image,c=this;a.onload=function(){c.texture_img=a;c.runtime.glwrap?(c.has_own_texture&&c.webGL_texture&&c.runtime.glwrap.deleteTexture(c.webGL_texture),c.webGL_texture=c.runtime.glwrap.loadTexture(a,!0,c.runtime.linearSampling)):
c.pattern=c.runtime.ctx.createPattern(a,"repeat");c.has_own_texture=!0;c.runtime.redraw=!0;c.runtime.trigger(cr.plugins_.TiledBg.prototype.cnds.OnURLLoaded,c)};"data:"!==A.substr(0,5)&&0===e&&(a.crossOrigin="anonymous");this.runtime.setImageSrc(a,A)};q.acts=new d;h.prototype.ImageWidth=function(A){A.set_float(this.texture_img.width)};h.prototype.ImageHeight=function(A){A.set_float(this.texture_img.height)};q.exps=new h})();cr.plugins_.Sprite=function(b){this.runtime=b};
(function(){function b(){if(0===this.datauri.length){var K=document.createElement("canvas");K.width=this.width;K.height=this.height;var f=K.getContext("2d");this.spritesheeted?f.drawImage(this.texture_img,this.offx,this.offy,this.width,this.height,0,0,this.width,this.height):f.drawImage(this.texture_img,0,0,this.width,this.height);this.datauri=K.toDataURL("image/png")}return this.datauri}function d(){}function h(K){K[0]=0;K[1]=0;K[2]=0;v.push(K)}function q(K,f){return K<f?""+K+","+f:""+f+","+K}function y(K,
f,n,G){f=f.uid;n=n.uid;var g=q(f,n);if(K.hasOwnProperty(g))K[g][2]=G;else{var z=v.length?v.pop():[0,0,0];z[0]=f;z[1]=n;z[2]=G;K[g]=z}}function A(K,f,n){f=q(f.uid,n.uid);K.hasOwnProperty(f)&&(h(K[f]),delete K[f])}function e(K,f,n){f=q(f.uid,n.uid);if(K.hasOwnProperty(f))return F=K[f][2],!0;F=-2;return!1}function a(K,f,n){if(!K)return!1;var G=0!==f||0!==n,g=!1,z=this.runtime.getCurrentCondition(),J=z.type;z=z.inverted;var N=K.getCurrentSol();var U=this.runtime.getCurrentEventStack().current_event.orblock;
N.select_all?(this.update_bbox(),V.copy(this.bbox),V.offset(f,n),this.runtime.getCollisionCandidates(this.layer,K,V,S),N=S):N=U?this.runtime.isCurrentConditionFirst()&&!N.else_instances.length&&N.instances.length?N.instances:N.else_instances:N.instances;l=K;D=J!==K&&!z;if(G){var W=this.x;var X=this.y;this.x+=f;this.y+=n;this.set_bbox_changed()}f=0;for(n=N.length;f<n;f++)if(U=N[f],this.runtime.testOverlap(this,U)){g=!0;if(z)break;J!==K&&t.add(U)}G&&(this.x=W,this.y=X,this.set_bbox_changed());cr.clearArray(S);
return g}function c(){}function m(){}var u=cr.plugins_.Sprite.prototype;u.Type=function(K){this.plugin=K;this.runtime=K.runtime};var p=u.Type.prototype;p.onCreate=function(){if(!this.is_family){var K,f;this.all_frames=[];this.has_loaded_textures=!1;var n=0;for(K=this.animations.length;n<K;n++){var G=this.animations[n];var g={};g.name=G[0];g.speed=G[1];g.loop=G[2];g.repeatcount=G[3];g.repeatto=G[4];g.pingpong=G[5];g.sid=G[6];g.frames=[];var z=0;for(f=G[7].length;z<f;z++){var J=G[7][z];var N={};N.texture_file=
J[0];N.texture_filesize=J[1];N.offx=J[2];N.offy=J[3];N.width=J[4];N.height=J[5];N.duration=J[6];N.hotspotX=J[7];N.hotspotY=J[8];N.image_points=J[9];N.poly_pts=J[10];N.pixelformat=J[11];N.spritesheeted=0!==N.width;N.datauri="";N.getDataUri=b;var U={left:0,top:0,right:1,bottom:1};N.sheetTex=U;N.webGL_texture=null;(U=this.runtime.findWaitingTexture(J[0]))?N.texture_img=U:(N.texture_img=new Image,N.texture_img.cr_src=J[0],N.texture_img.cr_filesize=J[1],N.texture_img.c2webGL_texture=null,this.runtime.waitForImageLoad(N.texture_img,
J[0]));cr.seal(N);g.frames.push(N);this.all_frames.push(N)}cr.seal(g);this.animations[n]=g}}};p.updateAllCurrentTexture=function(){var K;var f=0;for(K=this.instances.length;f<K;f++){var n=this.instances[f];n.curWebGLTexture=n.curFrame.webGL_texture}};p.onLostWebGLContext=function(){if(!this.is_family){var K;var f=0;for(K=this.all_frames.length;f<K;++f){var n=this.all_frames[f];n.texture_img.c2webGL_texture=null;n.webGL_texture=null}this.has_loaded_textures=!1;this.updateAllCurrentTexture()}};p.onRestoreWebGLContext=
function(){if(!this.is_family&&this.instances.length){var K;var f=0;for(K=this.all_frames.length;f<K;++f){var n=this.all_frames[f];n.webGL_texture=this.runtime.glwrap.loadTexture(n.texture_img,!1,this.runtime.linearSampling,n.pixelformat)}this.updateAllCurrentTexture()}};p.loadTextures=function(){if(!this.is_family&&!this.has_loaded_textures&&this.runtime.glwrap){var K;var f=0;for(K=this.all_frames.length;f<K;++f){var n=this.all_frames[f];n.webGL_texture=this.runtime.glwrap.loadTexture(n.texture_img,
!1,this.runtime.linearSampling,n.pixelformat)}this.has_loaded_textures=!0}};p.unloadTextures=function(){if(!this.is_family&&!this.instances.length&&this.has_loaded_textures){var K;var f=0;for(K=this.all_frames.length;f<K;++f){var n=this.all_frames[f];this.runtime.glwrap.deleteTexture(n.webGL_texture);n.webGL_texture=null}this.has_loaded_textures=!1}};var x=[];p.preloadCanvas2D=function(K){var f;cr.clearArray(x);var n=0;for(f=this.all_frames.length;n<f;++n){var G=this.all_frames[n].texture_img;-1===
x.indexOf(G)&&(K.drawImage(G,0,0),x.push(G))}};u.Instance=function(K){this.type=K;this.runtime=K.runtime;K=this.type.animations[0].frames[0].poly_pts;this.recycled?this.collision_poly.set_pts(K):this.collision_poly=new cr.CollisionPoly(K)};var M=u.Instance.prototype;M.onCreate=function(){this.visible=this.properties[0];this.inAnimTrigger=this.isTicking=!1;this.collisionsEnabled=this.properties[3];this.cur_animation=this.getAnimationByName(this.properties[1])||this.type.animations[0];this.cur_frame=
this.properties[2];0>this.cur_frame&&(this.cur_frame=0);this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1);var K=this.cur_animation.frames[this.cur_frame];this.collision_poly.set_pts(K.poly_pts);this.hotspotX=K.hotspotX;this.hotspotY=K.hotspotY;this.animForwards=0<=this.cur_animation.speed;this.cur_anim_speed=Math.abs(this.cur_animation.speed);this.cur_anim_repeatto=this.cur_animation.repeatto;1===this.type.animations.length&&1===this.type.animations[0].frames.length||
0===this.cur_anim_speed||(this.runtime.tickMe(this),this.isTicking=!0);this.recycled?this.animTimer.reset():this.animTimer=new cr.KahanAdder;this.frameStart=this.getNowTime();this.animPlaying=!0;this.animRepeats=0;this.changeAnimName=this.animTriggerName="";this.changeAnimFrom=0;this.changeAnimFrame=-1;this.type.loadTextures();var f,n;K=0;for(f=this.type.animations.length;K<f;K++){var G=this.type.animations[K];var g=0;for(n=G.frames.length;g<n;g++){var z=G.frames[g];0===z.width&&(z.width=z.texture_img.width,
z.height=z.texture_img.height);if(z.spritesheeted){var J=z.texture_img;var N=z.sheetTex;N.left=z.offx/J.width;N.top=z.offy/J.height;N.right=(z.offx+z.width)/J.width;N.bottom=(z.offy+z.height)/J.height;0===z.offx&&0===z.offy&&z.width===J.width&&z.height===J.height&&(z.spritesheeted=!1)}}}this.curFrame=this.cur_animation.frames[this.cur_frame];this.curWebGLTexture=this.curFrame.webGL_texture};M.saveToJSON=function(){var K={a:this.cur_animation.sid,f:this.cur_frame,cas:this.cur_anim_speed,fs:this.frameStart,
ar:this.animRepeats,at:this.animTimer.sum,rt:this.cur_anim_repeatto};this.animPlaying||(K.ap=this.animPlaying);this.animForwards||(K.af=this.animForwards);return K};M.loadFromJSON=function(K){var f=this.getAnimationBySid(K.a);f&&(this.cur_animation=f);this.cur_frame=K.f;0>this.cur_frame&&(this.cur_frame=0);this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1);this.cur_anim_speed=K.cas;this.frameStart=K.fs;this.animRepeats=K.ar;this.animTimer.reset();
this.animTimer.sum=K.at;this.animPlaying=K.hasOwnProperty("ap")?K.ap:!0;this.animForwards=K.hasOwnProperty("af")?K.af:!0;K.hasOwnProperty("rt")?this.cur_anim_repeatto=K.rt:this.cur_anim_repeatto=this.cur_animation.repeatto;this.curFrame=this.cur_animation.frames[this.cur_frame];this.curWebGLTexture=this.curFrame.webGL_texture;this.collision_poly.set_pts(this.curFrame.poly_pts);this.hotspotX=this.curFrame.hotspotX;this.hotspotY=this.curFrame.hotspotY};M.animationFinish=function(K){this.cur_frame=K?
0:this.cur_animation.frames.length-1;this.animPlaying=!1;this.animTriggerName=this.cur_animation.name;this.inAnimTrigger=!0;this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnAnyAnimFinished,this);this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnAnimFinished,this);this.inAnimTrigger=!1;this.animRepeats=0};M.getNowTime=function(){return this.animTimer.sum};M.tick=function(){this.animTimer.add(this.runtime.getDt(this));this.changeAnimName.length&&this.doChangeAnim();0<=this.changeAnimFrame&&
this.doChangeAnimFrame();var K=this.getNowTime(),f=this.cur_animation,n=f.frames[this.cur_frame],G=n.duration/this.cur_anim_speed;this.animPlaying&&K>=this.frameStart+G&&(this.animForwards?this.cur_frame++:this.cur_frame--,this.frameStart+=G,this.cur_frame>=f.frames.length&&(f.pingpong?(this.animForwards=!1,this.cur_frame=f.frames.length-2):f.loop?this.cur_frame=this.cur_anim_repeatto:(this.animRepeats++,this.animRepeats>=f.repeatcount?this.animationFinish(!1):this.cur_frame=this.cur_anim_repeatto)),
0>this.cur_frame&&(f.pingpong?(this.cur_frame=1,this.animForwards=!0,f.loop||(this.animRepeats++,this.animRepeats>=f.repeatcount&&this.animationFinish(!0))):f.loop?this.cur_frame=this.cur_anim_repeatto:(this.animRepeats++,this.animRepeats>=f.repeatcount?this.animationFinish(!0):this.cur_frame=this.cur_anim_repeatto)),0>this.cur_frame?this.cur_frame=0:this.cur_frame>=f.frames.length&&(this.cur_frame=f.frames.length-1),K>this.frameStart+f.frames[this.cur_frame].duration/this.cur_anim_speed&&(this.frameStart=
K),K=f.frames[this.cur_frame],this.OnFrameChanged(n,K),this.runtime.redraw=!0)};M.getAnimationByName=function(K){var f;var n=0;for(f=this.type.animations.length;n<f;n++){var G=this.type.animations[n];if(cr.equals_nocase(G.name,K))return G}return null};M.getAnimationBySid=function(K){var f;var n=0;for(f=this.type.animations.length;n<f;n++){var G=this.type.animations[n];if(G.sid===K)return G}return null};M.doChangeAnim=function(){var K=this.cur_animation.frames[this.cur_frame],f=this.getAnimationByName(this.changeAnimName);
this.changeAnimName="";!f||cr.equals_nocase(f.name,this.cur_animation.name)&&this.animPlaying||(this.cur_animation=f,this.animForwards=0<=f.speed,this.cur_anim_speed=Math.abs(f.speed),this.cur_anim_repeatto=f.repeatto,0>this.cur_frame&&(this.cur_frame=0),this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1),1===this.changeAnimFrom&&(this.cur_frame=0),this.animPlaying=!0,this.frameStart=this.getNowTime(),this.OnFrameChanged(K,this.cur_animation.frames[this.cur_frame]),
this.runtime.redraw=!0)};M.doChangeAnimFrame=function(){var K=this.cur_animation.frames[this.cur_frame],f=this.cur_frame;this.cur_frame=cr.floor(this.changeAnimFrame);0>this.cur_frame&&(this.cur_frame=0);this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1);f!==this.cur_frame&&(this.OnFrameChanged(K,this.cur_animation.frames[this.cur_frame]),this.frameStart=this.getNowTime(),this.runtime.redraw=!0);this.changeAnimFrame=-1};M.OnFrameChanged=function(K,
f){var n=K.width,G=K.height,g=f.width,z=f.height;n!=g&&(this.width*=g/n);G!=z&&(this.height*=z/G);this.hotspotX=f.hotspotX;this.hotspotY=f.hotspotY;this.collision_poly.set_pts(f.poly_pts);this.set_bbox_changed();this.curFrame=f;this.curWebGLTexture=f.webGL_texture;n=0;for(G=this.behavior_insts.length;n<G;n++)if(g=this.behavior_insts[n],g.onSpriteFrameChanged)g.onSpriteFrameChanged(K,f);this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnFrameChanged,this)};M.draw=function(K){K.globalAlpha=this.opacity;
var f=this.curFrame,n=f.spritesheeted,G=f.texture_img,g=this.x,z=this.y,J=this.width,N=this.height;if(0===this.angle&&0<=J&&0<=N)g-=this.hotspotX*J,z-=this.hotspotY*N,this.runtime.pixel_rounding&&(g=Math.round(g),z=Math.round(z)),n?K.drawImage(G,f.offx,f.offy,f.width,f.height,g,z,J,N):K.drawImage(G,g,z,J,N);else{this.runtime.pixel_rounding&&(g=Math.round(g),z=Math.round(z));K.save();var U=0<J?1:-1,W=0<N?1:-1;K.translate(g,z);1===U&&1===W||K.scale(U,W);K.rotate(this.angle*U*W);g=-(this.hotspotX*cr.abs(J));
z=-(this.hotspotY*cr.abs(N));n?K.drawImage(G,f.offx,f.offy,f.width,f.height,g,z,cr.abs(J),cr.abs(N)):K.drawImage(G,g,z,cr.abs(J),cr.abs(N));K.restore()}};M.drawGL_earlyZPass=function(K){this.drawGL(K)};M.drawGL=function(K){K.setTexture(this.curWebGLTexture);K.setOpacity(this.opacity);var f=this.curFrame,n=this.bquad;if(this.runtime.pixel_rounding){var G=Math.round(this.x)-this.x,g=Math.round(this.y)-this.y;f.spritesheeted?K.quadTex(n.tlx+G,n.tly+g,n.trx+G,n.try_+g,n.brx+G,n.bry+g,n.blx+G,n.bly+g,
f.sheetTex):K.quad(n.tlx+G,n.tly+g,n.trx+G,n.try_+g,n.brx+G,n.bry+g,n.blx+G,n.bly+g)}else f.spritesheeted?K.quadTex(n.tlx,n.tly,n.trx,n.try_,n.brx,n.bry,n.blx,n.bly,f.sheetTex):K.quad(n.tlx,n.tly,n.trx,n.try_,n.brx,n.bry,n.blx,n.bly)};M.getImagePointIndexByName=function(K){var f=this.curFrame,n;var G=0;for(n=f.image_points.length;G<n;G++)if(cr.equals_nocase(K,f.image_points[G][0]))return G;return-1};M.getImagePoint=function(K,f){var n=this.curFrame,G=n.image_points;var g=cr.is_string(K)?this.getImagePointIndexByName(K):
K-1;g=cr.floor(g);if(0>g||g>=G.length)return f?this.x:this.y;K=(G[g][1]-n.hotspotX)*this.width;G=G[g][2];G=(G-n.hotspotY)*this.height;n=Math.cos(this.angle);g=Math.sin(this.angle);var z=K*n-G*g;G=G*n+K*g;K=z+this.x;G+=this.y;return f?K:G};var v=[],F=-2,C=[];d.prototype.OnCollision=function(K){if(!K)return!1;var f=this.runtime,n=f.getCurrentCondition(),G=n.type,g=null;n.extra.collmemory?g=n.extra.collmemory:(g={},n.extra.collmemory=g);n.extra.spriteCreatedDestroyCallback||(n.extra.spriteCreatedDestroyCallback=
!0,f.addDestroyCallback(function(H){var B=n.extra.collmemory;H=H.uid;var L;for(L in B)if(B.hasOwnProperty(L)){var Q=B[L];if(Q[0]===H||Q[1]===H)h(B[L]),delete B[L]}}));var z=G.getCurrentSol(),J=K.getCurrentSol();z=z.getObjects();var N,U,W=this.runtime.tickcount,X=W-1,Y=f.getCurrentEventStack().current_event;for(N=0;N<z.length;N++){var ea=z[N];if(J.select_all){ea.update_bbox();this.runtime.getCollisionCandidates(ea.layer,K,ea.bbox,C);var ha=C;this.runtime.addRegisteredCollisionCandidates(ea,K,ha)}else ha=
J.getObjects();for(U=0;U<ha.length;U++){var k=ha[U];if(f.testOverlap(ea,k)||f.checkRegisteredCollision(ea,k)){var r=e(g,ea,k);r=!r||F<X;y(g,ea,k,W);if(r){f.pushCopySol(Y.solModifiers);r=G.getCurrentSol();var E=K.getCurrentSol();r.select_all=!1;E.select_all=!1;G===K?(r.instances.length=2,r.instances[0]=ea,r.instances[1]=k,G.applySolToContainer()):(r.instances.length=1,E.instances.length=1,r.instances[0]=ea,E.instances[0]=k,G.applySolToContainer(),K.applySolToContainer());Y.retrigger();f.popSol(Y.solModifiers)}}else A(g,
ea,k)}cr.clearArray(C)}return!1};var l=null,t=new cr.ObjectSet,D=!1,S=[],V=new cr.rect(0,0,0,0);p.finish=function(K){if(D){if(K){var f=this.runtime.getCurrentEventStack().current_event.orblock;K=l.getCurrentSol();var n=t.valuesRef(),G;if(K.select_all){K.select_all=!1;cr.clearArray(K.instances);var g=0;for(G=n.length;g<G;++g)K.instances[g]=n[g];if(f)for(cr.clearArray(K.else_instances),g=0,G=l.instances.length;g<G;++g)n=l.instances[g],t.contains(n)||K.else_instances.push(n)}else if(f)for(f=K.instances.length,
g=0,G=n.length;g<G;++g)K.instances[f+g]=n[g],cr.arrayFindRemove(K.else_instances,n[g]);else cr.shallowAssignArray(K.instances,n);l.applySolToContainer()}t.clear();D=!1}};d.prototype.IsOverlapping=function(K){return a.call(this,K,0,0)};d.prototype.IsOverlappingOffset=function(K,f,n){return a.call(this,K,f,n)};d.prototype.IsAnimPlaying=function(K){return this.changeAnimName.length?cr.equals_nocase(this.changeAnimName,K):cr.equals_nocase(this.cur_animation.name,K)};d.prototype.CompareFrame=function(K,
f){return cr.do_cmp(this.cur_frame,K,f)};d.prototype.CompareAnimSpeed=function(K,f){return cr.do_cmp(this.animForwards?this.cur_anim_speed:-this.cur_anim_speed,K,f)};d.prototype.OnAnimFinished=function(K){return cr.equals_nocase(this.animTriggerName,K)};d.prototype.OnAnyAnimFinished=function(){return!0};d.prototype.OnFrameChanged=function(){return!0};d.prototype.IsMirrored=function(){return 0>this.width};d.prototype.IsFlipped=function(){return 0>this.height};d.prototype.OnURLLoaded=function(){return!0};
d.prototype.IsCollisionEnabled=function(){return this.collisionsEnabled};u.cnds=new d;c.prototype.Spawn=function(K,f,n){if(K&&f&&(f=this.runtime.createInstance(K,f,this.getImagePoint(n,!0),this.getImagePoint(n,!1)))){"undefined"!==typeof f.angle&&(f.angle=this.angle,f.set_bbox_changed());this.runtime.isInOnDestroy++;var G;this.runtime.trigger(Object.getPrototypeOf(K.plugin).cnds.OnCreated,f);if(f.is_contained){var g=0;for(G=f.siblings.length;g<G;g++){var z=f.siblings[g];this.runtime.trigger(Object.getPrototypeOf(z.type.plugin).cnds.OnCreated,
z)}}this.runtime.isInOnDestroy--;g=this.runtime.getCurrentAction();n=!1;if(cr.is_undefined(g.extra.Spawn_LastExec)||g.extra.Spawn_LastExec<this.runtime.execcount)n=!0,g.extra.Spawn_LastExec=this.runtime.execcount;if(K!=this.type&&(K=K.getCurrentSol(),K.select_all=!1,n?(cr.clearArray(K.instances),K.instances[0]=f):K.instances.push(f),f.is_contained))for(g=0,G=f.siblings.length;g<G;g++)z=f.siblings[g],K=z.type.getCurrentSol(),K.select_all=!1,n?(cr.clearArray(K.instances),K.instances[0]=z):K.instances.push(z)}};
c.prototype.SetEffect=function(K){this.blend_mode=K;this.compositeOp=cr.effectToCompositeOp(K);cr.setGLBlend(this,K,this.runtime.gl);this.runtime.redraw=!0};c.prototype.StopAnim=function(){this.animPlaying=!1};c.prototype.StartAnim=function(K){this.animPlaying=!0;this.frameStart=this.getNowTime();1===K&&0!==this.cur_frame&&(this.changeAnimFrame=0,this.inAnimTrigger||this.doChangeAnimFrame());this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0)};c.prototype.SetAnim=function(K,f){this.changeAnimName=
K;this.changeAnimFrom=f;this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0);this.inAnimTrigger||this.doChangeAnim()};c.prototype.SetAnimFrame=function(K){this.changeAnimFrame=K;this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0);this.inAnimTrigger||this.doChangeAnimFrame()};c.prototype.SetAnimSpeed=function(K){this.cur_anim_speed=cr.abs(K);this.animForwards=0<=K;this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0)};c.prototype.SetAnimRepeatToFrame=function(K){K=Math.floor(K);
0>K&&(K=0);K>=this.cur_animation.frames.length&&(K=this.cur_animation.frames.length-1);this.cur_anim_repeatto=K};c.prototype.SetMirrored=function(K){K=cr.abs(this.width)*(0===K?-1:1);this.width!==K&&(this.width=K,this.set_bbox_changed())};c.prototype.SetFlipped=function(K){K=cr.abs(this.height)*(0===K?-1:1);this.height!==K&&(this.height=K,this.set_bbox_changed())};c.prototype.SetScale=function(K){var f=this.curFrame,n=f.width*K*(0>this.width?-1:1);K=f.height*K*(0>this.height?-1:1);if(this.width!==
n||this.height!==K)this.width=n,this.height=K,this.set_bbox_changed()};c.prototype.LoadURL=function(K,f,n){var G=new Image,g=this,z=this.curFrame;G.onload=function(){z.texture_img.src===G.src?g.runtime.glwrap&&g.curFrame===z&&(g.curWebGLTexture=z.webGL_texture):(z.texture_img=G,z.offx=0,z.offy=0,z.width=G.width,z.height=G.height,z.spritesheeted=!1,z.datauri="",z.pixelformat=0,g.runtime.glwrap&&(z.webGL_texture&&g.runtime.glwrap.deleteTexture(z.webGL_texture),z.webGL_texture=g.runtime.glwrap.loadTexture(G,
!1,g.runtime.linearSampling),g.curFrame===z&&(g.curWebGLTexture=z.webGL_texture),g.type.updateAllCurrentTexture()));0===f&&(g.width=G.width,g.height=G.height,g.set_bbox_changed());g.runtime.redraw=!0;g.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnURLLoaded,g)};"data:"!==K.substr(0,5)&&0===n&&(G.crossOrigin="anonymous");this.runtime.setImageSrc(G,K)};c.prototype.SetCollisions=function(K){this.collisionsEnabled!==(0!==K)&&((this.collisionsEnabled=0!==K)?this.set_bbox_changed():(this.collcells.right>=
this.collcells.left&&this.type.collision_grid.update(this,this.collcells,null),this.collcells.set(0,0,-1,-1)))};u.acts=new c;m.prototype.AnimationFrame=function(K){K.set_int(this.cur_frame)};m.prototype.AnimationFrameCount=function(K){K.set_int(this.cur_animation.frames.length)};m.prototype.AnimationName=function(K){K.set_string(this.cur_animation.name)};m.prototype.AnimationSpeed=function(K){K.set_float(this.animForwards?this.cur_anim_speed:-this.cur_anim_speed)};m.prototype.ImagePointX=function(K,
f){K.set_float(this.getImagePoint(f,!0))};m.prototype.ImagePointY=function(K,f){K.set_float(this.getImagePoint(f,!1))};m.prototype.ImagePointCount=function(K){K.set_int(this.curFrame.image_points.length)};m.prototype.ImageWidth=function(K){K.set_float(this.curFrame.width)};m.prototype.ImageHeight=function(K){K.set_float(this.curFrame.height)};u.exps=new m})();cr.plugins_.Touch=function(b){this.runtime=b};
(function(){function b(l){m=l.x;u=l.y;p=l.z}function d(l,t,D,S){var V=x.length?x.pop():new h;V.init(l,t,D,S);return V}function h(){this.startindex=this.id=this.lasty=this.lastx=this.y=this.x=this.starty=this.startx=this.lasttime=this.time=this.starttime=0;this.tooFarForHold=this.triggeredHold=!1}function q(l){return l.sourceCapabilities&&l.sourceCapabilities.firesTouchEvents||l.originalEvent&&l.originalEvent.sourceCapabilities&&l.originalEvent.sourceCapabilities.firesTouchEvents}function y(){}function A(){}
function e(){}var a=cr.plugins_.Touch.prototype;a.Type=function(l){this.plugin=l;this.runtime=l.runtime};a.Type.prototype.onCreate=function(){};a.Instance=function(l){this.type=l;this.runtime=l.runtime;this.touches=[];this.mouseDown=!1};var c=a.Instance.prototype;c.findTouch=function(l){var t;var D=0;for(t=this.touches.length;D<t;D++)if(this.touches[D].id===l)return D;return-1};var m=0,u=0,p=0,x=[];h.prototype.init=function(l,t,D,S){var V=cr.performance_now();this.starttime=this.lasttime=this.time=
V;this.startx=l;this.starty=t;this.x=l;this.y=t;this.lastx=l;this.lasty=t;this.pressure=this.height=this.width=0;this.id=D;this.startindex=S;this.tooFarForHold=this.triggeredHold=!1};h.prototype.update=function(l,t,D,S,V,K){this.lasttime=this.time;this.time=l;this.lastx=this.x;this.lasty=this.y;this.x=t;this.y=D;this.width=S;this.height=V;this.pressure=K;!this.tooFarForHold&&15<=cr.distanceTo(this.startx,this.starty,this.x,this.y)&&(this.tooFarForHold=!0)};h.prototype.maybeTriggerHold=function(l,
t){!this.triggeredHold&&500<=cr.performance_now()-this.starttime&&!this.tooFarForHold&&15>cr.distanceTo(this.startx,this.starty,this.x,this.y)&&(this.triggeredHold=!0,l.trigger_index=this.startindex,l.trigger_id=this.id,l.getTouchIndex=t,l.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnHoldGesture,l),l.curTouchX=this.x,l.curTouchY=this.y,l.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnHoldGestureObject,l),l.getTouchIndex=0)};var M=-1E3,v=-1E3,F=-1E4;h.prototype.maybeTriggerTap=function(l,
t){if(!this.triggeredHold){var D=cr.performance_now();333>=D-this.starttime&&!this.tooFarForHold&&15>cr.distanceTo(this.startx,this.starty,this.x,this.y)&&(l.trigger_index=this.startindex,l.trigger_id=this.id,l.getTouchIndex=t,666>=D-F&&25>cr.distanceTo(M,v,this.x,this.y)?(l.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnDoubleTapGesture,l),l.curTouchX=this.x,l.curTouchY=this.y,l.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnDoubleTapGestureObject,l),v=M=-1E3,F=-1E4):(l.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTapGesture,
l),l.curTouchX=this.x,l.curTouchY=this.y,l.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTapGestureObject,l),M=this.x,v=this.y,F=D),l.getTouchIndex=0)}};c.onCreate=function(){this.isWindows8=!("undefined"===typeof window.c2isWindows8||!window.c2isWindows8);this.getTouchIndex=this.trigger_permission=this.trigger_id=this.trigger_index=this.curTouchY=this.curTouchX=this.acc_z=this.acc_y=this.acc_x=this.acc_g_z=this.acc_g_y=this.acc_g_x=this.orient_gamma=this.orient_beta=this.orient_alpha=0;this.useMouseInput=
this.properties[0];var l=0<this.runtime.fullscreen_mode?document:this.runtime.canvas,t=document,D=this;"undefined"!==typeof PointerEvent?(l.addEventListener("pointerdown",function(n){D.onPointerStart(n)},!1),l.addEventListener("pointermove",function(n){D.onPointerMove(n)},!1),t.addEventListener("pointerup",function(n){D.onPointerEnd(n,!1)},!1),t.addEventListener("pointercancel",function(n){D.onPointerEnd(n,!0)},!1),this.runtime.canvas&&(this.runtime.canvas.addEventListener("MSGestureHold",function(n){n.preventDefault()},
!1),document.addEventListener("MSGestureHold",function(n){n.preventDefault()},!1),this.runtime.canvas.addEventListener("gesturehold",function(n){n.preventDefault()},!1),document.addEventListener("gesturehold",function(n){n.preventDefault()},!1))):window.navigator.msPointerEnabled?(l.addEventListener("MSPointerDown",function(n){D.onPointerStart(n)},!1),l.addEventListener("MSPointerMove",function(n){D.onPointerMove(n)},!1),t.addEventListener("MSPointerUp",function(n){D.onPointerEnd(n,!1)},!1),t.addEventListener("MSPointerCancel",
function(n){D.onPointerEnd(n,!0)},!1),this.runtime.canvas&&(this.runtime.canvas.addEventListener("MSGestureHold",function(n){n.preventDefault()},!1),document.addEventListener("MSGestureHold",function(n){n.preventDefault()},!1))):(l.addEventListener("touchstart",function(n){D.onTouchStart(n)},!1),l.addEventListener("touchmove",function(n){D.onTouchMove(n)},!1),t.addEventListener("touchend",function(n){D.onTouchEnd(n,!1)},!1),t.addEventListener("touchcancel",function(n){D.onTouchEnd(n,!0)},!1));if(this.isWindows8){var S=
function(n){n=n.reading;D.acc_x=n.accelerationX;D.acc_y=n.accelerationY;D.acc_z=n.accelerationZ},V=function(n){n=n.reading;D.orient_alpha=n.yawDegrees;D.orient_beta=n.pitchDegrees;D.orient_gamma=n.rollDegrees},K=Windows.Devices.Sensors.Accelerometer.getDefault();K&&(K.reportInterval=Math.max(K.minimumReportInterval,16),K.addEventListener("readingchanged",S));var f=Windows.Devices.Sensors.Inclinometer.getDefault();f&&(f.reportInterval=Math.max(f.minimumReportInterval,16),f.addEventListener("readingchanged",
V));document.addEventListener("visibilitychange",function(n){document.hidden||document.msHidden?(K&&K.removeEventListener("readingchanged",S),f&&f.removeEventListener("readingchanged",V)):(K&&K.addEventListener("readingchanged",S),f&&f.addEventListener("readingchanged",V))},!1)}else window.addEventListener("deviceorientation",function(n){D.orient_alpha=n.alpha||0;D.orient_beta=n.beta||0;D.orient_gamma=n.gamma||0},!1),window.addEventListener("devicemotion",function(n){n.accelerationIncludingGravity&&
(D.acc_g_x=n.accelerationIncludingGravity.x||0,D.acc_g_y=n.accelerationIncludingGravity.y||0,D.acc_g_z=n.accelerationIncludingGravity.z||0);n.acceleration&&(D.acc_x=n.acceleration.x||0,D.acc_y=n.acceleration.y||0,D.acc_z=n.acceleration.z||0)},!1);this.useMouseInput&&(document.addEventListener("mousemove",function(n){D.onMouseMove(n)}),document.addEventListener("mousedown",function(n){D.onMouseDown(n)}),document.addEventListener("mouseup",function(n){D.onMouseUp(n)}));!this.runtime.isiOS&&this.runtime.isCordova&&
navigator.accelerometer&&navigator.accelerometer.watchAcceleration&&navigator.accelerometer.watchAcceleration(b,null,{frequency:40});this.runtime.tick2Me(this)};c.onPointerMove=function(l){if(l.pointerType!==l.MSPOINTER_TYPE_MOUSE&&"mouse"!==l.pointerType){l.preventDefault&&l.preventDefault();var t=this.findTouch(l.pointerId),D=cr.performance_now();0<=t&&(t=this.touches[t],2>D-t.time||t.update(D,l.pageX-this.runtime.canvas.offsetLeft,l.pageY-this.runtime.canvas.offsetTop,l.width||0,l.height||0,l.pressure||
0))}};c.onPointerStart=function(l){if(l.pointerType!==l.MSPOINTER_TYPE_MOUSE&&"mouse"!==l.pointerType&&-1===this.findTouch(l.pointerId)){l.preventDefault&&cr.isCanvasInputEvent(l)&&l.preventDefault();var t=l.pageX-this.runtime.canvas.offsetLeft,D=l.pageY-this.runtime.canvas.offsetTop;cr.performance_now();this.trigger_index=this.touches.length;this.trigger_id=l.pointerId;this.touches.push(d(t,D,l.pointerId,this.trigger_index));this.runtime.isInUserInputEvent=!0;this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchStart,
this);this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchStart,this);this.curTouchX=t;this.curTouchY=D;this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchObject,this);this.runtime.isInUserInputEvent=!1}};c.onPointerEnd=function(l,t){l.pointerType!==l.MSPOINTER_TYPE_MOUSE&&"mouse"!==l.pointerType&&(l.preventDefault&&cr.isCanvasInputEvent(l)&&l.preventDefault(),l=this.findTouch(l.pointerId),this.trigger_index=0<=l?this.touches[l].startindex:-1,this.trigger_id=0<=l?this.touches[l].id:
-1,this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchEnd,this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchEnd,this),0<=l&&(t||this.touches[l].maybeTriggerTap(this,l),100>x.length&&x.push(this.touches[l]),this.touches.splice(l,1)),this.runtime.isInUserInputEvent=!1)};c.onTouchMove=function(l){l.preventDefault&&l.preventDefault();var t=cr.performance_now(),D;var S=0;for(D=l.changedTouches.length;S<D;S++){var V=l.changedTouches[S];var K=
this.findTouch(V.identifier);if(0<=K){var f=this.runtime.canvas.offsetLeft,n=this.runtime.canvas.offsetTop;K=this.touches[K];2>t-K.time||K.update(t,V.pageX-f,V.pageY-n,2*(V.radiusX||V.webkitRadiusX||V.mozRadiusX||V.msRadiusX||0),2*(V.radiusY||V.webkitRadiusY||V.mozRadiusY||V.msRadiusY||0),V.force||V.webkitForce||V.mozForce||V.msForce||0)}}};c.onTouchStart=function(l){l.preventDefault&&cr.isCanvasInputEvent(l)&&l.preventDefault();var t=this.runtime.canvas.offsetLeft,D=this.runtime.canvas.offsetTop;
cr.performance_now();this.runtime.isInUserInputEvent=!0;var S;var V=0;for(S=l.changedTouches.length;V<S;V++){var K=l.changedTouches[V];var f=this.findTouch(K.identifier);if(-1===f){f=K.pageX-t;var n=K.pageY-D;this.trigger_index=this.touches.length;this.trigger_id=K.identifier;this.touches.push(d(f,n,K.identifier,this.trigger_index));this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchStart,this);this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchStart,this);this.curTouchX=f;
this.curTouchY=n;this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchObject,this)}}this.runtime.isInUserInputEvent=!1};c.onTouchEnd=function(l,t){l.preventDefault&&cr.isCanvasInputEvent(l)&&l.preventDefault();this.runtime.isInUserInputEvent=!0;var D;var S=0;for(D=l.changedTouches.length;S<D;S++){var V=l.changedTouches[S];V=this.findTouch(V.identifier);0<=V&&(this.trigger_index=this.touches[V].startindex,this.trigger_id=this.touches[V].id,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchEnd,
this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchEnd,this),t||this.touches[V].maybeTriggerTap(this,V),100>x.length&&x.push(this.touches[V]),this.touches.splice(V,1))}this.runtime.isInUserInputEvent=!1};c.getAlpha=function(){return this.runtime.isCordova&&0===this.orient_alpha&&0!==p?90*p:this.orient_alpha};c.getBeta=function(){return this.runtime.isCordova&&0===this.orient_beta&&0!==u?90*u:this.orient_beta};c.getGamma=function(){return this.runtime.isCordova&&0===this.orient_gamma&&
0!==m?90*m:this.orient_gamma};c.onMouseDown=function(l){q(l)||(this.onTouchStart({changedTouches:[{pageX:l.pageX,pageY:l.pageY,identifier:0}]}),this.mouseDown=!0)};c.onMouseMove=function(l){if(this.mouseDown&&!q(l))this.onTouchMove({changedTouches:[{pageX:l.pageX,pageY:l.pageY,identifier:0}]})};c.onMouseUp=function(l){l.preventDefault&&this.runtime.had_a_click&&!this.runtime.isMobile&&l.preventDefault();this.runtime.had_a_click=!0;q(l)||(this.onTouchEnd({changedTouches:[{pageX:l.pageX,pageY:l.pageY,
identifier:0}]}),this.mouseDown=!1)};c.isClientPosOverCanvas=function(l,t){return 0<=l&&0<=t&&l<this.runtime.width&&t<this.runtime.height};c.tick2=function(){var l,t=cr.performance_now();var D=0;for(l=this.touches.length;D<l;++D){var S=this.touches[D];S.time<=t-50&&(S.lasttime=t);S.maybeTriggerHold(this,D)}};y.prototype.OnTouchStart=function(){return!0};y.prototype.OnTouchEnd=function(){return!0};y.prototype.IsInTouch=function(){return this.touches.length};y.prototype.OnTouchObject=function(l){return l&&
this.isClientPosOverCanvas(this.curTouchX,this.curTouchY)?this.runtime.testAndSelectCanvasPointOverlap(l,this.curTouchX,this.curTouchY,!1):!1};var C=[];y.prototype.IsTouchingObject=function(l){if(!l)return!1;var t=l.getCurrentSol(),D=t.getObjects(),S,V;var K=0;for(S=D.length;K<S;K++){var f=D[K];f.update_bbox();var n=0;for(V=this.touches.length;n<V;n++){var G=this.touches[n];if(this.isClientPosOverCanvas(G.x,G.y)){var g=f.layer.canvasToLayer(G.x,G.y,!0);G=f.layer.canvasToLayer(G.x,G.y,!1);if(f.contains_pt(g,
G)){C.push(f);break}}}}return C.length?(t.select_all=!1,cr.shallowAssignArray(t.instances,C),l.applySolToContainer(),cr.clearArray(C),!0):!1};y.prototype.CompareTouchSpeed=function(l,t,D){l=Math.floor(l);if(0>l||l>=this.touches.length)return!1;var S=this.touches[l];l=cr.distanceTo(S.x,S.y,S.lastx,S.lasty);S=(S.time-S.lasttime)/1E3;var V=0;0<S&&(V=l/S);return cr.do_cmp(V,t,D)};y.prototype.OrientationSupported=function(){return"undefined"!==typeof window.DeviceOrientationEvent};y.prototype.MotionSupported=
function(){return"undefined"!==typeof window.DeviceMotionEvent};y.prototype.CompareOrientation=function(l,t,D){l=0===l?this.getAlpha():1===l?this.getBeta():this.getGamma();return cr.do_cmp(l,t,D)};y.prototype.CompareAcceleration=function(l,t,D){var S=0;0===l?S=this.acc_g_x:1===l?S=this.acc_g_y:2===l?S=this.acc_g_z:3===l?S=this.acc_x:4===l?S=this.acc_y:5===l&&(S=this.acc_z);return cr.do_cmp(S,t,D)};y.prototype.OnNthTouchStart=function(l){l=Math.floor(l);return l===this.trigger_index};y.prototype.OnNthTouchEnd=
function(l){l=Math.floor(l);return l===this.trigger_index};y.prototype.HasNthTouch=function(l){l=Math.floor(l);return this.touches.length>=l+1};y.prototype.OnHoldGesture=function(){return!0};y.prototype.OnTapGesture=function(){return!0};y.prototype.OnDoubleTapGesture=function(){return!0};y.prototype.OnHoldGestureObject=function(l){return l&&this.isClientPosOverCanvas(this.curTouchX,this.curTouchY)?this.runtime.testAndSelectCanvasPointOverlap(l,this.curTouchX,this.curTouchY,!1):!1};y.prototype.OnTapGestureObject=
function(l){return l&&this.isClientPosOverCanvas(this.curTouchX,this.curTouchY)?this.runtime.testAndSelectCanvasPointOverlap(l,this.curTouchX,this.curTouchY,!1):!1};y.prototype.OnDoubleTapGestureObject=function(l){return l&&this.isClientPosOverCanvas(this.curTouchX,this.curTouchY)?this.runtime.testAndSelectCanvasPointOverlap(l,this.curTouchX,this.curTouchY,!1):!1};y.prototype.OnPermissionGranted=function(l){return this.trigger_permission===l};y.prototype.OnPermissionDenied=function(l){return this.trigger_permission===
l};a.cnds=new y;A.prototype.RequestPermission=function(l){var t=this,D=Promise.resolve(!0);0===l?window.DeviceOrientationEvent&&window.DeviceOrientationEvent.requestPermission&&(D=window.DeviceOrientationEvent.requestPermission().then(function(S){return"granted"===S})):window.DeviceMotionEvent&&window.DeviceMotionEvent.requestPermission&&(D=window.DeviceMotionEvent.requestPermission().then(function(S){return"granted"===S}));D.then(function(S){t.trigger_permission=l;S?t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnPermissionGranted,
t):t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnPermissionDenied,t)})};a.acts=new A;e.prototype.TouchCount=function(l){l.set_int(this.touches.length)};e.prototype.X=function(l,t){var D=this.getTouchIndex;if(0>D||D>=this.touches.length)l.set_float(0);else if(cr.is_undefined(t)){t=this.runtime.getLayerByNumber(0);var S=t.scale;var V=t.zoomRate;var K=t.parallaxX;var f=t.angle;t.scale=1;t.zoomRate=1;t.parallaxX=1;t.angle=0;l.set_float(t.canvasToLayer(this.touches[D].x,this.touches[D].y,!0));t.scale=
S;t.zoomRate=V;t.parallaxX=K;t.angle=f}else(t=cr.is_number(t)?this.runtime.getLayerByNumber(t):this.runtime.getLayerByName(t))?l.set_float(t.canvasToLayer(this.touches[D].x,this.touches[D].y,!0)):l.set_float(0)};e.prototype.XAt=function(l,t,D){t=Math.floor(t);if(0>t||t>=this.touches.length)l.set_float(0);else if(cr.is_undefined(D)){D=this.runtime.getLayerByNumber(0);var S=D.scale;var V=D.zoomRate;var K=D.parallaxX;var f=D.angle;D.scale=1;D.zoomRate=1;D.parallaxX=1;D.angle=0;l.set_float(D.canvasToLayer(this.touches[t].x,
this.touches[t].y,!0));D.scale=S;D.zoomRate=V;D.parallaxX=K;D.angle=f}else(D=cr.is_number(D)?this.runtime.getLayerByNumber(D):this.runtime.getLayerByName(D))?l.set_float(D.canvasToLayer(this.touches[t].x,this.touches[t].y,!0)):l.set_float(0)};e.prototype.XForID=function(l,t,D){t=this.findTouch(t);if(0>t)l.set_float(0);else if(t=this.touches[t],cr.is_undefined(D)){D=this.runtime.getLayerByNumber(0);var S=D.scale;var V=D.zoomRate;var K=D.parallaxX;var f=D.angle;D.scale=1;D.zoomRate=1;D.parallaxX=1;
D.angle=0;l.set_float(D.canvasToLayer(t.x,t.y,!0));D.scale=S;D.zoomRate=V;D.parallaxX=K;D.angle=f}else(D=cr.is_number(D)?this.runtime.getLayerByNumber(D):this.runtime.getLayerByName(D))?l.set_float(D.canvasToLayer(t.x,t.y,!0)):l.set_float(0)};e.prototype.Y=function(l,t){var D=this.getTouchIndex;if(0>D||D>=this.touches.length)l.set_float(0);else if(cr.is_undefined(t)){t=this.runtime.getLayerByNumber(0);var S=t.scale;var V=t.zoomRate;var K=t.parallaxY;var f=t.angle;t.scale=1;t.zoomRate=1;t.parallaxY=
1;t.angle=0;l.set_float(t.canvasToLayer(this.touches[D].x,this.touches[D].y,!1));t.scale=S;t.zoomRate=V;t.parallaxY=K;t.angle=f}else(t=cr.is_number(t)?this.runtime.getLayerByNumber(t):this.runtime.getLayerByName(t))?l.set_float(t.canvasToLayer(this.touches[D].x,this.touches[D].y,!1)):l.set_float(0)};e.prototype.YAt=function(l,t,D){t=Math.floor(t);if(0>t||t>=this.touches.length)l.set_float(0);else if(cr.is_undefined(D)){D=this.runtime.getLayerByNumber(0);var S=D.scale;var V=D.zoomRate;var K=D.parallaxY;
var f=D.angle;D.scale=1;D.zoomRate=1;D.parallaxY=1;D.angle=0;l.set_float(D.canvasToLayer(this.touches[t].x,this.touches[t].y,!1));D.scale=S;D.zoomRate=V;D.parallaxY=K;D.angle=f}else(D=cr.is_number(D)?this.runtime.getLayerByNumber(D):this.runtime.getLayerByName(D))?l.set_float(D.canvasToLayer(this.touches[t].x,this.touches[t].y,!1)):l.set_float(0)};e.prototype.YForID=function(l,t,D){t=this.findTouch(t);if(0>t)l.set_float(0);else if(t=this.touches[t],cr.is_undefined(D)){D=this.runtime.getLayerByNumber(0);
var S=D.scale;var V=D.zoomRate;var K=D.parallaxY;var f=D.angle;D.scale=1;D.zoomRate=1;D.parallaxY=1;D.angle=0;l.set_float(D.canvasToLayer(t.x,t.y,!1));D.scale=S;D.zoomRate=V;D.parallaxY=K;D.angle=f}else(D=cr.is_number(D)?this.runtime.getLayerByNumber(D):this.runtime.getLayerByName(D))?l.set_float(D.canvasToLayer(t.x,t.y,!1)):l.set_float(0)};e.prototype.AbsoluteX=function(l){this.touches.length?l.set_float(this.touches[0].x):l.set_float(0)};e.prototype.AbsoluteXAt=function(l,t){t=Math.floor(t);0>t||
t>=this.touches.length?l.set_float(0):l.set_float(this.touches[t].x)};e.prototype.AbsoluteXForID=function(l,t){t=this.findTouch(t);0>t?l.set_float(0):l.set_float(this.touches[t].x)};e.prototype.AbsoluteY=function(l){this.touches.length?l.set_float(this.touches[0].y):l.set_float(0)};e.prototype.AbsoluteYAt=function(l,t){t=Math.floor(t);0>t||t>=this.touches.length?l.set_float(0):l.set_float(this.touches[t].y)};e.prototype.AbsoluteYForID=function(l,t){t=this.findTouch(t);0>t?l.set_float(0):l.set_float(this.touches[t].y)};
e.prototype.SpeedAt=function(l,t){t=Math.floor(t);if(0>t||t>=this.touches.length)l.set_float(0);else{var D=this.touches[t];t=cr.distanceTo(D.x,D.y,D.lastx,D.lasty);D=(D.time-D.lasttime)/1E3;0>=D?l.set_float(0):l.set_float(t/D)}};e.prototype.SpeedForID=function(l,t){t=this.findTouch(t);if(0>t)l.set_float(0);else{var D=this.touches[t];t=cr.distanceTo(D.x,D.y,D.lastx,D.lasty);D=(D.time-D.lasttime)/1E3;0>=D?l.set_float(0):l.set_float(t/D)}};e.prototype.AngleAt=function(l,t){t=Math.floor(t);0>t||t>=this.touches.length?
l.set_float(0):(t=this.touches[t],l.set_float(cr.to_degrees(cr.angleTo(t.lastx,t.lasty,t.x,t.y))))};e.prototype.AngleForID=function(l,t){t=this.findTouch(t);0>t?l.set_float(0):(t=this.touches[t],l.set_float(cr.to_degrees(cr.angleTo(t.lastx,t.lasty,t.x,t.y))))};e.prototype.Alpha=function(l){l.set_float(this.getAlpha())};e.prototype.Beta=function(l){l.set_float(this.getBeta())};e.prototype.Gamma=function(l){l.set_float(this.getGamma())};e.prototype.AccelerationXWithG=function(l){l.set_float(this.acc_g_x)};
e.prototype.AccelerationYWithG=function(l){l.set_float(this.acc_g_y)};e.prototype.AccelerationZWithG=function(l){l.set_float(this.acc_g_z)};e.prototype.AccelerationX=function(l){l.set_float(this.acc_x)};e.prototype.AccelerationY=function(l){l.set_float(this.acc_y)};e.prototype.AccelerationZ=function(l){l.set_float(this.acc_z)};e.prototype.TouchIndex=function(l){l.set_int(this.trigger_index)};e.prototype.TouchID=function(l){l.set_float(this.trigger_id)};e.prototype.WidthForID=function(l,t){t=this.findTouch(t);
0>t?l.set_float(0):l.set_float(this.touches[t].width)};e.prototype.HeightForID=function(l,t){t=this.findTouch(t);0>t?l.set_float(0):l.set_float(this.touches[t].height)};e.prototype.PressureForID=function(l,t){t=this.findTouch(t);0>t?l.set_float(0):l.set_float(this.touches[t].pressure)};a.exps=new e})();cr.plugins_.Text=function(b){this.runtime=b};
(function(){function b(){return u.length?u.pop():{}}function d(p){var x;var M=0;for(x=p.length;M<x;M++)u.push(p[M]);cr.clearArray(p)}function h(p){return p.length&&" "===p.charAt(p.length-1)?p.substring(0,p.length-1):p}function q(){}function y(){}function A(){}var e=cr.plugins_.Text.prototype;e.onCreate=function(){e.acts.SetWidth=function(p){this.width!==p&&(this.width=p,this.text_changed=!0,this.set_bbox_changed())}};e.Type=function(p){this.plugin=p;this.runtime=p.runtime};var a=e.Type.prototype;
a.onCreate=function(){};a.onLostWebGLContext=function(){if(!this.is_family){var p;var x=0;for(p=this.instances.length;x<p;x++){var M=this.instances[x];M.mycanvas=null;M.myctx=null;M.mytex=null}}};e.Instance=function(p){this.type=p;this.runtime=p.runtime;this.recycled?cr.clearArray(this.lines):this.lines=[];this.text_changed=!0};a=e.Instance.prototype;var c={};a.onCreate=function(){this.text=this.properties[0];this.facename=this.properties[2];this.ptSize=this.properties[3];this.line_height_offset=
this.properties[4];this.isBold=this.properties[5];this.isItalic=this.properties[6];var p=this.properties[7];this.color="rgb("+Math.floor(255*p[0])+","+Math.floor(255*p[1])+","+Math.floor(255*p[2])+")";this.halign=this.properties[8];this.valign=this.properties[9];this.wrapbyword=0===this.properties[10];this.visible=this.properties[11];this.lastwrapwidth=this.lastwidth=this.width;this.lastheight=this.height;this.fontstyle=this.font="";this.textHeight=this.textWidth=this.pxHeight=0;this.updateFont();
this.mytex=this.myctx=this.mycanvas=null;this.need_text_redraw=!1;this.last_render_tick=this.runtime.tickcount;this.recycled?this.rcTex.set(0,0,1,1):this.rcTex=new cr.rect(0,0,1,1);this.runtime.glwrap&&this.runtime.tickMe(this)};a.saveToJSON=function(){return{t:this.text,f:this.font,c:this.color,ha:this.halign,va:this.valign,wr:this.wrapbyword,lho:this.line_height_offset,fn:this.facename,fs:this.fontstyle,ps:this.ptSize,pxh:this.pxHeight,tw:this.textWidth,th:this.textHeight,lrt:this.last_render_tick}};
a.loadFromJSON=function(p){this.text=p.t;this.font=p.f;this.color=p.c;this.halign=p.ha;this.valign=p.va;this.wrapbyword=p.wr;this.line_height_offset=p.lho;this.facename=p.fn;this.fontstyle=p.fs;this.ptSize=p.ps;this.pxHeight=p.pxh;this.textWidth=p.tw;this.textHeight=p.th;this.last_render_tick=p.lrt;this.isBold=0!==this.fontstyle.indexOf("bold");this.isItalic=0!==this.fontstyle.indexOf("italic");this.text_changed=!0;this.lastwrapwidth=this.lastwidth=this.width;this.lastheight=this.height};a.tick=function(){if(this.runtime.glwrap&&
this.mytex&&300<=this.runtime.tickcount-this.last_render_tick){var p=this.layer;this.update_bbox();var x=this.bbox;if(x.right<p.viewLeft||x.bottom<p.viewTop||x.left>p.viewRight||x.top>p.viewBottom)this.runtime.glwrap.deleteTexture(this.mytex),this.mycanvas=this.myctx=this.mytex=null}};a.onDestroy=function(){this.mycanvas=this.myctx=null;this.runtime.glwrap&&this.mytex&&this.runtime.glwrap.deleteTexture(this.mytex);this.mytex=null};a.updateFont=function(){this.pxHeight=Math.ceil(this.ptSize/72*96)+
4;var p=[];this.isBold&&p.push("bold");this.isItalic&&p.push("italic");this.fontstyle=p.join(" ");this.font=this.fontstyle+" "+this.ptSize.toString()+"pt '"+this.facename+"'";this.text_changed=!0;this.runtime.redraw=!0};a.draw=function(p,x){p.font=this.font;p.textBaseline="top";p.fillStyle=this.color;p.globalAlpha=x?1:this.opacity;if(x){var M=this.layer.getScale();p.save();p.scale(M,M)}if(this.text_changed||this.width!==this.lastwrapwidth)this.type.plugin.WordWrap(this.text,this.lines,p,this.width,
this.wrapbyword),this.text_changed=!1,this.lastwrapwidth=this.width;this.update_bbox();M=x?0:this.bquad.tlx;var v=x?0:this.bquad.tly;this.runtime.pixel_rounding&&(M=M+.5|0,v=v+.5|0);0===this.angle||x||(p.save(),p.translate(M,v),p.rotate(this.angle),v=M=0);var F=v+this.height,C=this.pxHeight;C+=this.line_height_offset;var l;1===this.valign?v+=Math.max(this.height/2-this.lines.length*C/2,0):2===this.valign&&(v+=Math.max(this.height-this.lines.length*C-2,0));for(l=0;l<this.lines.length;l++){var t=M;
1===this.halign?t=M+(this.width-this.lines[l].width)/2:2===this.halign&&(t=M+(this.width-this.lines[l].width));p.fillText(this.lines[l].text,t,v);v+=C;if(v>=F-C)break}(0!==this.angle||x)&&p.restore();this.last_render_tick=this.runtime.tickcount};a.drawGL=function(p){if(!(1>this.width||1>this.height)){var x=this.text_changed||this.need_text_redraw;this.need_text_redraw=!1;var M=this.layer.getScale(),v=this.layer.getAngle(),F=this.rcTex,C=M*this.width,l=M*this.height,t=Math.ceil(C),D=Math.ceil(l),S=
this.runtime.draw_width/2,V=this.runtime.draw_height/2;this.myctx||(this.mycanvas=document.createElement("canvas"),this.mycanvas.width=t,this.mycanvas.height=D,this.lastwidth=t,this.lastheight=D,x=!0,this.myctx=this.mycanvas.getContext("2d"));if(t!==this.lastwidth||D!==this.lastheight)this.mycanvas.width=t,this.mycanvas.height=D,this.mytex&&(p.deleteTexture(this.mytex),this.mytex=null),x=!0;x&&(this.myctx.clearRect(0,0,t,D),this.draw(this.myctx,!0),this.mytex||(this.mytex=p.createEmptyTexture(t,D,
this.runtime.linearSampling,this.runtime.isMobile)),p.videoToTexture(this.mycanvas,this.mytex,this.runtime.isMobile));this.lastwidth=t;this.lastheight=D;p.setTexture(this.mytex);p.setOpacity(this.opacity);p.resetModelView();p.translate(-S,-V);p.updateModelView();var K=this.bquad;x=this.layer.layerToCanvas(K.tlx,K.tly,!0,!0);S=this.layer.layerToCanvas(K.tlx,K.tly,!1,!0);V=this.layer.layerToCanvas(K.trx,K.try_,!0,!0);var f=this.layer.layerToCanvas(K.trx,K.try_,!1,!0),n=this.layer.layerToCanvas(K.brx,
K.bry,!0,!0),G=this.layer.layerToCanvas(K.brx,K.bry,!1,!0),g=this.layer.layerToCanvas(K.blx,K.bly,!0,!0);K=this.layer.layerToCanvas(K.blx,K.bly,!1,!0);if(this.runtime.pixel_rounding||0===this.angle&&0===v){var z=(x+.5|0)-x,J=(S+.5|0)-S;x+=z;S+=J;V+=z;f+=J;n+=z;G+=J;g+=z;K+=J}0===this.angle&&0===v?(V=x+t,f=S,n=V,G=S+D,g=x,K=G,F.right=1,F.bottom=1):(F.right=C/t,F.bottom=l/D);p.quadTex(x,S,V,f,n,G,g,K,F);p.resetModelView();p.scale(M,M);p.rotateZ(-this.layer.getAngle());p.translate((this.layer.viewLeft+
this.layer.viewRight)/-2,(this.layer.viewTop+this.layer.viewBottom)/-2);p.updateModelView();this.last_render_tick=this.runtime.tickcount}};var m=[];e.TokeniseWords=function(p){cr.clearArray(m);for(var x="",M,v=0;v<p.length;)if(M=p.charAt(v),"\n"===M)x.length&&(m.push(x),x=""),m.push("\n"),++v;else if(" "===M||"\t"===M||"-"===M){do x+=p.charAt(v),v++;while(v<p.length&&(" "===p.charAt(v)||"\t"===p.charAt(v)));m.push(x);x=""}else v<p.length&&(x+=M,v++);x.length&&m.push(x)};var u=[];e.WordWrap=function(p,
x,M,v,F){if(p&&p.length)if(2>=v)d(x);else{if(100>=p.length&&-1===p.indexOf("\n")){var C=M.measureText(p).width;if(C<=v){d(x);x.push(b());x[0].text=p;x[0].width=C;return}}this.WrapText(p,x,M,v,F)}else d(x)};e.WrapText=function(p,x,M,v,F){F&&(this.TokeniseWords(p),p=m);var C="",l,t=0;for(l=0;l<p.length;l++)if("\n"===p[l]){t>=x.length&&x.push(b());C=h(C);var D=x[t];D.text=C;D.width=M.measureText(C).width;t++;C=""}else{var S=C;C+=p[l];D=M.measureText(h(C)).width;D>=v&&(t>=x.length&&x.push(b()),S=h(S),
D=x[t],D.text=S,D.width=M.measureText(S).width,t++,C=p[l],F||" "!==C||(C=""))}C.length&&(t>=x.length&&x.push(b()),C=h(C),D=x[t],D.text=C,D.width=M.measureText(C).width,t++);for(l=t;l<x.length;l++)u.push(x[l]);x.length=t};q.prototype.CompareText=function(p,x){return x?this.text==p:cr.equals_nocase(this.text,p)};e.cnds=new q;y.prototype.SetText=function(p){cr.is_number(p)&&1E9>p&&(p=Math.round(1E10*p)/1E10);p=p.toString();this.text!==p&&(this.text=p,this.text_changed=!0,this.runtime.redraw=!0)};y.prototype.AppendText=
function(p){cr.is_number(p)&&(p=Math.round(1E10*p)/1E10);if(p=p.toString())this.text+=p,this.text_changed=!0,this.runtime.redraw=!0};y.prototype.SetFontFace=function(p,x){var M=!1,v=!1;switch(x){case 1:M=!0;break;case 2:v=!0;break;case 3:v=M=!0}if(p!==this.facename||this.isBold!==M||this.isItalic!==v)this.facename=p,this.isBold=M,this.isItalic=v,this.updateFont()};y.prototype.SetFontSize=function(p){this.ptSize!==p&&(this.ptSize=p,this.updateFont())};y.prototype.SetFontColor=function(p){var x=cr.clamp(Math.floor(255*
cr.GetRValue(p)),0,255),M=cr.clamp(Math.floor(255*cr.GetGValue(p)),0,255);p=cr.clamp(Math.floor(255*cr.GetBValue(p)),0,255);x="rgb("+x+","+M+","+p+")";x!==this.color&&(this.color=x,this.need_text_redraw=!0,this.runtime.redraw=!0)};y.prototype.SetWebFont=function(p,x){var M=this,v=function(){M.runtime.redraw=!0;M.text_changed=!0};if(c.hasOwnProperty(x)){if(p="'"+p+"'",this.facename!==p)for(this.facename=p,this.updateFont(),p=1;10>p;p++)setTimeout(v,100*p),setTimeout(v,1E3*p)}else{var F=document.createElement("link");
F.href=x;F.rel="stylesheet";F.type="text/css";F.onload=v;document.getElementsByTagName("head")[0].appendChild(F);c[x]=!0;this.facename="'"+p+"'";this.updateFont();for(p=1;10>p;p++)setTimeout(v,100*p),setTimeout(v,1E3*p)}};y.prototype.SetEffect=function(p){this.blend_mode=p;this.compositeOp=cr.effectToCompositeOp(p);cr.setGLBlend(this,p,this.runtime.gl);this.runtime.redraw=!0};e.acts=new y;A.prototype.Text=function(p){p.set_string(this.text)};A.prototype.FaceName=function(p){p.set_string(this.facename)};
A.prototype.FaceSize=function(p){p.set_int(this.ptSize)};A.prototype.TextWidth=function(p){var x=0,M;var v=0;for(M=this.lines.length;v<M;v++){var F=this.lines[v].width;x<F&&(x=F)}p.set_int(x)};A.prototype.TextHeight=function(p){p.set_int(this.lines.length*(this.pxHeight+this.line_height_offset)-this.line_height_offset)};e.exps=new A})();cr.plugins_.WebStorage=function(b){this.runtime=b};
(function(){function b(){}function d(){}function h(){}var q=cr.plugins_.WebStorage.prototype;q.Type=function(c){this.plugin=c;this.runtime=c.runtime};q.Type.prototype.onCreate=function(){};q.Instance=function(c){this.type=c;this.runtime=c.runtime};var y=q.Instance.prototype,A="",e="undefined"!==typeof window.is_scirra_arcade;e&&(A="arcade"+window.scirra_arcade_id);var a=!1;try{localStorage.getItem("test"),a=!0}catch(c){a=!1}y.onCreate=function(){a||cr.logexport("[Construct 2] Webstorage plugin: local storage is not supported on this platform.")};
b.prototype.LocalStorageEnabled=function(){return a};b.prototype.SessionStorageEnabled=function(){return a};b.prototype.LocalStorageExists=function(c){return a?null!=localStorage.getItem(A+c):!1};b.prototype.SessionStorageExists=function(c){return a?null!=sessionStorage.getItem(A+c):!1};b.prototype.OnQuotaExceeded=function(){return!0};b.prototype.CompareKeyText=function(c,m,u){if(!a)return!1;c=localStorage.getItem(A+c)||"";return u?c==m:cr.equals_nocase(c,m)};b.prototype.CompareKeyNumber=function(c,
m,u){if(!a)return!1;c=localStorage.getItem(A+c)||"";return cr.do_cmp(parseFloat(c),m,u)};q.cnds=new b;d.prototype.StoreLocal=function(c,m){if(a)try{localStorage.setItem(A+c,m)}catch(u){this.runtime.trigger(cr.plugins_.WebStorage.prototype.cnds.OnQuotaExceeded,this)}};d.prototype.StoreSession=function(c,m){if(a)try{sessionStorage.setItem(A+c,m)}catch(u){this.runtime.trigger(cr.plugins_.WebStorage.prototype.cnds.OnQuotaExceeded,this)}};d.prototype.RemoveLocal=function(c){a&&localStorage.removeItem(A+
c)};d.prototype.RemoveSession=function(c){a&&sessionStorage.removeItem(A+c)};d.prototype.ClearLocal=function(){a&&(e||localStorage.clear())};d.prototype.ClearSession=function(){a&&(e||sessionStorage.clear())};d.prototype.JSONLoad=function(c,m){if(a){try{var u=JSON.parse(c)}catch(x){return}if(u.c2dictionary){c=u.data;0!==m||e||localStorage.clear();for(var p in c)if(c.hasOwnProperty(p))try{localStorage.setItem(A+p,c[p])}catch(x){this.runtime.trigger(cr.plugins_.WebStorage.prototype.cnds.OnQuotaExceeded,
this);break}}}};q.acts=new d;h.prototype.LocalValue=function(c,m){a?c.set_string(localStorage.getItem(A+m)||""):c.set_string("")};h.prototype.SessionValue=function(c,m){a?c.set_string(sessionStorage.getItem(A+m)||""):c.set_string("")};h.prototype.LocalCount=function(c){a?c.set_int(e?0:localStorage.length):c.set_int(0)};h.prototype.SessionCount=function(c){a?c.set_int(e?0:sessionStorage.length):c.set_int(0)};h.prototype.LocalAt=function(c,m){e||!a?c.set_string(""):c.set_string(localStorage.getItem(localStorage.key(m))||
"")};h.prototype.SessionAt=function(c,m){e||!a?c.set_string(""):c.set_string(sessionStorage.getItem(sessionStorage.key(m))||"")};h.prototype.LocalKeyAt=function(c,m){e||!a?c.set_string(""):c.set_string(localStorage.key(m)||"")};h.prototype.SessionKeyAt=function(c,m){e||!a?c.set_string(""):c.set_string(sessionStorage.key(m)||"")};h.prototype.AsJSON=function(c){if(a){var m={},u;var p=0;for(u=localStorage.length;p<u;p++){var x=localStorage.key(p);e?x.substr(0,A.length)===A&&(m[x.substr(A.length)]=localStorage.getItem(x)):
m[x]=localStorage.getItem(x)}c.set_string(JSON.stringify({c2dictionary:!0,data:m}))}else c.set_string("")};q.exps=new h})();cr.plugins_.Audio=function(b){this.runtime=b};
(function(){function b(w){-1===xa.indexOf(w)&&xa.push(w)}function d(w){var I=w.instanceObject;try{var O=I.play()}catch(P){b(w);return}O?O.catch(function(P){b(w)}):Ca&&!k.isInUserInputEvent&&b(w)}function h(){var w,I;Da||ka||!L||(q(),"running"===L.state&&(Da=!0));var O=xa.slice(0);cr.clearArray(xa);if(!ba){var P=0;for(w=O.length;P<w;++P){var aa=O[P];aa.stopped||aa.is_paused||(I=aa.instanceObject.play())&&I.catch(function(ca){b(aa)})}}}function q(){"suspended"===L.state&&L.resume&&L.resume();if(L.createBuffer){var w=
L.createBuffer(1,220,22050),I=L.createBufferSource();I.buffer=w;I.connect(L.destination);m(I)}}function y(w){w=Math.pow(10,w/20);isFinite(w)||(w=0);0>w&&(w=0);1<w&&(w=1);return w}function A(w){0>w&&(w=0);1<w&&(w=1);return Math.log(w)/Math.log(10)*20}function e(w){w=w.toLowerCase();return oa.hasOwnProperty(w)&&oa[w].length?oa[w][0].getInputNode():L.destination}function a(){return L.createGain?L.createGain():L.createGainNode()}function c(w){return L.createDelay?L.createDelay(w):L.createDelayNode(w)}
function m(w,I){w.start?w.start(I||0):w.noteOn(I||0)}function u(w,I,O,P){w.start?w.start(P||0,I):w.noteGrainOn(P||0,I,O-I)}function p(w){try{w.stop?w.stop(0):w.noteOff(0)}catch(I){}}function x(w,I,O,P){if(w)if(w.cancelScheduledValues(0),0===P)w.value=I;else{var aa=L.currentTime;P+=aa;switch(O){case 0:w.setValueAtTime(I,P);break;case 1:w.setValueAtTime(w.value,aa);w.linearRampToValueAtTime(I,P);break;case 2:w.setValueAtTime(w.value,aa),w.exponentialRampToValueAtTime(I,P)}}}function M(w,I,O,P,aa,ca){this.type=
"filter";this.params=[w,I,O,P,aa,ca];this.inputNode=a();this.wetNode=a();this.wetNode.gain.value=ca;this.dryNode=a();this.dryNode.gain.value=1-ca;this.filterNode=L.createBiquadFilter();this.filterNode.type="number"===typeof this.filterNode.type?w:Ea[w];this.filterNode.frequency.value=I;this.filterNode.detune&&(this.filterNode.detune.value=O);this.filterNode.Q.value=P;this.filterNode.gain.value=aa;this.inputNode.connect(this.filterNode);this.inputNode.connect(this.dryNode);this.filterNode.connect(this.wetNode)}
function v(w,I,O){this.type="delay";this.params=[w,I,O];this.inputNode=a();this.wetNode=a();this.wetNode.gain.value=O;this.dryNode=a();this.dryNode.gain.value=1-O;this.mainNode=a();this.delayNode=c(w);this.delayNode.delayTime.value=w;this.delayGainNode=a();this.delayGainNode.gain.value=I;this.inputNode.connect(this.mainNode);this.inputNode.connect(this.dryNode);this.mainNode.connect(this.wetNode);this.mainNode.connect(this.delayNode);this.delayNode.connect(this.delayGainNode);this.delayGainNode.connect(this.mainNode)}
function F(w,I,O,P){this.type="convolve";this.params=[I,O,P];this.inputNode=a();this.wetNode=a();this.wetNode.gain.value=O;this.dryNode=a();this.dryNode.gain.value=1-O;this.convolveNode=L.createConvolver();w&&(this.convolveNode.normalize=I,this.convolveNode.buffer=w);this.inputNode.connect(this.convolveNode);this.inputNode.connect(this.dryNode);this.convolveNode.connect(this.wetNode)}function C(w,I,O,P,aa){this.type="flanger";this.params=[w,I,O,P,aa];this.inputNode=a();this.dryNode=a();this.dryNode.gain.value=
1-aa/2;this.wetNode=a();this.wetNode.gain.value=aa/2;this.feedbackNode=a();this.feedbackNode.gain.value=P;this.delayNode=c(w+I);this.delayNode.delayTime.value=w;this.oscNode=L.createOscillator();this.oscNode.frequency.value=O;this.oscGainNode=a();this.oscGainNode.gain.value=I;this.inputNode.connect(this.delayNode);this.inputNode.connect(this.dryNode);this.delayNode.connect(this.wetNode);this.delayNode.connect(this.feedbackNode);this.feedbackNode.connect(this.delayNode);this.oscNode.connect(this.oscGainNode);
this.oscGainNode.connect(this.delayNode.delayTime);m(this.oscNode)}function l(w,I,O,P,aa,ca){this.type="phaser";this.params=[w,I,O,P,aa,ca];this.inputNode=a();this.dryNode=a();this.dryNode.gain.value=1-ca/2;this.wetNode=a();this.wetNode.gain.value=ca/2;this.filterNode=L.createBiquadFilter();this.filterNode.type="number"===typeof this.filterNode.type?7:"allpass";this.filterNode.frequency.value=w;this.filterNode.detune&&(this.filterNode.detune.value=I);this.filterNode.Q.value=O;this.oscNode=L.createOscillator();
this.oscNode.frequency.value=aa;this.oscGainNode=a();this.oscGainNode.gain.value=P;this.inputNode.connect(this.filterNode);this.inputNode.connect(this.dryNode);this.filterNode.connect(this.wetNode);this.oscNode.connect(this.oscGainNode);this.oscGainNode.connect(this.filterNode.frequency);m(this.oscNode)}function t(w){this.type="gain";this.params=[w];this.node=a();this.node.gain.value=w}function D(w,I){this.type="tremolo";this.params=[w,I];this.node=a();this.node.gain.value=1-I/2;this.oscNode=L.createOscillator();
this.oscNode.frequency.value=w;this.oscGainNode=a();this.oscGainNode.gain.value=I/2;this.oscNode.connect(this.oscGainNode);this.oscGainNode.connect(this.node.gain);m(this.oscNode)}function S(w,I){this.type="ringmod";this.params=[w,I];this.inputNode=a();this.wetNode=a();this.wetNode.gain.value=I;this.dryNode=a();this.dryNode.gain.value=1-I;this.ringNode=a();this.ringNode.gain.value=0;this.oscNode=L.createOscillator();this.oscNode.frequency.value=w;this.oscNode.connect(this.ringNode.gain);m(this.oscNode);
this.inputNode.connect(this.ringNode);this.inputNode.connect(this.dryNode);this.ringNode.connect(this.wetNode)}function V(w,I,O,P,aa){this.type="distortion";this.params=[w,I,O,P,aa];this.inputNode=a();this.preGain=a();this.postGain=a();this.setDrive(O,Math.pow(10,P/20));this.wetNode=a();this.wetNode.gain.value=aa;this.dryNode=a();this.dryNode.gain.value=1-aa;this.waveShaper=L.createWaveShaper();this.curve=new Float32Array(65536);this.generateColortouchCurve(w,I);this.waveShaper.curve=this.curve;this.inputNode.connect(this.preGain);
this.inputNode.connect(this.dryNode);this.preGain.connect(this.waveShaper);this.waveShaper.connect(this.postGain);this.postGain.connect(this.wetNode)}function K(w,I,O,P,aa){this.type="compressor";this.params=[w,I,O,P,aa];this.node=L.createDynamicsCompressor();try{this.node.threshold.value=w,this.node.knee.value=I,this.node.ratio.value=O,this.node.attack.value=P,this.node.release.value=aa}catch(ca){}}function f(w,I){this.type="analyser";this.params=[w,I];this.node=L.createAnalyser();this.node.fftSize=
w;this.node.smoothingTimeConstant=I;this.freqBins=new Float32Array(this.node.frequencyBinCount);this.signal=new Uint8Array(w);this.rms=this.peak=0}function n(){this.obj=null;this.loadUid=0}function G(w,I,O){this.src=w;this.type=I;this.myapi=B;this.is_music=O;this.added_end_listener=!1;var P=this;this.mediaSourceNode=this.outNode=null;this.panWhenReady=[];this.seekWhenReady=0;this.failedToLoad=this.supportWebAudioAPI=this.pauseWhenReady=!1;this.needsSoftwareDecode="audio/webm; codecs=opus"===this.type&&
!ta;this.wasEverReady=!1;this.is_music&&this.needsSoftwareDecode&&(Fa=!0);1!==B||!O||ya||this.needsSoftwareDecode||(this.myapi=0,this.outNode=a());this.audioData=this.bufferObject=null;switch(this.myapi){case 0:this.bufferObject=new Audio;this.bufferObject.crossOrigin="anonymous";this.bufferObject.addEventListener("canplaythrough",function(){P.wasEverReady=!0});1===B&&L.createMediaElementSource&&!/wiiu/i.test(navigator.userAgent)&&(this.supportWebAudioAPI=!0,this.bufferObject.addEventListener("canplay",
function(){!P.mediaSourceNode&&P.bufferObject&&(P.mediaSourceNode=L.createMediaElementSource(P.bufferObject),P.mediaSourceNode.connect(P.outNode))}));this.bufferObject.autoplay=!1;this.bufferObject.preload="auto";this.bufferObject.src=w;break;case 1:if(k.isWKWebView)k.fetchLocalFileViaCordovaAsArrayBuffer(w,function(ca){P.audioData=ca;P.decodeAudioBuffer()},function(ca){P.failedToLoad=!0});else{var aa=new XMLHttpRequest;aa.open("GET",w,!0);aa.responseType="arraybuffer";aa.onload=function(){P.audioData=
aa.response;P.decodeAudioBuffer()};aa.onerror=function(){P.failedToLoad=!0};aa.send()}break;case 2:this.bufferObject=!0}}function g(w,I){var O=this;this.tag=I;this.stopped=this.fresh=!0;this.src=w.src;this.buffer=w;this.myapi=B;this.is_music=w.is_music;this.playbackRate=1;this.hasPlaybackEnded=!0;this.is_paused=this.resume_me=!1;this.resume_position=0;this.is_silent=this.is_muted=this.looping=!1;this.volume=1;this.onended_handler=function(aa){if(!O.is_paused&&!O.resume_me){var ca=this;ca||(ca=aa.target);
ca===O.active_buffer&&(O.hasPlaybackEnded=!0,O.stopped=!0,E=O.tag,k.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,r))}};this.active_buffer=null;this.isTimescaled=1===fa&&!this.is_music||2===fa;this.mutevol=1;this.startTime=this.isTimescaled?k.kahanTime.sum:k.wallTime.sum;this.pannerNode=this.gainNode=null;this.pannerEnabled=!1;this.objectTracker=null;this.panConeOuterGain=this.panConeOuter=this.panConeInner=this.panAngle=this.panY=this.panX=0;this.instanceObject=null;var P=!1;1!==this.myapi||0!==
this.buffer.myapi||this.buffer.supportWebAudioAPI||(this.myapi=0);switch(this.myapi){case 0:this.is_music?(this.instanceObject=w.bufferObject,P=!w.added_end_listener,w.added_end_listener=!0):(this.instanceObject=new Audio,this.instanceObject.crossOrigin="anonymous",this.instanceObject.autoplay=!1,this.instanceObject.src=w.bufferObject.src,P=!0);P&&this.instanceObject.addEventListener("ended",function(){E=O.tag;O.stopped=!0;k.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,r)});break;case 1:this.gainNode=
a();this.gainNode.connect(e(I));1===this.buffer.myapi?w.bufferObject&&(this.instanceObject=L.createBufferSource(),this.instanceObject.buffer=w.bufferObject,this.instanceObject.connect(this.gainNode)):(this.instanceObject=this.buffer.bufferObject,this.buffer.outNode.connect(this.gainNode),this.buffer.added_end_listener||(this.buffer.added_end_listener=!0,this.buffer.bufferObject.addEventListener("ended",function(){E=O.tag;O.stopped=!0;k.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,r)})));break;
case 2:this.instanceObject=new window.Media(H+this.src,null,null,function(aa){aa===window.Media.MEDIA_STOPPED&&(O.hasPlaybackEnded=!0,O.stopped=!0,E=O.tag,k.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,r))})}}function z(w,I){w=w.isPlaying()?1:0;I=I.isPlaying()?1:0;return w===I?0:w<I?1:-1}function J(w,I){cr.clearArray(na);if(w.length){var O;var P=0;for(O=R.length;P<O;P++){var aa=R[P];cr.equals_nocase(w,aa.tag)&&na.push(aa)}I&&na.sort(z)}else T&&!T.hasEnded()&&(cr.clearArray(na),na[0]=T)}function N(w){var I,
O=L.destination;if(oa.hasOwnProperty(w)){var P=oa[w];if(P.length){O=P[0].getInputNode();var aa=0;for(I=P.length;aa<I;aa++){var ca=P[aa];aa+1===I?ca.connectTo(L.destination):ca.connectTo(P[aa+1].getInputNode())}}}J(w);aa=0;for(I=na.length;aa<I;aa++)na[aa].reconnect(O);ua&&Aa===w&&(ua.disconnect(),ua.connect(O))}function U(w,I){oa.hasOwnProperty(w)?oa[w].push(I):oa[w]=[I];N(w)}function W(){}function X(){}function Y(){}function ea(w,I){var O=null;oa.hasOwnProperty(w)&&(O=oa[w]);return O&&0<=I&&I<O.length&&
O[I].freqBins?O[I]:null}var ha=cr.plugins_.Audio.prototype;ha.Type=function(w){this.plugin=w;this.runtime=w.runtime};ha.Type.prototype.onCreate=function(){};var k=null,r=null,E="",H="",B=0,L=null,Q=[],R=[],T=null,fa=0,ba=!1,Z=1,da=0,ia=0,ka=!1,ta=!!(new Audio).canPlayType("audio/webm; codecs=opus"),qa=1,Ba=1,Ga=10,Ha=1E4,Ia=1,ua=null,Aa="",Ca=!1,xa=[],ya=!1,Fa=!1,Da=!1;document.addEventListener("pointerup",h,!0);document.addEventListener("touchend",h,!0);document.addEventListener("click",h,!0);document.addEventListener("keydown",
h,!0);document.addEventListener("gamepadconnected",h,!0);var oa={},Ea="lowpass highpass bandpass lowshelf highshelf peaking notch allpass".split(" ");M.prototype.connectTo=function(w){this.wetNode.disconnect();this.wetNode.connect(w);this.dryNode.disconnect();this.dryNode.connect(w)};M.prototype.remove=function(){this.inputNode.disconnect();this.filterNode.disconnect();this.wetNode.disconnect();this.dryNode.disconnect()};M.prototype.getInputNode=function(){return this.inputNode};M.prototype.setParam=
function(w,I,O,P){switch(w){case 0:I/=100;0>I&&(I=0);1<I&&(I=1);this.params[5]=I;x(this.wetNode.gain,I,O,P);x(this.dryNode.gain,1-I,O,P);break;case 1:this.params[1]=I;x(this.filterNode.frequency,I,O,P);break;case 2:this.params[2]=I;x(this.filterNode.detune,I,O,P);break;case 3:this.params[3]=I;x(this.filterNode.Q,I,O,P);break;case 4:this.params[4]=I,x(this.filterNode.gain,I,O,P)}};v.prototype.connectTo=function(w){this.wetNode.disconnect();this.wetNode.connect(w);this.dryNode.disconnect();this.dryNode.connect(w)};
v.prototype.remove=function(){this.inputNode.disconnect();this.mainNode.disconnect();this.delayNode.disconnect();this.delayGainNode.disconnect();this.wetNode.disconnect();this.dryNode.disconnect()};v.prototype.getInputNode=function(){return this.inputNode};v.prototype.setParam=function(w,I,O,P){switch(w){case 0:I/=100;0>I&&(I=0);1<I&&(I=1);this.params[2]=I;x(this.wetNode.gain,I,O,P);x(this.dryNode.gain,1-I,O,P);break;case 4:this.params[1]=y(I);x(this.delayGainNode.gain,y(I),O,P);break;case 5:this.params[0]=
I,x(this.delayNode.delayTime,I,O,P)}};F.prototype.connectTo=function(w){this.wetNode.disconnect();this.wetNode.connect(w);this.dryNode.disconnect();this.dryNode.connect(w)};F.prototype.remove=function(){this.inputNode.disconnect();this.convolveNode.disconnect();this.wetNode.disconnect();this.dryNode.disconnect()};F.prototype.getInputNode=function(){return this.inputNode};F.prototype.setParam=function(w,I,O,P){switch(w){case 0:I/=100,0>I&&(I=0),1<I&&(I=1),this.params[1]=I,x(this.wetNode.gain,I,O,P),
x(this.dryNode.gain,1-I,O,P)}};C.prototype.connectTo=function(w){this.dryNode.disconnect();this.dryNode.connect(w);this.wetNode.disconnect();this.wetNode.connect(w)};C.prototype.remove=function(){this.inputNode.disconnect();this.delayNode.disconnect();this.oscNode.disconnect();this.oscGainNode.disconnect();this.dryNode.disconnect();this.wetNode.disconnect();this.feedbackNode.disconnect()};C.prototype.getInputNode=function(){return this.inputNode};C.prototype.setParam=function(w,I,O,P){switch(w){case 0:I/=
100;0>I&&(I=0);1<I&&(I=1);this.params[4]=I;x(this.wetNode.gain,I/2,O,P);x(this.dryNode.gain,1-I/2,O,P);break;case 6:this.params[1]=I/1E3;x(this.oscGainNode.gain,I/1E3,O,P);break;case 7:this.params[2]=I;x(this.oscNode.frequency,I,O,P);break;case 8:this.params[3]=I/100,x(this.feedbackNode.gain,I/100,O,P)}};l.prototype.connectTo=function(w){this.dryNode.disconnect();this.dryNode.connect(w);this.wetNode.disconnect();this.wetNode.connect(w)};l.prototype.remove=function(){this.inputNode.disconnect();this.filterNode.disconnect();
this.oscNode.disconnect();this.oscGainNode.disconnect();this.dryNode.disconnect();this.wetNode.disconnect()};l.prototype.getInputNode=function(){return this.inputNode};l.prototype.setParam=function(w,I,O,P){switch(w){case 0:I/=100;0>I&&(I=0);1<I&&(I=1);this.params[5]=I;x(this.wetNode.gain,I/2,O,P);x(this.dryNode.gain,1-I/2,O,P);break;case 1:this.params[0]=I;x(this.filterNode.frequency,I,O,P);break;case 2:this.params[1]=I;x(this.filterNode.detune,I,O,P);break;case 3:this.params[2]=I;x(this.filterNode.Q,
I,O,P);break;case 6:this.params[3]=I;x(this.oscGainNode.gain,I,O,P);break;case 7:this.params[4]=I,x(this.oscNode.frequency,I,O,P)}};t.prototype.connectTo=function(w){this.node.disconnect();this.node.connect(w)};t.prototype.remove=function(){this.node.disconnect()};t.prototype.getInputNode=function(){return this.node};t.prototype.setParam=function(w,I,O,P){switch(w){case 4:this.params[0]=y(I),x(this.node.gain,y(I),O,P)}};D.prototype.connectTo=function(w){this.node.disconnect();this.node.connect(w)};
D.prototype.remove=function(){this.oscNode.disconnect();this.oscGainNode.disconnect();this.node.disconnect()};D.prototype.getInputNode=function(){return this.node};D.prototype.setParam=function(w,I,O,P){switch(w){case 0:I/=100;0>I&&(I=0);1<I&&(I=1);this.params[1]=I;x(this.node.gain.value,1-I/2,O,P);x(this.oscGainNode.gain.value,I/2,O,P);break;case 7:this.params[0]=I,x(this.oscNode.frequency,I,O,P)}};S.prototype.connectTo=function(w){this.wetNode.disconnect();this.wetNode.connect(w);this.dryNode.disconnect();
this.dryNode.connect(w)};S.prototype.remove=function(){this.oscNode.disconnect();this.ringNode.disconnect();this.inputNode.disconnect();this.wetNode.disconnect();this.dryNode.disconnect()};S.prototype.getInputNode=function(){return this.inputNode};S.prototype.setParam=function(w,I,O,P){switch(w){case 0:I/=100;0>I&&(I=0);1<I&&(I=1);this.params[1]=I;x(this.wetNode.gain,I,O,P);x(this.dryNode.gain,1-I,O,P);break;case 7:this.params[0]=I,x(this.oscNode.frequency,I,O,P)}};V.prototype.setDrive=function(w,
I){.01>w&&(w=.01);this.preGain.gain.value=w;this.postGain.gain.value=Math.pow(1/w,.6)*I};V.prototype.shape=function(w,I,O){O=1.05*O*I-I;var P=0>w?-w:w;return(P<I?P:I+O*(1-Math.exp(-(1/O)*(P-I))))*(0>w?-1:1)};V.prototype.generateColortouchCurve=function(w,I){w=Math.pow(10,w/20);I=Math.pow(10,I/20);for(var O,P=0;32768>P;++P)O=P/32768,O=this.shape(O,w,I),this.curve[32768+P]=O,this.curve[32768-P-1]=-O};V.prototype.connectTo=function(w){this.wetNode.disconnect();this.wetNode.connect(w);this.dryNode.disconnect();
this.dryNode.connect(w)};V.prototype.remove=function(){this.inputNode.disconnect();this.preGain.disconnect();this.waveShaper.disconnect();this.postGain.disconnect();this.wetNode.disconnect();this.dryNode.disconnect()};V.prototype.getInputNode=function(){return this.inputNode};V.prototype.setParam=function(w,I,O,P){switch(w){case 0:I/=100,0>I&&(I=0),1<I&&(I=1),this.params[4]=I,x(this.wetNode.gain,I,O,P),x(this.dryNode.gain,1-I,O,P)}};K.prototype.connectTo=function(w){this.node.disconnect();this.node.connect(w)};
K.prototype.remove=function(){this.node.disconnect()};K.prototype.getInputNode=function(){return this.node};K.prototype.setParam=function(w,I,O,P){};f.prototype.tick=function(){this.node.getFloatFrequencyData(this.freqBins);this.node.getByteTimeDomainData(this.signal);for(var w=this.node.fftSize,I=0,O=this.peak=0,P;I<w;I++)P=(this.signal[I]-128)/128,0>P&&(P=-P),this.peak<P&&(this.peak=P),O+=P*P;this.peak=A(this.peak);this.rms=A(Math.sqrt(O/w))};f.prototype.connectTo=function(w){this.node.disconnect();
this.node.connect(w)};f.prototype.remove=function(){this.node.disconnect()};f.prototype.getInputNode=function(){return this.node};f.prototype.setParam=function(w,I,O,P){};n.prototype.setObject=function(w){this.obj=w};n.prototype.hasObject=function(){return!!this.obj};n.prototype.tick=function(w){};G.prototype.release=function(){var w,I;var O=w=0;for(I=R.length;w<I;++w){var P=R[w];R[O]=P;P.buffer===this?P.stop():++O}R.length=O;this.mediaSourceNode&&(this.mediaSourceNode.disconnect(),this.mediaSourceNode=
null);this.outNode&&(this.outNode.disconnect(),this.outNode=null);this.audioData=this.bufferObject=null};G.prototype.decodeAudioBuffer=function(){if(!this.bufferObject&&this.audioData){var w=this;if(this.needsSoftwareDecode){var I=this.audioData;this.audioData=null;window.OpusDecoder(I,function(O,P){if(O)w.onDecodeError(O);else O=new Float32Array(P),P=L.createBuffer(1,O.length,48E3),P.getChannelData(0).set(O),w.onDecodeComplete(P)})}else L.decodeAudioData(this.audioData,function(O){w.onDecodeComplete(O)},
function(O){w.onDecodeError(O)})}};G.prototype.onDecodeComplete=function(w){this.bufferObject=w;this.audioData=null;var I;if(cr.is_undefined(this.playTagWhenReady)||ba)cr.is_undefined(this.convolveWhenReady)||(O=this.convolveWhenReady.convolveNode,O.normalize=this.normalizeWhenReady,O.buffer=w);else if(this.panWhenReady.length){var O=0;for(I=this.panWhenReady.length;O<I;O++){w=this.panWhenReady[O];var P=new g(this,w.thistag);P.setPannerEnabled(!0);if("undefined"!==typeof w.objUid&&(w.obj=k.getObjectByUID(w.objUid),
!w.obj))continue;if(w.obj){var aa=cr.rotatePtAround(w.obj.x,w.obj.y,-w.obj.layer.getAngle(),da,ia,!0),ca=cr.rotatePtAround(w.obj.x,w.obj.y,-w.obj.layer.getAngle(),da,ia,!1);P.setPan(aa,ca,cr.to_degrees(w.obj.angle-w.obj.layer.getAngle()),w.ia,w.oa,w.og);P.setObject(w.obj)}else P.setPan(w.x,w.y,w.a,w.ia,w.oa,w.og);P.play(this.loopWhenReady,this.volumeWhenReady,this.seekWhenReady);this.pauseWhenReady&&P.pause();R.push(P)}cr.clearArray(this.panWhenReady)}else P=new g(this,this.playTagWhenReady||""),
P.play(this.loopWhenReady,this.volumeWhenReady,this.seekWhenReady),this.pauseWhenReady&&P.pause(),R.push(P)};G.prototype.onDecodeError=function(w){self.failedToLoad=!0;console.error("Failed to decode audio '"+this.src+"': "+w)};G.prototype.isLoaded=function(){switch(this.myapi){case 0:var w=4<=this.bufferObject.readyState;w&&(this.wasEverReady=!0);return w||this.wasEverReady;case 1:return!!this.audioData||!!this.bufferObject;case 2:return!0}return!1};G.prototype.isLoadedAndDecoded=function(){switch(this.myapi){case 0:return this.isLoaded();
case 1:return!!this.bufferObject;case 2:return!0}return!1};G.prototype.hasFailedToLoad=function(){switch(this.myapi){case 0:return!!this.bufferObject.error;case 1:return this.failedToLoad}return!1};g.prototype.hasEnded=function(){switch(this.myapi){case 0:return this.instanceObject.ended;case 1:return 1===this.buffer.myapi?!this.fresh&&!this.stopped&&this.instanceObject.loop||this.is_paused?!1:this.hasPlaybackEnded:this.instanceObject.ended;case 2:return this.hasPlaybackEnded}return!0};g.prototype.canBeRecycled=
function(){return this.fresh||this.stopped?!0:this.hasEnded()};g.prototype.setPannerEnabled=function(w){1===B&&(!this.pannerEnabled&&w?this.gainNode&&(this.pannerNode||(this.pannerNode=L.createPanner(),this.pannerNode.panningModel="number"===typeof this.pannerNode.panningModel?qa:["equalpower","HRTF","soundfield"][qa],this.pannerNode.distanceModel="number"===typeof this.pannerNode.distanceModel?Ba:["linear","inverse","exponential"][Ba],this.pannerNode.refDistance=Ga,this.pannerNode.maxDistance=Ha,
this.pannerNode.rolloffFactor=Ia),this.gainNode.disconnect(),this.gainNode.connect(this.pannerNode),this.pannerNode.connect(e(this.tag)),this.pannerEnabled=!0):this.pannerEnabled&&!w&&this.gainNode&&(this.pannerNode.disconnect(),this.gainNode.disconnect(),this.gainNode.connect(e(this.tag)),this.pannerEnabled=!1))};g.prototype.setPan=function(w,I,O,P,aa,ca){this.pannerEnabled&&1===B&&(this.pannerNode.setPosition(w,I,0),this.pannerNode.setOrientation(Math.cos(cr.to_radians(O)),Math.sin(cr.to_radians(O)),
0),this.pannerNode.coneInnerAngle=P,this.pannerNode.coneOuterAngle=aa,this.pannerNode.coneOuterGain=ca,this.panX=w,this.panY=I,this.panAngle=O,this.panConeInner=P,this.panConeOuter=aa,this.panConeOuterGain=ca)};g.prototype.setObject=function(w){this.pannerEnabled&&1===B&&(this.objectTracker||(this.objectTracker=new n),this.objectTracker.setObject(w))};g.prototype.tick=function(w){if(this.pannerEnabled&&1===B&&this.objectTracker&&this.objectTracker.hasObject()&&this.isPlaying()){this.objectTracker.tick(w);
w=this.objectTracker.obj;var I=cr.rotatePtAround(w.x,w.y,-w.layer.getAngle(),da,ia,!0),O=cr.rotatePtAround(w.x,w.y,-w.layer.getAngle(),da,ia,!1);this.pannerNode.setPosition(I,O,0);"undefined"!==typeof this.objectTracker.obj.angle&&(w=w.angle-w.layer.getAngle(),this.pannerNode.setOrientation(Math.cos(w),Math.sin(w),0))}};g.prototype.play=function(w,I,O,P){var aa=this.instanceObject;this.looping=w;this.volume=I;O=O||0;P=P||0;switch(this.myapi){case 0:1!==aa.playbackRate&&(aa.playbackRate=1);aa.volume!==
I*Z&&(aa.volume=I*Z);aa.loop!==w&&(aa.loop=w);aa.muted&&(aa.muted=!1);if(aa.currentTime!==O)try{aa.currentTime=O}catch(ca){}d(this);break;case 1:this.muted=!1;this.mutevol=1;if(1===this.buffer.myapi)this.gainNode.gain.value=I*Z,this.fresh||(this.instanceObject=L.createBufferSource(),this.instanceObject.buffer=this.buffer.bufferObject,this.instanceObject.connect(this.gainNode)),this.instanceObject.onended=this.onended_handler,this.active_buffer=this.instanceObject,this.instanceObject.loop=w,this.hasPlaybackEnded=
!1,0===O?m(this.instanceObject,P):u(this.instanceObject,O,this.getDuration(),P);else{1!==aa.playbackRate&&(aa.playbackRate=1);aa.loop!==w&&(aa.loop=w);aa.volume=I*Z;if(aa.currentTime!==O)try{aa.currentTime=O}catch(ca){}d(this)}break;case 2:(!this.fresh&&this.stopped||0!==O)&&aa.seekTo(O),aa.play(),this.hasPlaybackEnded=!1}this.playbackRate=1;this.startTime=(this.isTimescaled?k.kahanTime.sum:k.wallTime.sum)-O;this.is_paused=this.stopped=this.fresh=!1};g.prototype.stop=function(){switch(this.myapi){case 0:this.instanceObject.paused||
this.instanceObject.pause();break;case 1:1===this.buffer.myapi?p(this.instanceObject):this.instanceObject.paused||this.instanceObject.pause();break;case 2:this.instanceObject.stop()}this.stopped=!0;this.is_paused=!1};g.prototype.pause=function(){if(!(this.fresh||this.stopped||this.hasEnded()||this.is_paused)){switch(this.myapi){case 0:this.instanceObject.paused||this.instanceObject.pause();break;case 1:1===this.buffer.myapi?(this.resume_position=this.getPlaybackTime(!0),this.looping&&(this.resume_position%=
this.getDuration()),this.is_paused=!0,p(this.instanceObject)):this.instanceObject.paused||this.instanceObject.pause();break;case 2:this.instanceObject.pause()}this.is_paused=!0}};g.prototype.resume=function(){if(!(this.fresh||this.stopped||this.hasEnded())&&this.is_paused){switch(this.myapi){case 0:d(this);break;case 1:1===this.buffer.myapi?(this.instanceObject=L.createBufferSource(),this.instanceObject.buffer=this.buffer.bufferObject,this.instanceObject.connect(this.gainNode),this.instanceObject.onended=
this.onended_handler,this.active_buffer=this.instanceObject,this.instanceObject.loop=this.looping,this.gainNode.gain.value=Z*this.volume*this.mutevol,this.updatePlaybackRate(),this.startTime=(this.isTimescaled?k.kahanTime.sum:k.wallTime.sum)-this.resume_position/(this.playbackRate||.001),u(this.instanceObject,this.resume_position,this.getDuration())):d(this);break;case 2:this.instanceObject.play()}this.is_paused=!1}};g.prototype.seek=function(w){if(!(this.fresh||this.stopped||this.hasEnded()))switch(this.myapi){case 0:try{this.instanceObject.currentTime=
w}catch(I){}break;case 1:if(1===this.buffer.myapi)this.is_paused?this.resume_position=w:(this.pause(),this.resume_position=w,this.resume());else try{this.instanceObject.currentTime=w}catch(I){}}};g.prototype.reconnect=function(w){1===this.myapi&&(this.pannerEnabled?(this.pannerNode.disconnect(),this.pannerNode.connect(w)):(this.gainNode.disconnect(),this.gainNode.connect(w)))};g.prototype.getDuration=function(w){var I=0;switch(this.myapi){case 0:"undefined"!==typeof this.instanceObject.duration&&
(I=this.instanceObject.duration);break;case 1:I=this.buffer.bufferObject.duration;break;case 2:I=this.instanceObject.getDuration()}w&&(I/=this.playbackRate||.001);return I};g.prototype.getPlaybackTime=function(w){var I=this.getDuration(),O=0;switch(this.myapi){case 0:"undefined"!==typeof this.instanceObject.currentTime&&(O=this.instanceObject.currentTime);break;case 1:if(1===this.buffer.myapi){if(this.is_paused)return this.resume_position;O=(this.isTimescaled?k.kahanTime.sum:k.wallTime.sum)-this.startTime}else"undefined"!==
typeof this.instanceObject.currentTime&&(O=this.instanceObject.currentTime)}w&&(O*=this.playbackRate);!this.looping&&O>I&&(O=I);return O};g.prototype.isPlaying=function(){return!this.is_paused&&!this.fresh&&!this.stopped&&!this.hasEnded()};g.prototype.shouldSave=function(){return!this.fresh&&!this.stopped&&!this.hasEnded()};g.prototype.setVolume=function(w){this.volume=w;this.updateVolume()};g.prototype.updateVolume=function(){var w=this.volume*Z;isFinite(w)||(w=0);switch(this.myapi){case 0:"undefined"!==
typeof this.instanceObject.volume&&this.instanceObject.volume!==w&&(this.instanceObject.volume=w);break;case 1:1===this.buffer.myapi?this.gainNode.gain.value=w*this.mutevol:"undefined"!==typeof this.instanceObject.volume&&this.instanceObject.volume!==w&&(this.instanceObject.volume=w)}};g.prototype.getVolume=function(){return this.volume};g.prototype.doSetMuted=function(w){switch(this.myapi){case 0:this.instanceObject.muted!==!!w&&(this.instanceObject.muted=!!w);break;case 1:1===this.buffer.myapi?
(this.mutevol=w?0:1,this.gainNode.gain.value=Z*this.volume*this.mutevol):this.instanceObject.muted!==!!w&&(this.instanceObject.muted=!!w)}};g.prototype.setMuted=function(w){this.is_muted=!!w;this.doSetMuted(this.is_muted||this.is_silent)};g.prototype.setSilent=function(w){this.is_silent=!!w;this.doSetMuted(this.is_muted||this.is_silent)};g.prototype.setLooping=function(w){this.looping=w;switch(this.myapi){case 0:this.instanceObject.loop!==!!w&&(this.instanceObject.loop=!!w);break;case 1:this.instanceObject.loop!==
!!w&&(this.instanceObject.loop=!!w)}};g.prototype.setPlaybackRate=function(w){this.playbackRate=w;this.updatePlaybackRate()};g.prototype.getPlaybackRate=function(w){return this.playbackRate};g.prototype.updatePlaybackRate=function(){var w=this.playbackRate;this.isTimescaled&&(w*=k.timescale);switch(this.myapi){case 0:this.instanceObject.playbackRate!==w&&(this.instanceObject.playbackRate=w);break;case 1:1===this.buffer.myapi?this.instanceObject.playbackRate.value!==w&&(this.instanceObject.playbackRate.value=
w):this.instanceObject.playbackRate!==w&&(this.instanceObject.playbackRate=w)}};g.prototype.setSuspended=function(w){switch(this.myapi){case 0:w?this.isPlaying()?(this.resume_me=!0,this.instanceObject.pause()):this.resume_me=!1:this.resume_me&&(this.instanceObject.play(),this.resume_me=!1);break;case 1:w?this.isPlaying()?(this.resume_me=!0,1===this.buffer.myapi?(this.resume_position=this.getPlaybackTime(!0),this.looping&&(this.resume_position%=this.getDuration()),p(this.instanceObject)):this.instanceObject.pause()):
this.resume_me=!1:this.resume_me&&(1===this.buffer.myapi?(this.instanceObject=L.createBufferSource(),this.instanceObject.buffer=this.buffer.bufferObject,this.instanceObject.connect(this.gainNode),this.instanceObject.onended=this.onended_handler,this.active_buffer=this.instanceObject,this.instanceObject.loop=this.looping,this.gainNode.gain.value=Z*this.volume*this.mutevol,this.updatePlaybackRate(),this.startTime=(this.isTimescaled?k.kahanTime.sum:k.wallTime.sum)-this.resume_position/(this.playbackRate||
.001),u(this.instanceObject,this.resume_position,this.getDuration())):this.instanceObject.play(),this.resume_me=!1);break;case 2:w?this.isPlaying()?(this.instanceObject.pause(),this.resume_me=!0):this.resume_me=!1:this.resume_me&&(this.resume_me=!1,this.instanceObject.play())}};ha.Instance=function(w){this.type=w;k=this.runtime=w.runtime;r=this;this.listenerTracker=null;this.listenerZ=-600;this.runtime.isWKWebView&&(ya=!0);!(this.runtime.isiOS||this.runtime.isAndroid&&(this.runtime.isChrome||this.runtime.isAndroidStockBrowser))||
this.runtime.isCrosswalk||this.runtime.isAmazonWebApp||ya||(Ca=!0);L=null;"undefined"!==typeof AudioContext?(B=1,L=new AudioContext):"undefined"!==typeof webkitAudioContext&&(B=1,L=new webkitAudioContext);this.runtime.isiOS&&L&&(L.close&&L.close(),"undefined"!==typeof AudioContext?L=new AudioContext:"undefined"!==typeof webkitAudioContext&&(L=new webkitAudioContext));1!==B&&this.runtime.isCordova&&"undefined"!==typeof window.Media&&(B=2);2===B&&(H=location.href,w=H.lastIndexOf("/"),-1<w&&(H=H.substr(0,
w+1)),H=H.replace("file://",""));this.runtime.tickMe(this)};var ra=ha.Instance.prototype;ra.onCreate=function(){this.runtime.audioInstance=this;fa=this.properties[0];this.saveload=this.properties[1];this.playinbackground=this.properties[2];this.nextPlayTime=0;qa=this.properties[4];Ba=this.properties[5];this.listenerZ=-this.properties[6];Ga=this.properties[7];Ha=this.properties[8];Ia=this.properties[9];this.listenerTracker=new n;var w=this.runtime.draw_width||this.runtime.width,I=this.runtime.draw_height||
this.runtime.height;1===B&&(L.listener.setPosition(w/2,I/2,this.listenerZ),L.listener.setOrientation(0,0,1,0,-1,0),window.c2OnAudioMicStream=function(P,aa){ua&&ua.disconnect();Aa=aa.toLowerCase();ua=L.createMediaStreamSource(P);ua.connect(e(Aa))});this.runtime.addSuspendCallback(function(P){r.onSuspend(P)});var O=this;this.runtime.addDestroyCallback(function(P){O.onInstanceDestroyed(P)})};ra.onInstanceDestroyed=function(w){var I;var O=0;for(I=R.length;O<I;O++){var P=R[O];P.objectTracker&&P.objectTracker.obj===
w&&(P.objectTracker.obj=null,P.pannerEnabled&&P.isPlaying()&&P.looping&&P.stop())}this.listenerTracker.obj===w&&(this.listenerTracker.obj=null)};ra.saveToJSON=function(){var w={silent:ba,masterVolume:Z,listenerZ:this.listenerZ,listenerUid:this.listenerTracker.hasObject()?this.listenerTracker.obj.uid:-1,playing:[],effects:{}},I=w.playing,O,P;var aa=0;for(O=R.length;aa<O;aa++){var ca=R[aa];if(ca.shouldSave()&&3!==this.saveload&&(!ca.is_music||1!==this.saveload)&&(ca.is_music||2!==this.saveload)){var la=
ca.getPlaybackTime();ca.looping&&(la%=ca.getDuration());la={tag:ca.tag,buffersrc:ca.buffer.src,buffertype:ca.buffer.type,is_music:ca.is_music,playbackTime:la,volume:ca.volume,looping:ca.looping,muted:ca.is_muted,playbackRate:ca.playbackRate,paused:ca.is_paused,resume_position:ca.resume_position};if(ca.pannerEnabled){la.pan={};var ma=la.pan;ca.objectTracker&&ca.objectTracker.hasObject()?ma.objUid=ca.objectTracker.obj.uid:(ma.x=ca.panX,ma.y=ca.panY,ma.a=ca.panAngle);ma.ia=ca.panConeInner;ma.oa=ca.panConeOuter;
ma.og=ca.panConeOuterGain}I.push(la)}}I=w.effects;for(P in oa)if(oa.hasOwnProperty(P)){ca=[];aa=0;for(O=oa[P].length;aa<O;aa++)ca.push({type:oa[P][aa].type,params:oa[P][aa].params});I[P]=ca}return w};var va=[];ra.loadFromJSON=function(w){var I=w.silent;Z=w.masterVolume;this.listenerZ=w.listenerZ;this.listenerTracker.setObject(null);var O=w.listenerUid;-1!==O&&(this.listenerTracker.loadUid=O,va.push(this.listenerTracker));O=w.playing;var P;if(3!==this.saveload){var aa=0;for(P=R.length;aa<P;aa++){var ca=
R[aa];ca.is_music&&1===this.saveload||(ca.is_music||2!==this.saveload)&&ca.stop()}}for(pa in oa)if(oa.hasOwnProperty(pa))for(aa=0,P=oa[pa].length;aa<P;aa++)oa[pa][aa].remove();cr.wipe(oa);for(pa in w.effects)if(w.effects.hasOwnProperty(pa)){var la=w.effects[pa];aa=0;for(P=la.length;aa<P;aa++){var ma=la[aa].type;var ja=la[aa].params;switch(ma){case "filter":U(pa,new M(ja[0],ja[1],ja[2],ja[3],ja[4],ja[5]));break;case "delay":U(pa,new v(ja[0],ja[1],ja[2]));break;case "convolve":ma=ja[2];ca=this.getAudioBuffer(ma,
!1);ca.bufferObject?ma=new F(ca.bufferObject,ja[0],ja[1],ma):(ma=new F(null,ja[0],ja[1],ma),ca.normalizeWhenReady=ja[0],ca.convolveWhenReady=ma);U(pa,ma);break;case "flanger":U(pa,new C(ja[0],ja[1],ja[2],ja[3],ja[4]));break;case "phaser":U(pa,new l(ja[0],ja[1],ja[2],ja[3],ja[4],ja[5]));break;case "gain":U(pa,new t(ja[0]));break;case "tremolo":U(pa,new D(ja[0],ja[1]));break;case "ringmod":U(pa,new S(ja[0],ja[1]));break;case "distortion":U(pa,new V(ja[0],ja[1],ja[2],ja[3],ja[4]));break;case "compressor":U(pa,
new K(ja[0],ja[1],ja[2],ja[3],ja[4]));break;case "analyser":U(pa,new f(ja[0],ja[1]))}}}aa=0;for(P=O.length;aa<P;aa++)if(3!==this.saveload){w=O[aa];ma=w.buffersrc;ca=w.buffertype||"";var sa=w.is_music;var pa=w.tag;la=w.playbackTime;var Ja=w.looping;var Ka=w.volume;var za=(ja=w.pan)&&ja.hasOwnProperty("objUid")?ja.objUid:-1;if(!sa||1!==this.saveload)if(sa||2!==this.saveload)(ca=this.getAudioInstance({url:ma,type:ca},pa,sa,Ja,Ka))?(ca.resume_position=w.resume_position,ca.setPannerEnabled(!!ja),ca.play(Ja,
Ka,la),ca.updatePlaybackRate(),ca.updateVolume(),ca.doSetMuted(ca.is_muted||ca.is_silent),w.paused&&ca.pause(),w.muted&&ca.setMuted(!0),ca.doSetMuted(ca.is_muted||ca.is_silent),ja&&(-1!==za?(ca.objectTracker=ca.objectTracker||new n,ca.objectTracker.loadUid=za,va.push(ca.objectTracker)):ca.setPan(ja.x,ja.y,ja.a,ja.ia,ja.oa,ja.og))):(ca=this.getAudioBuffer({url:ma,type:""},sa),ca.seekWhenReady=la,ca.pauseWhenReady=w.paused,ja&&(-1!==za?ca.panWhenReady.push({objUid:za,ia:ja.ia,oa:ja.oa,og:ja.og,thistag:pa}):
ca.panWhenReady.push({x:ja.x,y:ja.y,a:ja.a,ia:ja.ia,oa:ja.oa,og:ja.og,thistag:pa})))}if(I&&!ba){aa=0;for(P=R.length;aa<P;aa++)R[aa].setSilent(!0);ba=!0}else if(!I&&ba){aa=0;for(P=R.length;aa<P;aa++)R[aa].setSilent(!1);ba=!1}};ra.afterLoad=function(){var w;var I=0;for(w=va.length;I<w;I++){var O=va[I];var P=this.runtime.getObjectByUID(O.loadUid);O.setObject(P);O.loadUid=-1;P&&(da=P.x,ia=P.y)}cr.clearArray(va)};ra.onSuspend=function(w){if(!this.playinbackground){!w&&L&&L.resume&&(L.resume(),ka=!1);var I;
var O=0;for(I=R.length;O<I;O++)R[O].setSuspended(w);w&&L&&L.suspend&&(L.suspend(),ka=!0)}};ra.tick=function(){var w=this.runtime.dt,I;var O=0;for(I=R.length;O<I;O++){var P=R[O];P.tick(w);0!==fa&&P.updatePlaybackRate()}var aa;for(aa in oa)if(oa.hasOwnProperty(aa))for(P=oa[aa],O=0,I=P.length;O<I;O++){var ca=P[O];ca.tick&&ca.tick()}1===B&&this.listenerTracker.hasObject()&&(this.listenerTracker.tick(w),da=this.listenerTracker.obj.x,ia=this.listenerTracker.obj.y,L.listener.setPosition(this.listenerTracker.obj.x,
this.listenerTracker.obj.y,this.listenerZ))};var wa=[];ra.setPreloadList=function(w){var I,O=0;var P=0;for(I=w.length;P<I;++P){var aa=w[P];var ca=2*aa.size;wa.push({filename:aa.filename,size:ca,type:aa.type,obj:null});O+=ca}return O};ra.startPreloads=function(){var w;var I=0;for(w=wa.length;I<w;++I){var O=wa[I];var P=this.runtime.getProjectFileUrl(O.filename);O.obj=this.getAudioBuffer({url:P,type:O.type},!1)}};ra.getPreloadedSize=function(){var w=0,I;var O=0;for(I=wa.length;O<I;++O){var P=wa[O];P.obj.isLoadedAndDecoded()||
P.obj.hasFailedToLoad()||this.runtime.isAndroidStockBrowser?w+=P.size:P.obj.isLoaded()&&(w+=Math.floor(P.size/2))}return w};ra.releaseAllMusicBuffers=function(){var w,I;var O=w=0;for(I=Q.length;w<I;++w){var P=Q[w];Q[O]=P;P.is_music?P.release():++O}Q.length=O};ra.getAudioBuffer=function(w,I,O){var P,aa=null,ca=w.url;var la=0;for(P=Q.length;la<P;la++){var ma=Q[la];if(ma.src===ca){aa=ma;break}}aa||O||((ya||Fa)&&I&&this.releaseAllMusicBuffers(),aa=new G(ca,w.type,I),Q.push(aa));return aa};ra.getAudioInstance=
function(w,I,O,P,aa){var ca,la=w.url;var ma=0;for(ca=R.length;ma<ca;ma++){var ja=R[ma];if(ja.src===la&&(ja.canBeRecycled()||O))return ja.tag=I,ja}w=this.getAudioBuffer(w,O);if(!w.bufferObject)return"<preload>"!==I&&(w.playTagWhenReady=I,w.loopWhenReady=P,w.volumeWhenReady=aa),null;ja=new g(w,I);R.push(ja);return ja};var na=[];W.prototype.OnEnded=function(w){return cr.equals_nocase(E,w)};W.prototype.PreloadsComplete=function(){var w;var I=0;for(w=Q.length;I<w;I++)if(!Q[I].isLoadedAndDecoded()&&!Q[I].hasFailedToLoad())return!1;
return!0};W.prototype.AdvancedAudioSupported=function(){return 1===B};W.prototype.IsSilent=function(){return ba};W.prototype.IsAnyPlaying=function(){var w;var I=0;for(w=R.length;I<w;I++)if(R[I].isPlaying())return!0;return!1};W.prototype.IsTagPlaying=function(w){J(w);var I;w=0;for(I=na.length;w<I;w++)if(na[w].isPlaying())return!0;return!1};ha.cnds=new W;X.prototype.Play=function(w,I,O,P){if(!ba){O=y(O);var aa=w[1];if(w=this.runtime.getProjectAudioFileUrl(w[0]))if(T=this.getAudioInstance(w,P,aa,0!==
I,O))T.setPannerEnabled(!1),T.play(0!==I,O,0,this.nextPlayTime),this.nextPlayTime=0}};X.prototype.PlayAtPosition=function(w,I,O,P,aa,ca,la,ma,ja,sa){if(!ba){O=y(O);var pa=w[1];if(w=this.runtime.getProjectAudioFileUrl(w[0]))(T=this.getAudioInstance(w,sa,pa,0!==I,O))?(T.setPannerEnabled(!0),T.setPan(P,aa,ca,la,ma,y(ja)),T.play(0!==I,O,0,this.nextPlayTime),this.nextPlayTime=0):this.getAudioBuffer(w,pa).panWhenReady.push({x:P,y:aa,a:ca,ia:la,oa:ma,og:y(ja),thistag:sa})}};X.prototype.PlayAtObject=function(w,
I,O,P,aa,ca,la,ma){if(!ba&&P&&(P=P.getFirstPicked())){O=y(O);var ja=w[1];if(w=this.runtime.getProjectAudioFileUrl(w[0]))(T=this.getAudioInstance(w,ma,ja,0!==I,O))?(T.setPannerEnabled(!0),ma=cr.rotatePtAround(P.x,P.y,-P.layer.getAngle(),da,ia,!0),w=cr.rotatePtAround(P.x,P.y,-P.layer.getAngle(),da,ia,!1),T.setPan(ma,w,cr.to_degrees(P.angle-P.layer.getAngle()),aa,ca,y(la)),T.setObject(P),T.play(0!==I,O,0,this.nextPlayTime),this.nextPlayTime=0):this.getAudioBuffer(w,ja).panWhenReady.push({obj:P,ia:aa,
oa:ca,og:y(la),thistag:ma})}};X.prototype.PlayByName=function(w,I,O,P,aa){!ba&&(P=y(P),w=1===w,I=this.runtime.getProjectAudioFileUrl(I))&&(T=this.getAudioInstance(I,aa,w,0!==O,P))&&(T.setPannerEnabled(!1),T.play(0!==O,P,0,this.nextPlayTime),this.nextPlayTime=0)};X.prototype.PlayAtPositionByName=function(w,I,O,P,aa,ca,la,ma,ja,sa,pa){!ba&&(P=y(P),w=1===w,I=this.runtime.getProjectAudioFileUrl(I))&&((T=this.getAudioInstance(I,pa,w,0!==O,P))?(T.setPannerEnabled(!0),T.setPan(aa,ca,la,ma,ja,y(sa)),T.play(0!==
O,P,0,this.nextPlayTime),this.nextPlayTime=0):this.getAudioBuffer(I,w).panWhenReady.push({x:aa,y:ca,a:la,ia:ma,oa:ja,og:y(sa),thistag:pa}))};X.prototype.PlayAtObjectByName=function(w,I,O,P,aa,ca,la,ma,ja){!ba&&aa&&(aa=aa.getFirstPicked())&&(P=y(P),w=1===w,I=this.runtime.getProjectAudioFileUrl(I))&&((T=this.getAudioInstance(I,ja,w,0!==O,P))?(T.setPannerEnabled(!0),ja=cr.rotatePtAround(aa.x,aa.y,-aa.layer.getAngle(),da,ia,!0),I=cr.rotatePtAround(aa.x,aa.y,-aa.layer.getAngle(),da,ia,!1),T.setPan(ja,
I,cr.to_degrees(aa.angle-aa.layer.getAngle()),ca,la,y(ma)),T.setObject(aa),T.play(0!==O,P,0,this.nextPlayTime),this.nextPlayTime=0):this.getAudioBuffer(I,w).panWhenReady.push({obj:aa,ia:ca,oa:la,og:y(ma),thistag:ja}))};X.prototype.SetLooping=function(w,I){J(w);var O;w=0;for(O=na.length;w<O;w++)na[w].setLooping(0===I)};X.prototype.SetMuted=function(w,I){J(w);var O;w=0;for(O=na.length;w<O;w++)na[w].setMuted(0===I)};X.prototype.SetVolume=function(w,I){J(w);w=y(I);var O;I=0;for(O=na.length;I<O;I++)na[I].setVolume(w)};
X.prototype.Preload=function(w){if(!ba){var I=w[1];(w=this.runtime.getProjectAudioFileUrl(w[0]))&&2!==B&&this.getAudioInstance(w,"<preload>",I,!1)}};X.prototype.PreloadByName=function(w,I){ba||(w=1===w,(I=this.runtime.getProjectAudioFileUrl(I))&&2!==B&&this.getAudioInstance(I,"<preload>",w,!1))};X.prototype.SetPlaybackRate=function(w,I){J(w);0>I&&(I=0);var O;w=0;for(O=na.length;w<O;w++)na[w].setPlaybackRate(I)};X.prototype.Stop=function(w){J(w);var I;w=0;for(I=na.length;w<I;w++)na[w].stop()};X.prototype.StopAll=
function(){var w;var I=0;for(w=R.length;I<w;I++)R[I].stop()};X.prototype.SetPaused=function(w,I){J(w);var O;w=0;for(O=na.length;w<O;w++)0===I?na[w].pause():na[w].resume()};X.prototype.Seek=function(w,I){J(w);var O;w=0;for(O=na.length;w<O;w++)na[w].seek(I)};X.prototype.SetSilent=function(w){var I;2===w&&(w=ba?1:0);if(0===w&&!ba){w=0;for(I=R.length;w<I;w++)R[w].setSilent(!0);ba=!0}else if(1===w&&ba){w=0;for(I=R.length;w<I;w++)R[w].setSilent(!1);ba=!1}};X.prototype.SetMasterVolume=function(w){Z=y(w);
var I;w=0;for(I=R.length;w<I;w++)R[w].updateVolume()};X.prototype.AddFilterEffect=function(w,I,O,P,aa,ca,la){1!==B||0>I||I>=Ea.length||!L.createBiquadFilter||(w=w.toLowerCase(),la/=100,0>la&&(la=0),1<la&&(la=1),U(w,new M(I,O,P,aa,ca,la)))};X.prototype.AddDelayEffect=function(w,I,O,P){1===B&&(w=w.toLowerCase(),P/=100,0>P&&(P=0),1<P&&(P=1),U(w,new v(I,y(O),P)))};X.prototype.AddFlangerEffect=function(w,I,O,P,aa,ca){1===B&&L.createOscillator&&(w=w.toLowerCase(),ca/=100,0>ca&&(ca=0),1<ca&&(ca=1),U(w,new C(I/
1E3,O/1E3,P,aa/100,ca)))};X.prototype.AddPhaserEffect=function(w,I,O,P,aa,ca,la){1===B&&L.createOscillator&&(w=w.toLowerCase(),la/=100,0>la&&(la=0),1<la&&(la=1),U(w,new l(I,O,P,aa,ca,la)))};X.prototype.AddConvolutionEffect=function(w,I,O,P){if(1===B&&L.createConvolver){O=0===O;var aa=this.runtime.getProjectAudioFileUrl(I[0]);aa&&(I=this.getAudioBuffer(aa,!1),w=w.toLowerCase(),P/=100,0>P&&(P=0),1<P&&(P=1),I.bufferObject?P=new F(I.bufferObject,O,P,aa.url):(P=new F(null,O,P,aa.url),I.normalizeWhenReady=
O,I.convolveWhenReady=P),U(w,P))}};X.prototype.AddGainEffect=function(w,I){1===B&&(w=w.toLowerCase(),U(w,new t(y(I))))};X.prototype.AddMuteEffect=function(w){1===B&&(w=w.toLowerCase(),U(w,new t(0)))};X.prototype.AddTremoloEffect=function(w,I,O){1===B&&L.createOscillator&&(w=w.toLowerCase(),O/=100,0>O&&(O=0),1<O&&(O=1),U(w,new D(I,O)))};X.prototype.AddRingModEffect=function(w,I,O){1===B&&L.createOscillator&&(w=w.toLowerCase(),O/=100,0>O&&(O=0),1<O&&(O=1),U(w,new S(I,O)))};X.prototype.AddDistortionEffect=
function(w,I,O,P,aa,ca){1===B&&L.createWaveShaper&&(w=w.toLowerCase(),ca/=100,0>ca&&(ca=0),1<ca&&(ca=1),U(w,new V(I,O,P,aa,ca)))};X.prototype.AddCompressorEffect=function(w,I,O,P,aa,ca){1===B&&L.createDynamicsCompressor&&(w=w.toLowerCase(),U(w,new K(I,O,P,aa/1E3,ca/1E3)))};X.prototype.AddAnalyserEffect=function(w,I,O){1===B&&(w=w.toLowerCase(),U(w,new f(I,O)))};X.prototype.RemoveEffects=function(w){if(1===B){w=w.toLowerCase();var I;if(oa.hasOwnProperty(w)){var O=oa[w];if(O.length){var P=0;for(I=O.length;P<
I;P++)O[P].remove();cr.clearArray(O);N(w)}}}};X.prototype.SetEffectParameter=function(w,I,O,P,aa,ca){1===B&&(w=w.toLowerCase(),I=Math.floor(I),oa.hasOwnProperty(w)&&(w=oa[w],0>I||I>=w.length||w[I].setParam(O,P,aa,ca)))};X.prototype.SetListenerObject=function(w){w&&1===B&&(w=w.getFirstPicked())&&(this.listenerTracker.setObject(w),da=w.x,ia=w.y)};X.prototype.SetListenerZ=function(w){this.listenerZ=w};X.prototype.ScheduleNextPlay=function(w){L&&(this.nextPlayTime=w)};X.prototype.UnloadAudio=function(w){var I=
w[1];if(w=this.runtime.getProjectAudioFileUrl(w[0]))if(I=this.getAudioBuffer(w,I,!0))I.release(),cr.arrayFindRemove(Q,I)};X.prototype.UnloadAudioByName=function(w,I){w=1===w;if(I=this.runtime.getProjectAudioFileUrl(I))if(I=this.getAudioBuffer(I,w,!0))I.release(),cr.arrayFindRemove(Q,I)};X.prototype.UnloadAll=function(){var w;var I=0;for(w=Q.length;I<w;++I)Q[I].release();cr.clearArray(Q)};ha.acts=new X;Y.prototype.Duration=function(w,I){J(I,!0);na.length?w.set_float(na[0].getDuration()):w.set_float(0)};
Y.prototype.PlaybackTime=function(w,I){J(I,!0);na.length?w.set_float(na[0].getPlaybackTime(!0)):w.set_float(0)};Y.prototype.PlaybackRate=function(w,I){J(I,!0);na.length?w.set_float(na[0].getPlaybackRate()):w.set_float(0)};Y.prototype.Volume=function(w,I){J(I,!0);na.length?(I=na[0].getVolume(),w.set_float(A(I))):w.set_float(0)};Y.prototype.MasterVolume=function(w){w.set_float(A(Z))};Y.prototype.EffectCount=function(w,I){I=I.toLowerCase();var O=null;oa.hasOwnProperty(I)&&(O=oa[I]);w.set_int(O?O.length:
0)};Y.prototype.AnalyserFreqBinCount=function(w,I,O){I=I.toLowerCase();O=Math.floor(O);I=ea(I,O);w.set_int(I?I.node.frequencyBinCount:0)};Y.prototype.AnalyserFreqBinAt=function(w,I,O,P){I=I.toLowerCase();O=Math.floor(O);P=Math.floor(P);(I=ea(I,O))?0>P||P>=I.node.frequencyBinCount?w.set_float(0):w.set_float(I.freqBins[P]):w.set_float(0)};Y.prototype.AnalyserPeakLevel=function(w,I,O){I=I.toLowerCase();O=Math.floor(O);(I=ea(I,O))?w.set_float(I.peak):w.set_float(0)};Y.prototype.AnalyserRMSLevel=function(w,
I,O){I=I.toLowerCase();O=Math.floor(O);(I=ea(I,O))?w.set_float(I.rms):w.set_float(0)};Y.prototype.SampleRate=function(w){w.set_int(L?L.sampleRate:0)};Y.prototype.CurrentTime=function(w){w.set_float(L?L.currentTime:cr.performance_now())};ha.exps=new Y})();cr.plugins_.Browser=function(b){this.runtime=b};
(function(){function b(){c&&m&&window.OfflineClientInfo&&window.OfflineClientInfo.SetMessageCallback(function(C){u.onSWMessage(C)})}function d(){if(!x&&navigator.getBattery){var C=navigator.getBattery();x=!0;C&&C.then(function(l){p=l})}}function h(){}function q(){}function y(C){console&&console.warn&&console.warn("Fullscreen request failed: ",C);v.setSize(window.innerWidth,window.innerHeight)}function A(){}var e=cr.plugins_.Browser.prototype;e.Type=function(C){this.plugin=C;this.runtime=C.runtime};
var a=e.Type.prototype;a.onCreate=function(){};var c=!1,m=!1;document.addEventListener("DOMContentLoaded",function(){if(window.C3_RegisterSW&&navigator.serviceWorker){var C=document.createElement("script");C.onload=function(){c=!0;b()};C.src="offlineclient.js";document.head.appendChild(C)}});var u=null;a.onAppBegin=function(){m=!0;b()};e.Instance=function(C){this.type=C;this.runtime=C.runtime};a=e.Instance.prototype;a.onCreate=function(){var C=this;window.addEventListener("resize",function(){C.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnResize,
C)});u=this;"undefined"!==typeof navigator.onLine&&(window.addEventListener("online",function(){C.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOnline,C)}),window.addEventListener("offline",function(){C.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOffline,C)}));document.addEventListener("backbutton",function(){C.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,C)});document.addEventListener("menubutton",function(){C.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnMenuButton,
C)});document.addEventListener("searchbutton",function(){C.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnSearchButton,C)});document.addEventListener("tizenhwkey",function(l){switch(l.keyName){case "back":var t=C.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,C);!t&&window.tizen&&window.tizen.application.getCurrentApplication().exit();break;case "menu":(t=C.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnMenuButton,C))||l.preventDefault()}});this.runtime.isWindows10&&"undefined"!==
typeof Windows?Windows.UI.Core.SystemNavigationManager.getForCurrentView().addEventListener("backrequested",function(l){C.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,C)&&(l.handled=!0)}):this.runtime.isWinJS&&WinJS.Application&&(WinJS.Application.onbackclick=function(l){return!!C.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,C)});this.runtime.addSuspendCallback(function(l){l?C.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnPageHidden,C):C.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnPageVisible,
C)});this.is_arcade="undefined"!==typeof window.is_scirra_arcade};a.onSWMessage=function(C){C=C.data.type;"downloading-update"===C?this.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnUpdateFound,this):"update-ready"===C||"update-pending"===C?this.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnUpdateReady,this):"offline-ready"===C&&this.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOfflineReady,this)};var p=null,x=!1;h.prototype.CookiesEnabled=function(){return navigator?navigator.cookieEnabled:
!1};h.prototype.IsOnline=function(){return navigator?navigator.onLine:!1};h.prototype.HasJava=function(){return navigator?navigator.javaEnabled():!1};h.prototype.OnOnline=function(){return!0};h.prototype.OnOffline=function(){return!0};h.prototype.IsDownloadingUpdate=function(){return!1};h.prototype.PageVisible=function(){return!this.runtime.isSuspended};h.prototype.OnPageVisible=function(){return!0};h.prototype.OnPageHidden=function(){return!0};h.prototype.OnResize=function(){return!0};h.prototype.IsFullscreen=
function(){return!!(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen)};h.prototype.OnBackButton=function(){return!0};h.prototype.OnMenuButton=function(){return!0};h.prototype.OnSearchButton=function(){return!0};h.prototype.IsMetered=function(){var C=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return C?!!C.metered:!1};h.prototype.IsCharging=function(){var C=navigator.battery||navigator.mozBattery||navigator.webkitBattery;if(C)return!!C.charging;
d();return p?!!p.charging:!0};h.prototype.IsPortraitLandscape=function(C){return(window.innerWidth<=window.innerHeight?0:1)===C};h.prototype.SupportsFullscreen=function(){if(this.runtime.isNWjs)return!0;var C=this.runtime.canvas;return!!(C.requestFullscreen||C.mozRequestFullScreen||C.msRequestFullscreen||C.webkitRequestFullScreen)};h.prototype.OnUpdateFound=function(){return!0};h.prototype.OnUpdateReady=function(){return!0};h.prototype.OnOfflineReady=function(){return!0};e.cnds=new h;q.prototype.Alert=
function(C){alert(C.toString())};q.prototype.Close=function(){window.tizen?window.tizen.application.getCurrentApplication().exit():navigator.app&&navigator.app.exitApp?navigator.app.exitApp():navigator.device&&navigator.device.exitApp?navigator.device.exitApp():this.is_arcade||window.close()};q.prototype.Focus=function(){this.runtime.isNWjs?nw.Window.get().focus():this.is_arcade||window.focus()};q.prototype.Blur=function(){this.runtime.isNWjs?nw.Window.get().blur():this.is_arcade||window.blur()};
q.prototype.GoBack=function(){navigator.app&&navigator.app.backHistory?navigator.app.backHistory():!this.is_arcade&&window.back&&window.back()};q.prototype.GoForward=function(){!this.is_arcade&&window.forward&&window.forward()};q.prototype.GoHome=function(){!this.is_arcade&&window.home&&window.home()};q.prototype.GoToURL=function(C,l){this.runtime.isWinJS?Windows.System.Launcher.launchUriAsync(new Windows.Foundation.Uri(C)):navigator.app&&navigator.app.loadUrl?navigator.app.loadUrl(C,{openExternal:!0}):
this.runtime.isCordova?window.open(C,"_system"):this.runtime.isPreview?window.open(C,"_blank"):this.is_arcade||(2!==l||this.is_arcade?1!==l||this.is_arcade?window.location=C:window.parent.location=C:window.top.location=C)};q.prototype.GoToURLWindow=function(C,l){this.runtime.isWinJS?Windows.System.Launcher.launchUriAsync(new Windows.Foundation.Uri(C)):navigator.app&&navigator.app.loadUrl?navigator.app.loadUrl(C,{openExternal:!0}):this.runtime.isCordova?window.open(C,"_system"):this.is_arcade||window.open(C,
l)};q.prototype.Reload=function(){this.is_arcade||window.location.reload()};var M=!0,v=null;q.prototype.RequestFullScreen=function(C,l){2<=C&&(C+=1);6===C&&(C=2);document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement||document.fullScreen||document.fullScreenElement||(this.runtime.fullscreen_scaling=2<=C?C:0,C={navigationUI:"auto"},1===l?C.navigationUI="hide":2===l&&(C.navigationUI="show"),l=document.documentElement,M&&(M=!1,v=this.runtime,l.addEventListener("mozfullscreenerror",
y),l.addEventListener("webkitfullscreenerror",y),l.addEventListener("MSFullscreenError",y),l.addEventListener("fullscreenerror",y)),l.requestFullscreen?l.requestFullscreen(C):l.mozRequestFullScreen?l.mozRequestFullScreen(C):l.msRequestFullscreen?l.msRequestFullscreen(C):l.webkitRequestFullScreen&&("undefined"!==typeof Element&&"undefined"!==typeof Element.ALLOW_KEYBOARD_INPUT?l.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):l.webkitRequestFullScreen()))};q.prototype.CancelFullScreen=function(){document.exitFullscreen?
document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()};q.prototype.Vibrate=function(C){try{var l=C.split(","),t;var D=0;for(t=l.length;D<t;D++)l[D]=parseInt(l[D],10);navigator.vibrate?navigator.vibrate(l):navigator.mozVibrate?navigator.mozVibrate(l):navigator.webkitVibrate?navigator.webkitVibrate(l):navigator.msVibrate&&navigator.msVibrate(l)}catch(S){}};
q.prototype.InvokeDownload=function(C,l){if(l){var t=document.createElement("a");if("undefined"===typeof t.download)window.open(C);else{var D=document.getElementsByTagName("body")[0];t.textContent=l;t.href=C;t.download=l;D.appendChild(t);C=new MouseEvent("click");t.dispatchEvent(C);D.removeChild(t)}}};q.prototype.InvokeDownloadString=function(C,l,t){if(t){var D="data:"+l+","+encodeURIComponent(C);C=document.createElement("a");"undefined"===typeof C.download?window.open(D):(l=document.getElementsByTagName("body")[0],
C.textContent=t,C.href=D,C.download=t,l.appendChild(C),t=new MouseEvent("click"),C.dispatchEvent(t),l.removeChild(C))}};q.prototype.ConsoleLog=function(C,l){"undefined"!==typeof console&&(0===C&&console.log&&console.log(l.toString()),1===C&&console.warn&&console.warn(l.toString()),2===C&&console.error&&console.error(l.toString()))};q.prototype.ConsoleGroup=function(C){console&&console.group&&console.group(C)};q.prototype.ConsoleGroupEnd=function(){console&&console.groupEnd&&console.groupEnd()};q.prototype.ExecJs=
function(C){try{eval&&eval(C)}catch(l){console&&console.error&&console.error("Error executing Javascript: ",l)}};var F="portrait landscape portrait-primary portrait-secondary landscape-primary landscape-secondary".split(" ");q.prototype.LockOrientation=function(C){C=Math.floor(C);0>C||C>=F.length||(this.runtime.autoLockOrientation=!1,C=F[C],screen.orientation&&screen.orientation.lock?screen.orientation.lock(C):screen.lockOrientation?screen.lockOrientation(C):screen.webkitLockOrientation?screen.webkitLockOrientation(C):
screen.mozLockOrientation?screen.mozLockOrientation(C):screen.msLockOrientation&&screen.msLockOrientation(C))};q.prototype.UnlockOrientation=function(){this.runtime.autoLockOrientation=!1;screen.orientation&&screen.orientation.unlock?screen.orientation.unlock():screen.unlockOrientation?screen.unlockOrientation():screen.webkitUnlockOrientation?screen.webkitUnlockOrientation():screen.mozUnlockOrientation?screen.mozUnlockOrientation():screen.msUnlockOrientation&&screen.msUnlockOrientation()};e.acts=
new q;A.prototype.URL=function(C){C.set_string(window.location.toString())};A.prototype.Protocol=function(C){C.set_string(window.location.protocol)};A.prototype.Domain=function(C){C.set_string(window.location.hostname)};A.prototype.PathName=function(C){C.set_string(window.location.pathname)};A.prototype.Hash=function(C){C.set_string(window.location.hash)};A.prototype.Referrer=function(C){C.set_string(document.referrer)};A.prototype.Title=function(C){C.set_string(document.title)};A.prototype.Name=
function(C){C.set_string(navigator.appName)};A.prototype.Version=function(C){C.set_string(navigator.appVersion)};A.prototype.Language=function(C){navigator&&navigator.language?C.set_string(navigator.language):C.set_string("")};A.prototype.Platform=function(C){C.set_string(navigator.platform)};A.prototype.Product=function(C){navigator&&navigator.product?C.set_string(navigator.product):C.set_string("")};A.prototype.Vendor=function(C){navigator&&navigator.vendor?C.set_string(navigator.vendor):C.set_string("")};
A.prototype.UserAgent=function(C){C.set_string(navigator.userAgent)};A.prototype.QueryString=function(C){C.set_string(window.location.search)};A.prototype.QueryParam=function(C,l){(l=RegExp("[?&]"+l+"=([^&]*)").exec(window.location.search))?C.set_string(decodeURIComponent(l[1].replace(/\+/g," "))):C.set_string("")};A.prototype.Bandwidth=function(C){var l=navigator.connection||navigator.mozConnection||navigator.webkitConnection;l?"undefined"!==typeof l.bandwidth?C.set_float(l.bandwidth):"undefined"!==
typeof l.downlinkMax?C.set_float(l.downlinkMax):C.set_float(Number.POSITIVE_INFINITY):C.set_float(Number.POSITIVE_INFINITY)};A.prototype.ConnectionType=function(C){var l=navigator.connection||navigator.mozConnection||navigator.webkitConnection;l?C.set_string(l.type||"unknown"):C.set_string("unknown")};A.prototype.BatteryLevel=function(C){var l=navigator.battery||navigator.mozBattery||navigator.webkitBattery;l?C.set_float(l.level):(d(),p?C.set_float(p.level):C.set_float(1))};A.prototype.BatteryTimeLeft=
function(C){var l=navigator.battery||navigator.mozBattery||navigator.webkitBattery;l?C.set_float(l.dischargingTime):(d(),p?C.set_float(p.dischargingTime):C.set_float(Number.POSITIVE_INFINITY))};A.prototype.ExecJS=function(C,l){if(eval){var t=0;try{t=eval(l)}catch(D){console&&console.error&&console.error("Error executing Javascript: ",D)}"number"===typeof t?C.set_any(t):"string"===typeof t?C.set_any(t):"boolean"===typeof t?C.set_any(t?1:0):C.set_any(0)}else C.set_any(0)};A.prototype.ScreenWidth=function(C){C.set_int(screen.width)};
A.prototype.ScreenHeight=function(C){C.set_int(screen.height)};A.prototype.DevicePixelRatio=function(C){C.set_float(this.runtime.devicePixelRatio)};A.prototype.WindowInnerWidth=function(C){C.set_int(window.innerWidth)};A.prototype.WindowInnerHeight=function(C){C.set_int(window.innerHeight)};A.prototype.WindowOuterWidth=function(C){C.set_int(window.outerWidth)};A.prototype.WindowOuterHeight=function(C){C.set_int(window.outerHeight)};e.exps=new A})();cr.plugins_.Keyboard=function(b){this.runtime=b};
(function(){function b(){}function d(){}function h(e){e=Math.floor(e);switch(e){case 8:return"backspace";case 9:return"tab";case 13:return"enter";case 16:return"shift";case 17:return"control";case 18:return"alt";case 19:return"pause";case 20:return"capslock";case 27:return"esc";case 33:return"pageup";case 34:return"pagedown";case 35:return"end";case 36:return"home";case 37:return"\u2190";case 38:return"\u2191";case 39:return"\u2192";case 40:return"\u2193";case 45:return"insert";case 46:return"del";
case 91:return"left window key";case 92:return"right window key";case 93:return"select";case 96:return"numpad 0";case 97:return"numpad 1";case 98:return"numpad 2";case 99:return"numpad 3";case 100:return"numpad 4";case 101:return"numpad 5";case 102:return"numpad 6";case 103:return"numpad 7";case 104:return"numpad 8";case 105:return"numpad 9";case 106:return"numpad *";case 107:return"numpad +";case 109:return"numpad -";case 110:return"numpad .";case 111:return"numpad /";case 112:return"F1";case 113:return"F2";
case 114:return"F3";case 115:return"F4";case 116:return"F5";case 117:return"F6";case 118:return"F7";case 119:return"F8";case 120:return"F9";case 121:return"F10";case 122:return"F11";case 123:return"F12";case 144:return"numlock";case 145:return"scroll lock";case 186:return";";case 187:return"=";case 188:return",";case 189:return"-";case 190:return".";case 191:return"/";case 192:return"'";case 219:return"[";case 220:return"\\";case 221:return"]";case 222:return"#";case 223:return"`";default:return String.fromCharCode(e)}}
var q=cr.plugins_.Keyboard.prototype;q.Type=function(e){this.plugin=e;this.runtime=e.runtime};q.Type.prototype.onCreate=function(){};q.Instance=function(e){this.type=e;this.runtime=e.runtime;this.keyMap=Array(256);this.typedKeyMap=Array(256);this.usedKeys=Array(256);this.triggerKey=0};var y=q.Instance.prototype;y.onCreate=function(){var e=this;document.addEventListener("keydown",function(a){e.onKeyDown(a)});document.addEventListener("keyup",function(a){e.onKeyUp(a)})};var A=[32,33,34,35,36,37,38,
39,40,44];y.onKeyDown=function(e){var a=!1;window!=window.top&&-1<A.indexOf(e.which)&&(e.preventDefault(),a=!0,e.stopPropagation());if(this.keyMap[e.which])this.usedKeys[e.which]&&!a&&e.preventDefault();else{var c=e.which;this.typedKeyMap[c]=e.key;this.keyMap[c]=!0;this.triggerKey=c;this.runtime.isInUserInputEvent=!0;this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnAnyKey,this);var m=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKey,this),u=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyCode,
this);this.runtime.isInUserInputEvent=!1;if(m||u)this.usedKeys[c]=!0,a||e.preventDefault()}};y.onKeyUp=function(e){var a=e.which;this.typedKeyMap[a]=e.key;this.keyMap[a]=!1;this.triggerKey=a;this.runtime.isInUserInputEvent=!0;this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnAnyKeyReleased,this);var c=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyReleased,this),m=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyCodeReleased,this);this.runtime.isInUserInputEvent=
!1;if(c||m||this.usedKeys[e.which])this.usedKeys[a]=!0,e.preventDefault()};y.onWindowBlur=function(){var e;for(e=0;256>e;++e)if(this.keyMap[e]){this.keyMap[e]=!1;this.triggerKey=e;this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnAnyKeyReleased,this);var a=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyReleased,this),c=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyCodeReleased,this);if(a||c)this.usedKeys[e]=!0}};y.saveToJSON=function(){return{triggerKey:this.triggerKey}};
y.loadFromJSON=function(e){this.triggerKey=e.triggerKey};b.prototype.IsKeyDown=function(e){return this.keyMap[e]};b.prototype.OnKey=function(e){return e===this.triggerKey};b.prototype.OnAnyKey=function(e){return!0};b.prototype.OnAnyKeyReleased=function(e){return!0};b.prototype.OnKeyReleased=function(e){return e===this.triggerKey};b.prototype.IsKeyCodeDown=function(e){e=Math.floor(e);return 0>e||e>=this.keyMap.length?!1:this.keyMap[e]};b.prototype.OnKeyCode=function(e){return e===this.triggerKey};
b.prototype.OnKeyCodeReleased=function(e){return e===this.triggerKey};q.cnds=new b;q.acts=new function(){};d.prototype.TypedKey=function(e){e.set_string(this.typedKeyMap[this.triggerKey]||"")};d.prototype.LastKeyCode=function(e){e.set_int(this.triggerKey)};d.prototype.StringFromKeyCode=function(e,a){e.set_string(h(a))};q.exps=new d})();cr.plugins_.Arr=function(b){this.runtime=b};
(function(){function b(){return c.length?c.pop():[]}function d(m){var u;var p=0;for(u=m.length;p<u;p++)Array.isArray(m[p])&&d(m[p]);cr.clearArray(m);c.push(m)}function h(){}function q(){}function y(m,u){if(cr.is_number(m)&&cr.is_number(u))return m-u;m=""+m;u=""+u;return m<u?-1:m>u?1:0}function A(){}var e=cr.plugins_.Arr.prototype;e.Type=function(m){this.plugin=m;this.runtime=m.runtime};e.Type.prototype.onCreate=function(){};e.Instance=function(m){this.type=m;this.runtime=m.runtime};var a=e.Instance.prototype,
c=[];Array.isArray||(Array.isArray=function(m){return"[object Array]"===Object.prototype.toString.call(m)});a.onCreate=function(){this.cx=this.properties[0];this.cy=this.properties[1];this.cz=this.properties[2];this.recycled||(this.arr=b());var m=this.arr;m.length=this.cx;var u,p,x;for(u=0;u<this.cx;u++)for(m[u]||(m[u]=b()),m[u].length=this.cy,p=0;p<this.cy;p++)for(m[u][p]||(m[u][p]=b()),m[u][p].length=this.cz,x=0;x<this.cz;x++)m[u][p][x]=0;this.forX=[];this.forY=[];this.forZ=[];this.forDepth=-1};
a.onDestroy=function(){var m;for(m=0;m<this.cx;m++)d(this.arr[m]);cr.clearArray(this.arr)};a.at=function(m,u,p){m=Math.floor(m);u=Math.floor(u);p=Math.floor(p);return isNaN(m)||0>m||m>this.cx-1||isNaN(u)||0>u||u>this.cy-1||isNaN(p)||0>p||p>this.cz-1?0:this.arr[m][u][p]};a.set=function(m,u,p,x){m=Math.floor(m);u=Math.floor(u);p=Math.floor(p);isNaN(m)||0>m||m>this.cx-1||isNaN(u)||0>u||u>this.cy-1||isNaN(p)||0>p||p>this.cz-1||(this.arr[m][u][p]=x)};a.getAsJSON=function(){return JSON.stringify({c2array:!0,
size:[this.cx,this.cy,this.cz],data:this.arr})};a.saveToJSON=function(){return{size:[this.cx,this.cy,this.cz],data:this.arr}};a.loadFromJSON=function(m){var u=m.size;this.cx=u[0];this.cy=u[1];this.cz=u[2];this.arr=m.data};a.setSize=function(m,u,p){0>m&&(m=0);0>u&&(u=0);0>p&&(p=0);if(this.cx!==m||this.cy!==u||this.cz!==p){this.cx=m;this.cy=u;this.cz=p;var x,M,v=this.arr;v.length=m;for(m=0;m<this.cx;m++)for(cr.is_undefined(v[m])&&(v[m]=b()),v[m].length=u,x=0;x<this.cy;x++)for(cr.is_undefined(v[m][x])&&
(v[m][x]=b()),v[m][x].length=p,M=0;M<this.cz;M++)cr.is_undefined(v[m][x][M])&&(v[m][x][M]=0)}};a.getForX=function(){return 0<=this.forDepth&&this.forDepth<this.forX.length?this.forX[this.forDepth]:0};a.getForY=function(){return 0<=this.forDepth&&this.forDepth<this.forY.length?this.forY[this.forDepth]:0};a.getForZ=function(){return 0<=this.forDepth&&this.forDepth<this.forZ.length?this.forZ[this.forDepth]:0};h.prototype.CompareX=function(m,u,p){return cr.do_cmp(this.at(m,0,0),u,p)};h.prototype.CompareXY=
function(m,u,p,x){return cr.do_cmp(this.at(m,u,0),p,x)};h.prototype.CompareXYZ=function(m,u,p,x,M){return cr.do_cmp(this.at(m,u,p),x,M)};a.doForEachTrigger=function(m){this.runtime.pushCopySol(m.solModifiers);m.retrigger();this.runtime.popSol(m.solModifiers)};h.prototype.ArrForEach=function(m){var u=this.runtime.getCurrentEventStack().current_event;this.forDepth++;var p=this.forDepth;p===this.forX.length?(this.forX.push(0),this.forY.push(0),this.forZ.push(0)):(this.forX[p]=0,this.forY[p]=0,this.forZ[p]=
0);switch(m){case 0:for(this.forX[p]=0;this.forX[p]<this.cx;this.forX[p]++)for(this.forY[p]=0;this.forY[p]<this.cy;this.forY[p]++)for(this.forZ[p]=0;this.forZ[p]<this.cz;this.forZ[p]++)this.doForEachTrigger(u);break;case 1:for(this.forX[p]=0;this.forX[p]<this.cx;this.forX[p]++)for(this.forY[p]=0;this.forY[p]<this.cy;this.forY[p]++)this.doForEachTrigger(u);break;case 2:for(this.forX[p]=0;this.forX[p]<this.cx;this.forX[p]++)this.doForEachTrigger(u)}this.forDepth--;return!1};h.prototype.CompareCurrent=
function(m,u){return cr.do_cmp(this.at(this.getForX(),this.getForY(),this.getForZ()),m,u)};h.prototype.Contains=function(m){var u,p,x;for(u=0;u<this.cx;u++)for(p=0;p<this.cy;p++)for(x=0;x<this.cz;x++)if(this.arr[u][p][x]===m)return!0;return!1};h.prototype.IsEmpty=function(){return 0===this.cx||0===this.cy||0===this.cz};h.prototype.CompareSize=function(m,u,p){var x=0;switch(m){case 0:x=this.cx;break;case 1:x=this.cy;break;case 2:x=this.cz}return cr.do_cmp(x,u,p)};e.cnds=new h;q.prototype.Clear=function(m){var u,
p,x;for(u=0;u<this.cx;u++)for(p=0;p<this.cy;p++)for(x=0;x<this.cz;x++)this.arr[u][p][x]=m};q.prototype.SetSize=function(m,u,p){this.setSize(m,u,p)};q.prototype.SetX=function(m,u){this.set(m,0,0,u)};q.prototype.SetXY=function(m,u,p){this.set(m,u,0,p)};q.prototype.SetXYZ=function(m,u,p,x){this.set(m,u,p,x)};q.prototype.Push=function(m,u,p){var x=0,M=0,v=this.arr;switch(p){case 0:0===m?(x=v.length,v.push(b())):(x=0,v.unshift(b()));for(v[x].length=this.cy;M<this.cy;M++)for(v[x][M]=b(),v[x][M].length=
this.cz,p=0;p<this.cz;p++)v[x][M][p]=u;this.cx++;break;case 1:for(;x<this.cx;x++)for(0===m?(M=v[x].length,v[x].push(b())):(M=0,v[x].unshift(b())),v[x][M].length=this.cz,p=0;p<this.cz;p++)v[x][M][p]=u;this.cy++;break;case 2:for(;x<this.cx;x++)for(M=0;M<this.cy;M++)0===m?v[x][M].push(u):v[x][M].unshift(u);this.cz++}};q.prototype.Pop=function(m,u){var p=0,x=this.arr;switch(u){case 0:if(0===this.cx)break;0===m?d(x.pop()):d(x.shift());this.cx--;break;case 1:if(0===this.cy)break;for(;p<this.cx;p++)0===
m?d(x[p].pop()):d(x[p].shift());this.cy--;break;case 2:if(0!==this.cz){for(;p<this.cx;p++)for(u=0;u<this.cy;u++)0===m?x[p][u].pop():x[p][u].shift();this.cz--}}};q.prototype.Reverse=function(m){var u=0,p=this.arr;if(0!==this.cx&&0!==this.cy&&0!==this.cz)switch(m){case 0:p.reverse();break;case 1:for(;u<this.cx;u++)p[u].reverse();break;case 2:for(;u<this.cx;u++)for(m=0;m<this.cy;m++)p[u][m].reverse()}};q.prototype.Sort=function(m){var u=0,p=0,x=this.arr;if(0!==this.cx&&0!==this.cy&&0!==this.cz)switch(m){case 0:x.sort(function(M,
v){return y(M[0][0],v[0][0])});break;case 1:for(;u<this.cx;u++)x[u].sort(function(M,v){return y(M[0],v[0])});break;case 2:for(;u<this.cx;u++)for(p=0;p<this.cy;p++)x[u][p].sort(y)}};q.prototype.Delete=function(m,u){var p=0;m=Math.floor(m);var x=this.arr;if(!(0>m))switch(u){case 0:if(m>=this.cx)break;d(x[m]);x.splice(m,1);this.cx--;break;case 1:if(m>=this.cy)break;for(;p<this.cx;p++)d(x[p][m]),x[p].splice(m,1);this.cy--;break;case 2:if(!(m>=this.cz)){for(;p<this.cx;p++)for(u=0;u<this.cy;u++)x[p][u].splice(m,
1);this.cz--}}};q.prototype.Insert=function(m,u,p){var x=0,M=0;u=Math.floor(u);var v=this.arr;if(!(0>u))switch(p){case 0:if(u>this.cx)break;x=u;v.splice(x,0,b());for(v[x].length=this.cy;M<this.cy;M++)for(v[x][M]=b(),v[x][M].length=this.cz,p=0;p<this.cz;p++)v[x][M][p]=m;this.cx++;break;case 1:if(u>this.cy)break;for(;x<this.cx;x++)for(M=u,v[x].splice(M,0,b()),v[x][M].length=this.cz,p=0;p<this.cz;p++)v[x][M][p]=m;this.cy++;break;case 2:if(!(u>this.cz)){for(;x<this.cx;x++)for(M=0;M<this.cy;M++)v[x][M].splice(u,
0,m);this.cz++}}};q.prototype.JSONLoad=function(m){try{var u=JSON.parse(m)}catch(p){return}u.c2array&&(m=u.size,this.cx=m[0],this.cy=m[1],this.cz=m[2],this.arr=u.data)};q.prototype.JSONDownload=function(m){var u=document.createElement("a");if("undefined"===typeof u.download)m="data:text/html,"+encodeURIComponent("<p><a download='"+m+"' href=\"data:application/json,"+encodeURIComponent(this.getAsJSON())+'">Download link</a></p>'),window.open(m);else{var p=document.getElementsByTagName("body")[0];u.textContent=
m;u.href="data:application/json,"+encodeURIComponent(this.getAsJSON());u.download=m;p.appendChild(u);u.click();p.removeChild(u)}};e.acts=new q;A.prototype.At=function(m,u,p,x){m.set_any(this.at(u,p||0,x||0))};A.prototype.Width=function(m){m.set_int(this.cx)};A.prototype.Height=function(m){m.set_int(this.cy)};A.prototype.Depth=function(m){m.set_int(this.cz)};A.prototype.CurX=function(m){m.set_int(this.getForX())};A.prototype.CurY=function(m){m.set_int(this.getForY())};A.prototype.CurZ=function(m){m.set_int(this.getForZ())};
A.prototype.CurValue=function(m){m.set_any(this.at(this.getForX(),this.getForY(),this.getForZ()))};A.prototype.Front=function(m){m.set_any(this.at(0,0,0))};A.prototype.Back=function(m){m.set_any(this.at(this.cx-1,0,0))};A.prototype.IndexOf=function(m,u){for(var p=0;p<this.cx;p++)if(this.arr[p][0][0]===u){m.set_int(p);return}m.set_int(-1)};A.prototype.LastIndexOf=function(m,u){for(var p=this.cx-1;0<=p;p--)if(this.arr[p][0][0]===u){m.set_int(p);return}m.set_int(-1)};A.prototype.AsJSON=function(m){m.set_string(this.getAsJSON())};
e.exps=new A})();cr.plugins_.Spritefont2=function(b){this.runtime=b};
(function(){function b(v,F){return v.length?v.pop():new F}function d(v,F,C){if(C){var l;C=0;for(l=F.length;C<l;C++)v.length<c&&v.push(F[C]);cr.clearArray(F)}else for(l in F)Object.prototype.hasOwnProperty.call(F,l)&&(v.length<c&&v.push(F[l]),delete F[l])}function h(v,F,C){var l=v.lines;C=C.replace(/\s\s*$/,"");F>=l.length&&l.push(b(m,Object));F=l[F];F.text=C;F.width=v.measureWidth(C);v.textWidth=cr.max(v.textWidth,F.width)}function q(){}function y(){}function A(){}var e=cr.plugins_.Spritefont2.prototype;
e.onCreate=function(){};e.Type=function(v){this.plugin=v;this.runtime=v.runtime};var a=e.Type.prototype;a.onCreate=function(){this.is_family||(this.texture_img=this.runtime.findWaitingTexture(this.texture_file),this.texture_img||(this.texture_img=new Image,this.texture_img.cr_src=this.texture_file,this.texture_img.cr_filesize=this.texture_filesize,this.texture_img.c2webGL_texture=null,this.runtime.waitForImageLoad(this.texture_img,this.texture_file)),this.spriteX=this.texture_data[3],this.spriteY=
this.texture_data[4],this.spriteWidth=this.texture_data[5],this.spriteHeight=this.texture_data[6],this.webGL_texture=null)};a.onLostWebGLContext=function(){this.is_family||(this.webGL_texture=null)};a.onRestoreWebGLContext=function(){if(!this.is_family&&this.instances.length){this.webGL_texture||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!1,this.runtime.linearSampling,this.texture_pixelformat));var v;var F=0;for(v=this.instances.length;F<v;F++)this.instances[F].webGL_texture=
this.webGL_texture}};a.unloadTextures=function(){this.is_family||this.instances.length||!this.webGL_texture||(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null)};a.preloadCanvas2D=function(v){v.drawImage(this.texture_img,0,0)};e.Instance=function(v){this.type=v;this.runtime=v.runtime};a=e.Instance.prototype;a.onDestroy=function(){d(m,this.lines,!0);d(u,this.clipList,!1);d(p,this.clipUV,!1);cr.wipe(this.characterWidthList)};a.onCreate=function(){this.texture_img=this.type.texture_img;
this.text=this.properties[0];this.characterWidth=this.properties[2];this.characterHeight=this.properties[3];this.characterSet=this.properties[4];var v=this.properties[5];this.characterScale=this.properties[6];this.characterSpacing=this.properties[7];this.lineHeight=this.properties[8];this.halign=this.properties[9]/2;this.valign=this.properties[10]/2;this.wrapbyword=0===this.properties[11];this.visible=this.properties[12];this.textHeight=this.textWidth=0;this.recycled?(cr.clearArray(this.lines),cr.wipe(this.clipList),
cr.wipe(this.clipUV),cr.wipe(this.characterWidthList)):(this.lines=[],this.clipList={},this.clipUV={},this.characterWidthList={});this.text_changed=!0;this.lastwrapwidth=this.width;this.runtime.glwrap&&(this.type.webGL_texture||(this.type.webGL_texture=this.runtime.glwrap.loadTexture(this.type.texture_img,!1,this.runtime.linearSampling,this.type.texture_pixelformat)),this.webGL_texture=this.type.webGL_texture);this.LoadCharacterSpacingData(v);this.SplitSheet()};a.saveToJSON=function(){var v={t:this.text,
csc:this.characterScale,csp:this.characterSpacing,lh:this.lineHeight,tw:this.textWidth,th:this.textHeight,lrt:this.last_render_tick,ha:this.halign,va:this.valign,cw:{}},F;for(F in this.characterWidthList)v.cw[F]=this.characterWidthList[F];return v};a.loadFromJSON=function(v){this.text=v.t;this.characterScale=v.csc;this.characterSpacing=v.csp;this.lineHeight=v.lh;this.textWidth=v.tw;this.textHeight=v.th;this.last_render_tick=v.lrt;v.hasOwnProperty("ha")&&(this.halign=v.ha);v.hasOwnProperty("va")&&
(this.valign=v.va);for(var F in v.cw)this.characterWidthList[F]=v.cw[F];this.text_changed=!0;this.lastwrapwidth=this.width};var c=1E3,m=[],u=[],p=[];a.SplitSheet=function(){var v=this.texture_img.width,F=this.texture_img.height,C=this.type.spriteX,l=this.type.spriteY,t=this.characterWidth,D=this.characterHeight,S=C/v,V=l/F;v=t/v;F=D/F;for(var K=this.characterSet,f=Math.floor(this.type.spriteWidth/t),n=Math.floor(this.type.spriteHeight/D),G=0;G<K.length&&!(G>=f*n);G++){var g=G%f,z=Math.floor(G/f),
J=K.charAt(G);if(this.runtime.glwrap){var N=this.clipUV,U=g*v+S,W=z*F+V;g=(g+1)*v+S;z=(z+1)*F+V;void 0===N[J]&&(N[J]=b(p,cr.rect));N[J].left=U;N[J].top=W;N[J].right=g;N[J].bottom=z}else N=this.clipList,g=g*t+C,z=z*D+l,U=t,W=D,void 0===N[J]&&(N[J]=b(u,Object)),N[J].x=g,N[J].y=z,N[J].w=U,N[J].h=W}};var x=[];e.TokeniseWords=function(v){cr.clearArray(x);for(var F="",C,l=0;l<v.length;)if(C=v.charAt(l),"\n"===C)F.length&&(x.push(F),F=""),x.push("\n"),++l;else if(" "===C||"\t"===C||"-"===C){do F+=v.charAt(l),
l++;while(l<v.length&&(" "===v.charAt(l)||"\t"===v.charAt(l)));x.push(F);F=""}else l<v.length&&(F+=C,l++);F.length&&x.push(F)};e.WordWrap=function(v){var F=v.text,C=v.lines;if(F&&F.length){var l=v.width;if(2>=l)d(m,C,!0);else{var t=v.characterScale,D=v.characterSpacing;if(F.length*(v.characterWidth*t+D)-D<=l&&-1===F.indexOf("\n")&&(D=v.measureWidth(F),D<=l)){d(m,C,!0);C.push(b(m,Object));C[0].text=F;C[0].width=D;v.textWidth=D;v.textHeight=v.characterHeight*t+v.lineHeight;return}this.WrapText(v);v.textHeight=
C.length*(v.characterHeight*t+v.lineHeight)}}else d(m,C,!0)};e.WrapText=function(v){var F=v.wrapbyword,C=v.text,l=v.lines,t=v.width;F&&(this.TokeniseWords(C),C=x);var D="",S,V=0,K=!1;for(S=0;S<C.length;S++)if("\n"===C[S])!0===K?K=!1:(h(v,V,D),V++),D="";else{K=!1;var f=D;D+=C[S];var n=v.measureWidth(D.replace(/\s\s*$/,""));n>t&&(""===f?(h(v,V,D),D="",K=!0):(h(v,V,f),D=C[S]),V++,F||" "!==D||(D=""))}D.replace(/\s\s*$/,"").length&&(h(v,V,D),V++);for(S=V;S<l.length;S++)m.length<c&&m.push(l[S]);l.length=
V};a.measureWidth=function(v){for(var F=this.characterSpacing,C=v.length,l=0,t=0;t<C;t++)l+=this.getCharacterWidth(v.charAt(t))*this.characterScale+F;return l-(0<l?F:0)};a.getCharacterWidth=function(v){var F=this.characterWidthList;return void 0!==F[v]?F[v]:this.characterWidth};a.rebuildText=function(){if(this.text_changed||this.width!==this.lastwrapwidth)this.textHeight=this.textWidth=0,this.type.plugin.WordWrap(this),this.text_changed=!1,this.lastwrapwidth=this.width};a.draw=function(v,F){F=this.texture_img;
if(""!==this.text&&null!=F&&(this.rebuildText(),!(this.height<this.characterHeight*this.characterScale+this.lineHeight))){v.globalAlpha=this.opacity;F=this.x;var C=this.y;this.runtime.pixel_rounding&&(F=Math.round(F),C=Math.round(C));var l=this.layer.viewLeft,t=this.layer.viewTop,D=this.layer.viewRight,S=this.layer.viewBottom;v.save();v.translate(F,C);v.rotate(this.angle);var V=this.angle,K=this.halign,f=this.characterScale,n=this.characterHeight*f,G=this.lineHeight,g=this.characterSpacing,z=this.lines,
J=this.valign*cr.max(0,this.height-this.textHeight),N=-(this.hotspotX*this.width);J=-(this.hotspotY*this.height)+J;for(var U,W,X=0;X<z.length;X++){var Y=z[X].text;var ea=K*cr.max(0,this.width-z[X].width);var ha=N+ea;J+=G;if(0===V&&C+J+n<t)J+=n;else{for(var k=0;k<Y.length;k++){U=Y.charAt(k);ea=this.getCharacterWidth(U);var r=this.clipList[U];if(0===V&&F+ha+ea*f+g<l)ha+=ea*f+g;else{if(ha+ea*f>this.width+1E-5)break;void 0!==r&&(U=ha,W=J,0===V&&1===f&&(U=Math.round(U),W=Math.round(W)),v.drawImage(this.texture_img,
r.x,r.y,r.w,r.h,U,W,r.w*f,r.h*f));ha+=ea*f+g;if(0===V&&F+ha>D)break}}J+=n;if(0===V&&(J+n+G>this.height||C+J>S))break}}v.restore()}};var M=new cr.quad;a.drawGL=function(v){v.setTexture(this.webGL_texture);v.setOpacity(this.opacity);if(this.text&&(this.rebuildText(),!(this.height<this.characterHeight*this.characterScale+this.lineHeight))){this.update_bbox();var F=this.bquad,C=0,l=0;this.runtime.pixel_rounding&&(C=Math.round(this.x)-this.x,l=Math.round(this.y)-this.y);var t=this.layer.viewLeft,D=this.layer.viewTop,
S=this.layer.viewRight,V=this.layer.viewBottom,K=this.angle,f=this.halign,n=this.valign,G=this.characterScale,g=this.characterHeight*G,z=this.lineHeight,J=this.characterSpacing,N=this.lines,U=this.textHeight,W;if(0!==K){var X=Math.cos(K);var Y=Math.sin(K)}n*=cr.max(0,this.height-U);C=F.tlx+C;F=F.tly+l;l=n;for(n=0;n<N.length;n++){U=N[n].text;var ea=W=f*cr.max(0,this.width-N[n].width);l+=z;if(0===K&&F+l+g<D)l+=g;else{for(var ha=0;ha<U.length;ha++){var k=U.charAt(ha);W=this.getCharacterWidth(k);k=this.clipUV[k];
if(0===K&&C+ea+W*G+J<t)ea+=W*G+J;else{if(ea+W*G>this.width+1E-5)break;if(void 0!==k){var r=this.characterWidth*G,E=this.characterHeight*G;var H=ea;var B=l;0===K&&1===G&&(H=Math.round(H),B=Math.round(B));M.tlx=H;M.tly=B;M.trx=H+r;M.try_=B;M.blx=H;M.bly=B+E;M.brx=H+r;M.bry=B+E;0!==K&&(B=M,r=X,E=Y,H=B.tlx*r-B.tly*E,B.tly=B.tly*r+B.tlx*E,B.tlx=H,H=B.trx*r-B.try_*E,B.try_=B.try_*r+B.trx*E,B.trx=H,H=B.blx*r-B.bly*E,B.bly=B.bly*r+B.blx*E,B.blx=H,H=B.brx*r-B.bry*E,B.bry=B.bry*r+B.brx*E,B.brx=H);M.offset(C,
F);v.quadTex(M.tlx,M.tly,M.trx,M.try_,M.brx,M.bry,M.blx,M.bly,k)}ea+=W*G+J;if(0===K&&C+ea>S)break}}l+=g;if(0===K&&(l+g+z>this.height||F+l>V))break}}}};q.prototype.CompareText=function(v,F){return F?this.text==v:cr.equals_nocase(this.text,v)};e.cnds=new q;y.prototype.SetText=function(v){cr.is_number(v)&&1E9>v&&(v=Math.round(1E10*v)/1E10);v=v.toString();this.text!==v&&(this.text=v,this.text_changed=!0,this.runtime.redraw=!0)};y.prototype.AppendText=function(v){cr.is_number(v)&&(v=Math.round(1E10*v)/
1E10);if(v=v.toString())this.text+=v,this.text_changed=!0,this.runtime.redraw=!0};y.prototype.SetScale=function(v){v!==this.characterScale&&(this.characterScale=v,this.text_changed=!0,this.runtime.redraw=!0)};y.prototype.SetCharacterSpacing=function(v){v!==this.CharacterSpacing&&(this.characterSpacing=v,this.text_changed=!0,this.runtime.redraw=!0)};y.prototype.SetLineHeight=function(v){v!==this.lineHeight&&(this.lineHeight=v,this.text_changed=!0,this.runtime.redraw=!0)};a.SetCharWidth=function(v,
F){F=parseInt(F,10);this.characterWidthList[v]!==F&&(this.characterWidthList[v]=F,this.text_changed=!0,this.runtime.redraw=!0)};a.LoadCharacterSpacingData=function(v){var F,C;if(v){try{var l=JSON.parse(v)}catch(V){return}if(Array.isArray(l))for(v=0,F=l.length;v<F;++v){var t=l[v];if(Array.isArray(t)&&2===t.length&&"number"===typeof t[0]&&"string"===typeof t[1]){var D=t[0];t=t[1];var S=0;for(C=t.length;S<C;++S)this.SetCharWidth(t.charAt(S),D)}}}};y.prototype.SetCharacterWidth=function(v,F){if(""!==
v)for(var C=0;C<v.length;C++)this.SetCharWidth(v.charAt(C),F)};y.prototype.SetEffect=function(v){this.blend_mode=v;this.compositeOp=cr.effectToCompositeOp(v);cr.setGLBlend(this,v,this.runtime.gl);this.runtime.redraw=!0};y.prototype.SetHAlign=function(v){this.halign=v/2;this.text_changed=!0;this.runtime.redraw=!0};y.prototype.SetVAlign=function(v){this.valign=v/2;this.text_changed=!0;this.runtime.redraw=!0};e.acts=new y;A.prototype.CharacterWidth=function(v,F){v.set_int(this.getCharacterWidth(F))};
A.prototype.CharacterHeight=function(v){v.set_int(this.characterHeight)};A.prototype.CharacterScale=function(v){v.set_float(this.characterScale)};A.prototype.CharacterSpacing=function(v){v.set_int(this.characterSpacing)};A.prototype.LineHeight=function(v){v.set_int(this.lineHeight)};A.prototype.Text=function(v){v.set_string(this.text)};A.prototype.TextWidth=function(v){this.rebuildText();v.set_float(this.textWidth)};A.prototype.TextHeight=function(v){this.rebuildText();v.set_float(this.textHeight)};
e.exps=new A})();cr.plugins_.TextBox=function(b){this.runtime=b};
(function(){function b(){}function d(){}function h(){}var q=cr.plugins_.TextBox.prototype;q.Type=function(e){this.plugin=e;this.runtime=e.runtime};q.Type.prototype.onCreate=function(){};q.Instance=function(e){this.type=e;this.runtime=e.runtime};var y=q.Instance.prototype,A="text password email number tel url textarea search".split(" ");-1<navigator.userAgent.indexOf("MSIE 9")&&(A[2]="text",A[3]="text",A[4]="text",A[5]="text",A[7]="text");y.onCreate=function(){6===this.properties[7]?(this.elem=document.createElement("textarea"),
this.elem.style.resize="none"):(this.elem=document.createElement("input"),this.elem.type=A[this.properties[7]]);this.elem.id=this.properties[9];document.body.appendChild(this.elem);this.elem.autocomplete="off";this.elem.value=this.properties[0];this.elem.placeholder=this.properties[1];this.elem.title=this.properties[2];this.elem.disabled=!this.properties[4];this.elem.readOnly=this.properties[5];this.elem.spellcheck=this.properties[6];this.autoFontSize=this.properties[8];this.element_hidden=!1;this.properties[3]||
(this.elem.style.display="none",this.visible=!1,this.element_hidden=!0);var e=function(a){return function(){a.runtime.trigger(cr.plugins_.TextBox.prototype.cnds.OnTextChanged,a)}}(this);this.elem.oninput=e;-1!==navigator.userAgent.indexOf("MSIE")&&(this.elem.oncut=e);this.elem.onclick=function(a){return function(c){c.stopPropagation();a.runtime.isInUserInputEvent=!0;a.runtime.trigger(cr.plugins_.TextBox.prototype.cnds.OnClicked,a);a.runtime.isInUserInputEvent=!1}}(this);this.elem.ondblclick=function(a){return function(c){c.stopPropagation();
a.runtime.isInUserInputEvent=!0;a.runtime.trigger(cr.plugins_.TextBox.prototype.cnds.OnDoubleClicked,a);a.runtime.isInUserInputEvent=!1}}(this);this.elem.addEventListener("touchstart",function(a){a.stopPropagation()},!1);this.elem.addEventListener("touchmove",function(a){a.stopPropagation()},!1);this.elem.addEventListener("touchend",function(a){a.stopPropagation()},!1);this.elem.addEventListener("mousedown",function(a){a.stopPropagation()});this.elem.addEventListener("mouseup",function(a){a.stopPropagation()});
this.elem.addEventListener("keydown",function(a){13!==a.which&&27!=a.which&&a.stopPropagation()});this.elem.addEventListener("keyup",function(a){13!==a.which&&27!=a.which&&a.stopPropagation()});this.lastWinHeight=this.lastWinWidth=this.lastBottom=this.lastRight=this.lastTop=this.lastLeft=0;this.updatePosition(!0);this.runtime.tickMe(this)};y.saveToJSON=function(){return{text:this.elem.value,placeholder:this.elem.placeholder,tooltip:this.elem.title,disabled:!!this.elem.disabled,readonly:!!this.elem.readOnly,
spellcheck:!!this.elem.spellcheck}};y.loadFromJSON=function(e){this.elem.value=e.text;this.elem.placeholder=e.placeholder;this.elem.title=e.tooltip;this.elem.disabled=e.disabled;this.elem.readOnly=e.readonly;this.elem.spellcheck=e.spellcheck};y.onDestroy=function(){this.elem.parentElement.removeChild(this.elem);this.elem=null};y.tick=function(){this.updatePosition()};y.updatePosition=function(e){var a=this.layer.layerToCanvas(this.x,this.y,!0),c=this.layer.layerToCanvas(this.x,this.y,!1),m=this.layer.layerToCanvas(this.x+
this.width,this.y+this.height,!0),u=this.layer.layerToCanvas(this.x+this.width,this.y+this.height,!1),p=this.runtime.width/this.runtime.devicePixelRatio,x=this.runtime.height/this.runtime.devicePixelRatio;!this.visible||!this.layer.visible||0>=m||0>=u||a>=p||c>=x?(this.element_hidden||(this.elem.style.display="none"),this.element_hidden=!0):(1>a&&(a=1),1>c&&(c=1),m>=p&&(m=p-1),u>=x&&(u=x-1),p=window.innerWidth,x=window.innerHeight,e||this.lastLeft!==a||this.lastTop!==c||this.lastRight!==m||this.lastBottom!==
u||this.lastWinWidth!==p||this.lastWinHeight!==x?(this.lastLeft=a,this.lastTop=c,this.lastRight=m,this.lastBottom=u,this.lastWinWidth=p,this.lastWinHeight=x,this.element_hidden&&(this.elem.style.display="",this.element_hidden=!1),e=Math.round(a)+this.runtime.canvas.offsetLeft,p=Math.round(c)+this.runtime.canvas.offsetTop,this.elem.style.position="absolute",this.elem.style.left=e+"px",this.elem.style.top=p+"px",this.elem.style.width=Math.round(m-a)+"px",this.elem.style.height=Math.round(u-c)+"px",
this.autoFontSize&&(this.elem.style.fontSize=this.layer.getScale(!0)/this.runtime.devicePixelRatio-.2+"em")):this.element_hidden&&(this.elem.style.display="",this.element_hidden=!1))};y.draw=function(e){};y.drawGL=function(e){};b.prototype.CompareText=function(e,a){return 0===a?cr.equals_nocase(this.elem.value,e):this.elem.value===e};b.prototype.OnTextChanged=function(){return!0};b.prototype.OnClicked=function(){return!0};b.prototype.OnDoubleClicked=function(){return!0};q.cnds=new b;d.prototype.SetText=
function(e){this.elem.value=e.toString()};d.prototype.SetPlaceholder=function(e){this.elem.placeholder=e};d.prototype.SetTooltip=function(e){this.elem.title=e};d.prototype.SetReadOnly=function(e){this.elem.readOnly=0===e};d.prototype.ScrollToBottom=function(){this.elem.scrollTop=this.elem.scrollHeight};q.acts=new d;h.prototype.Text=function(e){e.set_string(this.elem.value)};q.exps=new h})();cr.plugins_.AJAX=function(b){this.runtime=b};
(function(){function b(){}function d(){}function h(){}var q=!1,y=null,A=null,e="",a=cr.plugins_.AJAX.prototype;a.Type=function(p){this.plugin=p;this.runtime=p.runtime};a.Type.prototype.onCreate=function(){};a.Instance=function(p){this.type=p;this.runtime=p.runtime;this.curTag=this.lastData="";this.progress=0;this.timeout=-1;if(q=this.runtime.isNWjs)y=require("path"),A=require("fs"),e=y.dirname((window.process||nw.process).execPath)+"\\"};var c=a.Instance.prototype;c.onCreate=function(){};c.saveToJSON=
function(){return{lastData:this.lastData}};c.loadFromJSON=function(p){this.lastData=p.lastData;this.curTag="";this.progress=0};var m={},u="";c.doRequest=function(p,x,M,v){var F=this,C=null,l=function(){F.curTag=p;F.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyError,F);F.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnError,F)},t=function(){if(q){var V=e+x;A.existsSync(V)?A.readFile(V,{encoding:"utf8"},function(K,f){K?l():(F.curTag=p,F.lastData=f.replace(/\r\n/g,"\n"),F.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyComplete,
F),F.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnComplete,F))}):l()}else l()},D=function(V){V.lengthComputable&&(F.progress=V.loaded/V.total,F.curTag=p,F.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnProgress,F))};try{C=this.runtime.isWindowsPhone8?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest;C.onreadystatechange=function(){4===C.readyState&&(F.curTag=p,F.lastData=C.responseText?C.responseText.replace(/\r\n/g,"\n"):"",400<=C.status?(F.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyError,
F),F.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnError,F)):q&&!F.lastData.length||!q&&0===C.status&&!F.lastData.length||(F.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyComplete,F),F.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnComplete,F)))};this.runtime.isWindowsPhone8||(C.onerror=t,C.ontimeout=t,C.onabort=t,C.onprogress=D);C.open(M,x);!this.runtime.isWindowsPhone8&&0<=this.timeout&&"undefined"!==typeof C.timeout&&(C.timeout=this.timeout);C.responseType="text";v&&C.setRequestHeader&&
!m.hasOwnProperty("Content-Type")&&C.setRequestHeader("Content-Type","application/x-www-form-urlencoded");if(C.setRequestHeader){for(var S in m)if(m.hasOwnProperty(S))try{C.setRequestHeader(S,m[S])}catch(V){}m={}}if(u&&C.overrideMimeType){try{C.overrideMimeType(u)}catch(V){}u=""}v?C.send(v):C.send()}catch(V){t()}};b.prototype.OnComplete=function(p){return cr.equals_nocase(p,this.curTag)};b.prototype.OnAnyComplete=function(p){return!0};b.prototype.OnError=function(p){return cr.equals_nocase(p,this.curTag)};
b.prototype.OnAnyError=function(p){return!0};b.prototype.OnProgress=function(p){return cr.equals_nocase(p,this.curTag)};a.cnds=new b;d.prototype.Request=function(p,x){var M=this;this.runtime.isWKWebView&&!this.runtime.isAbsoluteUrl(x)?this.runtime.fetchLocalFileViaCordovaAsText(x,function(v){M.curTag=p;M.lastData=v.replace(/\r\n/g,"\n");M.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyComplete,M);M.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnComplete,M)},function(v){M.curTag=p;M.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyError,
M);M.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnError,M)}):this.runtime.isPreview&&!this.runtime.isAbsoluteUrl(x)?this.doRequest(p,this.runtime.getLocalFileUrl(x),"GET"):this.doRequest(p,x,"GET")};d.prototype.RequestFile=function(p,x){var M=this;this.runtime.isWKWebView?this.runtime.fetchLocalFileViaCordovaAsText(x,function(v){M.curTag=p;M.lastData=v.replace(/\r\n/g,"\n");M.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyComplete,M);M.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnComplete,
M)},function(v){M.curTag=p;M.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyError,M);M.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnError,M)}):this.doRequest(p,this.runtime.getLocalFileUrl(x),"GET")};d.prototype.Post=function(p,x,M,v){this.doRequest(p,x,v,M)};d.prototype.SetTimeout=function(p){this.timeout=1E3*p};d.prototype.SetHeader=function(p,x){m[p]=x};d.prototype.OverrideMIMEType=function(p){u=p};a.acts=new d;h.prototype.LastData=function(p){p.set_string(this.lastData)};h.prototype.Progress=
function(p){p.set_float(this.progress)};h.prototype.Tag=function(p){p.set_string(this.curTag)};a.exps=new h})();cr.behaviors.Fade=function(b){this.runtime=b};
(function(){function b(){}function d(){}function h(){}var q=cr.behaviors.Fade.prototype;q.Type=function(A,e){this.behavior=A;this.objtype=e;this.runtime=A.runtime};q.Type.prototype.onCreate=function(){};q.Instance=function(A,e){this.type=A;this.behavior=A.behavior;this.inst=e;this.runtime=A.runtime};var y=q.Instance.prototype;y.onCreate=function(){this.fadeInTime=this.properties[0];this.waitTime=this.properties[1];this.fadeOutTime=this.properties[2];this.destroy=this.properties[3];this.activeAtStart=
this.properties[4];this.setMaxOpacity=!1;this.stage=this.activeAtStart?0:3;this.recycled?this.stageTime.reset():this.stageTime=new cr.KahanAdder;this.maxOpacity=this.inst.opacity?this.inst.opacity:1;this.activeAtStart&&(0===this.fadeInTime?(this.stage=1,0===this.waitTime&&(this.stage=2)):(this.inst.opacity=0,this.runtime.redraw=!0))};y.saveToJSON=function(){return{fit:this.fadeInTime,wt:this.waitTime,fot:this.fadeOutTime,s:this.stage,st:this.stageTime.sum,mo:this.maxOpacity}};y.loadFromJSON=function(A){this.fadeInTime=
A.fit;this.waitTime=A.wt;this.fadeOutTime=A.fot;this.stage=A.s;this.stageTime.reset();this.stageTime.sum=A.st;this.maxOpacity=A.mo};y.tick=function(){this.stageTime.add(this.runtime.getDt(this.inst));0===this.stage&&(this.inst.opacity=this.stageTime.sum/this.fadeInTime*this.maxOpacity,this.runtime.redraw=!0,this.inst.opacity>=this.maxOpacity&&(this.inst.opacity=this.maxOpacity,this.stage=1,this.stageTime.reset(),this.runtime.trigger(cr.behaviors.Fade.prototype.cnds.OnFadeInEnd,this.inst)));1===this.stage&&
this.stageTime.sum>=this.waitTime&&(this.stage=2,this.stageTime.reset(),this.runtime.trigger(cr.behaviors.Fade.prototype.cnds.OnWaitEnd,this.inst));2===this.stage&&0!==this.fadeOutTime&&(this.inst.opacity=this.maxOpacity-this.stageTime.sum/this.fadeOutTime*this.maxOpacity,this.runtime.redraw=!0,0>this.inst.opacity&&(this.inst.opacity=0,this.stage=3,this.stageTime.reset(),this.runtime.trigger(cr.behaviors.Fade.prototype.cnds.OnFadeOutEnd,this.inst),this.destroy&&this.runtime.DestroyInstance(this.inst)))};
y.doStart=function(){this.stage=0;this.stageTime.reset();0===this.fadeInTime?(this.stage=1,0===this.waitTime&&(this.stage=2)):(this.inst.opacity=0,this.runtime.redraw=!0)};b.prototype.OnFadeOutEnd=function(){return!0};b.prototype.OnFadeInEnd=function(){return!0};b.prototype.OnWaitEnd=function(){return!0};q.cnds=new b;d.prototype.StartFade=function(){this.activeAtStart||this.setMaxOpacity||(this.maxOpacity=this.inst.opacity?this.inst.opacity:1,this.setMaxOpacity=!0);3===this.stage&&this.doStart()};
d.prototype.RestartFade=function(){this.doStart()};d.prototype.SetFadeInTime=function(A){0>A&&(A=0);this.fadeInTime=A};d.prototype.SetWaitTime=function(A){0>A&&(A=0);this.waitTime=A};d.prototype.SetFadeOutTime=function(A){0>A&&(A=0);this.fadeOutTime=A};q.acts=new d;h.prototype.FadeInTime=function(A){A.set_float(this.fadeInTime)};h.prototype.WaitTime=function(A){A.set_float(this.waitTime)};h.prototype.FadeOutTime=function(A){A.set_float(this.fadeOutTime)};q.exps=new h})();
cr.behaviors.Sin=function(b){this.runtime=b};
(function(){function b(){}function d(){}function h(){}var q=cr.behaviors.Sin.prototype;q.Type=function(m,u){this.behavior=m;this.objtype=u;this.runtime=m.runtime};q.Type.prototype.onCreate=function(){};q.Instance=function(m,u){this.type=m;this.behavior=m.behavior;this.inst=u;this.runtime=m.runtime;this.i=0};var y=q.Instance.prototype,A=2*Math.PI,e=Math.PI/2,a=3*Math.PI/2,c=[0,1,8,3,4,2,5,6,7];y.onCreate=function(){this.movement=c[this.properties[0]];this.wave=this.properties[1];this.period=this.properties[2];
this.period+=Math.random()*this.properties[3];0===this.period?this.i=0:(this.i=this.properties[4]/this.period*A,this.i+=Math.random()*this.properties[5]/this.period*A);this.mag=this.properties[6];this.mag+=Math.random()*this.properties[7];this.isEnabled=this.properties[8];this.ratio=this.initialValue2=this.initialValue=0;5===this.movement&&(this.mag=cr.to_radians(this.mag));this.init()};y.saveToJSON=function(){return{i:this.i,a:this.isEnabled,mv:this.movement,w:this.wave,p:this.period,mag:this.mag,
iv:this.initialValue,iv2:this.initialValue2,r:this.ratio,lkv:this.lastKnownValue,lkv2:this.lastKnownValue2}};y.loadFromJSON=function(m){this.i=m.i;this.isEnabled=m.a;this.movement=m.mv;this.wave=m.w;this.period=m.p;this.mag=m.mag;this.initialValue=m.iv;this.initialValue2=m.iv2||0;this.ratio=m.r;this.lastKnownValue=m.lkv;this.lastKnownValue2=m.lkv2||0};y.init=function(){switch(this.movement){case 0:this.initialValue=this.inst.x;break;case 1:this.initialValue=this.inst.y;break;case 2:this.initialValue=
this.inst.width;this.ratio=this.inst.height/this.inst.width;break;case 3:this.initialValue=this.inst.width;break;case 4:this.initialValue=this.inst.height;break;case 5:this.initialValue=this.inst.angle;break;case 6:this.initialValue=this.inst.opacity;break;case 7:this.initialValue=0;break;case 8:this.initialValue=this.inst.x,this.initialValue2=this.inst.y}this.lastKnownValue=this.initialValue;this.lastKnownValue2=this.initialValue2};y.waveFunc=function(m){m%=A;switch(this.wave){case 0:return Math.sin(m);
case 1:return m<=e?m/e:m<=a?1-2*(m-e)/Math.PI:(m-a)/e-1;case 2:return 2*m/A-1;case 3:return-2*m/A+1;case 4:return m<Math.PI?-1:1}return 0};y.tick=function(){var m=this.runtime.getDt(this.inst);this.isEnabled&&0!==m&&(0===this.period?this.i=0:(this.i+=m/this.period*A,this.i%=A),this.updateFromPhase())};y.updateFromPhase=function(){switch(this.movement){case 0:this.inst.x!==this.lastKnownValue&&(this.initialValue+=this.inst.x-this.lastKnownValue);this.inst.x=this.initialValue+this.waveFunc(this.i)*
this.mag;this.lastKnownValue=this.inst.x;break;case 1:this.inst.y!==this.lastKnownValue&&(this.initialValue+=this.inst.y-this.lastKnownValue);this.inst.y=this.initialValue+this.waveFunc(this.i)*this.mag;this.lastKnownValue=this.inst.y;break;case 2:this.inst.width=this.initialValue+this.waveFunc(this.i)*this.mag;this.inst.height=this.inst.width*this.ratio;break;case 3:this.inst.width=this.initialValue+this.waveFunc(this.i)*this.mag;break;case 4:this.inst.height=this.initialValue+this.waveFunc(this.i)*
this.mag;break;case 5:this.inst.angle!==this.lastKnownValue&&(this.initialValue=cr.clamp_angle(this.initialValue+(this.inst.angle-this.lastKnownValue)));this.inst.angle=cr.clamp_angle(this.initialValue+this.waveFunc(this.i)*this.mag);this.lastKnownValue=this.inst.angle;break;case 6:this.inst.opacity=this.initialValue+this.waveFunc(this.i)*this.mag/100;0>this.inst.opacity?this.inst.opacity=0:1<this.inst.opacity&&(this.inst.opacity=1);break;case 8:this.inst.x!==this.lastKnownValue&&(this.initialValue+=
this.inst.x-this.lastKnownValue),this.inst.y!==this.lastKnownValue2&&(this.initialValue2+=this.inst.y-this.lastKnownValue2),this.inst.x=this.initialValue+Math.cos(this.inst.angle)*this.waveFunc(this.i)*this.mag,this.inst.y=this.initialValue2+Math.sin(this.inst.angle)*this.waveFunc(this.i)*this.mag,this.lastKnownValue=this.inst.x,this.lastKnownValue2=this.inst.y}this.inst.set_bbox_changed()};y.onSpriteFrameChanged=function(m,u){switch(this.movement){case 2:this.initialValue*=u.width/m.width;this.ratio=
u.height/u.width;break;case 3:this.initialValue*=u.width/m.width;break;case 4:this.initialValue*=u.height/m.height}};b.prototype.IsEnabled=function(){return this.isEnabled};b.prototype.CompareMovement=function(m){return this.movement===m};b.prototype.ComparePeriod=function(m,u){return cr.do_cmp(this.period,m,u)};b.prototype.CompareMagnitude=function(m,u){return 5===this.movement?cr.do_cmp(this.mag,m,cr.to_radians(u)):cr.do_cmp(this.mag,m,u)};b.prototype.CompareWave=function(m){return this.wave===
m};q.cnds=new b;d.prototype.SetEnabled=function(m){this.isEnabled=1===m};d.prototype.SetPeriod=function(m){this.period=m};d.prototype.SetMagnitude=function(m){this.mag=m;5===this.movement&&(this.mag=cr.to_radians(this.mag))};d.prototype.SetMovement=function(m){5===this.movement&&5!==m&&(this.mag=cr.to_degrees(this.mag));this.movement=m;this.init()};d.prototype.SetWave=function(m){this.wave=m};d.prototype.SetPhase=function(m){this.i=m*A%A;this.updateFromPhase()};d.prototype.UpdateInitialState=function(){this.init()};
q.acts=new d;h.prototype.CyclePosition=function(m){m.set_float(this.i/A)};h.prototype.Period=function(m){m.set_float(this.period)};h.prototype.Magnitude=function(m){5===this.movement?m.set_float(cr.to_degrees(this.mag)):m.set_float(this.mag)};h.prototype.Value=function(m){m.set_float(this.waveFunc(this.i)*this.mag)};q.exps=new h})();cr.behaviors.custom=function(b){this.runtime=b};
(function(){function b(){}function d(){}function h(){}var q=cr.behaviors.custom.prototype;q.Type=function(A,e){this.behavior=A;this.objtype=e;this.runtime=A.runtime};q.Type.prototype.onCreate=function(){};q.Instance=function(A,e){this.type=A;this.behavior=A.behavior;this.inst=e;this.runtime=A.runtime;this.cancelStep=this.dy=this.dx=0};var y=q.Instance.prototype;y.onCreate=function(){this.stepMode=this.properties[0];this.pxPerStep=this.properties[1];this.enabled=this.properties[2]};y.saveToJSON=function(){return{dx:this.dx,
dy:this.dy,cancelStep:this.cancelStep,enabled:this.enabled,stepMode:this.stepMode,pxPerStep:this.pxPerStep}};y.loadFromJSON=function(A){this.dx=A.dx;this.dy=A.dy;this.cancelStep=A.cancelStep;this.enabled=A.enabled;this.stepMode=A.stepMode;this.pxPerStep=A.pxPerStep};y.getSpeed=function(){return Math.sqrt(this.dx*this.dx+this.dy*this.dy)};y.getAngle=function(){return Math.atan2(this.dy,this.dx)};y.step=function(A,e,a){if(0!==A||0!==e){var c=this.inst.x,m=this.inst.y,u=Math.round(Math.sqrt(A*A+e*e)/
this.pxPerStep);0===u&&(u=1);var p;for(p=1;p<=u;p++){var x=p/u;this.inst.x=c+A*x;this.inst.y=m+e*x;this.inst.set_bbox_changed();this.runtime.trigger(a,this.inst);if(1===this.cancelStep){p--;x=p/u;this.inst.x=c+A*x;this.inst.y=m+e*x;this.inst.set_bbox_changed();break}else if(2===this.cancelStep)break}}};y.tick=function(){var A=this.runtime.getDt(this.inst),e=this.dx*A;A*=this.dy;0===this.dx&&0===this.dy||!this.enabled||(this.cancelStep=0,0===this.stepMode?(this.inst.x+=e,this.inst.y+=A):1===this.stepMode?
this.step(e,A,cr.behaviors.custom.prototype.cnds.OnCMStep):2===this.stepMode?(this.step(e,0,cr.behaviors.custom.prototype.cnds.OnCMHorizStep),this.cancelStep=0,this.step(0,A,cr.behaviors.custom.prototype.cnds.OnCMVertStep)):3===this.stepMode&&(this.step(0,A,cr.behaviors.custom.prototype.cnds.OnCMVertStep),this.cancelStep=0,this.step(e,0,cr.behaviors.custom.prototype.cnds.OnCMHorizStep)),this.inst.set_bbox_changed())};b.prototype.IsMoving=function(){return 0!=this.dx||0!=this.dy};b.prototype.CompareSpeed=
function(A,e,a){switch(A){case 0:var c=this.getSpeed();break;case 1:c=this.dx;break;case 2:c=this.dy}return cr.do_cmp(c,e,a)};b.prototype.OnCMStep=function(){return!0};b.prototype.OnCMHorizStep=function(){return!0};b.prototype.OnCMVertStep=function(){return!0};b.prototype.IsEnabled=function(){return this.enabled};q.cnds=new b;d.prototype.Stop=function(){this.dy=this.dx=0};d.prototype.Reverse=function(A){switch(A){case 0:this.dx*=-1;this.dy*=-1;break;case 1:this.dx*=-1;break;case 2:this.dy*=-1}};d.prototype.SetSpeed=
function(A,e){switch(A){case 0:A=this.getAngle();this.dx=Math.cos(A)*e;this.dy=Math.sin(A)*e;break;case 1:this.dx=e;break;case 2:this.dy=e}};d.prototype.Accelerate=function(A,e){var a=this.runtime.getDt(this.inst);e*=a;switch(A){case 0:A=this.getAngle();this.dx+=Math.cos(A)*e;this.dy+=Math.sin(A)*e;break;case 1:this.dx+=e;break;case 2:this.dy+=e}};d.prototype.AccelerateAngle=function(A,e){var a=this.runtime.getDt(this.inst);A*=a;e=cr.to_radians(e);this.dx+=Math.cos(e)*A;this.dy+=Math.sin(e)*A};d.prototype.AcceleratePos=
function(A,e,a){var c=this.runtime.getDt(this.inst);A*=c;e=Math.atan2(a-this.inst.y,e-this.inst.x);this.dx+=Math.cos(e)*A;this.dy+=Math.sin(e)*A};d.prototype.SetAngleOfMotion=function(A){A=cr.to_radians(A);var e=this.getSpeed();this.dx=Math.cos(A)*e;this.dy=Math.sin(A)*e};d.prototype.RotateAngleOfMotionClockwise=function(A){A=this.getAngle()+cr.to_radians(A);var e=this.getSpeed();this.dx=Math.cos(A)*e;this.dy=Math.sin(A)*e};d.prototype.RotateAngleOfMotionCounterClockwise=function(A){A=this.getAngle()-
cr.to_radians(A);var e=this.getSpeed();this.dx=Math.cos(A)*e;this.dy=Math.sin(A)*e};d.prototype.StopStepping=function(A){this.cancelStep=A+1};d.prototype.PushOutSolid=function(A){switch(A){case 0:var e=this.getAngle();A=Math.cos(e);e=Math.sin(e);this.runtime.pushOutSolid(this.inst,-A,-e,Math.max(3*this.getSpeed(),100));break;case 1:this.runtime.pushOutSolidNearest(this.inst);break;case 2:this.runtime.pushOutSolid(this.inst,0,-1,Math.max(3*Math.abs(this.dy),100));break;case 3:this.runtime.pushOutSolid(this.inst,
0,1,Math.max(3*Math.abs(this.dy),100));break;case 4:this.runtime.pushOutSolid(this.inst,-1,0,Math.max(3*Math.abs(this.dx),100));break;case 5:this.runtime.pushOutSolid(this.inst,1,0,Math.max(3*Math.abs(this.dx),100))}};d.prototype.PushOutSolidAngle=function(A){A=cr.to_radians(A);this.runtime.pushOutSolid(this.inst,Math.cos(A),Math.sin(A),Math.max(3*this.getSpeed(),100))};d.prototype.SetEnabled=function(A){this.enabled=1===A};q.acts=new d;h.prototype.Speed=function(A){A.set_float(this.getSpeed())};
h.prototype.MovingAngle=function(A){A.set_float(cr.to_degrees(this.getAngle()))};h.prototype.dx=function(A){A.set_float(this.dx)};h.prototype.dy=function(A){A.set_float(this.dy)};q.exps=new h})();cr.behaviors.Pin=function(b){this.runtime=b};
(function(){function b(){}function d(){}function h(){}var q=cr.behaviors.Pin.prototype;q.Type=function(A,e){this.behavior=A;this.objtype=e;this.runtime=A.runtime};q.Type.prototype.onCreate=function(){};q.Instance=function(A,e){this.type=A;this.behavior=A.behavior;this.inst=e;this.runtime=A.runtime};var y=q.Instance.prototype;y.onCreate=function(){this.pinObject=null;this.pinObjectUid=-1;this.mode=this.lastKnownAngle=this.theirStartAngle=this.myStartAngle=this.pinDist=this.pinAngle=0;var A=this;this.recycled||
(this.myDestroyCallback=function(e){A.onInstanceDestroyed(e)});this.runtime.addDestroyCallback(this.myDestroyCallback)};y.saveToJSON=function(){return{uid:this.pinObject?this.pinObject.uid:-1,pa:this.pinAngle,pd:this.pinDist,msa:this.myStartAngle,tsa:this.theirStartAngle,lka:this.lastKnownAngle,m:this.mode}};y.loadFromJSON=function(A){this.pinObjectUid=A.uid;this.pinAngle=A.pa;this.pinDist=A.pd;this.myStartAngle=A.msa;this.theirStartAngle=A.tsa;this.lastKnownAngle=A.lka;this.mode=A.m};y.afterLoad=
function(){this.pinObject=-1===this.pinObjectUid?null:this.runtime.getObjectByUID(this.pinObjectUid);this.pinObjectUid=-1};y.onInstanceDestroyed=function(A){this.pinObject==A&&(this.pinObject=null)};y.onDestroy=function(){this.pinObject=null;this.runtime.removeDestroyCallback(this.myDestroyCallback)};y.tick=function(){};y.tick2=function(){if(this.pinObject){this.lastKnownAngle!==this.inst.angle&&(this.myStartAngle=cr.clamp_angle(this.myStartAngle+(this.inst.angle-this.lastKnownAngle)));var A=this.inst.x,
e=this.inst.y;if(3===this.mode||4===this.mode){var a=cr.distanceTo(this.inst.x,this.inst.y,this.pinObject.x,this.pinObject.y);if(a>this.pinDist||4===this.mode&&a<this.pinDist)e=cr.angleTo(this.pinObject.x,this.pinObject.y,this.inst.x,this.inst.y),A=this.pinObject.x+Math.cos(e)*this.pinDist,e=this.pinObject.y+Math.sin(e)*this.pinDist}else A=this.pinObject.x+Math.cos(this.pinObject.angle+this.pinAngle)*this.pinDist,e=this.pinObject.y+Math.sin(this.pinObject.angle+this.pinAngle)*this.pinDist;this.lastKnownAngle=
a=cr.clamp_angle(this.myStartAngle+(this.pinObject.angle-this.theirStartAngle));0!==this.mode&&1!==this.mode&&3!==this.mode&&4!==this.mode||this.inst.x===A&&this.inst.y===e||(this.inst.x=A,this.inst.y=e,this.inst.set_bbox_changed());0!==this.mode&&2!==this.mode||this.inst.angle===a||(this.inst.angle=a,this.inst.set_bbox_changed())}};b.prototype.IsPinned=function(){return!!this.pinObject};q.cnds=new b;d.prototype.Pin=function(A,e){A&&(A=A.getFirstPicked(this.inst))&&(this.pinObject=A,this.pinAngle=
cr.angleTo(A.x,A.y,this.inst.x,this.inst.y)-A.angle,this.pinDist=cr.distanceTo(A.x,A.y,this.inst.x,this.inst.y),this.lastKnownAngle=this.myStartAngle=this.inst.angle,this.theirStartAngle=A.angle,this.mode=e)};d.prototype.Unpin=function(){this.pinObject=null};q.acts=new d;h.prototype.PinnedUID=function(A){A.set_int(this.pinObject?this.pinObject.uid:-1)};q.exps=new h})();cr.behaviors.destroy=function(b){this.runtime=b};
(function(){var b=cr.behaviors.destroy.prototype;b.Type=function(d,h){this.behavior=d;this.objtype=h;this.runtime=d.runtime};b.Type.prototype.onCreate=function(){};b.Instance=function(d,h){this.type=d;this.behavior=d.behavior;this.inst=h;this.runtime=d.runtime};b=b.Instance.prototype;b.onCreate=function(){};b.tick=function(){this.inst.update_bbox();var d=this.inst.bbox,h=this.inst.layer.layout;(0>d.right||0>d.bottom||d.left>h.width||d.top>h.height)&&this.runtime.DestroyInstance(this.inst)}})();
var easeOutBounceArray=[],easeInElasticArray=[],easeOutElasticArray=[],easeInOutElasticArray=[],easeInCircle=[],easeOutCircle=[],easeInOutCircle=[],easeInBack=[],easeOutBack=[],easeInOutBack=[],litetween_precision=1E4,updateLimit=0;function easeOutBouncefunc(b){return result=(b/=1)<1/2.75?7.5625*b*b:b<2/2.75?7.5625*(b-=1.5/2.75)*b+.75:b<2.5/2.75?7.5625*(b-=2.25/2.75)*b+.9375:7.5625*(b-=2.625/2.75)*b+.984375}function integerize(b,d){return Math.round(b/d*litetween_precision)}
function easeFunc(b,d,h,q,y,A,e){var a=0;switch(b){case 0:a=q*d/y+h;break;case 1:a=q*(d/=y)*d+h;break;case 2:a=-q*(d/=y)*(d-2)+h;break;case 3:a=1>(d/=y/2)?q/2*d*d+h:-q/2*(--d*(d-2)-1)+h;break;case 4:a=q*(d/=y)*d*d+h;break;case 5:a=q*((d=d/y-1)*d*d+1)+h;break;case 6:a=1>(d/=y/2)?q/2*d*d*d+h:q/2*((d-=2)*d*d+2)+h;break;case 7:a=q*(d/=y)*d*d*d+h;break;case 8:a=-q*((d=d/y-1)*d*d*d-1)+h;break;case 9:a=1>(d/=y/2)?q/2*d*d*d*d+h:-q/2*((d-=2)*d*d*d-2)+h;break;case 10:a=q*(d/=y)*d*d*d*d+h;break;case 11:a=q*
((d=d/y-1)*d*d*d*d+1)+h;break;case 12:a=1>(d/=y/2)?q/2*d*d*d*d*d+h:q/2*((d-=2)*d*d*d*d+2)+h;break;case 13:a=e.optimized?easeInCircle[integerize(d,y)]:-(Math.sqrt(1-d*d)-1);break;case 14:a=e.optimized?easeOutCircle[integerize(d,y)]:Math.sqrt(1-(d-1)*(d-1));break;case 15:a=e.optimized?easeInOutCircle[integerize(d,y)]:1>(d/=y/2)?-q/2*(Math.sqrt(1-d*d)-1)+h:q/2*(Math.sqrt(1-(d-=2)*d)+1)+h;break;case 16:e.optimized?a=easeInBack[integerize(d,y)]:(e=e.s,a=q*(d/=y)*d*((e+1)*d-e)+h);break;case 17:e.optimized?
a=easeOutBack[integerize(d,y)]:(e=e.s,a=q*((d=d/y-1)*d*((e+1)*d+e)+1)+h);break;case 18:e.optimized?a=easeInOutBack[integerize(d,y)]:(e=e.s,a=1>(d/=y/2)?q/2*d*d*(((e*=1.525)+1)*d-e)+h:q/2*((d-=2)*d*(((e*=1.525)+1)*d+e)+2)+h);break;case 19:e.optimized?a=easeInElasticArray[integerize(d,y)]:(a=e.a,b=e.p,d/=y,0==b&&(b=.3*y),0==a||a<Math.abs(q)?(a=q,e=b/4):e=b/(2*Math.PI)*Math.asin(q/a),a=-(a*Math.pow(2,10*--d)*Math.sin(2*(d*y-e)*Math.PI/b))+h);break;case 20:e.optimized?a=easeOutElasticArray[integerize(d,
y)]:(a=e.a,b=e.p,d/=y,0==b&&(b=.3*y),0==a||a<Math.abs(q)?(a=q,e=b/4):e=b/(2*Math.PI)*Math.asin(q/a),a=a*Math.pow(2,-10*d)*Math.sin(2*(d*y-e)*Math.PI/b)+q+h);break;case 21:e.optimized?a=easeInOutElasticArray[integerize(d,y)]:(a=e.a,b=e.p,d/=y/2,0==b&&(b=.3*y*1.5),0==a||a<Math.abs(q)?(a=q,e=b/4):e=b/(2*Math.PI)*Math.asin(q/a),a=1>d?-.5*a*Math.pow(2,10*--d)*Math.sin(2*(d*y-e)*Math.PI/b)+h:a*Math.pow(2,-10*--d)*Math.sin(2*(d*y-e)*Math.PI/b)*.5+q+h);break;case 22:a=e.optimized?q-easeOutBounceArray[integerize(y-
d,y)]+h:q-easeOutBouncefunc(y-d/y)+h;break;case 23:a=e.optimized?easeOutBounceArray[integerize(d,y)]:easeOutBouncefunc(d/y);break;case 24:a=e.optimized?d<y/2?.5*(q-easeOutBounceArray[integerize(y-2*d,y)]+h)+h:.5*easeOutBounceArray[integerize(2*d-y,y)]+.5*q+h:d<y/2?.5*(q-easeOutBouncefunc(y-2*d)+h)+h:.5*easeOutBouncefunc((2*d-y)/y)+.5*q+h;break;case 25:d=d/y/2;a=2*d*d*(3-2*d);break;case 26:d=(d/y+1)/2;a=2*d*d*(3-2*d)-1;break;case 27:d/=y,a=d*d*(3-2*d)}return A?q-h-a:a}
(function(){for(var b,d,h,q,y=0;y<=litetween_precision;y++)h=y/litetween_precision,b=(h/=1)<1/2.75?7.5625*h*h:h<2/2.75?7.5625*(h-=1.5/2.75)*h+.75:h<2.5/2.75?7.5625*(h-=2.25/2.75)*h+.9375:7.5625*(h-=2.625/2.75)*h+.984375,easeOutBounceArray[y]=b,h=y/litetween_precision,d=b=0,h/=1,0==d&&(d=.3),0==b||1>b?(b=1,q=d/4):q=d/(2*Math.PI)*Math.asin(1/b),b=-(b*Math.pow(2,10*--h)*Math.sin(2*(1*h-q)*Math.PI/d)),easeInElasticArray[y]=b,h=y/litetween_precision,d=b=0,h/=1,0==d&&(d=.3),0==b||1>b?(b=1,q=d/4):q=d/(2*
Math.PI)*Math.asin(1/b),b=b*Math.pow(2,-10*h)*Math.sin(2*(1*h-q)*Math.PI/d)+1,easeOutElasticArray[y]=b,h=y/litetween_precision,d=b=0,h/=.5,0==d&&(d=.3*1.5),0==b||1>b?(b=1,q=d/4):q=d/(2*Math.PI)*Math.asin(1/b),b=1>h?-.5*b*Math.pow(2,10*--h)*Math.sin(2*(1*h-q)*Math.PI/d):b*Math.pow(2,-10*--h)*Math.sin(2*(1*h-q)*Math.PI/d)*.5+1,easeInOutElasticArray[y]=b,h=y/litetween_precision,easeInCircle[y]=-(Math.sqrt(1-h*h)-1),h=y/litetween_precision,easeOutCircle[y]=Math.sqrt(1-(h-1)*(h-1)),h=y/litetween_precision,
b=1>(h/=.5)?-.5*(Math.sqrt(1-h*h)-1):.5*(Math.sqrt(1-(h-=2)*h)+1),easeInOutCircle[y]=b,h=y/litetween_precision,q=0,0==q&&(q=1.70158),b=(h/=1)*h*((q+1)*h-q),easeInBack[y]=b,h=y/litetween_precision,q=0,0==q&&(q=1.70158),b=(h=h/1-1)*h*((q+1)*h+q)+1,easeOutBack[y]=b,h=y/litetween_precision,q=0,0==q&&(q=1.70158),b=1>(h/=.5)?.5*h*h*(((q*=1.525)+1)*h-q):.5*((h-=2)*h*(((q*=1.525)+1)*h+q)+2),easeInOutBack[y]=b})();
var TweenObject=function(){return function(b,d,h,q,y,A,e){this.name=b;this.value=0;this.setInitial(q);this.setTarget(y);this.easefunc=h;this.tweened=d;this.duration=A;this.state=this.progress=0;this.onReverseEnd=this.onReverseStart=this.onEnd=this.onStart=!1;this.lastKnownValue2=this.lastKnownValue=0;this.enforce=e;this.pingpong=1;this.flipEase=!1;this.easingparam=[];this.lastState=1;for(b=0;28>b;b++)this.easingparam[b]={},this.easingparam[b].a=0,this.easingparam[b].p=0,this.easingparam[b].t=0,this.easingparam[b].s=
0,this.easingparam[b].optimized=!0}}();
(function(){TweenObject.prototype={};TweenObject.prototype.flipTarget=function(){var b=this.initialparam1,d=this.initialparam2;this.initialparam1=this.targetparam1;this.initialparam2=this.targetparam2;this.targetparam1=b;this.targetparam2=d;this.lastKnownValue2=this.lastKnownValue=0};TweenObject.prototype.setInitial=function(b){this.initialparam1=parseFloat(b.split(",")[0]);this.initialparam2=parseFloat(b.split(",")[1]);this.lastKnownValue2=this.lastKnownValue=0};TweenObject.prototype.setTarget=function(b){this.targetparam1=
parseFloat(b.split(",")[0]);this.targetparam2=parseFloat(b.split(",")[1]);isNaN(this.targetparam2)&&(this.targetparam2=this.targetparam1)};TweenObject.prototype.OnTick=function(b){if(0===this.state)return-1;1===this.state&&(this.progress+=b);2===this.state&&(this.progress-=b);3===this.state&&(this.state=0);if(4===this.state||6===this.state)this.progress+=b*this.pingpong;5===this.state&&(this.progress+=b*this.pingpong);return 0>this.progress?(this.progress=0,4===this.state?this.pingpong=1:6===this.state?
(this.pingpong=1,this.flipEase=!1):this.state=0,this.onReverseEnd=!0,0):this.progress>this.duration?(this.progress=this.duration,4===this.state?this.pingpong=-1:6===this.state?(this.pingpong=-1,this.flipEase=!0):5===this.state?this.progress=0:this.state=0,this.onEnd=!0,1):this.flipEase?easeFunc(this.easefunc,this.duration-this.progress,0,1,this.duration,this.flipEase,this.easingparam[this.easefunc]):easeFunc(this.easefunc,this.progress,0,1,this.duration,this.flipEase,this.easingparam[this.easefunc])}})();
function trim(b){return b.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}cr.behaviors.lunarray_LiteTween=function(b){this.runtime=b};
(function(){var b=cr.behaviors.lunarray_LiteTween.prototype;b.Type=function(h,q){this.behavior=h;this.objtype=q;this.runtime=h.runtime};b.Type.prototype.onCreate=function(){};b.Instance=function(h,q){this.type=h;this.behavior=h.behavior;this.inst=q;this.runtime=h.runtime;this.i=0};var d=b.Instance.prototype;d.onCreate=function(){this.playmode=this.properties[0];this.active=1==this.playmode||2==this.playmode||3==this.playmode||4==this.playmode;this.tweened=this.properties[1];this.easing=this.properties[2];
this.target=this.properties[3];this.targetmode=this.properties[4];this.useCurrent=!1;1===this.targetmode&&(this.target="relative("+this.target+")");this.duration=this.properties[5];this.enforce=1===this.properties[6];this.value=0;this.tween_list={};this.addToTweenList("default",this.tweened,this.easing,"current",this.target,this.duration,this.enforce);1===this.properties[0]&&this.startTween(0);2===this.properties[0]&&this.startTween(2);3===this.properties[0]&&this.startTween(3);4===this.properties[0]&&
this.startTween(4)};d.parseCurrent=function(h,q){void 0===q&&(q="current");var y=trim(q);q=trim(q);var A=this.value;if("current"===q)switch(h){case 0:y=this.inst.x+","+this.inst.y;break;case 1:y=this.inst.width+","+this.inst.height;break;case 2:y=this.inst.width+","+this.inst.height;break;case 3:y=this.inst.width+","+this.inst.height;break;case 4:y=cr.to_degrees(this.inst.angle)+","+cr.to_degrees(this.inst.angle);break;case 5:y=100*this.inst.opacity+","+100*this.inst.opacity;break;case 6:y=A+","+
A;break;case 7:y=this.inst.x+","+this.inst.y;break;case 8:y=this.inst.x+","+this.inst.y;break;case 9:y=void 0!==this.inst.curFrame?this.inst.width/this.inst.curFrame.width+","+this.inst.height/this.inst.curFrame.height:"1,1"}if("relative"===q.substring(0,8)){if(q=q.match(/\((.*?)\)/))var e=parseFloat(q[1].split(",")[0]),a=parseFloat(q[1].split(",")[1]);isNaN(e)&&(e=0);isNaN(a)&&(a=0);switch(h){case 0:y=this.inst.x+e+","+(this.inst.y+a);break;case 1:y=this.inst.width+e+","+(this.inst.height+a);break;
case 2:y=this.inst.width+e+","+(this.inst.height+a);break;case 3:y=this.inst.width+e+","+(this.inst.height+a);break;case 4:y=cr.to_degrees(this.inst.angle)+e+","+(cr.to_degrees(this.inst.angle)+a);break;case 5:y=100*this.inst.opacity+e+","+(100*this.inst.opacity+a);break;case 6:y=A+e+","+A+e;break;case 7:y=this.inst.x+e+","+this.inst.y;break;case 8:y=this.inst.x+","+(this.inst.y+e);break;case 9:y=e+","+a}}return y};d.addToTweenList=function(h,q,y,A,e,a,c){A=this.parseCurrent(q,A);e=this.parseCurrent(q,
e);void 0!==this.tween_list[h]&&delete this.tween_list[h];this.tween_list[h]=new TweenObject(h,q,y,A,e,a,c);this.tween_list[h].dt=0};d.saveToJSON=function(){JSON.stringify(this.tween_list["default"]);return{playmode:this.playmode,active:this.active,tweened:this.tweened,easing:this.easing,target:this.target,targetmode:this.targetmode,useCurrent:this.useCurrent,duration:this.duration,enforce:this.enforce,value:this.value,tweenlist:JSON.stringify(this.tween_list["default"])}};TweenObject.Load=function(h,
q,y,A,e,a,c,m){q=new TweenObject(q,y,A,e,a,c,m);for(var u in h)q[u]=h[u];return q};d.loadFromJSON=function(h){var q=JSON.parse(h.tweenlist);q=TweenObject.Load(q,q.name,q.tweened,q.easefunc,q.initialparam1+","+q.initialparam2,q.targetparam1+","+q.targetparam2,q.duration,q.enforce);this.tween_list["default"]=q;this.playmode=h.playmode;this.active=h.active;this.movement=h.tweened;this.easing=h.easing;this.target=h.target;this.targetmode=h.targetmode;this.useCurrent=h.useCurrent;this.duration=h.duration;
this.enforce=h.enforce;this.value=h.value};d.setProgressTo=function(h){1<h&&(h=1);0>h&&(h=0);for(var q in this.tween_list){var y=this.tween_list[q];y.lastKnownValue=0;y.lastKnownValue2=0;y.state=3;y.progress=h*y.duration;var A=y.OnTick(0);this.updateTween(y,A)}};d.startTween=function(h){for(var q in this.tween_list){var y=this.tween_list[q];if(this.useCurrent){var A=this.parseCurrent(y.tweened,"current"),e=this.parseCurrent(y.tweened,this.target);y.setInitial(A);y.setTarget(e)}0===h&&(y.progress=
1E-6,y.lastKnownValue=0,y.lastKnownValue2=0,y.onStart=!0,y.state=1);1===h&&(y.state=y.lastState);if(2===h||4===h)y.progress=1E-6,y.lastKnownValue=0,y.lastKnownValue2=0,y.onStart=!0,2==h&&(y.state=4),4==h&&(y.state=6);3===h&&(y.progress=1E-6,y.lastKnownValue=0,y.lastKnownValue2=0,y.onStart=!0,y.state=5)}};d.stopTween=function(h){for(var q in this.tween_list){var y=this.tween_list[q];3!=y.state&&0!=y.state&&(y.lastState=y.state);1===h&&(y.progress=0);2===h&&(y.progress=y.duration);y.state=3;var A=y.OnTick(0);
this.updateTween(y,A)}};d.reverseTween=function(h){for(var q in this.tween_list){var y=this.tween_list[q];1===h&&(y.progress=y.duration,y.lastKnownValue=0,y.lastKnownValue2=0,y.onReverseStart=!0);y.state=2}};d.updateTween=function(h,q){if(0===h.tweened)h.enforce?(this.inst.x=h.initialparam1+(h.targetparam1-h.initialparam1)*q,this.inst.y=h.initialparam2+(h.targetparam2-h.initialparam2)*q):(this.inst.x+=(h.targetparam1-h.initialparam1)*q-h.lastKnownValue,this.inst.y+=(h.targetparam2-h.initialparam2)*
q-h.lastKnownValue2,h.lastKnownValue=(h.targetparam1-h.initialparam1)*q,h.lastKnownValue2=(h.targetparam2-h.initialparam2)*q);else if(1===h.tweened)h.enforce?(this.inst.width=h.initialparam1+(h.targetparam1-h.initialparam1)*q,this.inst.height=h.initialparam2+(h.targetparam2-h.initialparam2)*q):(this.inst.width+=(h.targetparam1-h.initialparam1)*q-h.lastKnownValue,this.inst.height+=(h.targetparam2-h.initialparam2)*q-h.lastKnownValue2,h.lastKnownValue=(h.targetparam1-h.initialparam1)*q,h.lastKnownValue2=
(h.targetparam2-h.initialparam2)*q);else if(2===h.tweened)h.enforce?this.inst.width=h.initialparam1+(h.targetparam1-h.initialparam1)*q:(this.inst.width+=(h.targetparam1-h.initialparam1)*q-h.lastKnownValue,h.lastKnownValue=(h.targetparam1-h.initialparam1)*q);else if(3===h.tweened)h.enforce?this.inst.height=h.initialparam2+(h.targetparam2-h.initialparam2)*q:(this.inst.height+=(h.targetparam2-h.initialparam2)*q-h.lastKnownValue2,h.lastKnownValue2=(h.targetparam2-h.initialparam2)*q);else if(4===h.tweened)if(h.enforce){var y=
h.initialparam1+(h.targetparam1-h.initialparam1)*q;this.inst.angle=cr.clamp_angle(cr.to_radians(y))}else y=(h.targetparam1-h.initialparam1)*q-h.lastKnownValue,this.inst.angle=cr.clamp_angle(this.inst.angle+cr.to_radians(y)),h.lastKnownValue=(h.targetparam1-h.initialparam1)*q;else if(5===h.tweened)h.enforce?this.inst.opacity=(h.initialparam1+(h.targetparam1-h.initialparam1)*q)/100:(this.inst.opacity+=((h.targetparam1-h.initialparam1)*q-h.lastKnownValue)/100,h.lastKnownValue=(h.targetparam1-h.initialparam1)*
q);else if(6===h.tweened)h.enforce?this.value=h.initialparam1+(h.targetparam1-h.initialparam1)*q:(this.value+=(h.targetparam1-h.initialparam1)*q-h.lastKnownValue,h.lastKnownValue=(h.targetparam1-h.initialparam1)*q);else if(7===h.tweened)h.enforce?this.inst.x=h.initialparam1+(h.targetparam1-h.initialparam1)*q:(this.inst.x+=(h.targetparam1-h.initialparam1)*q-h.lastKnownValue,h.lastKnownValue=(h.targetparam1-h.initialparam1)*q);else if(8===h.tweened)h.enforce?this.inst.y=h.initialparam2+(h.targetparam2-
h.initialparam2)*q:(this.inst.y+=(h.targetparam2-h.initialparam2)*q-h.lastKnownValue2,h.lastKnownValue2=(h.targetparam2-h.initialparam2)*q);else if(9===h.tweened){y=h.initialparam1+(h.targetparam1-h.initialparam1)*q;var A=h.initialparam2+(h.targetparam2-h.initialparam2)*q;0>this.inst.width&&(y=h.initialparam1+(h.targetparam1+h.initialparam1)*-q);0>this.inst.height&&(A=h.initialparam2+(h.targetparam2+h.initialparam2)*-q);h.enforce?(this.inst.width=this.inst.curFrame.width*y,this.inst.height=this.inst.curFrame.height*
A):(0>this.inst.width?(this.inst.width=this.inst.width/(-1+h.lastKnownValue)*y,h.lastKnownValue=y+1):(this.inst.width=this.inst.width/(1+h.lastKnownValue)*y,h.lastKnownValue=y-1),0>this.inst.height?(this.inst.height=this.inst.height/(-1+h.lastKnownValue2)*A,h.lastKnownValue2=A+1):(this.inst.height=this.inst.height/(1+h.lastKnownValue2)*A,h.lastKnownValue2=A-1))}this.inst.set_bbox_changed()};d.tick=function(){var h=this.runtime.getDt(this.inst),q=this.tween_list["default"];0!==q.state&&(q.onStart&&
(this.runtime.trigger(cr.behaviors.lunarray_LiteTween.prototype.cnds.OnStart,this.inst),q.onStart=!1),q.onReverseStart&&(this.runtime.trigger(cr.behaviors.lunarray_LiteTween.prototype.cnds.OnReverseStart,this.inst),q.onReverseStart=!1),this.active=1==q.state||2==q.state||4==q.state||5==q.state||6==q.state,h=q.OnTick(h),this.updateTween(q,h),q.onEnd&&(this.runtime.trigger(cr.behaviors.lunarray_LiteTween.prototype.cnds.OnEnd,this.inst),q.onEnd=!1),q.onReverseEnd&&(this.runtime.trigger(cr.behaviors.lunarray_LiteTween.prototype.cnds.OnReverseEnd,
this.inst),q.onReverseEnd=!1))};b.cnds={};d=b.cnds;d.IsActive=function(){return 0!==this.tween_list["default"].state};d.IsReversing=function(){return 2==this.tween_list["default"].state};d.CompareProgress=function(h,q){var y=this.tween_list["default"];return cr.do_cmp(y.progress/y.duration,h,q)};d.OnThreshold=function(h,q){var y=this.tween_list["default"];this.threshold=cr.do_cmp(y.progress/y.duration,h,q);if(h=this.oldthreshold!=this.threshold&&this.threshold)this.oldthreshold=this.threshold;return h};
d.OnStart=function(){return void 0===this.tween_list["default"]?!1:this.tween_list["default"].onStart};d.OnReverseStart=function(){return void 0===this.tween_list["default"]?!1:this.tween_list["default"].onReverseStart};d.OnEnd=function(){return void 0===this.tween_list["default"]?!1:this.tween_list["default"].onEnd};d.OnReverseEnd=function(){return void 0===this.tween_list["default"]?!1:this.tween_list["default"].onReverseEnd};b.acts={};d=b.acts;d.Start=function(h,q){this.oldthreshold=this.threshold=
!1;this.useCurrent=1==q;this.startTween(h)};d.Stop=function(h){this.stopTween(h)};d.Reverse=function(h){this.oldthreshold=this.threshold=!1;this.reverseTween(h)};d.ProgressTo=function(h){this.setProgressTo(h)};d.SetDuration=function(h){isNaN(h)||0>h||void 0===this.tween_list["default"]||(this.tween_list["default"].duration=h)};d.SetEnforce=function(h){void 0!==this.tween_list["default"]&&(this.tween_list["default"].enforce=1===h)};d.SetInitial=function(h){void 0!==this.tween_list["default"]&&(h=this.parseCurrent(this.tween_list["default"].tweened,
h),this.tween_list["default"].setInitial(h))};d.SetTarget=function(h,q,y){if(void 0!==this.tween_list["default"]&&!isNaN(y)){var A=this.tween_list["default"],e=y+"";this.targetmode=q;var a="",c="";if(1===q){this.target="relative("+e+")";switch(h){case 0:a=this.inst.x+y;c=A.targetparam2;break;case 1:a=A.targetparam1;c=this.inst.y+y;break;case 2:c=a=""+cr.to_degrees(this.inst.angle+cr.to_radians(y));break;case 3:c=a=""+100*this.inst.opacity+y;break;case 4:a=this.inst.width+y;c=A.targetparam2;break;
case 5:a=A.targetparam1;c=this.inst.height+y;break;case 6:c=a=y}e=a+","+c}else{switch(h){case 0:a=y;c=A.targetparam2;break;case 1:a=A.targetparam1;c=y;break;case 2:c=a=y;break;case 3:c=a=y;break;case 4:a=y;c=A.targetparam2;break;case 5:a=A.targetparam1;c=y;break;case 6:c=a=y}this.target=e=a+","+c}h=this.parseCurrent(this.tween_list["default"].tweened,"current");e=this.parseCurrent(this.tween_list["default"].tweened,e);A.setInitial(h);A.setTarget(e)}};d.SetTweenedProperty=function(h){void 0!==this.tween_list["default"]&&
(this.tween_list["default"].tweened=h)};d.SetEasing=function(h){void 0!==this.tween_list["default"]&&(this.tween_list["default"].easefunc=h)};d.SetEasingParam=function(h,q,y,A,e){void 0!==this.tween_list["default"]&&(this.tween_list["default"].easingparam[h].optimized=!1,this.tween_list["default"].easingparam[h].a=q,this.tween_list["default"].easingparam[h].p=y,this.tween_list["default"].easingparam[h].t=A,this.tween_list["default"].easingparam[h].s=e)};d.ResetEasingParam=function(){void 0!==this.tween_list["default"]&&
(this.tween_list["default"].optimized=!0)};d.SetValue=function(h){var q=this.tween_list["default"];this.value=h;6===q.tweened&&q.setInitial(this.parseCurrent(q.tweened,"current"))};d.SetParameter=function(h,q,y,A,e){if(void 0===this.tween_list["default"])this.addToTweenList("default",h,q,initial,y,A,e,0);else{var a=this.tween_list["default"];a.tweened=h;a.easefunc=q;a.setInitial(this.parseCurrent(h,"current"));a.setTarget(this.parseCurrent(h,y));a.duration=A;a.enforce=1===e}};b.exps={};b=b.exps;b.State=
function(h){var q="N/A";switch(this.tween_list["default"].state){case 0:q="paused";break;case 1:q="playing";break;case 2:q="reversing";break;case 3:q="seeking"}h.set_string(q)};b.Progress=function(h){h.set_float(this.tween_list["default"].progress/this.tween_list["default"].duration)};b.Duration=function(h){h.set_float(this.tween_list["default"].duration)};b.Target=function(h){var q=this.tween_list["default"],y="N/A";switch(q.tweened){case 0:y=q.targetparam1;break;case 1:y=q.targetparam2;break;case 2:y=
q.targetparam1;break;case 3:y=q.targetparam1;break;case 4:y=q.targetparam1;break;case 5:y=q.targetparam2;break;case 6:y=q.targetparam1}h.set_float(y)};b.Value=function(h){h.set_float(this.value)};b.Tween=function(h,q,y,A,e){A=1<A?1:A;e=easeFunc(e,0>A?0:A,0,1,1,!1,!1);h.set_float(q+e*(y-q))}})();
cr.getObjectRefTable=function(){return[cr.plugins_.Mouse,cr.plugins_.TiledBg,cr.plugins_.Sprite,cr.plugins_.Touch,cr.plugins_.Text,cr.behaviors.Fade,cr.plugins_.WebStorage,cr.plugins_.Audio,cr.plugins_.Browser,cr.behaviors.Sin,cr.behaviors.custom,cr.behaviors.Pin,cr.behaviors.destroy,cr.plugins_.Keyboard,cr.behaviors.lunarray_LiteTween,cr.plugins_.Arr,cr.plugins_.Spritefont2,cr.plugins_.TextBox,cr.plugins_.AJAX,cr.system_object.prototype.cnds.IsGroupActive,cr.system_object.prototype.cnds.OnLayoutStart,
cr.behaviors.custom.prototype.acts.SetSpeed,cr.system_object.prototype.exps.random,cr.plugins_.Sprite.prototype.acts.SetInstanceVar,cr.plugins_.Sprite.prototype.cnds.OnCollision,cr.plugins_.Sprite.prototype.acts.SetMirrored,cr.behaviors.custom.prototype.acts.Reverse,cr.plugins_.Sprite.prototype.acts.SetPos,cr.system_object.prototype.cnds.Every,cr.plugins_.Sprite.prototype.acts.Spawn,cr.plugins_.Audio.prototype.acts.Play,cr.plugins_.Sprite.prototype.cnds.IsOutsideLayout,cr.behaviors.custom.prototype.acts.AccelerateAngle,
cr.behaviors.Fade.prototype.acts.StartFade,cr.system_object.prototype.cnds.LayerCmpOpacity,cr.system_object.prototype.acts.SetLayerOpacity,cr.system_object.prototype.cnds.EveryTick,cr.plugins_.Text.prototype.acts.SetText,cr.plugins_.Keyboard.prototype.cnds.IsKeyDown,cr.plugins_.Sprite.prototype.acts.Destroy,cr.plugins_.Touch.prototype.cnds.OnTouchStart,cr.system_object.prototype.cnds.CompareVar,cr.plugins_.Touch.prototype.cnds.IsTouchingObject,cr.behaviors.Sin.prototype.acts.SetEnabled,cr.behaviors.custom.prototype.acts.SetAngleOfMotion,
cr.plugins_.Sprite.prototype.exps.Angle,cr.system_object.prototype.acts.SetVar,cr.plugins_.Sprite.prototype.acts.SetAnim,cr.plugins_.Sprite.prototype.cnds.IsOverlapping,cr.plugins_.Sprite.prototype.acts.SetAngle,cr.plugins_.Sprite.prototype.exps.ImagePointX,cr.plugins_.Sprite.prototype.exps.ImagePointY,cr.plugins_.Sprite.prototype.acts.SetWidth,cr.system_object.prototype.exps.distance,cr.plugins_.Sprite.prototype.exps.X,cr.plugins_.Sprite.prototype.exps.Y,cr.system_object.prototype.cnds.Compare,cr.behaviors.Pin.prototype.acts.Pin,
cr.behaviors.Pin.prototype.cnds.IsPinned,cr.system_object.prototype.acts.AddVar,cr.plugins_.Text.prototype.acts.SetAngle,cr.system_object.prototype.acts.SubVar,cr.plugins_.Audio.prototype.acts.Stop,cr.system_object.prototype.acts.Wait,cr.system_object.prototype.acts.GoToLayout,cr.plugins_.Touch.prototype.cnds.OnTouchObject,cr.plugins_.Sprite.prototype.acts.ToggleBoolInstanceVar,cr.plugins_.Sprite.prototype.cnds.IsBoolInstanceVarSet,cr.plugins_.Audio.prototype.acts.SetSilent,cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
cr.system_object.prototype.cnds.Else,cr.system_object.prototype.acts.ResetGlobals,cr.plugins_.Sprite.prototype.exps.Count,cr.plugins_.Sprite.prototype.cnds.IsOnLayer,cr.system_object.prototype.cnds.TriggerOnce,cr.system_object.prototype.exps.choose,cr.system_object.prototype.exps.layeropacity,cr.system_object.prototype.exps.int,cr.plugins_.Sprite.prototype.acts.SubInstanceVar,cr.system_object.prototype.exps.dt,cr.plugins_.Spritefont2.prototype.cnds.CompareInstanceVar,cr.plugins_.Spritefont2.prototype.acts.SetText,
cr.system_object.prototype.exps.zeropad,cr.plugins_.Sprite.prototype.cnds.CompareInstanceVar,cr.system_object.prototype.acts.CreateObject,cr.plugins_.TextBox.prototype.acts.SetVisible,cr.plugins_.WebStorage.prototype.exps.LocalValue,cr.plugins_.WebStorage.prototype.acts.StoreLocal,cr.system_object.prototype.exps.newline,cr.plugins_.TextBox.prototype.cnds.OnTextChanged,cr.plugins_.TextBox.prototype.acts.SetEnabled,cr.system_object.prototype.cnds.RegexTest,cr.plugins_.TextBox.prototype.exps.Text,cr.plugins_.Sprite.prototype.acts.SetVisible,
cr.system_object.prototype.exps.len,cr.plugins_.TextBox.prototype.acts.SetText,cr.system_object.prototype.exps.left,cr.system_object.prototype.exps.urlencode,cr.system_object.prototype.exps.floor,cr.system_object.prototype.exps.mid,cr.plugins_.AJAX.prototype.acts.Post,cr.plugins_.Text.prototype.acts.SetVisible,cr.plugins_.Audio.prototype.acts.PlayByName,cr.plugins_.WebStorage.prototype.cnds.LocalStorageExists,cr.plugins_.Sprite.prototype.cnds.CompareY,cr.plugins_.Touch.prototype.cnds.OnTapGestureObject,
cr.behaviors.lunarray_LiteTween.prototype.acts.Start,cr.plugins_.Sprite.prototype.acts.SetBoolInstanceVar,cr.plugins_.TiledBg.prototype.acts.SetSize,cr.system_object.prototype.exps.layoutwidth,cr.system_object.prototype.exps.layoutheight,cr.plugins_.Sprite.prototype.acts.SetPosToObject,cr.behaviors.lunarray_LiteTween.prototype.cnds.OnEnd,cr.plugins_.AJAX.prototype.cnds.OnProgress,cr.plugins_.AJAX.prototype.cnds.OnComplete,cr.plugins_.AJAX.prototype.exps.LastData]};
self.C3_JsPropNameTable=[{mouse:0},{bgPlay:0},{HUDBg:0},{divider:0},{walls:0},{Touch:0},{Score:0},{Text3:0},{replay:0},{home:0},{Panel:0},{GO_Score:0},{GO_Best:0},{Fade:0},{Fade2:0},{Transition:0},{WebStorage:0},{Audio:0},{Browser:0},{touchPLAY:0},{Menu_Best:0},{Sine:0},{Title:0},{music:0},{Text5:0},{CustomMovement:0},{Hook:0},{Rope:0},{GhostPlace:0},{Pin:0},{Fish_big:0},{Bomb:0},{DestroyOutsideLayout:0},{explode:0},{Fish_medium:0},{CentralScore:0},{Fish_Orange:0},{Custom:0},{Sine3:0},{Smalldolphin:0},
{Bigoctopus:0},{Keyboard:0},{ScoreSpawner:0},{Spawner:0},{right_limit:0},{left_limit:0},{bg:0},{seaBottom:0},{seaBottom2:0},{seaBottom3:0},{seaBottom4:0},{seaBottom5:0},{bubbles:0},{tiny_fish:0},{tiny_fish2:0},{fisherman:0},{Sprite:0},{help:0},{LiteTween:0},{LiteTween2:0},{instructions:0},{cross:0},{opacity:0},{bubble_menu:0},{bottle:0},{zd:0},{SpriteFont_Yellow:0},{CentralScore4:0},{Display:0},{log:0},{NameText:0},{NameInput:0},{EmailText:0},{EmailInput:0},{PhoneText:0},{PhoneInput:0},{Top_10:0},
{submit_button:0},{Confirmation:0},{AJAX:0},{decor:0},{High:0},{Top10:0},{Temp:0},{bubble_menu2:0},{home2:0},{winner:0},{Sprite2:0},{download:0},{Buttons:0},{Objects:0},{octopus:0},{BarrelsandBomb:0},{input:0},{Fish:0},{Point:0},{BestScore:0},{Speed:0},{RopeState:0},{hook_speed:0},{web_app_url:0},{s:0},{value0:0},{value1:0},{value2:0},{sum:0},{string0:0},{string1:0},{string2:0}];
